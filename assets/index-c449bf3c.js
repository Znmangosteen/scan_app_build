(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))d(p);new MutationObserver(p=>{for(const v of p)if(v.type==="childList")for(const b of v.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&d(b)}).observe(document,{childList:!0,subtree:!0});function a(p){const v={};return p.integrity&&(v.integrity=p.integrity),p.referrerPolicy&&(v.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?v.credentials="include":p.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function d(p){if(p.ep)return;p.ep=!0;const v=a(p);fetch(p.href,v)}})();function Gi(u,e){const a=Object.create(null),d=u.split(",");for(let p=0;p<d.length;p++)a[d[p]]=!0;return e?p=>!!a[p.toLowerCase()]:p=>!!a[p]}const Tt={},we=[],Vt=()=>{},jn=()=>!1,Bn=/^on[^a-z]/,fi=u=>Bn.test(u),Vi=u=>u.startsWith("onUpdate:"),Dt=Object.assign,zi=(u,e)=>{const a=u.indexOf(e);a>-1&&u.splice(a,1)},Wn=Object.prototype.hasOwnProperty,bt=(u,e)=>Wn.call(u,e),gt=Array.isArray,Be=u=>di(u)==="[object Map]",Un=u=>di(u)==="[object Set]",pt=u=>typeof u=="function",It=u=>typeof u=="string",Xi=u=>typeof u=="symbol",Et=u=>u!==null&&typeof u=="object",Gr=u=>Et(u)&&pt(u.then)&&pt(u.catch),Nn=Object.prototype.toString,di=u=>Nn.call(u),Hn=u=>di(u).slice(8,-1),Gn=u=>di(u)==="[object Object]",Yi=u=>It(u)&&u!=="NaN"&&u[0]!=="-"&&""+parseInt(u,10)===u,ii=Gi(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),gi=u=>{const e=Object.create(null);return a=>e[a]||(e[a]=u(a))},Vn=/-(\w)/g,Se=gi(u=>u.replace(Vn,(e,a)=>a?a.toUpperCase():"")),zn=/\B([A-Z])/g,Me=gi(u=>u.replace(zn,"-$1").toLowerCase()),Vr=gi(u=>u.charAt(0).toUpperCase()+u.slice(1)),xi=gi(u=>u?`on${Vr(u)}`:""),Ne=(u,e)=>!Object.is(u,e),Si=(u,e)=>{for(let a=0;a<u.length;a++)u[a](e)},oi=(u,e,a)=>{Object.defineProperty(u,e,{configurable:!0,enumerable:!1,value:a})},Xn=u=>{const e=parseFloat(u);return isNaN(e)?u:e};let fr;const Fi=()=>fr||(fr=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function qi(u){if(gt(u)){const e={};for(let a=0;a<u.length;a++){const d=u[a],p=It(d)?Jn(d):qi(d);if(p)for(const v in p)e[v]=p[v]}return e}else{if(It(u))return u;if(Et(u))return u}}const Yn=/;(?![^(]*\))/g,qn=/:([^]+)/,Kn=/\/\*[^]*?\*\//g;function Jn(u){const e={};return u.replace(Kn,"").split(Yn).forEach(a=>{if(a){const d=a.split(qn);d.length>1&&(e[d[0].trim()]=d[1].trim())}}),e}function Ki(u){let e="";if(It(u))e=u;else if(gt(u))for(let a=0;a<u.length;a++){const d=Ki(u[a]);d&&(e+=d+" ")}else if(Et(u))for(const a in u)u[a]&&(e+=a+" ");return e.trim()}const $n="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Qn=Gi($n);function zr(u){return!!u||u===""}let Nt;class Zn{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Nt,!e&&Nt&&(this.index=(Nt.scopes||(Nt.scopes=[])).push(this)-1)}get active(){return this._active}run(e){if(this._active){const a=Nt;try{return Nt=this,e()}finally{Nt=a}}}on(){Nt=this}off(){Nt=this.parent}stop(e){if(this._active){let a,d;for(a=0,d=this.effects.length;a<d;a++)this.effects[a].stop();for(a=0,d=this.cleanups.length;a<d;a++)this.cleanups[a]();if(this.scopes)for(a=0,d=this.scopes.length;a<d;a++)this.scopes[a].stop(!0);if(!this.detached&&this.parent&&!e){const p=this.parent.scopes.pop();p&&p!==this&&(this.parent.scopes[this.index]=p,p.index=this.index)}this.parent=void 0,this._active=!1}}}function ts(u,e=Nt){e&&e.active&&e.effects.push(u)}function es(){return Nt}const Ji=u=>{const e=new Set(u);return e.w=0,e.n=0,e},Xr=u=>(u.w&le)>0,Yr=u=>(u.n&le)>0,is=({deps:u})=>{if(u.length)for(let e=0;e<u.length;e++)u[e].w|=le},rs=u=>{const{deps:e}=u;if(e.length){let a=0;for(let d=0;d<e.length;d++){const p=e[d];Xr(p)&&!Yr(p)?p.delete(u):e[a++]=p,p.w&=~le,p.n&=~le}e.length=a}},Pi=new WeakMap;let Re=0,le=1;const Li=30;let Ht;const pe=Symbol(""),ki=Symbol("");class $i{constructor(e,a=null,d){this.fn=e,this.scheduler=a,this.active=!0,this.deps=[],this.parent=void 0,ts(this,d)}run(){if(!this.active)return this.fn();let e=Ht,a=se;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=Ht,Ht=this,se=!0,le=1<<++Re,Re<=Li?is(this):dr(this),this.fn()}finally{Re<=Li&&rs(this),le=1<<--Re,Ht=this.parent,se=a,this.parent=void 0,this.deferStop&&this.stop()}}stop(){Ht===this?this.deferStop=!0:this.active&&(dr(this),this.onStop&&this.onStop(),this.active=!1)}}function dr(u){const{deps:e}=u;if(e.length){for(let a=0;a<e.length;a++)e[a].delete(u);e.length=0}}let se=!0;const qr=[];function De(){qr.push(se),se=!1}function Ie(){const u=qr.pop();se=u===void 0?!0:u}function jt(u,e,a){if(se&&Ht){let d=Pi.get(u);d||Pi.set(u,d=new Map);let p=d.get(a);p||d.set(a,p=Ji()),Kr(p)}}function Kr(u,e){let a=!1;Re<=Li?Yr(u)||(u.n|=le,a=!Xr(u)):a=!u.has(Ht),a&&(u.add(Ht),Ht.deps.push(u))}function te(u,e,a,d,p,v){const b=Pi.get(u);if(!b)return;let C=[];if(e==="clear")C=[...b.values()];else if(a==="length"&&gt(u)){const S=Number(d);b.forEach((T,M)=>{(M==="length"||M>=S)&&C.push(T)})}else switch(a!==void 0&&C.push(b.get(a)),e){case"add":gt(u)?Yi(a)&&C.push(b.get("length")):(C.push(b.get(pe)),Be(u)&&C.push(b.get(ki)));break;case"delete":gt(u)||(C.push(b.get(pe)),Be(u)&&C.push(b.get(ki)));break;case"set":Be(u)&&C.push(b.get(pe));break}if(C.length===1)C[0]&&Ai(C[0]);else{const S=[];for(const T of C)T&&S.push(...T);Ai(Ji(S))}}function Ai(u,e){const a=gt(u)?u:[...u];for(const d of a)d.computed&&gr(d);for(const d of a)d.computed||gr(d)}function gr(u,e){(u!==Ht||u.allowRecurse)&&(u.scheduler?u.scheduler():u.run())}const ns=Gi("__proto__,__v_isRef,__isVue"),Jr=new Set(Object.getOwnPropertyNames(Symbol).filter(u=>u!=="arguments"&&u!=="caller").map(u=>Symbol[u]).filter(Xi)),ss=Qi(),os=Qi(!1,!0),as=Qi(!0),pr=ls();function ls(){const u={};return["includes","indexOf","lastIndexOf"].forEach(e=>{u[e]=function(...a){const d=wt(this);for(let v=0,b=this.length;v<b;v++)jt(d,"get",v+"");const p=d[e](...a);return p===-1||p===!1?d[e](...a.map(wt)):p}}),["push","pop","shift","unshift","splice"].forEach(e=>{u[e]=function(...a){De();const d=wt(this)[e].apply(this,a);return Ie(),d}}),u}function hs(u){const e=wt(this);return jt(e,"has",u),e.hasOwnProperty(u)}function Qi(u=!1,e=!1){return function(d,p,v){if(p==="__v_isReactive")return!u;if(p==="__v_isReadonly")return u;if(p==="__v_isShallow")return e;if(p==="__v_raw"&&v===(u?e?Ts:en:e?tn:Zr).get(d))return d;const b=gt(d);if(!u){if(b&&bt(pr,p))return Reflect.get(pr,p,v);if(p==="hasOwnProperty")return hs}const C=Reflect.get(d,p,v);return(Xi(p)?Jr.has(p):ns(p))||(u||jt(d,"get",p),e)?C:kt(C)?b&&Yi(p)?C:C.value:Et(C)?u?rn(C):er(C):C}}const cs=$r(),us=$r(!0);function $r(u=!1){return function(a,d,p,v){let b=a[d];if(Te(b)&&kt(b)&&!kt(p))return!1;if(!u&&(!ai(p)&&!Te(p)&&(b=wt(b),p=wt(p)),!gt(a)&&kt(b)&&!kt(p)))return b.value=p,!0;const C=gt(a)&&Yi(d)?Number(d)<a.length:bt(a,d),S=Reflect.set(a,d,p,v);return a===wt(v)&&(C?Ne(p,b)&&te(a,"set",d,p):te(a,"add",d,p)),S}}function fs(u,e){const a=bt(u,e);u[e];const d=Reflect.deleteProperty(u,e);return d&&a&&te(u,"delete",e,void 0),d}function ds(u,e){const a=Reflect.has(u,e);return(!Xi(e)||!Jr.has(e))&&jt(u,"has",e),a}function gs(u){return jt(u,"iterate",gt(u)?"length":pe),Reflect.ownKeys(u)}const Qr={get:ss,set:cs,deleteProperty:fs,has:ds,ownKeys:gs},ps={get:as,set(u,e){return!0},deleteProperty(u,e){return!0}},ms=Dt({},Qr,{get:os,set:us}),Zi=u=>u,pi=u=>Reflect.getPrototypeOf(u);function Ke(u,e,a=!1,d=!1){u=u.__v_raw;const p=wt(u),v=wt(e);a||(e!==v&&jt(p,"get",e),jt(p,"get",v));const{has:b}=pi(p),C=d?Zi:a?rr:He;if(b.call(p,e))return C(u.get(e));if(b.call(p,v))return C(u.get(v));u!==p&&u.get(e)}function Je(u,e=!1){const a=this.__v_raw,d=wt(a),p=wt(u);return e||(u!==p&&jt(d,"has",u),jt(d,"has",p)),u===p?a.has(u):a.has(u)||a.has(p)}function $e(u,e=!1){return u=u.__v_raw,!e&&jt(wt(u),"iterate",pe),Reflect.get(u,"size",u)}function mr(u){u=wt(u);const e=wt(this);return pi(e).has.call(e,u)||(e.add(u),te(e,"add",u,u)),this}function vr(u,e){e=wt(e);const a=wt(this),{has:d,get:p}=pi(a);let v=d.call(a,u);v||(u=wt(u),v=d.call(a,u));const b=p.call(a,u);return a.set(u,e),v?Ne(e,b)&&te(a,"set",u,e):te(a,"add",u,e),this}function _r(u){const e=wt(this),{has:a,get:d}=pi(e);let p=a.call(e,u);p||(u=wt(u),p=a.call(e,u)),d&&d.call(e,u);const v=e.delete(u);return p&&te(e,"delete",u,void 0),v}function yr(){const u=wt(this),e=u.size!==0,a=u.clear();return e&&te(u,"clear",void 0,void 0),a}function Qe(u,e){return function(d,p){const v=this,b=v.__v_raw,C=wt(b),S=e?Zi:u?rr:He;return!u&&jt(C,"iterate",pe),b.forEach((T,M)=>d.call(p,S(T),S(M),v))}}function Ze(u,e,a){return function(...d){const p=this.__v_raw,v=wt(p),b=Be(v),C=u==="entries"||u===Symbol.iterator&&b,S=u==="keys"&&b,T=p[u](...d),M=a?Zi:e?rr:He;return!e&&jt(v,"iterate",S?ki:pe),{next(){const{value:B,done:j}=T.next();return j?{value:B,done:j}:{value:C?[M(B[0]),M(B[1])]:M(B),done:j}},[Symbol.iterator](){return this}}}}function ie(u){return function(...e){return u==="delete"?!1:this}}function vs(){const u={get(v){return Ke(this,v)},get size(){return $e(this)},has:Je,add:mr,set:vr,delete:_r,clear:yr,forEach:Qe(!1,!1)},e={get(v){return Ke(this,v,!1,!0)},get size(){return $e(this)},has:Je,add:mr,set:vr,delete:_r,clear:yr,forEach:Qe(!1,!0)},a={get(v){return Ke(this,v,!0)},get size(){return $e(this,!0)},has(v){return Je.call(this,v,!0)},add:ie("add"),set:ie("set"),delete:ie("delete"),clear:ie("clear"),forEach:Qe(!0,!1)},d={get(v){return Ke(this,v,!0,!0)},get size(){return $e(this,!0)},has(v){return Je.call(this,v,!0)},add:ie("add"),set:ie("set"),delete:ie("delete"),clear:ie("clear"),forEach:Qe(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(v=>{u[v]=Ze(v,!1,!1),a[v]=Ze(v,!0,!1),e[v]=Ze(v,!1,!0),d[v]=Ze(v,!0,!0)}),[u,a,e,d]}const[_s,ys,bs,ws]=vs();function tr(u,e){const a=e?u?ws:bs:u?ys:_s;return(d,p,v)=>p==="__v_isReactive"?!u:p==="__v_isReadonly"?u:p==="__v_raw"?d:Reflect.get(bt(a,p)&&p in d?a:d,p,v)}const Cs={get:tr(!1,!1)},xs={get:tr(!1,!0)},Ss={get:tr(!0,!1)},Zr=new WeakMap,tn=new WeakMap,en=new WeakMap,Ts=new WeakMap;function Os(u){switch(u){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Es(u){return u.__v_skip||!Object.isExtensible(u)?0:Os(Hn(u))}function er(u){return Te(u)?u:ir(u,!1,Qr,Cs,Zr)}function Ms(u){return ir(u,!1,ms,xs,tn)}function rn(u){return ir(u,!0,ps,Ss,en)}function ir(u,e,a,d,p){if(!Et(u)||u.__v_raw&&!(e&&u.__v_isReactive))return u;const v=p.get(u);if(v)return v;const b=Es(u);if(b===0)return u;const C=new Proxy(u,b===2?d:a);return p.set(u,C),C}function Ce(u){return Te(u)?Ce(u.__v_raw):!!(u&&u.__v_isReactive)}function Te(u){return!!(u&&u.__v_isReadonly)}function ai(u){return!!(u&&u.__v_isShallow)}function nn(u){return Ce(u)||Te(u)}function wt(u){const e=u&&u.__v_raw;return e?wt(e):u}function sn(u){return oi(u,"__v_skip",!0),u}const He=u=>Et(u)?er(u):u,rr=u=>Et(u)?rn(u):u;function on(u){se&&Ht&&(u=wt(u),Kr(u.dep||(u.dep=Ji())))}function an(u,e){u=wt(u);const a=u.dep;a&&Ai(a)}function kt(u){return!!(u&&u.__v_isRef===!0)}function Ds(u){return Is(u,!1)}function Is(u,e){return kt(u)?u:new Fs(u,e)}class Fs{constructor(e,a){this.__v_isShallow=a,this.dep=void 0,this.__v_isRef=!0,this._rawValue=a?e:wt(e),this._value=a?e:He(e)}get value(){return on(this),this._value}set value(e){const a=this.__v_isShallow||ai(e)||Te(e);e=a?e:wt(e),Ne(e,this._rawValue)&&(this._rawValue=e,this._value=a?e:He(e),an(this))}}function Ps(u){return kt(u)?u.value:u}const Ls={get:(u,e,a)=>Ps(Reflect.get(u,e,a)),set:(u,e,a,d)=>{const p=u[e];return kt(p)&&!kt(a)?(p.value=a,!0):Reflect.set(u,e,a,d)}};function ln(u){return Ce(u)?u:new Proxy(u,Ls)}class ks{constructor(e,a,d,p){this._setter=a,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this._dirty=!0,this.effect=new $i(e,()=>{this._dirty||(this._dirty=!0,an(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!p,this.__v_isReadonly=d}get value(){const e=wt(this);return on(e),(e._dirty||!e._cacheable)&&(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}function As(u,e,a=!1){let d,p;const v=pt(u);return v?(d=u,p=Vt):(d=u.get,p=u.set),new ks(d,p,v||!p,a)}function oe(u,e,a,d){let p;try{p=d?u(...d):u()}catch(v){mi(v,e,a)}return p}function zt(u,e,a,d){if(pt(u)){const v=oe(u,e,a,d);return v&&Gr(v)&&v.catch(b=>{mi(b,e,a)}),v}const p=[];for(let v=0;v<u.length;v++)p.push(zt(u[v],e,a,d));return p}function mi(u,e,a,d=!0){const p=e?e.vnode:null;if(e){let v=e.parent;const b=e.proxy,C=a;for(;v;){const T=v.ec;if(T){for(let M=0;M<T.length;M++)if(T[M](u,b,C)===!1)return}v=v.parent}const S=e.appContext.config.errorHandler;if(S){oe(S,null,10,[u,b,C]);return}}Rs(u,a,p,d)}function Rs(u,e,a,d=!0){console.error(u)}let Ge=!1,Ri=!1;const Pt=[];let qt=0;const xe=[];let $t=null,fe=0;const hn=Promise.resolve();let nr=null;function js(u){const e=nr||hn;return u?e.then(this?u.bind(this):u):e}function Bs(u){let e=qt+1,a=Pt.length;for(;e<a;){const d=e+a>>>1;Ve(Pt[d])<u?e=d+1:a=d}return e}function sr(u){(!Pt.length||!Pt.includes(u,Ge&&u.allowRecurse?qt+1:qt))&&(u.id==null?Pt.push(u):Pt.splice(Bs(u.id),0,u),cn())}function cn(){!Ge&&!Ri&&(Ri=!0,nr=hn.then(fn))}function Ws(u){const e=Pt.indexOf(u);e>qt&&Pt.splice(e,1)}function Us(u){gt(u)?xe.push(...u):(!$t||!$t.includes(u,u.allowRecurse?fe+1:fe))&&xe.push(u),cn()}function br(u,e=Ge?qt+1:0){for(;e<Pt.length;e++){const a=Pt[e];a&&a.pre&&(Pt.splice(e,1),e--,a())}}function un(u){if(xe.length){const e=[...new Set(xe)];if(xe.length=0,$t){$t.push(...e);return}for($t=e,$t.sort((a,d)=>Ve(a)-Ve(d)),fe=0;fe<$t.length;fe++)$t[fe]();$t=null,fe=0}}const Ve=u=>u.id==null?1/0:u.id,Ns=(u,e)=>{const a=Ve(u)-Ve(e);if(a===0){if(u.pre&&!e.pre)return-1;if(e.pre&&!u.pre)return 1}return a};function fn(u){Ri=!1,Ge=!0,Pt.sort(Ns);const e=Vt;try{for(qt=0;qt<Pt.length;qt++){const a=Pt[qt];a&&a.active!==!1&&oe(a,null,14)}}finally{qt=0,Pt.length=0,un(),Ge=!1,nr=null,(Pt.length||xe.length)&&fn()}}function Hs(u,e,...a){if(u.isUnmounted)return;const d=u.vnode.props||Tt;let p=a;const v=e.startsWith("update:"),b=v&&e.slice(7);if(b&&b in d){const M=`${b==="modelValue"?"model":b}Modifiers`,{number:B,trim:j}=d[M]||Tt;j&&(p=a.map(q=>It(q)?q.trim():q)),B&&(p=a.map(Xn))}let C,S=d[C=xi(e)]||d[C=xi(Se(e))];!S&&v&&(S=d[C=xi(Me(e))]),S&&zt(S,u,6,p);const T=d[C+"Once"];if(T){if(!u.emitted)u.emitted={};else if(u.emitted[C])return;u.emitted[C]=!0,zt(T,u,6,p)}}function dn(u,e,a=!1){const d=e.emitsCache,p=d.get(u);if(p!==void 0)return p;const v=u.emits;let b={},C=!1;if(!pt(u)){const S=T=>{const M=dn(T,e,!0);M&&(C=!0,Dt(b,M))};!a&&e.mixins.length&&e.mixins.forEach(S),u.extends&&S(u.extends),u.mixins&&u.mixins.forEach(S)}return!v&&!C?(Et(u)&&d.set(u,null),null):(gt(v)?v.forEach(S=>b[S]=null):Dt(b,v),Et(u)&&d.set(u,b),b)}function vi(u,e){return!u||!fi(e)?!1:(e=e.slice(2).replace(/Once$/,""),bt(u,e[0].toLowerCase()+e.slice(1))||bt(u,Me(e))||bt(u,e))}let Kt=null,gn=null;function li(u){const e=Kt;return Kt=u,gn=u&&u.type.__scopeId||null,e}function Gs(u,e=Kt,a){if(!e||u._n)return u;const d=(...p)=>{d._d&&Ir(-1);const v=li(e);let b;try{b=u(...p)}finally{li(v),d._d&&Ir(1)}return b};return d._n=!0,d._c=!0,d._d=!0,d}function Ti(u){const{type:e,vnode:a,proxy:d,withProxy:p,props:v,propsOptions:[b],slots:C,attrs:S,emit:T,render:M,renderCache:B,data:j,setupState:q,ctx:J,inheritAttrs:z}=u;let Y,tt;const st=li(u);try{if(a.shapeFlag&4){const ot=p||d;Y=Yt(M.call(ot,ot,B,v,q,j,J)),tt=S}else{const ot=e;Y=Yt(ot.length>1?ot(v,{attrs:S,slots:C,emit:T}):ot(v,null)),tt=e.props?S:Vs(S)}}catch(ot){Ue.length=0,mi(ot,u,1),Y=ae(ze)}let nt=Y;if(tt&&z!==!1){const ot=Object.keys(tt),{shapeFlag:ct}=nt;ot.length&&ct&7&&(b&&ot.some(Vi)&&(tt=zs(tt,b)),nt=Oe(nt,tt))}return a.dirs&&(nt=Oe(nt),nt.dirs=nt.dirs?nt.dirs.concat(a.dirs):a.dirs),a.transition&&(nt.transition=a.transition),Y=nt,li(st),Y}const Vs=u=>{let e;for(const a in u)(a==="class"||a==="style"||fi(a))&&((e||(e={}))[a]=u[a]);return e},zs=(u,e)=>{const a={};for(const d in u)(!Vi(d)||!(d.slice(9)in e))&&(a[d]=u[d]);return a};function Xs(u,e,a){const{props:d,children:p,component:v}=u,{props:b,children:C,patchFlag:S}=e,T=v.emitsOptions;if(e.dirs||e.transition)return!0;if(a&&S>=0){if(S&1024)return!0;if(S&16)return d?wr(d,b,T):!!b;if(S&8){const M=e.dynamicProps;for(let B=0;B<M.length;B++){const j=M[B];if(b[j]!==d[j]&&!vi(T,j))return!0}}}else return(p||C)&&(!C||!C.$stable)?!0:d===b?!1:d?b?wr(d,b,T):!0:!!b;return!1}function wr(u,e,a){const d=Object.keys(e);if(d.length!==Object.keys(u).length)return!0;for(let p=0;p<d.length;p++){const v=d[p];if(e[v]!==u[v]&&!vi(a,v))return!0}return!1}function Ys({vnode:u,parent:e},a){for(;e&&e.subTree===u;)(u=e.vnode).el=a,e=e.parent}const qs=u=>u.__isSuspense;function Ks(u,e){e&&e.pendingBranch?gt(u)?e.effects.push(...u):e.effects.push(u):Us(u)}const ti={};function Oi(u,e,a){return pn(u,e,a)}function pn(u,e,{immediate:a,deep:d,flush:p,onTrack:v,onTrigger:b}=Tt){var C;const S=es()===((C=Lt)==null?void 0:C.scope)?Lt:null;let T,M=!1,B=!1;if(kt(u)?(T=()=>u.value,M=ai(u)):Ce(u)?(T=()=>u,d=!0):gt(u)?(B=!0,M=u.some(ot=>Ce(ot)||ai(ot)),T=()=>u.map(ot=>{if(kt(ot))return ot.value;if(Ce(ot))return be(ot);if(pt(ot))return oe(ot,S,2)})):pt(u)?e?T=()=>oe(u,S,2):T=()=>{if(!(S&&S.isUnmounted))return j&&j(),zt(u,S,3,[q])}:T=Vt,e&&d){const ot=T;T=()=>be(ot())}let j,q=ot=>{j=st.onStop=()=>{oe(ot,S,4)}},J;if(Ye)if(q=Vt,e?a&&zt(e,S,3,[T(),B?[]:void 0,q]):T(),p==="sync"){const ot=Yo();J=ot.__watcherHandles||(ot.__watcherHandles=[])}else return Vt;let z=B?new Array(u.length).fill(ti):ti;const Y=()=>{if(st.active)if(e){const ot=st.run();(d||M||(B?ot.some((ct,ut)=>Ne(ct,z[ut])):Ne(ot,z)))&&(j&&j(),zt(e,S,3,[ot,z===ti?void 0:B&&z[0]===ti?[]:z,q]),z=ot)}else st.run()};Y.allowRecurse=!!e;let tt;p==="sync"?tt=Y:p==="post"?tt=()=>Rt(Y,S&&S.suspense):(Y.pre=!0,S&&(Y.id=S.uid),tt=()=>sr(Y));const st=new $i(T,tt);e?a?Y():z=st.run():p==="post"?Rt(st.run.bind(st),S&&S.suspense):st.run();const nt=()=>{st.stop(),S&&S.scope&&zi(S.scope.effects,st)};return J&&J.push(nt),nt}function Js(u,e,a){const d=this.proxy,p=It(u)?u.includes(".")?mn(d,u):()=>d[u]:u.bind(d,d);let v;pt(e)?v=e:(v=e.handler,a=e);const b=Lt;Ee(this);const C=pn(p,v.bind(d),a);return b?Ee(b):me(),C}function mn(u,e){const a=e.split(".");return()=>{let d=u;for(let p=0;p<a.length&&d;p++)d=d[a[p]];return d}}function be(u,e){if(!Et(u)||u.__v_skip||(e=e||new Set,e.has(u)))return u;if(e.add(u),kt(u))be(u.value,e);else if(gt(u))for(let a=0;a<u.length;a++)be(u[a],e);else if(Un(u)||Be(u))u.forEach(a=>{be(a,e)});else if(Gn(u))for(const a in u)be(u[a],e);return u}function ce(u,e,a,d){const p=u.dirs,v=e&&e.dirs;for(let b=0;b<p.length;b++){const C=p[b];v&&(C.oldValue=v[b].value);let S=C.dir[d];S&&(De(),zt(S,a,8,[u.el,C,u,e]),Ie())}}const ri=u=>!!u.type.__asyncLoader,vn=u=>u.type.__isKeepAlive;function $s(u,e){_n(u,"a",e)}function Qs(u,e){_n(u,"da",e)}function _n(u,e,a=Lt){const d=u.__wdc||(u.__wdc=()=>{let p=a;for(;p;){if(p.isDeactivated)return;p=p.parent}return u()});if(_i(e,d,a),a){let p=a.parent;for(;p&&p.parent;)vn(p.parent.vnode)&&Zs(d,e,a,p),p=p.parent}}function Zs(u,e,a,d){const p=_i(e,u,d,!0);yn(()=>{zi(d[e],p)},a)}function _i(u,e,a=Lt,d=!1){if(a){const p=a[u]||(a[u]=[]),v=e.__weh||(e.__weh=(...b)=>{if(a.isUnmounted)return;De(),Ee(a);const C=zt(e,a,u,b);return me(),Ie(),C});return d?p.unshift(v):p.push(v),v}}const ee=u=>(e,a=Lt)=>(!Ye||u==="sp")&&_i(u,(...d)=>e(...d),a),to=ee("bm"),eo=ee("m"),io=ee("bu"),ro=ee("u"),no=ee("bum"),yn=ee("um"),so=ee("sp"),oo=ee("rtg"),ao=ee("rtc");function lo(u,e=Lt){_i("ec",u,e)}const ho=Symbol.for("v-ndc"),ji=u=>u?Pn(u)?cr(u)||u.proxy:ji(u.parent):null,We=Dt(Object.create(null),{$:u=>u,$el:u=>u.vnode.el,$data:u=>u.data,$props:u=>u.props,$attrs:u=>u.attrs,$slots:u=>u.slots,$refs:u=>u.refs,$parent:u=>ji(u.parent),$root:u=>ji(u.root),$emit:u=>u.emit,$options:u=>or(u),$forceUpdate:u=>u.f||(u.f=()=>sr(u.update)),$nextTick:u=>u.n||(u.n=js.bind(u.proxy)),$watch:u=>Js.bind(u)}),Ei=(u,e)=>u!==Tt&&!u.__isScriptSetup&&bt(u,e),co={get({_:u},e){const{ctx:a,setupState:d,data:p,props:v,accessCache:b,type:C,appContext:S}=u;let T;if(e[0]!=="$"){const q=b[e];if(q!==void 0)switch(q){case 1:return d[e];case 2:return p[e];case 4:return a[e];case 3:return v[e]}else{if(Ei(d,e))return b[e]=1,d[e];if(p!==Tt&&bt(p,e))return b[e]=2,p[e];if((T=u.propsOptions[0])&&bt(T,e))return b[e]=3,v[e];if(a!==Tt&&bt(a,e))return b[e]=4,a[e];Bi&&(b[e]=0)}}const M=We[e];let B,j;if(M)return e==="$attrs"&&jt(u,"get",e),M(u);if((B=C.__cssModules)&&(B=B[e]))return B;if(a!==Tt&&bt(a,e))return b[e]=4,a[e];if(j=S.config.globalProperties,bt(j,e))return j[e]},set({_:u},e,a){const{data:d,setupState:p,ctx:v}=u;return Ei(p,e)?(p[e]=a,!0):d!==Tt&&bt(d,e)?(d[e]=a,!0):bt(u.props,e)||e[0]==="$"&&e.slice(1)in u?!1:(v[e]=a,!0)},has({_:{data:u,setupState:e,accessCache:a,ctx:d,appContext:p,propsOptions:v}},b){let C;return!!a[b]||u!==Tt&&bt(u,b)||Ei(e,b)||(C=v[0])&&bt(C,b)||bt(d,b)||bt(We,b)||bt(p.config.globalProperties,b)},defineProperty(u,e,a){return a.get!=null?u._.accessCache[e]=0:bt(a,"value")&&this.set(u,e,a.value,null),Reflect.defineProperty(u,e,a)}};function Cr(u){return gt(u)?u.reduce((e,a)=>(e[a]=null,e),{}):u}let Bi=!0;function uo(u){const e=or(u),a=u.proxy,d=u.ctx;Bi=!1,e.beforeCreate&&xr(e.beforeCreate,u,"bc");const{data:p,computed:v,methods:b,watch:C,provide:S,inject:T,created:M,beforeMount:B,mounted:j,beforeUpdate:q,updated:J,activated:z,deactivated:Y,beforeDestroy:tt,beforeUnmount:st,destroyed:nt,unmounted:ot,render:ct,renderTracked:ut,renderTriggered:mt,errorCaptured:m,serverPrefetch:dt,expose:_t,inheritAttrs:Ft,components:s,directives:r,filters:n}=e;if(T&&fo(T,d,null),b)for(const i in b){const o=b[i];pt(o)&&(d[i]=o.bind(a))}if(p){const i=p.call(a,a);Et(i)&&(u.data=er(i))}if(Bi=!0,v)for(const i in v){const o=v[i],f=pt(o)?o.bind(a,a):pt(o.get)?o.get.bind(a,a):Vt,h=!pt(o)&&pt(o.set)?o.set.bind(a):Vt,c=zo({get:f,set:h});Object.defineProperty(d,i,{enumerable:!0,configurable:!0,get:()=>c.value,set:g=>c.value=g})}if(C)for(const i in C)bn(C[i],d,a,i);if(S){const i=pt(S)?S.call(a):S;Reflect.ownKeys(i).forEach(o=>{yo(o,i[o])})}M&&xr(M,u,"c");function t(i,o){gt(o)?o.forEach(f=>i(f.bind(a))):o&&i(o.bind(a))}if(t(to,B),t(eo,j),t(io,q),t(ro,J),t($s,z),t(Qs,Y),t(lo,m),t(ao,ut),t(oo,mt),t(no,st),t(yn,ot),t(so,dt),gt(_t))if(_t.length){const i=u.exposed||(u.exposed={});_t.forEach(o=>{Object.defineProperty(i,o,{get:()=>a[o],set:f=>a[o]=f})})}else u.exposed||(u.exposed={});ct&&u.render===Vt&&(u.render=ct),Ft!=null&&(u.inheritAttrs=Ft),s&&(u.components=s),r&&(u.directives=r)}function fo(u,e,a=Vt){gt(u)&&(u=Wi(u));for(const d in u){const p=u[d];let v;Et(p)?"default"in p?v=ni(p.from||d,p.default,!0):v=ni(p.from||d):v=ni(p),kt(v)?Object.defineProperty(e,d,{enumerable:!0,configurable:!0,get:()=>v.value,set:b=>v.value=b}):e[d]=v}}function xr(u,e,a){zt(gt(u)?u.map(d=>d.bind(e.proxy)):u.bind(e.proxy),e,a)}function bn(u,e,a,d){const p=d.includes(".")?mn(a,d):()=>a[d];if(It(u)){const v=e[u];pt(v)&&Oi(p,v)}else if(pt(u))Oi(p,u.bind(a));else if(Et(u))if(gt(u))u.forEach(v=>bn(v,e,a,d));else{const v=pt(u.handler)?u.handler.bind(a):e[u.handler];pt(v)&&Oi(p,v,u)}}function or(u){const e=u.type,{mixins:a,extends:d}=e,{mixins:p,optionsCache:v,config:{optionMergeStrategies:b}}=u.appContext,C=v.get(e);let S;return C?S=C:!p.length&&!a&&!d?S=e:(S={},p.length&&p.forEach(T=>hi(S,T,b,!0)),hi(S,e,b)),Et(e)&&v.set(e,S),S}function hi(u,e,a,d=!1){const{mixins:p,extends:v}=e;v&&hi(u,v,a,!0),p&&p.forEach(b=>hi(u,b,a,!0));for(const b in e)if(!(d&&b==="expose")){const C=go[b]||a&&a[b];u[b]=C?C(u[b],e[b]):e[b]}return u}const go={data:Sr,props:Tr,emits:Tr,methods:je,computed:je,beforeCreate:At,created:At,beforeMount:At,mounted:At,beforeUpdate:At,updated:At,beforeDestroy:At,beforeUnmount:At,destroyed:At,unmounted:At,activated:At,deactivated:At,errorCaptured:At,serverPrefetch:At,components:je,directives:je,watch:mo,provide:Sr,inject:po};function Sr(u,e){return e?u?function(){return Dt(pt(u)?u.call(this,this):u,pt(e)?e.call(this,this):e)}:e:u}function po(u,e){return je(Wi(u),Wi(e))}function Wi(u){if(gt(u)){const e={};for(let a=0;a<u.length;a++)e[u[a]]=u[a];return e}return u}function At(u,e){return u?[...new Set([].concat(u,e))]:e}function je(u,e){return u?Dt(Object.create(null),u,e):e}function Tr(u,e){return u?gt(u)&&gt(e)?[...new Set([...u,...e])]:Dt(Object.create(null),Cr(u),Cr(e??{})):e}function mo(u,e){if(!u)return e;if(!e)return u;const a=Dt(Object.create(null),u);for(const d in e)a[d]=At(u[d],e[d]);return a}function wn(){return{app:null,config:{isNativeTag:jn,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let vo=0;function _o(u,e){return function(d,p=null){pt(d)||(d=Dt({},d)),p!=null&&!Et(p)&&(p=null);const v=wn(),b=new Set;let C=!1;const S=v.app={_uid:vo++,_component:d,_props:p,_container:null,_context:v,_instance:null,version:qo,get config(){return v.config},set config(T){},use(T,...M){return b.has(T)||(T&&pt(T.install)?(b.add(T),T.install(S,...M)):pt(T)&&(b.add(T),T(S,...M))),S},mixin(T){return v.mixins.includes(T)||v.mixins.push(T),S},component(T,M){return M?(v.components[T]=M,S):v.components[T]},directive(T,M){return M?(v.directives[T]=M,S):v.directives[T]},mount(T,M,B){if(!C){const j=ae(d,p);return j.appContext=v,M&&e?e(j,T):u(j,T,B),C=!0,S._container=T,T.__vue_app__=S,cr(j.component)||j.component.proxy}},unmount(){C&&(u(null,S._container),delete S._container.__vue_app__)},provide(T,M){return v.provides[T]=M,S},runWithContext(T){ci=S;try{return T()}finally{ci=null}}};return S}}let ci=null;function yo(u,e){if(Lt){let a=Lt.provides;const d=Lt.parent&&Lt.parent.provides;d===a&&(a=Lt.provides=Object.create(d)),a[u]=e}}function ni(u,e,a=!1){const d=Lt||Kt;if(d||ci){const p=d?d.parent==null?d.vnode.appContext&&d.vnode.appContext.provides:d.parent.provides:ci._context.provides;if(p&&u in p)return p[u];if(arguments.length>1)return a&&pt(e)?e.call(d&&d.proxy):e}}function bo(u,e,a,d=!1){const p={},v={};oi(v,bi,1),u.propsDefaults=Object.create(null),Cn(u,e,p,v);for(const b in u.propsOptions[0])b in p||(p[b]=void 0);a?u.props=d?p:Ms(p):u.type.props?u.props=p:u.props=v,u.attrs=v}function wo(u,e,a,d){const{props:p,attrs:v,vnode:{patchFlag:b}}=u,C=wt(p),[S]=u.propsOptions;let T=!1;if((d||b>0)&&!(b&16)){if(b&8){const M=u.vnode.dynamicProps;for(let B=0;B<M.length;B++){let j=M[B];if(vi(u.emitsOptions,j))continue;const q=e[j];if(S)if(bt(v,j))q!==v[j]&&(v[j]=q,T=!0);else{const J=Se(j);p[J]=Ui(S,C,J,q,u,!1)}else q!==v[j]&&(v[j]=q,T=!0)}}}else{Cn(u,e,p,v)&&(T=!0);let M;for(const B in C)(!e||!bt(e,B)&&((M=Me(B))===B||!bt(e,M)))&&(S?a&&(a[B]!==void 0||a[M]!==void 0)&&(p[B]=Ui(S,C,B,void 0,u,!0)):delete p[B]);if(v!==C)for(const B in v)(!e||!bt(e,B))&&(delete v[B],T=!0)}T&&te(u,"set","$attrs")}function Cn(u,e,a,d){const[p,v]=u.propsOptions;let b=!1,C;if(e)for(let S in e){if(ii(S))continue;const T=e[S];let M;p&&bt(p,M=Se(S))?!v||!v.includes(M)?a[M]=T:(C||(C={}))[M]=T:vi(u.emitsOptions,S)||(!(S in d)||T!==d[S])&&(d[S]=T,b=!0)}if(v){const S=wt(a),T=C||Tt;for(let M=0;M<v.length;M++){const B=v[M];a[B]=Ui(p,S,B,T[B],u,!bt(T,B))}}return b}function Ui(u,e,a,d,p,v){const b=u[a];if(b!=null){const C=bt(b,"default");if(C&&d===void 0){const S=b.default;if(b.type!==Function&&!b.skipFactory&&pt(S)){const{propsDefaults:T}=p;a in T?d=T[a]:(Ee(p),d=T[a]=S.call(null,e),me())}else d=S}b[0]&&(v&&!C?d=!1:b[1]&&(d===""||d===Me(a))&&(d=!0))}return d}function xn(u,e,a=!1){const d=e.propsCache,p=d.get(u);if(p)return p;const v=u.props,b={},C=[];let S=!1;if(!pt(u)){const M=B=>{S=!0;const[j,q]=xn(B,e,!0);Dt(b,j),q&&C.push(...q)};!a&&e.mixins.length&&e.mixins.forEach(M),u.extends&&M(u.extends),u.mixins&&u.mixins.forEach(M)}if(!v&&!S)return Et(u)&&d.set(u,we),we;if(gt(v))for(let M=0;M<v.length;M++){const B=Se(v[M]);Or(B)&&(b[B]=Tt)}else if(v)for(const M in v){const B=Se(M);if(Or(B)){const j=v[M],q=b[B]=gt(j)||pt(j)?{type:j}:Dt({},j);if(q){const J=Dr(Boolean,q.type),z=Dr(String,q.type);q[0]=J>-1,q[1]=z<0||J<z,(J>-1||bt(q,"default"))&&C.push(B)}}}const T=[b,C];return Et(u)&&d.set(u,T),T}function Or(u){return u[0]!=="$"}function Er(u){const e=u&&u.toString().match(/^\s*(function|class) (\w+)/);return e?e[2]:u===null?"null":""}function Mr(u,e){return Er(u)===Er(e)}function Dr(u,e){return gt(e)?e.findIndex(a=>Mr(a,u)):pt(e)&&Mr(e,u)?0:-1}const Sn=u=>u[0]==="_"||u==="$stable",ar=u=>gt(u)?u.map(Yt):[Yt(u)],Co=(u,e,a)=>{if(e._n)return e;const d=Gs((...p)=>ar(e(...p)),a);return d._c=!1,d},Tn=(u,e,a)=>{const d=u._ctx;for(const p in u){if(Sn(p))continue;const v=u[p];if(pt(v))e[p]=Co(p,v,d);else if(v!=null){const b=ar(v);e[p]=()=>b}}},On=(u,e)=>{const a=ar(e);u.slots.default=()=>a},xo=(u,e)=>{if(u.vnode.shapeFlag&32){const a=e._;a?(u.slots=wt(e),oi(e,"_",a)):Tn(e,u.slots={})}else u.slots={},e&&On(u,e);oi(u.slots,bi,1)},So=(u,e,a)=>{const{vnode:d,slots:p}=u;let v=!0,b=Tt;if(d.shapeFlag&32){const C=e._;C?a&&C===1?v=!1:(Dt(p,e),!a&&C===1&&delete p._):(v=!e.$stable,Tn(e,p)),b=e}else e&&(On(u,e),b={default:1});if(v)for(const C in p)!Sn(C)&&!(C in b)&&delete p[C]};function Ni(u,e,a,d,p=!1){if(gt(u)){u.forEach((j,q)=>Ni(j,e&&(gt(e)?e[q]:e),a,d,p));return}if(ri(d)&&!p)return;const v=d.shapeFlag&4?cr(d.component)||d.component.proxy:d.el,b=p?null:v,{i:C,r:S}=u,T=e&&e.r,M=C.refs===Tt?C.refs={}:C.refs,B=C.setupState;if(T!=null&&T!==S&&(It(T)?(M[T]=null,bt(B,T)&&(B[T]=null)):kt(T)&&(T.value=null)),pt(S))oe(S,C,12,[b,M]);else{const j=It(S),q=kt(S);if(j||q){const J=()=>{if(u.f){const z=j?bt(B,S)?B[S]:M[S]:S.value;p?gt(z)&&zi(z,v):gt(z)?z.includes(v)||z.push(v):j?(M[S]=[v],bt(B,S)&&(B[S]=M[S])):(S.value=[v],u.k&&(M[u.k]=S.value))}else j?(M[S]=b,bt(B,S)&&(B[S]=b)):q&&(S.value=b,u.k&&(M[u.k]=b))};b?(J.id=-1,Rt(J,a)):J()}}}const Rt=Ks;function To(u){return Oo(u)}function Oo(u,e){const a=Fi();a.__VUE__=!0;const{insert:d,remove:p,patchProp:v,createElement:b,createText:C,createComment:S,setText:T,setElementText:M,parentNode:B,nextSibling:j,setScopeId:q=Vt,insertStaticContent:J}=u,z=(O,D,E,F=null,k=null,W=null,N=!1,L=null,P=!!D.dynamicChildren)=>{if(O===D)return;O&&!ke(O,D)&&(F=I(O),g(O,k,W,!0),O=null),D.patchFlag===-2&&(P=!1,D.dynamicChildren=null);const{type:A,ref:V,shapeFlag:H}=D;switch(A){case yi:Y(O,D,E,F);break;case ze:tt(O,D,E,F);break;case Mi:O==null&&st(D,E,F,N);break;case Qt:s(O,D,E,F,k,W,N,L,P);break;default:H&1?ct(O,D,E,F,k,W,N,L,P):H&6?r(O,D,E,F,k,W,N,L,P):(H&64||H&128)&&A.process(O,D,E,F,k,W,N,L,P,U)}V!=null&&k&&Ni(V,O&&O.ref,W,D||O,!D)},Y=(O,D,E,F)=>{if(O==null)d(D.el=C(D.children),E,F);else{const k=D.el=O.el;D.children!==O.children&&T(k,D.children)}},tt=(O,D,E,F)=>{O==null?d(D.el=S(D.children||""),E,F):D.el=O.el},st=(O,D,E,F)=>{[O.el,O.anchor]=J(O.children,D,E,F,O.el,O.anchor)},nt=({el:O,anchor:D},E,F)=>{let k;for(;O&&O!==D;)k=j(O),d(O,E,F),O=k;d(D,E,F)},ot=({el:O,anchor:D})=>{let E;for(;O&&O!==D;)E=j(O),p(O),O=E;p(D)},ct=(O,D,E,F,k,W,N,L,P)=>{N=N||D.type==="svg",O==null?ut(D,E,F,k,W,N,L,P):dt(O,D,k,W,N,L,P)},ut=(O,D,E,F,k,W,N,L)=>{let P,A;const{type:V,props:H,shapeFlag:X,transition:$,dirs:Q}=O;if(P=O.el=b(O.type,W,H&&H.is,H),X&8?M(P,O.children):X&16&&m(O.children,P,null,F,k,W&&V!=="foreignObject",N,L),Q&&ce(O,null,F,"created"),mt(P,O,O.scopeId,N,F),H){for(const it in H)it!=="value"&&!ii(it)&&v(P,it,null,H[it],W,O.children,F,k,w);"value"in H&&v(P,"value",null,H.value),(A=H.onVnodeBeforeMount)&&Xt(A,F,O)}Q&&ce(O,null,F,"beforeMount");const Z=(!k||k&&!k.pendingBranch)&&$&&!$.persisted;Z&&$.beforeEnter(P),d(P,D,E),((A=H&&H.onVnodeMounted)||Z||Q)&&Rt(()=>{A&&Xt(A,F,O),Z&&$.enter(P),Q&&ce(O,null,F,"mounted")},k)},mt=(O,D,E,F,k)=>{if(E&&q(O,E),F)for(let W=0;W<F.length;W++)q(O,F[W]);if(k){let W=k.subTree;if(D===W){const N=k.vnode;mt(O,N,N.scopeId,N.slotScopeIds,k.parent)}}},m=(O,D,E,F,k,W,N,L,P=0)=>{for(let A=P;A<O.length;A++){const V=O[A]=L?re(O[A]):Yt(O[A]);z(null,V,D,E,F,k,W,N,L)}},dt=(O,D,E,F,k,W,N)=>{const L=D.el=O.el;let{patchFlag:P,dynamicChildren:A,dirs:V}=D;P|=O.patchFlag&16;const H=O.props||Tt,X=D.props||Tt;let $;E&&ue(E,!1),($=X.onVnodeBeforeUpdate)&&Xt($,E,D,O),V&&ce(D,O,E,"beforeUpdate"),E&&ue(E,!0);const Q=k&&D.type!=="foreignObject";if(A?_t(O.dynamicChildren,A,L,E,F,Q,W):N||o(O,D,L,null,E,F,Q,W,!1),P>0){if(P&16)Ft(L,D,H,X,E,F,k);else if(P&2&&H.class!==X.class&&v(L,"class",null,X.class,k),P&4&&v(L,"style",H.style,X.style,k),P&8){const Z=D.dynamicProps;for(let it=0;it<Z.length;it++){const rt=Z[it],at=H[rt],ht=X[rt];(ht!==at||rt==="value")&&v(L,rt,at,ht,k,O.children,E,F,w)}}P&1&&O.children!==D.children&&M(L,D.children)}else!N&&A==null&&Ft(L,D,H,X,E,F,k);(($=X.onVnodeUpdated)||V)&&Rt(()=>{$&&Xt($,E,D,O),V&&ce(D,O,E,"updated")},F)},_t=(O,D,E,F,k,W,N)=>{for(let L=0;L<D.length;L++){const P=O[L],A=D[L],V=P.el&&(P.type===Qt||!ke(P,A)||P.shapeFlag&70)?B(P.el):E;z(P,A,V,null,F,k,W,N,!0)}},Ft=(O,D,E,F,k,W,N)=>{if(E!==F){if(E!==Tt)for(const L in E)!ii(L)&&!(L in F)&&v(O,L,E[L],null,N,D.children,k,W,w);for(const L in F){if(ii(L))continue;const P=F[L],A=E[L];P!==A&&L!=="value"&&v(O,L,A,P,N,D.children,k,W,w)}"value"in F&&v(O,"value",E.value,F.value)}},s=(O,D,E,F,k,W,N,L,P)=>{const A=D.el=O?O.el:C(""),V=D.anchor=O?O.anchor:C("");let{patchFlag:H,dynamicChildren:X,slotScopeIds:$}=D;$&&(L=L?L.concat($):$),O==null?(d(A,E,F),d(V,E,F),m(D.children,E,V,k,W,N,L,P)):H>0&&H&64&&X&&O.dynamicChildren?(_t(O.dynamicChildren,X,E,k,W,N,L),(D.key!=null||k&&D===k.subTree)&&En(O,D,!0)):o(O,D,E,V,k,W,N,L,P)},r=(O,D,E,F,k,W,N,L,P)=>{D.slotScopeIds=L,O==null?D.shapeFlag&512?k.ctx.activate(D,E,F,N,P):n(D,E,F,k,W,N,P):l(O,D,P)},n=(O,D,E,F,k,W,N)=>{const L=O.component=Wo(O,F,k);if(vn(O)&&(L.ctx.renderer=U),Uo(L),L.asyncDep){if(k&&k.registerDep(L,t),!O.el){const P=L.subTree=ae(ze);tt(null,P,D,E)}return}t(L,O,D,E,k,W,N)},l=(O,D,E)=>{const F=D.component=O.component;if(Xs(O,D,E))if(F.asyncDep&&!F.asyncResolved){i(F,D,E);return}else F.next=D,Ws(F.update),F.update();else D.el=O.el,F.vnode=D},t=(O,D,E,F,k,W,N)=>{const L=()=>{if(O.isMounted){let{next:V,bu:H,u:X,parent:$,vnode:Q}=O,Z=V,it;ue(O,!1),V?(V.el=Q.el,i(O,V,N)):V=Q,H&&Si(H),(it=V.props&&V.props.onVnodeBeforeUpdate)&&Xt(it,$,V,Q),ue(O,!0);const rt=Ti(O),at=O.subTree;O.subTree=rt,z(at,rt,B(at.el),I(at),O,k,W),V.el=rt.el,Z===null&&Ys(O,rt.el),X&&Rt(X,k),(it=V.props&&V.props.onVnodeUpdated)&&Rt(()=>Xt(it,$,V,Q),k)}else{let V;const{el:H,props:X}=D,{bm:$,m:Q,parent:Z}=O,it=ri(D);if(ue(O,!1),$&&Si($),!it&&(V=X&&X.onVnodeBeforeMount)&&Xt(V,Z,D),ue(O,!0),H&&K){const rt=()=>{O.subTree=Ti(O),K(H,O.subTree,O,k,null)};it?D.type.__asyncLoader().then(()=>!O.isUnmounted&&rt()):rt()}else{const rt=O.subTree=Ti(O);z(null,rt,E,F,O,k,W),D.el=rt.el}if(Q&&Rt(Q,k),!it&&(V=X&&X.onVnodeMounted)){const rt=D;Rt(()=>Xt(V,Z,rt),k)}(D.shapeFlag&256||Z&&ri(Z.vnode)&&Z.vnode.shapeFlag&256)&&O.a&&Rt(O.a,k),O.isMounted=!0,D=E=F=null}},P=O.effect=new $i(L,()=>sr(A),O.scope),A=O.update=()=>P.run();A.id=O.uid,ue(O,!0),A()},i=(O,D,E)=>{D.component=O;const F=O.vnode.props;O.vnode=D,O.next=null,wo(O,D.props,F,E),So(O,D.children,E),De(),br(),Ie()},o=(O,D,E,F,k,W,N,L,P=!1)=>{const A=O&&O.children,V=O?O.shapeFlag:0,H=D.children,{patchFlag:X,shapeFlag:$}=D;if(X>0){if(X&128){h(A,H,E,F,k,W,N,L,P);return}else if(X&256){f(A,H,E,F,k,W,N,L,P);return}}$&8?(V&16&&w(A,k,W),H!==A&&M(E,H)):V&16?$&16?h(A,H,E,F,k,W,N,L,P):w(A,k,W,!0):(V&8&&M(E,""),$&16&&m(H,E,F,k,W,N,L,P))},f=(O,D,E,F,k,W,N,L,P)=>{O=O||we,D=D||we;const A=O.length,V=D.length,H=Math.min(A,V);let X;for(X=0;X<H;X++){const $=D[X]=P?re(D[X]):Yt(D[X]);z(O[X],$,E,null,k,W,N,L,P)}A>V?w(O,k,W,!0,!1,H):m(D,E,F,k,W,N,L,P,H)},h=(O,D,E,F,k,W,N,L,P)=>{let A=0;const V=D.length;let H=O.length-1,X=V-1;for(;A<=H&&A<=X;){const $=O[A],Q=D[A]=P?re(D[A]):Yt(D[A]);if(ke($,Q))z($,Q,E,null,k,W,N,L,P);else break;A++}for(;A<=H&&A<=X;){const $=O[H],Q=D[X]=P?re(D[X]):Yt(D[X]);if(ke($,Q))z($,Q,E,null,k,W,N,L,P);else break;H--,X--}if(A>H){if(A<=X){const $=X+1,Q=$<V?D[$].el:F;for(;A<=X;)z(null,D[A]=P?re(D[A]):Yt(D[A]),E,Q,k,W,N,L,P),A++}}else if(A>X)for(;A<=H;)g(O[A],k,W,!0),A++;else{const $=A,Q=A,Z=new Map;for(A=Q;A<=X;A++){const Ct=D[A]=P?re(D[A]):Yt(D[A]);Ct.key!=null&&Z.set(Ct.key,A)}let it,rt=0;const at=X-Q+1;let ht=!1,lt=0;const ft=new Array(at);for(A=0;A<at;A++)ft[A]=0;for(A=$;A<=H;A++){const Ct=O[A];if(rt>=at){g(Ct,k,W,!0);continue}let Ot;if(Ct.key!=null)Ot=Z.get(Ct.key);else for(it=Q;it<=X;it++)if(ft[it-Q]===0&&ke(Ct,D[it])){Ot=it;break}Ot===void 0?g(Ct,k,W,!0):(ft[Ot-Q]=A+1,Ot>=lt?lt=Ot:ht=!0,z(Ct,D[Ot],E,null,k,W,N,L,P),rt++)}const yt=ht?Eo(ft):we;for(it=yt.length-1,A=at-1;A>=0;A--){const Ct=Q+A,Ot=D[Ct],Jt=Ct+1<V?D[Ct+1].el:F;ft[A]===0?z(null,Ot,E,Jt,k,W,N,L,P):ht&&(it<0||A!==yt[it]?c(Ot,E,Jt,2):it--)}}},c=(O,D,E,F,k=null)=>{const{el:W,type:N,transition:L,children:P,shapeFlag:A}=O;if(A&6){c(O.component.subTree,D,E,F);return}if(A&128){O.suspense.move(D,E,F);return}if(A&64){N.move(O,D,E,U);return}if(N===Qt){d(W,D,E);for(let H=0;H<P.length;H++)c(P[H],D,E,F);d(O.anchor,D,E);return}if(N===Mi){nt(O,D,E);return}if(F!==2&&A&1&&L)if(F===0)L.beforeEnter(W),d(W,D,E),Rt(()=>L.enter(W),k);else{const{leave:H,delayLeave:X,afterLeave:$}=L,Q=()=>d(W,D,E),Z=()=>{H(W,()=>{Q(),$&&$()})};X?X(W,Q,Z):Z()}else d(W,D,E)},g=(O,D,E,F=!1,k=!1)=>{const{type:W,props:N,ref:L,children:P,dynamicChildren:A,shapeFlag:V,patchFlag:H,dirs:X}=O;if(L!=null&&Ni(L,null,E,O,!0),V&256){D.ctx.deactivate(O);return}const $=V&1&&X,Q=!ri(O);let Z;if(Q&&(Z=N&&N.onVnodeBeforeUnmount)&&Xt(Z,D,O),V&6)x(O.component,E,F);else{if(V&128){O.suspense.unmount(E,F);return}$&&ce(O,null,D,"beforeUnmount"),V&64?O.type.remove(O,D,E,k,U,F):A&&(W!==Qt||H>0&&H&64)?w(A,D,E,!1,!0):(W===Qt&&H&384||!k&&V&16)&&w(P,D,E),F&&_(O)}(Q&&(Z=N&&N.onVnodeUnmounted)||$)&&Rt(()=>{Z&&Xt(Z,D,O),$&&ce(O,null,D,"unmounted")},E)},_=O=>{const{type:D,el:E,anchor:F,transition:k}=O;if(D===Qt){y(E,F);return}if(D===Mi){ot(O);return}const W=()=>{p(E),k&&!k.persisted&&k.afterLeave&&k.afterLeave()};if(O.shapeFlag&1&&k&&!k.persisted){const{leave:N,delayLeave:L}=k,P=()=>N(E,W);L?L(O.el,W,P):P()}else W()},y=(O,D)=>{let E;for(;O!==D;)E=j(O),p(O),O=E;p(D)},x=(O,D,E)=>{const{bum:F,scope:k,update:W,subTree:N,um:L}=O;F&&Si(F),k.stop(),W&&(W.active=!1,g(N,O,D,E)),L&&Rt(L,D),Rt(()=>{O.isUnmounted=!0},D),D&&D.pendingBranch&&!D.isUnmounted&&O.asyncDep&&!O.asyncResolved&&O.suspenseId===D.pendingId&&(D.deps--,D.deps===0&&D.resolve())},w=(O,D,E,F=!1,k=!1,W=0)=>{for(let N=W;N<O.length;N++)g(O[N],D,E,F,k)},I=O=>O.shapeFlag&6?I(O.component.subTree):O.shapeFlag&128?O.suspense.next():j(O.anchor||O.el),R=(O,D,E)=>{O==null?D._vnode&&g(D._vnode,null,null,!0):z(D._vnode||null,O,D,null,null,null,E),br(),un(),D._vnode=O},U={p:z,um:g,m:c,r:_,mt:n,mc:m,pc:o,pbc:_t,n:I,o:u};let G,K;return e&&([G,K]=e(U)),{render:R,hydrate:G,createApp:_o(R,G)}}function ue({effect:u,update:e},a){u.allowRecurse=e.allowRecurse=a}function En(u,e,a=!1){const d=u.children,p=e.children;if(gt(d)&&gt(p))for(let v=0;v<d.length;v++){const b=d[v];let C=p[v];C.shapeFlag&1&&!C.dynamicChildren&&((C.patchFlag<=0||C.patchFlag===32)&&(C=p[v]=re(p[v]),C.el=b.el),a||En(b,C)),C.type===yi&&(C.el=b.el)}}function Eo(u){const e=u.slice(),a=[0];let d,p,v,b,C;const S=u.length;for(d=0;d<S;d++){const T=u[d];if(T!==0){if(p=a[a.length-1],u[p]<T){e[d]=p,a.push(d);continue}for(v=0,b=a.length-1;v<b;)C=v+b>>1,u[a[C]]<T?v=C+1:b=C;T<u[a[v]]&&(v>0&&(e[d]=a[v-1]),a[v]=d)}}for(v=a.length,b=a[v-1];v-- >0;)a[v]=b,b=e[b];return a}const Mo=u=>u.__isTeleport,Qt=Symbol.for("v-fgt"),yi=Symbol.for("v-txt"),ze=Symbol.for("v-cmt"),Mi=Symbol.for("v-stc"),Ue=[];let Gt=null;function Mn(u=!1){Ue.push(Gt=u?null:[])}function Do(){Ue.pop(),Gt=Ue[Ue.length-1]||null}let Xe=1;function Ir(u){Xe+=u}function Dn(u){return u.dynamicChildren=Xe>0?Gt||we:null,Do(),Xe>0&&Gt&&Gt.push(u),u}function Io(u,e,a,d,p,v){return Dn(Fn(u,e,a,d,p,v,!0))}function Fo(u,e,a,d,p){return Dn(ae(u,e,a,d,p,!0))}function Po(u){return u?u.__v_isVNode===!0:!1}function ke(u,e){return u.type===e.type&&u.key===e.key}const bi="__vInternal",In=({key:u})=>u??null,si=({ref:u,ref_key:e,ref_for:a})=>(typeof u=="number"&&(u=""+u),u!=null?It(u)||kt(u)||pt(u)?{i:Kt,r:u,k:e,f:!!a}:u:null);function Fn(u,e=null,a=null,d=0,p=null,v=u===Qt?0:1,b=!1,C=!1){const S={__v_isVNode:!0,__v_skip:!0,type:u,props:e,key:e&&In(e),ref:e&&si(e),scopeId:gn,slotScopeIds:null,children:a,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:v,patchFlag:d,dynamicProps:p,dynamicChildren:null,appContext:null,ctx:Kt};return C?(lr(S,a),v&128&&u.normalize(S)):a&&(S.shapeFlag|=It(a)?8:16),Xe>0&&!b&&Gt&&(S.patchFlag>0||v&6)&&S.patchFlag!==32&&Gt.push(S),S}const ae=Lo;function Lo(u,e=null,a=null,d=0,p=null,v=!1){if((!u||u===ho)&&(u=ze),Po(u)){const C=Oe(u,e,!0);return a&&lr(C,a),Xe>0&&!v&&Gt&&(C.shapeFlag&6?Gt[Gt.indexOf(u)]=C:Gt.push(C)),C.patchFlag|=-2,C}if(Vo(u)&&(u=u.__vccOpts),e){e=ko(e);let{class:C,style:S}=e;C&&!It(C)&&(e.class=Ki(C)),Et(S)&&(nn(S)&&!gt(S)&&(S=Dt({},S)),e.style=qi(S))}const b=It(u)?1:qs(u)?128:Mo(u)?64:Et(u)?4:pt(u)?2:0;return Fn(u,e,a,d,p,b,v,!0)}function ko(u){return u?nn(u)||bi in u?Dt({},u):u:null}function Oe(u,e,a=!1){const{props:d,ref:p,patchFlag:v,children:b}=u,C=e?Ro(d||{},e):d;return{__v_isVNode:!0,__v_skip:!0,type:u.type,props:C,key:C&&In(C),ref:e&&e.ref?a&&p?gt(p)?p.concat(si(e)):[p,si(e)]:si(e):p,scopeId:u.scopeId,slotScopeIds:u.slotScopeIds,children:b,target:u.target,targetAnchor:u.targetAnchor,staticCount:u.staticCount,shapeFlag:u.shapeFlag,patchFlag:e&&u.type!==Qt?v===-1?16:v|16:v,dynamicProps:u.dynamicProps,dynamicChildren:u.dynamicChildren,appContext:u.appContext,dirs:u.dirs,transition:u.transition,component:u.component,suspense:u.suspense,ssContent:u.ssContent&&Oe(u.ssContent),ssFallback:u.ssFallback&&Oe(u.ssFallback),el:u.el,anchor:u.anchor,ctx:u.ctx,ce:u.ce}}function Ao(u=" ",e=0){return ae(yi,null,u,e)}function Yt(u){return u==null||typeof u=="boolean"?ae(ze):gt(u)?ae(Qt,null,u.slice()):typeof u=="object"?re(u):ae(yi,null,String(u))}function re(u){return u.el===null&&u.patchFlag!==-1||u.memo?u:Oe(u)}function lr(u,e){let a=0;const{shapeFlag:d}=u;if(e==null)e=null;else if(gt(e))a=16;else if(typeof e=="object")if(d&65){const p=e.default;p&&(p._c&&(p._d=!1),lr(u,p()),p._c&&(p._d=!0));return}else{a=32;const p=e._;!p&&!(bi in e)?e._ctx=Kt:p===3&&Kt&&(Kt.slots._===1?e._=1:(e._=2,u.patchFlag|=1024))}else pt(e)?(e={default:e,_ctx:Kt},a=32):(e=String(e),d&64?(a=16,e=[Ao(e)]):a=8);u.children=e,u.shapeFlag|=a}function Ro(...u){const e={};for(let a=0;a<u.length;a++){const d=u[a];for(const p in d)if(p==="class")e.class!==d.class&&(e.class=Ki([e.class,d.class]));else if(p==="style")e.style=qi([e.style,d.style]);else if(fi(p)){const v=e[p],b=d[p];b&&v!==b&&!(gt(v)&&v.includes(b))&&(e[p]=v?[].concat(v,b):b)}else p!==""&&(e[p]=d[p])}return e}function Xt(u,e,a,d=null){zt(u,e,7,[a,d])}const jo=wn();let Bo=0;function Wo(u,e,a){const d=u.type,p=(e?e.appContext:u.appContext)||jo,v={uid:Bo++,vnode:u,type:d,parent:e,appContext:p,root:null,next:null,subTree:null,effect:null,update:null,scope:new Zn(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(p.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:xn(d,p),emitsOptions:dn(d,p),emit:null,emitted:null,propsDefaults:Tt,inheritAttrs:d.inheritAttrs,ctx:Tt,data:Tt,props:Tt,attrs:Tt,slots:Tt,refs:Tt,setupState:Tt,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:a,suspenseId:a?a.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return v.ctx={_:v},v.root=e?e.root:v,v.emit=Hs.bind(null,v),u.ce&&u.ce(v),v}let Lt=null,hr,ye,Fr="__VUE_INSTANCE_SETTERS__";(ye=Fi()[Fr])||(ye=Fi()[Fr]=[]),ye.push(u=>Lt=u),hr=u=>{ye.length>1?ye.forEach(e=>e(u)):ye[0](u)};const Ee=u=>{hr(u),u.scope.on()},me=()=>{Lt&&Lt.scope.off(),hr(null)};function Pn(u){return u.vnode.shapeFlag&4}let Ye=!1;function Uo(u,e=!1){Ye=e;const{props:a,children:d}=u.vnode,p=Pn(u);bo(u,a,p,e),xo(u,d);const v=p?No(u,e):void 0;return Ye=!1,v}function No(u,e){const a=u.type;u.accessCache=Object.create(null),u.proxy=sn(new Proxy(u.ctx,co));const{setup:d}=a;if(d){const p=u.setupContext=d.length>1?Go(u):null;Ee(u),De();const v=oe(d,u,0,[u.props,p]);if(Ie(),me(),Gr(v)){if(v.then(me,me),e)return v.then(b=>{Pr(u,b,e)}).catch(b=>{mi(b,u,0)});u.asyncDep=v}else Pr(u,v,e)}else Ln(u,e)}function Pr(u,e,a){pt(e)?u.type.__ssrInlineRender?u.ssrRender=e:u.render=e:Et(e)&&(u.setupState=ln(e)),Ln(u,a)}let Lr;function Ln(u,e,a){const d=u.type;if(!u.render){if(!e&&Lr&&!d.render){const p=d.template||or(u).template;if(p){const{isCustomElement:v,compilerOptions:b}=u.appContext.config,{delimiters:C,compilerOptions:S}=d,T=Dt(Dt({isCustomElement:v,delimiters:C},b),S);d.render=Lr(p,T)}}u.render=d.render||Vt}Ee(u),De(),uo(u),Ie(),me()}function Ho(u){return u.attrsProxy||(u.attrsProxy=new Proxy(u.attrs,{get(e,a){return jt(u,"get","$attrs"),e[a]}}))}function Go(u){const e=a=>{u.exposed=a||{}};return{get attrs(){return Ho(u)},slots:u.slots,emit:u.emit,expose:e}}function cr(u){if(u.exposed)return u.exposeProxy||(u.exposeProxy=new Proxy(ln(sn(u.exposed)),{get(e,a){if(a in e)return e[a];if(a in We)return We[a](u)},has(e,a){return a in e||a in We}}))}function Vo(u){return pt(u)&&"__vccOpts"in u}const zo=(u,e)=>As(u,e,Ye),Xo=Symbol.for("v-scx"),Yo=()=>ni(Xo),qo="3.3.4",Ko="http://www.w3.org/2000/svg",de=typeof document<"u"?document:null,kr=de&&de.createElement("template"),Jo={insert:(u,e,a)=>{e.insertBefore(u,a||null)},remove:u=>{const e=u.parentNode;e&&e.removeChild(u)},createElement:(u,e,a,d)=>{const p=e?de.createElementNS(Ko,u):de.createElement(u,a?{is:a}:void 0);return u==="select"&&d&&d.multiple!=null&&p.setAttribute("multiple",d.multiple),p},createText:u=>de.createTextNode(u),createComment:u=>de.createComment(u),setText:(u,e)=>{u.nodeValue=e},setElementText:(u,e)=>{u.textContent=e},parentNode:u=>u.parentNode,nextSibling:u=>u.nextSibling,querySelector:u=>de.querySelector(u),setScopeId(u,e){u.setAttribute(e,"")},insertStaticContent(u,e,a,d,p,v){const b=a?a.previousSibling:e.lastChild;if(p&&(p===v||p.nextSibling))for(;e.insertBefore(p.cloneNode(!0),a),!(p===v||!(p=p.nextSibling)););else{kr.innerHTML=d?`<svg>${u}</svg>`:u;const C=kr.content;if(d){const S=C.firstChild;for(;S.firstChild;)C.appendChild(S.firstChild);C.removeChild(S)}e.insertBefore(C,a)}return[b?b.nextSibling:e.firstChild,a?a.previousSibling:e.lastChild]}};function $o(u,e,a){const d=u._vtc;d&&(e=(e?[e,...d]:[...d]).join(" ")),e==null?u.removeAttribute("class"):a?u.setAttribute("class",e):u.className=e}function Qo(u,e,a){const d=u.style,p=It(a);if(a&&!p){if(e&&!It(e))for(const v in e)a[v]==null&&Hi(d,v,"");for(const v in a)Hi(d,v,a[v])}else{const v=d.display;p?e!==a&&(d.cssText=a):e&&u.removeAttribute("style"),"_vod"in u&&(d.display=v)}}const Ar=/\s*!important$/;function Hi(u,e,a){if(gt(a))a.forEach(d=>Hi(u,e,d));else if(a==null&&(a=""),e.startsWith("--"))u.setProperty(e,a);else{const d=Zo(u,e);Ar.test(a)?u.setProperty(Me(d),a.replace(Ar,""),"important"):u[d]=a}}const Rr=["Webkit","Moz","ms"],Di={};function Zo(u,e){const a=Di[e];if(a)return a;let d=Se(e);if(d!=="filter"&&d in u)return Di[e]=d;d=Vr(d);for(let p=0;p<Rr.length;p++){const v=Rr[p]+d;if(v in u)return Di[e]=v}return e}const jr="http://www.w3.org/1999/xlink";function ta(u,e,a,d,p){if(d&&e.startsWith("xlink:"))a==null?u.removeAttributeNS(jr,e.slice(6,e.length)):u.setAttributeNS(jr,e,a);else{const v=Qn(e);a==null||v&&!zr(a)?u.removeAttribute(e):u.setAttribute(e,v?"":a)}}function ea(u,e,a,d,p,v,b){if(e==="innerHTML"||e==="textContent"){d&&b(d,p,v),u[e]=a??"";return}const C=u.tagName;if(e==="value"&&C!=="PROGRESS"&&!C.includes("-")){u._value=a;const T=C==="OPTION"?u.getAttribute("value"):u.value,M=a??"";T!==M&&(u.value=M),a==null&&u.removeAttribute(e);return}let S=!1;if(a===""||a==null){const T=typeof u[e];T==="boolean"?a=zr(a):a==null&&T==="string"?(a="",S=!0):T==="number"&&(a=0,S=!0)}try{u[e]=a}catch{}S&&u.removeAttribute(e)}function ia(u,e,a,d){u.addEventListener(e,a,d)}function ra(u,e,a,d){u.removeEventListener(e,a,d)}function na(u,e,a,d,p=null){const v=u._vei||(u._vei={}),b=v[e];if(d&&b)b.value=d;else{const[C,S]=sa(e);if(d){const T=v[e]=la(d,p);ia(u,C,T,S)}else b&&(ra(u,C,b,S),v[e]=void 0)}}const Br=/(?:Once|Passive|Capture)$/;function sa(u){let e;if(Br.test(u)){e={};let d;for(;d=u.match(Br);)u=u.slice(0,u.length-d[0].length),e[d[0].toLowerCase()]=!0}return[u[2]===":"?u.slice(3):Me(u.slice(2)),e]}let Ii=0;const oa=Promise.resolve(),aa=()=>Ii||(oa.then(()=>Ii=0),Ii=Date.now());function la(u,e){const a=d=>{if(!d._vts)d._vts=Date.now();else if(d._vts<=a.attached)return;zt(ha(d,a.value),e,5,[d])};return a.value=u,a.attached=aa(),a}function ha(u,e){if(gt(e)){const a=u.stopImmediatePropagation;return u.stopImmediatePropagation=()=>{a.call(u),u._stopped=!0},e.map(d=>p=>!p._stopped&&d&&d(p))}else return e}const Wr=/^on[a-z]/,ca=(u,e,a,d,p=!1,v,b,C,S)=>{e==="class"?$o(u,d,p):e==="style"?Qo(u,a,d):fi(e)?Vi(e)||na(u,e,a,d,b):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):ua(u,e,d,p))?ea(u,e,d,v,b,C,S):(e==="true-value"?u._trueValue=d:e==="false-value"&&(u._falseValue=d),ta(u,e,d,p))};function ua(u,e,a,d){return d?!!(e==="innerHTML"||e==="textContent"||e in u&&Wr.test(e)&&pt(a)):e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&u.tagName==="INPUT"||e==="type"&&u.tagName==="TEXTAREA"||Wr.test(e)&&It(a)?!1:e in u}const fa=Dt({patchProp:ca},Jo);let Ur;function da(){return Ur||(Ur=To(fa))}const ga=(...u)=>{const e=da().createApp(...u),{mount:a}=e;return e.mount=d=>{const p=pa(d);if(!p)return;const v=e._component;!pt(v)&&!v.render&&!v.template&&(v.template=p.innerHTML),p.innerHTML="";const b=a(p,!1,p instanceof SVGElement);return p instanceof Element&&(p.removeAttribute("v-cloak"),p.setAttribute("data-v-app","")),b},e};function pa(u){return It(u)?document.querySelector(u):u}/*! For license information please see fabric.js.LICENSE.txt */var ma={653:(u,e,a)=>{var d,p,v,b,C,S,T,M,B,j,q,J,z,Y,tt,st,nt,ot,ct,ut,mt,m=m||{version:"5.2.1"};if(e.fabric=m,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?m.document=document:m.document=document.implementation.createHTMLDocument(""),m.window=window;else{var dt=new(a(192)).JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;m.document=dt.document,m.jsdomImplForWrapper=a(898).implForWrapper,m.nodeCanvas=a(245).Canvas,m.window=dt,DOMParser=m.window.DOMParser}function _t(s,r){var n=s.canvas,l=r.targetCanvas,t=l.getContext("2d");t.translate(0,l.height),t.scale(1,-1);var i=n.height-l.height;t.drawImage(n,0,i,l.width,l.height,0,0,l.width,l.height)}function Ft(s,r){var n=r.targetCanvas.getContext("2d"),l=r.destinationWidth,t=r.destinationHeight,i=l*t*4,o=new Uint8Array(this.imageBuffer,0,i),f=new Uint8ClampedArray(this.imageBuffer,0,i);s.readPixels(0,0,l,t,s.RGBA,s.UNSIGNED_BYTE,o);var h=new ImageData(f,l,t);n.putImageData(h,0,0)}m.isTouchSupported="ontouchstart"in m.window||"ontouchstart"in m.document||m.window&&m.window.navigator&&m.window.navigator.maxTouchPoints>0,m.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",m.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],m.DPI=96,m.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",m.commaWsp="(?:\\s+,?\\s*|,\\s*)",m.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,m.reNonWord=/[ \n\.,;!\?\-]/,m.fontPaths={},m.iMatrix=[1,0,0,1,0,0],m.svgNS="http://www.w3.org/2000/svg",m.perfLimitSizeTotal=2097152,m.maxCacheSideLimit=4096,m.minCacheSideLimit=256,m.charWidthsCache={},m.textureSize=2048,m.disableStyleCopyPaste=!1,m.enableGLFiltering=!0,m.devicePixelRatio=m.window.devicePixelRatio||m.window.webkitDevicePixelRatio||m.window.mozDevicePixelRatio||1,m.browserShadowBlurConstant=1,m.arcToSegmentsCache={},m.boundsOfCurveCache={},m.cachesBoundsOfCurve=!0,m.forceGLPutImageData=!1,m.initFilterBackend=function(){return m.enableGLFiltering&&m.isWebglSupported&&m.isWebglSupported(m.textureSize)?(console.log("max texture size: "+m.maxTextureSize),new m.WebglFilterBackend({tileSize:m.textureSize})):m.Canvas2dFilterBackend?new m.Canvas2dFilterBackend:void 0},typeof document<"u"&&typeof window<"u"&&(window.fabric=m),function(){function s(n,l){if(this.__eventListeners[n]){var t=this.__eventListeners[n];l?t[t.indexOf(l)]=!1:m.util.array.fill(t,!1)}}function r(n,l){var t=function(){l.apply(this,arguments),this.off(n,t)}.bind(this);this.on(n,t)}m.Observable={fire:function(n,l){if(!this.__eventListeners)return this;var t=this.__eventListeners[n];if(!t)return this;for(var i=0,o=t.length;i<o;i++)t[i]&&t[i].call(this,l||{});return this.__eventListeners[n]=t.filter(function(f){return f!==!1}),this},on:function(n,l){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var t in n)this.on(t,n[t]);else this.__eventListeners[n]||(this.__eventListeners[n]=[]),this.__eventListeners[n].push(l);return this},once:function(n,l){if(arguments.length===1)for(var t in n)r.call(this,t,n[t]);else r.call(this,n,l);return this},off:function(n,l){if(!this.__eventListeners)return this;if(arguments.length===0)for(n in this.__eventListeners)s.call(this,n);else if(arguments.length===1&&typeof arguments[0]=="object")for(var t in n)s.call(this,t,n[t]);else s.call(this,n,l);return this}}}(),m.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var s=0,r=arguments.length;s<r;s++)this._onObjectAdded(arguments[s]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(s,r,n){var l=this._objects;return n?l[r]=s:l.splice(r,0,s),this._onObjectAdded&&this._onObjectAdded(s),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var s,r=this._objects,n=!1,l=0,t=arguments.length;l<t;l++)(s=r.indexOf(arguments[l]))!==-1&&(n=!0,r.splice(s,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[l]));return this.renderOnAddRemove&&n&&this.requestRenderAll(),this},forEachObject:function(s,r){for(var n=this.getObjects(),l=0,t=n.length;l<t;l++)s.call(r,n[l],l,n);return this},getObjects:function(s){return s===void 0?this._objects.concat():this._objects.filter(function(r){return r.type===s})},item:function(s){return this._objects[s]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(s,r){return this._objects.indexOf(s)>-1||!!r&&this._objects.some(function(n){return typeof n.contains=="function"&&n.contains(s,!0)})},complexity:function(){return this._objects.reduce(function(s,r){return s+(r.complexity?r.complexity():0)},0)}},m.CommonMethods={_setOptions:function(s){for(var r in s)this.set(r,s[r])},_initGradient:function(s,r){!s||!s.colorStops||s instanceof m.Gradient||this.set(r,new m.Gradient(s))},_initPattern:function(s,r,n){!s||!s.source||s instanceof m.Pattern?n&&n():this.set(r,new m.Pattern(s,n))},_setObject:function(s){for(var r in s)this._set(r,s[r])},set:function(s,r){return typeof s=="object"?this._setObject(s):this._set(s,r),this},_set:function(s,r){this[s]=r},toggle:function(s){var r=this.get(s);return typeof r=="boolean"&&this.set(s,!r),this},get:function(s){return this[s]}},d=e,p=Math.sqrt,v=Math.atan2,b=Math.pow,C=Math.PI/180,S=Math.PI/2,m.util={cos:function(s){if(s===0)return 1;switch(s<0&&(s=-s),s/S){case 1:case 3:return 0;case 2:return-1}return Math.cos(s)},sin:function(s){if(s===0)return 0;var r=1;switch(s<0&&(r=-1),s/S){case 1:return r;case 2:return 0;case 3:return-r}return Math.sin(s)},removeFromArray:function(s,r){var n=s.indexOf(r);return n!==-1&&s.splice(n,1),s},getRandomInt:function(s,r){return Math.floor(Math.random()*(r-s+1))+s},degreesToRadians:function(s){return s*C},radiansToDegrees:function(s){return s/C},rotatePoint:function(s,r,n){var l=new m.Point(s.x-r.x,s.y-r.y),t=m.util.rotateVector(l,n);return new m.Point(t.x,t.y).addEquals(r)},rotateVector:function(s,r){var n=m.util.sin(r),l=m.util.cos(r);return{x:s.x*l-s.y*n,y:s.x*n+s.y*l}},createVector:function(s,r){return new m.Point(r.x-s.x,r.y-s.y)},calcAngleBetweenVectors:function(s,r){return Math.acos((s.x*r.x+s.y*r.y)/(Math.hypot(s.x,s.y)*Math.hypot(r.x,r.y)))},getHatVector:function(s){return new m.Point(s.x,s.y).multiply(1/Math.hypot(s.x,s.y))},getBisector:function(s,r,n){var l=m.util.createVector(s,r),t=m.util.createVector(s,n),i=m.util.calcAngleBetweenVectors(l,t),o=i*(m.util.calcAngleBetweenVectors(m.util.rotateVector(l,i),t)===0?1:-1)/2;return{vector:m.util.getHatVector(m.util.rotateVector(l,o)),angle:i}},projectStrokeOnPoints:function(s,r,n){var l=[],t=r.strokeWidth/2,i=r.strokeUniform?new m.Point(1/r.scaleX,1/r.scaleY):new m.Point(1,1),o=function(f){var h=t/Math.hypot(f.x,f.y);return new m.Point(f.x*h*i.x,f.y*h*i.y)};return s.length<=1||s.forEach(function(f,h){var c,g,_=new m.Point(f.x,f.y);h===0?(g=s[h+1],c=n?o(m.util.createVector(g,_)).addEquals(_):s[s.length-1]):h===s.length-1?(c=s[h-1],g=n?o(m.util.createVector(c,_)).addEquals(_):s[0]):(c=s[h-1],g=s[h+1]);var y,x,w=m.util.getBisector(_,c,g),I=w.vector,R=w.angle;if(r.strokeLineJoin==="miter"&&(y=-t/Math.sin(R/2),x=new m.Point(I.x*y*i.x,I.y*y*i.y),Math.hypot(x.x,x.y)/t<=r.strokeMiterLimit))return l.push(_.add(x)),void l.push(_.subtract(x));y=-t*Math.SQRT2,x=new m.Point(I.x*y*i.x,I.y*y*i.y),l.push(_.add(x)),l.push(_.subtract(x))}),l},transformPoint:function(s,r,n){return n?new m.Point(r[0]*s.x+r[2]*s.y,r[1]*s.x+r[3]*s.y):new m.Point(r[0]*s.x+r[2]*s.y+r[4],r[1]*s.x+r[3]*s.y+r[5])},makeBoundingBoxFromPoints:function(s,r){if(r)for(var n=0;n<s.length;n++)s[n]=m.util.transformPoint(s[n],r);var l=[s[0].x,s[1].x,s[2].x,s[3].x],t=m.util.array.min(l),i=m.util.array.max(l)-t,o=[s[0].y,s[1].y,s[2].y,s[3].y],f=m.util.array.min(o);return{left:t,top:f,width:i,height:m.util.array.max(o)-f}},invertTransform:function(s){var r=1/(s[0]*s[3]-s[1]*s[2]),n=[r*s[3],-r*s[1],-r*s[2],r*s[0]],l=m.util.transformPoint({x:s[4],y:s[5]},n,!0);return n[4]=-l.x,n[5]=-l.y,n},toFixed:function(s,r){return parseFloat(Number(s).toFixed(r))},parseUnit:function(s,r){var n=/\D{0,2}$/.exec(s),l=parseFloat(s);switch(r||(r=m.Text.DEFAULT_SVG_FONT_SIZE),n[0]){case"mm":return l*m.DPI/25.4;case"cm":return l*m.DPI/2.54;case"in":return l*m.DPI;case"pt":return l*m.DPI/72;case"pc":return l*m.DPI/72*12;case"em":return l*r;default:return l}},falseFunction:function(){return!1},getKlass:function(s,r){return s=m.util.string.camelize(s.charAt(0).toUpperCase()+s.slice(1)),m.util.resolveNamespace(r)[s]},getSvgAttributes:function(s){var r=["instantiated_by_use","style","id","class"];switch(s){case"linearGradient":r=r.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":r=r.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":r=r.concat(["offset","stop-color","stop-opacity"])}return r},resolveNamespace:function(s){if(!s)return m;var r,n=s.split("."),l=n.length,t=d||m.window;for(r=0;r<l;++r)t=t[n[r]];return t},loadImage:function(s,r,n,l){if(s){var t=m.util.createImage(),i=function(){r&&r.call(n,t,!1),t=t.onload=t.onerror=null};t.onload=i,t.onerror=function(){m.log("Error loading "+t.src),r&&r.call(n,null,!0),t=t.onload=t.onerror=null},s.indexOf("data")!==0&&l!=null&&(t.crossOrigin=l),s.substring(0,14)==="data:image/svg"&&(t.onload=null,m.util.loadImageInDom(t,i)),t.src=s}else r&&r.call(n,s)},loadImageInDom:function(s,r){var n=m.document.createElement("div");n.style.width=n.style.height="1px",n.style.left=n.style.top="-100%",n.style.position="absolute",n.appendChild(s),m.document.querySelector("body").appendChild(n),s.onload=function(){r(),n.parentNode.removeChild(n),n=null}},enlivenObjects:function(s,r,n,l){var t=[],i=0,o=(s=s||[]).length;function f(){++i===o&&r&&r(t.filter(function(h){return h}))}o?s.forEach(function(h,c){h&&h.type?m.util.getKlass(h.type,n).fromObject(h,function(g,_){_||(t[c]=g),l&&l(h,g,_),f()}):f()}):r&&r(t)},enlivenObjectEnlivables:function(s,r,n){var l=m.Object.ENLIVEN_PROPS.filter(function(t){return!!s[t]});m.util.enlivenObjects(l.map(function(t){return s[t]}),function(t){var i={};l.forEach(function(o,f){i[o]=t[f],r&&(r[o]=t[f])}),n&&n(i)})},enlivenPatterns:function(s,r){function n(){++t===i&&r&&r(l)}var l=[],t=0,i=(s=s||[]).length;i?s.forEach(function(o,f){o&&o.source?new m.Pattern(o,function(h){l[f]=h,n()}):(l[f]=o,n())}):r&&r(l)},groupSVGElements:function(s,r,n){var l;return s&&s.length===1?s[0]:(r&&(r.width&&r.height?r.centerPoint={x:r.width/2,y:r.height/2}:(delete r.width,delete r.height)),l=new m.Group(s,r),n!==void 0&&(l.sourcePath=n),l)},populateWithProperties:function(s,r,n){if(n&&Array.isArray(n))for(var l=0,t=n.length;l<t;l++)n[l]in s&&(r[n[l]]=s[n[l]])},createCanvasElement:function(){return m.document.createElement("canvas")},copyCanvasElement:function(s){var r=m.util.createCanvasElement();return r.width=s.width,r.height=s.height,r.getContext("2d").drawImage(s,0,0),r},toDataURL:function(s,r,n){return s.toDataURL("image/"+r,n)},createImage:function(){return m.document.createElement("img")},multiplyTransformMatrices:function(s,r,n){return[s[0]*r[0]+s[2]*r[1],s[1]*r[0]+s[3]*r[1],s[0]*r[2]+s[2]*r[3],s[1]*r[2]+s[3]*r[3],n?0:s[0]*r[4]+s[2]*r[5]+s[4],n?0:s[1]*r[4]+s[3]*r[5]+s[5]]},qrDecompose:function(s){var r=v(s[1],s[0]),n=b(s[0],2)+b(s[1],2),l=p(n),t=(s[0]*s[3]-s[2]*s[1])/l,i=v(s[0]*s[2]+s[1]*s[3],n);return{angle:r/C,scaleX:l,scaleY:t,skewX:i/C,skewY:0,translateX:s[4],translateY:s[5]}},calcRotateMatrix:function(s){if(!s.angle)return m.iMatrix.concat();var r=m.util.degreesToRadians(s.angle),n=m.util.cos(r),l=m.util.sin(r);return[n,l,-l,n,0,0]},calcDimensionsMatrix:function(s){var r=s.scaleX===void 0?1:s.scaleX,n=s.scaleY===void 0?1:s.scaleY,l=[s.flipX?-r:r,0,0,s.flipY?-n:n,0,0],t=m.util.multiplyTransformMatrices,i=m.util.degreesToRadians;return s.skewX&&(l=t(l,[1,0,Math.tan(i(s.skewX)),1],!0)),s.skewY&&(l=t(l,[1,Math.tan(i(s.skewY)),0,1],!0)),l},composeMatrix:function(s){var r=[1,0,0,1,s.translateX||0,s.translateY||0],n=m.util.multiplyTransformMatrices;return s.angle&&(r=n(r,m.util.calcRotateMatrix(s))),(s.scaleX!==1||s.scaleY!==1||s.skewX||s.skewY||s.flipX||s.flipY)&&(r=n(r,m.util.calcDimensionsMatrix(s))),r},resetObjectTransform:function(s){s.scaleX=1,s.scaleY=1,s.skewX=0,s.skewY=0,s.flipX=!1,s.flipY=!1,s.rotate(0)},saveObjectTransform:function(s){return{scaleX:s.scaleX,scaleY:s.scaleY,skewX:s.skewX,skewY:s.skewY,angle:s.angle,left:s.left,flipX:s.flipX,flipY:s.flipY,top:s.top}},isTransparent:function(s,r,n,l){l>0&&(r>l?r-=l:r=0,n>l?n-=l:n=0);var t,i=!0,o=s.getImageData(r,n,2*l||1,2*l||1),f=o.data.length;for(t=3;t<f&&(i=o.data[t]<=0)!=0;t+=4);return o=null,i},parsePreserveAspectRatioAttribute:function(s){var r,n="meet",l=s.split(" ");return l&&l.length&&((n=l.pop())!=="meet"&&n!=="slice"?(r=n,n="meet"):l.length&&(r=l.pop())),{meetOrSlice:n,alignX:r!=="none"?r.slice(1,4):"none",alignY:r!=="none"?r.slice(5,8):"none"}},clearFabricFontCache:function(s){(s=(s||"").toLowerCase())?m.charWidthsCache[s]&&delete m.charWidthsCache[s]:m.charWidthsCache={}},limitDimsByArea:function(s,r){var n=Math.sqrt(r*s),l=Math.floor(r/n);return{x:Math.floor(n),y:l}},capValue:function(s,r,n){return Math.max(s,Math.min(r,n))},findScaleToFit:function(s,r){return Math.min(r.width/s.width,r.height/s.height)},findScaleToCover:function(s,r){return Math.max(r.width/s.width,r.height/s.height)},matrixToSVG:function(s){return"matrix("+s.map(function(r){return m.util.toFixed(r,m.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(s,r){var n=m.util.invertTransform(r),l=m.util.multiplyTransformMatrices(n,s.calcOwnMatrix());m.util.applyTransformToObject(s,l)},addTransformToObject:function(s,r){m.util.applyTransformToObject(s,m.util.multiplyTransformMatrices(r,s.calcOwnMatrix()))},applyTransformToObject:function(s,r){var n=m.util.qrDecompose(r),l=new m.Point(n.translateX,n.translateY);s.flipX=!1,s.flipY=!1,s.set("scaleX",n.scaleX),s.set("scaleY",n.scaleY),s.skewX=n.skewX,s.skewY=n.skewY,s.angle=n.angle,s.setPositionByOrigin(l,"center","center")},sizeAfterTransform:function(s,r,n){var l=s/2,t=r/2,i=[{x:-l,y:-t},{x:l,y:-t},{x:-l,y:t},{x:l,y:t}],o=m.util.calcDimensionsMatrix(n),f=m.util.makeBoundingBoxFromPoints(i,o);return{x:f.width,y:f.height}},mergeClipPaths:function(s,r){var n=s,l=r;n.inverted&&!l.inverted&&(n=r,l=s),m.util.applyTransformToObject(l,m.util.multiplyTransformMatrices(m.util.invertTransform(n.calcTransformMatrix()),l.calcTransformMatrix()));var t=n.inverted&&l.inverted;return t&&(n.inverted=l.inverted=!1),new m.Group([n],{clipPath:l,inverted:t})}},function(){var s=Array.prototype.join,r={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},n={m:"l",M:"L"};function l(x,w,I,R,U,G,K,O,D,E,F){var k=m.util.cos(x),W=m.util.sin(x),N=m.util.cos(w),L=m.util.sin(w),P=I*U*N-R*G*L+K,A=R*U*N+I*G*L+O;return["C",E+D*(-I*U*W-R*G*k),F+D*(-R*U*W+I*G*k),P+D*(I*U*L+R*G*N),A+D*(R*U*L-I*G*N),P,A]}function t(x,w,I,R){var U=Math.atan2(w,x),G=Math.atan2(R,I);return G>=U?G-U:2*Math.PI-(U-G)}function i(x,w,I){for(var R=I[1],U=I[2],G=I[3],K=I[4],O=I[5],D=function(k,W,N,L,P,A,V){var H=Math.PI,X=V*H/180,$=m.util.sin(X),Q=m.util.cos(X),Z=0,it=0,rt=-Q*k*.5-$*W*.5,at=-Q*W*.5+$*k*.5,ht=(N=Math.abs(N))*N,lt=(L=Math.abs(L))*L,ft=at*at,yt=rt*rt,Ct=ht*lt-ht*ft-lt*yt,Ot=0;if(Ct<0){var Jt=Math.sqrt(1-Ct/(ht*lt));N*=Jt,L*=Jt}else Ot=(P===A?-1:1)*Math.sqrt(Ct/(ht*ft+lt*yt));var xt=Ot*N*at/L,Ut=-Ot*L*rt/N,Fe=Q*xt-$*Ut+.5*k,ve=$*xt+Q*Ut+.5*W,he=t(1,0,(rt-xt)/N,(at-Ut)/L),_e=t((rt-xt)/N,(at-Ut)/L,(-rt-xt)/N,(-at-Ut)/L);A===0&&_e>0?_e-=2*H:A===1&&_e<0&&(_e+=2*H);for(var ur=Math.ceil(Math.abs(_e/H*2)),qe=[],Pe=_e/ur,Rn=8/3*Math.sin(Pe/4)*Math.sin(Pe/4)/Math.sin(Pe/2),Ci=he+Pe,Le=0;Le<ur;Le++)qe[Le]=l(he,Ci,Q,$,N,L,Fe,ve,Rn,Z,it),Z=qe[Le][5],it=qe[Le][6],he=Ci,Ci+=Pe;return qe}(I[6]-x,I[7]-w,R,U,K,O,G),E=0,F=D.length;E<F;E++)D[E][1]+=x,D[E][2]+=w,D[E][3]+=x,D[E][4]+=w,D[E][5]+=x,D[E][6]+=w;return D}function o(x,w,I,R){return Math.sqrt((I-x)*(I-x)+(R-w)*(R-w))}function f(x,w,I,R,U,G,K,O){return function(D){var E,F=(E=D)*E*E,k=function(L){return 3*L*L*(1-L)}(D),W=function(L){return 3*L*(1-L)*(1-L)}(D),N=function(L){return(1-L)*(1-L)*(1-L)}(D);return{x:K*F+U*k+I*W+x*N,y:O*F+G*k+R*W+w*N}}}function h(x,w,I,R,U,G,K,O){return function(D){var E=1-D,F=3*E*E*(I-x)+6*E*D*(U-I)+3*D*D*(K-U),k=3*E*E*(R-w)+6*E*D*(G-R)+3*D*D*(O-G);return Math.atan2(k,F)}}function c(x,w,I,R,U,G){return function(K){var O,D=(O=K)*O,E=function(k){return 2*k*(1-k)}(K),F=function(k){return(1-k)*(1-k)}(K);return{x:U*D+I*E+x*F,y:G*D+R*E+w*F}}}function g(x,w,I,R,U,G){return function(K){var O=1-K,D=2*O*(I-x)+2*K*(U-I),E=2*O*(R-w)+2*K*(G-R);return Math.atan2(E,D)}}function _(x,w,I){var R,U,G={x:w,y:I},K=0;for(U=1;U<=100;U+=1)R=x(U/100),K+=o(G.x,G.y,R.x,R.y),G=R;return K}function y(x){for(var w,I,R,U,G=0,K=x.length,O=0,D=0,E=0,F=0,k=[],W=0;W<K;W++){switch(R={x:O,y:D,command:(w=x[W])[0]},w[0]){case"M":R.length=0,E=O=w[1],F=D=w[2];break;case"L":R.length=o(O,D,w[1],w[2]),O=w[1],D=w[2];break;case"C":I=f(O,D,w[1],w[2],w[3],w[4],w[5],w[6]),U=h(O,D,w[1],w[2],w[3],w[4],w[5],w[6]),R.iterator=I,R.angleFinder=U,R.length=_(I,O,D),O=w[5],D=w[6];break;case"Q":I=c(O,D,w[1],w[2],w[3],w[4]),U=g(O,D,w[1],w[2],w[3],w[4]),R.iterator=I,R.angleFinder=U,R.length=_(I,O,D),O=w[3],D=w[4];break;case"Z":case"z":R.destX=E,R.destY=F,R.length=o(O,D,E,F),O=E,D=F}G+=R.length,k.push(R)}return k.push({length:G,x:O,y:D}),k}m.util.joinPath=function(x){return x.map(function(w){return w.join(" ")}).join(" ")},m.util.parsePath=function(x){var w,I,R,U,G,K=[],O=[],D=m.rePathCommand,E="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",F="("+E+")"+m.commaWsp,k="([01])"+m.commaWsp+"?",W=new RegExp(F+"?"+F+"?"+F+k+k+F+"?("+E+")","g");if(!x||!x.match)return K;for(var N,L=0,P=(G=x.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;L<P;L++){U=(w=G[L]).slice(1).trim(),O.length=0;var A=w.charAt(0);if(N=[A],A.toLowerCase()==="a")for(var V;V=W.exec(U);)for(var H=1;H<V.length;H++)O.push(V[H]);else for(;R=D.exec(U);)O.push(R[0]);H=0;for(var X=O.length;H<X;H++)I=parseFloat(O[H]),isNaN(I)||N.push(I);var $=r[A.toLowerCase()],Q=n[A]||A;if(N.length-1>$)for(var Z=1,it=N.length;Z<it;Z+=$)K.push([A].concat(N.slice(Z,Z+$))),A=Q;else K.push(N)}return K},m.util.makePathSimpler=function(x){var w,I,R,U,G,K,O=0,D=0,E=x.length,F=0,k=0,W=[];for(I=0;I<E;++I){switch(R=!1,(w=x[I].slice(0))[0]){case"l":w[0]="L",w[1]+=O,w[2]+=D;case"L":O=w[1],D=w[2];break;case"h":w[1]+=O;case"H":w[0]="L",w[2]=D,O=w[1];break;case"v":w[1]+=D;case"V":w[0]="L",D=w[1],w[1]=O,w[2]=D;break;case"m":w[0]="M",w[1]+=O,w[2]+=D;case"M":O=w[1],D=w[2],F=w[1],k=w[2];break;case"c":w[0]="C",w[1]+=O,w[2]+=D,w[3]+=O,w[4]+=D,w[5]+=O,w[6]+=D;case"C":G=w[3],K=w[4],O=w[5],D=w[6];break;case"s":w[0]="S",w[1]+=O,w[2]+=D,w[3]+=O,w[4]+=D;case"S":U==="C"?(G=2*O-G,K=2*D-K):(G=O,K=D),O=w[3],D=w[4],w[0]="C",w[5]=w[3],w[6]=w[4],w[3]=w[1],w[4]=w[2],w[1]=G,w[2]=K,G=w[3],K=w[4];break;case"q":w[0]="Q",w[1]+=O,w[2]+=D,w[3]+=O,w[4]+=D;case"Q":G=w[1],K=w[2],O=w[3],D=w[4];break;case"t":w[0]="T",w[1]+=O,w[2]+=D;case"T":U==="Q"?(G=2*O-G,K=2*D-K):(G=O,K=D),w[0]="Q",O=w[1],D=w[2],w[1]=G,w[2]=K,w[3]=O,w[4]=D;break;case"a":w[0]="A",w[6]+=O,w[7]+=D;case"A":R=!0,W=W.concat(i(O,D,w)),O=w[6],D=w[7];break;case"z":case"Z":O=F,D=k}R||W.push(w),U=w[0]}return W},m.util.getSmoothPathFromPoints=function(x,w){var I,R=[],U=new m.Point(x[0].x,x[0].y),G=new m.Point(x[1].x,x[1].y),K=x.length,O=1,D=0,E=K>2;for(w=w||0,E&&(O=x[2].x<G.x?-1:x[2].x===G.x?0:1,D=x[2].y<G.y?-1:x[2].y===G.y?0:1),R.push(["M",U.x-O*w,U.y-D*w]),I=1;I<K;I++){if(!U.eq(G)){var F=U.midPointFrom(G);R.push(["Q",U.x,U.y,F.x,F.y])}U=x[I],I+1<x.length&&(G=x[I+1])}return E&&(O=U.x>x[I-2].x?1:U.x===x[I-2].x?0:-1,D=U.y>x[I-2].y?1:U.y===x[I-2].y?0:-1),R.push(["L",U.x+O*w,U.y+D*w]),R},m.util.getPathSegmentsInfo=y,m.util.getBoundsOfCurve=function(x,w,I,R,U,G,K,O){var D;if(m.cachesBoundsOfCurve&&(D=s.call(arguments),m.boundsOfCurveCache[D]))return m.boundsOfCurveCache[D];var E,F,k,W,N,L,P,A,V=Math.sqrt,H=Math.min,X=Math.max,$=Math.abs,Q=[],Z=[[],[]];F=6*x-12*I+6*U,E=-3*x+9*I-9*U+3*K,k=3*I-3*x;for(var it=0;it<2;++it)if(it>0&&(F=6*w-12*R+6*G,E=-3*w+9*R-9*G+3*O,k=3*R-3*w),$(E)<1e-12){if($(F)<1e-12)continue;0<(W=-k/F)&&W<1&&Q.push(W)}else(P=F*F-4*k*E)<0||(0<(N=(-F+(A=V(P)))/(2*E))&&N<1&&Q.push(N),0<(L=(-F-A)/(2*E))&&L<1&&Q.push(L));for(var rt,at,ht,lt=Q.length,ft=lt;lt--;)rt=(ht=1-(W=Q[lt]))*ht*ht*x+3*ht*ht*W*I+3*ht*W*W*U+W*W*W*K,Z[0][lt]=rt,at=ht*ht*ht*w+3*ht*ht*W*R+3*ht*W*W*G+W*W*W*O,Z[1][lt]=at;Z[0][ft]=x,Z[1][ft]=w,Z[0][ft+1]=K,Z[1][ft+1]=O;var yt=[{x:H.apply(null,Z[0]),y:H.apply(null,Z[1])},{x:X.apply(null,Z[0]),y:X.apply(null,Z[1])}];return m.cachesBoundsOfCurve&&(m.boundsOfCurveCache[D]=yt),yt},m.util.getPointOnPath=function(x,w,I){I||(I=y(x));for(var R=0;w-I[R].length>0&&R<I.length-2;)w-=I[R].length,R++;var U,G=I[R],K=w/G.length,O=G.command,D=x[R];switch(O){case"M":return{x:G.x,y:G.y,angle:0};case"Z":case"z":return(U=new m.Point(G.x,G.y).lerp(new m.Point(G.destX,G.destY),K)).angle=Math.atan2(G.destY-G.y,G.destX-G.x),U;case"L":return(U=new m.Point(G.x,G.y).lerp(new m.Point(D[1],D[2]),K)).angle=Math.atan2(D[2]-G.y,D[1]-G.x),U;case"C":case"Q":return function(E,F){for(var k,W,N,L=0,P=0,A=E.iterator,V={x:E.x,y:E.y},H=.01,X=E.angleFinder;P<F&&H>1e-4;)k=A(L),N=L,(W=o(V.x,V.y,k.x,k.y))+P>F?(L-=H,H/=2):(V=k,L+=H,P+=W);return k.angle=X(N),k}(G,w)}},m.util.transformPath=function(x,w,I){return I&&(w=m.util.multiplyTransformMatrices(w,[1,0,0,1,-I.x,-I.y])),x.map(function(R){for(var U=R.slice(0),G={},K=1;K<R.length-1;K+=2)G.x=R[K],G.y=R[K+1],G=m.util.transformPoint(G,w),U[K]=G.x,U[K+1]=G.y;return U})}}(),function(){var s=Array.prototype.slice;function r(n,l,t){if(n&&n.length!==0){var i=n.length-1,o=l?n[i][l]:n[i];if(l)for(;i--;)t(n[i][l],o)&&(o=n[i][l]);else for(;i--;)t(n[i],o)&&(o=n[i]);return o}}m.util.array={fill:function(n,l){for(var t=n.length;t--;)n[t]=l;return n},invoke:function(n,l){for(var t=s.call(arguments,2),i=[],o=0,f=n.length;o<f;o++)i[o]=t.length?n[o][l].apply(n[o],t):n[o][l].call(n[o]);return i},min:function(n,l){return r(n,l,function(t,i){return t<i})},max:function(n,l){return r(n,l,function(t,i){return t>=i})}}}(),function(){function s(r,n,l){if(l)if(!m.isLikelyNode&&n instanceof Element)r=n;else if(n instanceof Array){r=[];for(var t=0,i=n.length;t<i;t++)r[t]=s({},n[t],l)}else if(n&&typeof n=="object")for(var o in n)o==="canvas"||o==="group"?r[o]=null:n.hasOwnProperty(o)&&(r[o]=s({},n[o],l));else r=n;else for(var o in n)r[o]=n[o];return r}m.util.object={extend:s,clone:function(r,n){return s({},r,n)}},m.util.object.extend(m.util,m.Observable)}(),function(){function s(r,n){var l=r.charCodeAt(n);if(isNaN(l))return"";if(l<55296||l>57343)return r.charAt(n);if(55296<=l&&l<=56319){if(r.length<=n+1)throw"High surrogate without following low surrogate";var t=r.charCodeAt(n+1);if(56320>t||t>57343)throw"High surrogate without following low surrogate";return r.charAt(n)+r.charAt(n+1)}if(n===0)throw"Low surrogate without preceding high surrogate";var i=r.charCodeAt(n-1);if(55296>i||i>56319)throw"Low surrogate without preceding high surrogate";return!1}m.util.string={camelize:function(r){return r.replace(/-+(.)?/g,function(n,l){return l?l.toUpperCase():""})},capitalize:function(r,n){return r.charAt(0).toUpperCase()+(n?r.slice(1):r.slice(1).toLowerCase())},escapeXml:function(r){return r.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(r){var n,l=0,t=[];for(l=0;l<r.length;l++)(n=s(r,l))!==!1&&t.push(n);return t}}}(),function(){var s=Array.prototype.slice,r=function(){},n=function(){for(var o in{toString:1})if(o==="toString")return!1;return!0}(),l=function(o,f,h){for(var c in f)c in o.prototype&&typeof o.prototype[c]=="function"&&(f[c]+"").indexOf("callSuper")>-1?o.prototype[c]=function(g){return function(){var _=this.constructor.superclass;this.constructor.superclass=h;var y=f[g].apply(this,arguments);if(this.constructor.superclass=_,g!=="initialize")return y}}(c):o.prototype[c]=f[c],n&&(f.toString!==Object.prototype.toString&&(o.prototype.toString=f.toString),f.valueOf!==Object.prototype.valueOf&&(o.prototype.valueOf=f.valueOf))};function t(){}function i(o){for(var f=null,h=this;h.constructor.superclass;){var c=h.constructor.superclass.prototype[o];if(h[o]!==c){f=c;break}h=h.constructor.superclass.prototype}return f?arguments.length>1?f.apply(this,s.call(arguments,1)):f.call(this):console.log("tried to callSuper "+o+", method not found in prototype chain",this)}m.util.createClass=function(){var o=null,f=s.call(arguments,0);function h(){this.initialize.apply(this,arguments)}typeof f[0]=="function"&&(o=f.shift()),h.superclass=o,h.subclasses=[],o&&(t.prototype=o.prototype,h.prototype=new t,o.subclasses.push(h));for(var c=0,g=f.length;c<g;c++)l(h,f[c],o);return h.prototype.initialize||(h.prototype.initialize=r),h.prototype.constructor=h,h.prototype.callSuper=i,h}}(),T=!!m.document.createElement("div").attachEvent,M=["touchstart","touchmove","touchend"],m.util.addListener=function(s,r,n,l){s&&s.addEventListener(r,n,!T&&l)},m.util.removeListener=function(s,r,n,l){s&&s.removeEventListener(r,n,!T&&l)},m.util.getPointer=function(s){var r=s.target,n=m.util.getScrollLeftTop(r),l=function(t){var i=t.changedTouches;return i&&i[0]?i[0]:t}(s);return{x:l.clientX+n.left,y:l.clientY+n.top}},m.util.isTouchEvent=function(s){return M.indexOf(s.type)>-1||s.pointerType==="touch"},j=typeof(B=m.document.createElement("div")).style.opacity=="string",q=typeof B.style.filter=="string",J=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,z=function(s){return s},j?z=function(s,r){return s.style.opacity=r,s}:q&&(z=function(s,r){var n=s.style;return s.currentStyle&&!s.currentStyle.hasLayout&&(n.zoom=1),J.test(n.filter)?(r=r>=.9999?"":"alpha(opacity="+100*r+")",n.filter=n.filter.replace(J,r)):n.filter+=" alpha(opacity="+100*r+")",s}),m.util.setStyle=function(s,r){var n=s.style;if(!n)return s;if(typeof r=="string")return s.style.cssText+=";"+r,r.indexOf("opacity")>-1?z(s,r.match(/opacity:\s*(\d?\.?\d*)/)[1]):s;for(var l in r)l==="opacity"?z(s,r[l]):n[l==="float"||l==="cssFloat"?n.styleFloat===void 0?"cssFloat":"styleFloat":l]=r[l];return s},function(){var s,r,n,l,t=Array.prototype.slice,i=function(h){return t.call(h,0)};try{s=i(m.document.childNodes)instanceof Array}catch{}function o(h,c){var g=m.document.createElement(h);for(var _ in c)_==="class"?g.className=c[_]:_==="for"?g.htmlFor=c[_]:g.setAttribute(_,c[_]);return g}function f(h){for(var c=0,g=0,_=m.document.documentElement,y=m.document.body||{scrollLeft:0,scrollTop:0};h&&(h.parentNode||h.host)&&((h=h.parentNode||h.host)===m.document?(c=y.scrollLeft||_.scrollLeft||0,g=y.scrollTop||_.scrollTop||0):(c+=h.scrollLeft||0,g+=h.scrollTop||0),h.nodeType!==1||h.style.position!=="fixed"););return{left:c,top:g}}s||(i=function(h){for(var c=new Array(h.length),g=h.length;g--;)c[g]=h[g];return c}),r=m.document.defaultView&&m.document.defaultView.getComputedStyle?function(h,c){var g=m.document.defaultView.getComputedStyle(h,null);return g?g[c]:void 0}:function(h,c){var g=h.style[c];return!g&&h.currentStyle&&(g=h.currentStyle[c]),g},n=m.document.documentElement.style,l="userSelect"in n?"userSelect":"MozUserSelect"in n?"MozUserSelect":"WebkitUserSelect"in n?"WebkitUserSelect":"KhtmlUserSelect"in n?"KhtmlUserSelect":"",m.util.makeElementUnselectable=function(h){return h.onselectstart!==void 0&&(h.onselectstart=m.util.falseFunction),l?h.style[l]="none":typeof h.unselectable=="string"&&(h.unselectable="on"),h},m.util.makeElementSelectable=function(h){return h.onselectstart!==void 0&&(h.onselectstart=null),l?h.style[l]="":typeof h.unselectable=="string"&&(h.unselectable=""),h},m.util.setImageSmoothing=function(h,c){h.imageSmoothingEnabled=h.imageSmoothingEnabled||h.webkitImageSmoothingEnabled||h.mozImageSmoothingEnabled||h.msImageSmoothingEnabled||h.oImageSmoothingEnabled,h.imageSmoothingEnabled=c},m.util.getById=function(h){return typeof h=="string"?m.document.getElementById(h):h},m.util.toArray=i,m.util.addClass=function(h,c){h&&(" "+h.className+" ").indexOf(" "+c+" ")===-1&&(h.className+=(h.className?" ":"")+c)},m.util.makeElement=o,m.util.wrapElement=function(h,c,g){return typeof c=="string"&&(c=o(c,g)),h.parentNode&&h.parentNode.replaceChild(c,h),c.appendChild(h),c},m.util.getScrollLeftTop=f,m.util.getElementOffset=function(h){var c,g,_=h&&h.ownerDocument,y={left:0,top:0},x={left:0,top:0},w={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!_)return x;for(var I in w)x[w[I]]+=parseInt(r(h,I),10)||0;return c=_.documentElement,h.getBoundingClientRect!==void 0&&(y=h.getBoundingClientRect()),g=f(h),{left:y.left+g.left-(c.clientLeft||0)+x.left,top:y.top+g.top-(c.clientTop||0)+x.top}},m.util.getNodeCanvas=function(h){var c=m.jsdomImplForWrapper(h);return c._canvas||c._image},m.util.cleanUpJsdomNode=function(h){if(m.isLikelyNode){var c=m.jsdomImplForWrapper(h);c&&(c._image=null,c._canvas=null,c._currentSrc=null,c._attributes=null,c._classList=null)}}}(),function(){function s(){}m.util.request=function(r,n){n||(n={});var l=n.method?n.method.toUpperCase():"GET",t=n.onComplete||function(){},i=new m.window.XMLHttpRequest,o=n.body||n.parameters;return i.onreadystatechange=function(){i.readyState===4&&(t(i),i.onreadystatechange=s)},l==="GET"&&(o=null,typeof n.parameters=="string"&&(r=function(f,h){return f+(/\?/.test(f)?"&":"?")+h}(r,n.parameters))),i.open(l,r,!0),l!=="POST"&&l!=="PUT"||i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(o),i}}(),m.log=console.log,m.warn=console.warn,function(){var s=m.util.object.extend,r=m.util.object.clone,n=[];function l(){return!1}function t(h,c,g,_){return-g*Math.cos(h/_*(Math.PI/2))+g+c}m.util.object.extend(n,{cancelAll:function(){var h=this.splice(0);return h.forEach(function(c){c.cancel()}),h},cancelByCanvas:function(h){if(!h)return[];var c=this.filter(function(g){return typeof g.target=="object"&&g.target.canvas===h});return c.forEach(function(g){g.cancel()}),c},cancelByTarget:function(h){var c=this.findAnimationsByTarget(h);return c.forEach(function(g){g.cancel()}),c},findAnimationIndex:function(h){return this.indexOf(this.findAnimation(h))},findAnimation:function(h){return this.find(function(c){return c.cancel===h})},findAnimationsByTarget:function(h){return h?this.filter(function(c){return c.target===h}):[]}});var i=m.window.requestAnimationFrame||m.window.webkitRequestAnimationFrame||m.window.mozRequestAnimationFrame||m.window.oRequestAnimationFrame||m.window.msRequestAnimationFrame||function(h){return m.window.setTimeout(h,1e3/60)},o=m.window.cancelAnimationFrame||m.window.clearTimeout;function f(){return i.apply(m.window,arguments)}m.util.animate=function(h){h||(h={});var c,g=!1,_=function(){var y=m.runningAnimations.indexOf(c);return y>-1&&m.runningAnimations.splice(y,1)[0]};return c=s(r(h),{cancel:function(){return g=!0,_()},currentValue:"startValue"in h?h.startValue:0,completionRate:0,durationRate:0}),m.runningAnimations.push(c),f(function(y){var x,w=y||+new Date,I=h.duration||500,R=w+I,U=h.onChange||l,G=h.abort||l,K=h.onComplete||l,O=h.easing||t,D="startValue"in h&&h.startValue.length>0,E="startValue"in h?h.startValue:0,F="endValue"in h?h.endValue:100,k=h.byValue||(D?E.map(function(W,N){return F[N]-E[N]}):F-E);h.onStart&&h.onStart(),function W(N){var L=(x=N||+new Date)>R?I:x-w,P=L/I,A=D?E.map(function(H,X){return O(L,E[X],k[X],I)}):O(L,E,k,I),V=Math.abs(D?(A[0]-E[0])/k[0]:(A-E)/k);if(c.currentValue=D?A.slice():A,c.completionRate=V,c.durationRate=P,!g){if(!G(A,V,P))return x>R?(c.currentValue=D?F.slice():F,c.completionRate=1,c.durationRate=1,U(D?F.slice():F,1,1),K(F,1,1),void _()):(U(A,V,P),void f(W));_()}}(w)}),c.cancel},m.util.requestAnimFrame=f,m.util.cancelAnimFrame=function(){return o.apply(m.window,arguments)},m.runningAnimations=n}(),function(){function s(r,n,l){var t="rgba("+parseInt(r[0]+l*(n[0]-r[0]),10)+","+parseInt(r[1]+l*(n[1]-r[1]),10)+","+parseInt(r[2]+l*(n[2]-r[2]),10);return(t+=","+(r&&n?parseFloat(r[3]+l*(n[3]-r[3])):1))+")"}m.util.animateColor=function(r,n,l,t){var i=new m.Color(r).getSource(),o=new m.Color(n).getSource(),f=t.onComplete,h=t.onChange;return t=t||{},m.util.animate(m.util.object.extend(t,{duration:l||500,startValue:i,endValue:o,byValue:o,easing:function(c,g,_,y){return s(g,_,t.colorEasing?t.colorEasing(c,y):1-Math.cos(c/y*(Math.PI/2)))},onComplete:function(c,g,_){if(f)return f(s(o,o,0),g,_)},onChange:function(c,g,_){if(h){if(Array.isArray(c))return h(s(c,c,0),g,_);h(c,g,_)}}}))}}(),function(){function s(t,i,o,f){return t<Math.abs(i)?(t=i,f=o/4):f=i===0&&t===0?o/(2*Math.PI)*Math.asin(1):o/(2*Math.PI)*Math.asin(i/t),{a:t,c:i,p:o,s:f}}function r(t,i,o){return t.a*Math.pow(2,10*(i-=1))*Math.sin((i*o-t.s)*(2*Math.PI)/t.p)}function n(t,i,o,f){return o-l(f-t,0,o,f)+i}function l(t,i,o,f){return(t/=f)<1/2.75?o*(7.5625*t*t)+i:t<2/2.75?o*(7.5625*(t-=1.5/2.75)*t+.75)+i:t<2.5/2.75?o*(7.5625*(t-=2.25/2.75)*t+.9375)+i:o*(7.5625*(t-=2.625/2.75)*t+.984375)+i}m.util.ease={easeInQuad:function(t,i,o,f){return o*(t/=f)*t+i},easeOutQuad:function(t,i,o,f){return-o*(t/=f)*(t-2)+i},easeInOutQuad:function(t,i,o,f){return(t/=f/2)<1?o/2*t*t+i:-o/2*(--t*(t-2)-1)+i},easeInCubic:function(t,i,o,f){return o*(t/=f)*t*t+i},easeOutCubic:function(t,i,o,f){return o*((t=t/f-1)*t*t+1)+i},easeInOutCubic:function(t,i,o,f){return(t/=f/2)<1?o/2*t*t*t+i:o/2*((t-=2)*t*t+2)+i},easeInQuart:function(t,i,o,f){return o*(t/=f)*t*t*t+i},easeOutQuart:function(t,i,o,f){return-o*((t=t/f-1)*t*t*t-1)+i},easeInOutQuart:function(t,i,o,f){return(t/=f/2)<1?o/2*t*t*t*t+i:-o/2*((t-=2)*t*t*t-2)+i},easeInQuint:function(t,i,o,f){return o*(t/=f)*t*t*t*t+i},easeOutQuint:function(t,i,o,f){return o*((t=t/f-1)*t*t*t*t+1)+i},easeInOutQuint:function(t,i,o,f){return(t/=f/2)<1?o/2*t*t*t*t*t+i:o/2*((t-=2)*t*t*t*t+2)+i},easeInSine:function(t,i,o,f){return-o*Math.cos(t/f*(Math.PI/2))+o+i},easeOutSine:function(t,i,o,f){return o*Math.sin(t/f*(Math.PI/2))+i},easeInOutSine:function(t,i,o,f){return-o/2*(Math.cos(Math.PI*t/f)-1)+i},easeInExpo:function(t,i,o,f){return t===0?i:o*Math.pow(2,10*(t/f-1))+i},easeOutExpo:function(t,i,o,f){return t===f?i+o:o*(1-Math.pow(2,-10*t/f))+i},easeInOutExpo:function(t,i,o,f){return t===0?i:t===f?i+o:(t/=f/2)<1?o/2*Math.pow(2,10*(t-1))+i:o/2*(2-Math.pow(2,-10*--t))+i},easeInCirc:function(t,i,o,f){return-o*(Math.sqrt(1-(t/=f)*t)-1)+i},easeOutCirc:function(t,i,o,f){return o*Math.sqrt(1-(t=t/f-1)*t)+i},easeInOutCirc:function(t,i,o,f){return(t/=f/2)<1?-o/2*(Math.sqrt(1-t*t)-1)+i:o/2*(Math.sqrt(1-(t-=2)*t)+1)+i},easeInElastic:function(t,i,o,f){var h=0;return t===0?i:(t/=f)==1?i+o:(h||(h=.3*f),-r(s(o,o,h,1.70158),t,f)+i)},easeOutElastic:function(t,i,o,f){var h=0;if(t===0)return i;if((t/=f)==1)return i+o;h||(h=.3*f);var c=s(o,o,h,1.70158);return c.a*Math.pow(2,-10*t)*Math.sin((t*f-c.s)*(2*Math.PI)/c.p)+c.c+i},easeInOutElastic:function(t,i,o,f){var h=0;if(t===0)return i;if((t/=f/2)==2)return i+o;h||(h=f*(.3*1.5));var c=s(o,o,h,1.70158);return t<1?-.5*r(c,t,f)+i:c.a*Math.pow(2,-10*(t-=1))*Math.sin((t*f-c.s)*(2*Math.PI)/c.p)*.5+c.c+i},easeInBack:function(t,i,o,f,h){return h===void 0&&(h=1.70158),o*(t/=f)*t*((h+1)*t-h)+i},easeOutBack:function(t,i,o,f,h){return h===void 0&&(h=1.70158),o*((t=t/f-1)*t*((h+1)*t+h)+1)+i},easeInOutBack:function(t,i,o,f,h){return h===void 0&&(h=1.70158),(t/=f/2)<1?o/2*(t*t*((1+(h*=1.525))*t-h))+i:o/2*((t-=2)*t*((1+(h*=1.525))*t+h)+2)+i},easeInBounce:n,easeOutBounce:l,easeInOutBounce:function(t,i,o,f){return t<f/2?.5*n(2*t,0,o,f)+i:.5*l(2*t-f,0,o,f)+.5*o+i}}}(),function(s){var r=s.fabric||(s.fabric={}),n=r.util.object.extend,l=r.util.object.clone,t=r.util.toFixed,i=r.util.parseUnit,o=r.util.multiplyTransformMatrices,f={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},h={stroke:"strokeOpacity",fill:"fillOpacity"},c="font-size",g="clip-path";function _(E){return E in f?f[E]:E}function y(E,F,k,W){var N,L=Array.isArray(F);if(E!=="fill"&&E!=="stroke"||F!=="none"){if(E==="strokeUniform")return F==="non-scaling-stroke";if(E==="strokeDashArray")F=F==="none"?null:F.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(E==="transformMatrix")F=k&&k.transformMatrix?o(k.transformMatrix,r.parseTransformAttribute(F)):r.parseTransformAttribute(F);else if(E==="visible")F=F!=="none"&&F!=="hidden",k&&k.visible===!1&&(F=!1);else if(E==="opacity")F=parseFloat(F),k&&k.opacity!==void 0&&(F*=k.opacity);else if(E==="textAnchor")F=F==="start"?"left":F==="end"?"right":"center";else if(E==="charSpacing")N=i(F,W)/W*1e3;else if(E==="paintFirst"){var P=F.indexOf("fill"),A=F.indexOf("stroke");F="fill",(P>-1&&A>-1&&A<P||P===-1&&A>-1)&&(F="stroke")}else{if(E==="href"||E==="xlink:href"||E==="font")return F;if(E==="imageSmoothing")return F==="optimizeQuality";N=L?F.map(i):i(F,W)}}else F="";return!L&&isNaN(N)?F:N}function x(E){return new RegExp("^("+E.join("|")+")\\b","i")}function w(E,F){var k,W,N,L,P=[];for(N=0,L=F.length;N<L;N++)k=F[N],W=E.getElementsByTagName(k),P=P.concat(Array.prototype.slice.call(W));return P}function I(E,F){var k,W=!0;return(k=R(E,F.pop()))&&F.length&&(W=function(N,L){for(var P,A=!0;N.parentNode&&N.parentNode.nodeType===1&&L.length;)A&&(P=L.pop()),A=R(N=N.parentNode,P);return L.length===0}(E,F)),k&&W&&F.length===0}function R(E,F){var k,W,N=E.nodeName,L=E.getAttribute("class"),P=E.getAttribute("id");if(k=new RegExp("^"+N,"i"),F=F.replace(k,""),P&&F.length&&(k=new RegExp("#"+P+"(?![a-zA-Z\\-]+)","i"),F=F.replace(k,"")),L&&F.length)for(W=(L=L.split(" ")).length;W--;)k=new RegExp("\\."+L[W]+"(?![a-zA-Z\\-]+)","i"),F=F.replace(k,"");return F.length===0}function U(E,F){var k;if(E.getElementById&&(k=E.getElementById(F)),k)return k;var W,N,L,P=E.getElementsByTagName("*");for(N=0,L=P.length;N<L;N++)if(F===(W=P[N]).getAttribute("id"))return W}r.svgValidTagNamesRegEx=x(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),r.svgViewBoxElementsRegEx=x(["symbol","image","marker","pattern","view","svg"]),r.svgInvalidAncestorsRegEx=x(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),r.svgValidParentsRegEx=x(["symbol","g","a","svg","clipPath","defs"]),r.cssRules={},r.gradientDefs={},r.clipPaths={},r.parseTransformAttribute=function(){function E(A,V,H){A[H]=Math.tan(r.util.degreesToRadians(V[0]))}var F=r.iMatrix,k=r.reNum,W=r.commaWsp,N="(?:(?:(matrix)\\s*\\(\\s*("+k+")"+W+"("+k+")"+W+"("+k+")"+W+"("+k+")"+W+"("+k+")"+W+"("+k+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+k+")(?:"+W+"("+k+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+k+")(?:"+W+"("+k+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+k+")(?:"+W+"("+k+")"+W+"("+k+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+k+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+k+")\\s*\\)))",L=new RegExp("^\\s*(?:(?:"+N+"(?:"+W+"*"+N+")*)?)\\s*$"),P=new RegExp(N,"g");return function(A){var V=F.concat(),H=[];if(!A||A&&!L.test(A))return V;A.replace(P,function($){var Q=new RegExp(N).exec($).filter(function(rt){return!!rt}),Z=Q[1],it=Q.slice(2).map(parseFloat);switch(Z){case"translate":(function(rt,at){rt[4]=at[0],at.length===2&&(rt[5]=at[1])})(V,it);break;case"rotate":it[0]=r.util.degreesToRadians(it[0]),function(rt,at){var ht=r.util.cos(at[0]),lt=r.util.sin(at[0]),ft=0,yt=0;at.length===3&&(ft=at[1],yt=at[2]),rt[0]=ht,rt[1]=lt,rt[2]=-lt,rt[3]=ht,rt[4]=ft-(ht*ft-lt*yt),rt[5]=yt-(lt*ft+ht*yt)}(V,it);break;case"scale":(function(rt,at){var ht=at[0],lt=at.length===2?at[1]:at[0];rt[0]=ht,rt[3]=lt})(V,it);break;case"skewX":E(V,it,2);break;case"skewY":E(V,it,1);break;case"matrix":V=it}H.push(V.concat()),V=F.concat()});for(var X=H[0];H.length>1;)H.shift(),X=r.util.multiplyTransformMatrices(X,H[0]);return X}}();var G=new RegExp("^\\s*("+r.reNum+"+)\\s*,?\\s*("+r.reNum+"+)\\s*,?\\s*("+r.reNum+"+)\\s*,?\\s*("+r.reNum+"+)\\s*$");function K(E){if(!r.svgViewBoxElementsRegEx.test(E.nodeName))return{};var F,k,W,N,L,P,A=E.getAttribute("viewBox"),V=1,H=1,X=E.getAttribute("width"),$=E.getAttribute("height"),Q=E.getAttribute("x")||0,Z=E.getAttribute("y")||0,it=E.getAttribute("preserveAspectRatio")||"",rt=!A||!(A=A.match(G)),at=!X||!$||X==="100%"||$==="100%",ht=rt&&at,lt={},ft="",yt=0,Ct=0;if(lt.width=0,lt.height=0,lt.toBeParsed=ht,rt&&(Q||Z)&&E.parentNode&&E.parentNode.nodeName!=="#document"&&(ft=" translate("+i(Q)+" "+i(Z)+") ",L=(E.getAttribute("transform")||"")+ft,E.setAttribute("transform",L),E.removeAttribute("x"),E.removeAttribute("y")),ht)return lt;if(rt)return lt.width=i(X),lt.height=i($),lt;if(F=-parseFloat(A[1]),k=-parseFloat(A[2]),W=parseFloat(A[3]),N=parseFloat(A[4]),lt.minX=F,lt.minY=k,lt.viewBoxWidth=W,lt.viewBoxHeight=N,at?(lt.width=W,lt.height=N):(lt.width=i(X),lt.height=i($),V=lt.width/W,H=lt.height/N),(it=r.util.parsePreserveAspectRatioAttribute(it)).alignX!=="none"&&(it.meetOrSlice==="meet"&&(H=V=V>H?H:V),it.meetOrSlice==="slice"&&(H=V=V>H?V:H),yt=lt.width-W*V,Ct=lt.height-N*V,it.alignX==="Mid"&&(yt/=2),it.alignY==="Mid"&&(Ct/=2),it.alignX==="Min"&&(yt=0),it.alignY==="Min"&&(Ct=0)),V===1&&H===1&&F===0&&k===0&&Q===0&&Z===0)return lt;if((Q||Z)&&E.parentNode.nodeName!=="#document"&&(ft=" translate("+i(Q)+" "+i(Z)+") "),L=ft+" matrix("+V+" 0 0 "+H+" "+(F*V+yt)+" "+(k*H+Ct)+") ",E.nodeName==="svg"){for(P=E.ownerDocument.createElementNS(r.svgNS,"g");E.firstChild;)P.appendChild(E.firstChild);E.appendChild(P)}else(P=E).removeAttribute("x"),P.removeAttribute("y"),L=P.getAttribute("transform")+L;return P.setAttribute("transform",L),lt}function O(E,F){var k="xlink:href",W=U(E,F.getAttribute(k).slice(1));if(W&&W.getAttribute(k)&&O(E,W),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(L){W&&!F.hasAttribute(L)&&W.hasAttribute(L)&&F.setAttribute(L,W.getAttribute(L))}),!F.children.length)for(var N=W.cloneNode(!0);N.firstChild;)F.appendChild(N.firstChild);F.removeAttribute(k)}r.parseSVGDocument=function(E,F,k,W){if(E){(function(Q){for(var Z=w(Q,["use","svg:use"]),it=0;Z.length&&it<Z.length;){var rt=Z[it],at=rt.getAttribute("xlink:href")||rt.getAttribute("href");if(at===null)return;var ht,lt,ft,yt,Ct=at.slice(1),Ot=rt.getAttribute("x")||0,Jt=rt.getAttribute("y")||0,xt=U(Q,Ct).cloneNode(!0),Ut=(xt.getAttribute("transform")||"")+" translate("+Ot+", "+Jt+")",Fe=Z.length,ve=r.svgNS;if(K(xt),/^svg$/i.test(xt.nodeName)){var he=xt.ownerDocument.createElementNS(ve,"g");for(lt=0,yt=(ft=xt.attributes).length;lt<yt;lt++)ht=ft.item(lt),he.setAttributeNS(ve,ht.nodeName,ht.nodeValue);for(;xt.firstChild;)he.appendChild(xt.firstChild);xt=he}for(lt=0,yt=(ft=rt.attributes).length;lt<yt;lt++)(ht=ft.item(lt)).nodeName!=="x"&&ht.nodeName!=="y"&&ht.nodeName!=="xlink:href"&&ht.nodeName!=="href"&&(ht.nodeName==="transform"?Ut=ht.nodeValue+" "+Ut:xt.setAttribute(ht.nodeName,ht.nodeValue));xt.setAttribute("transform",Ut),xt.setAttribute("instantiated_by_use","1"),xt.removeAttribute("id"),rt.parentNode.replaceChild(xt,rt),Z.length===Fe&&it++}})(E);var N,L,P=r.Object.__uid++,A=K(E),V=r.util.toArray(E.getElementsByTagName("*"));if(A.crossOrigin=W&&W.crossOrigin,A.svgUid=P,V.length===0&&r.isLikelyNode){var H=[];for(N=0,L=(V=E.selectNodes('//*[name(.)!="svg"]')).length;N<L;N++)H[N]=V[N];V=H}var X=V.filter(function(Q){return K(Q),r.svgValidTagNamesRegEx.test(Q.nodeName.replace("svg:",""))&&!function(Z,it){for(;Z&&(Z=Z.parentNode);)if(Z.nodeName&&it.test(Z.nodeName.replace("svg:",""))&&!Z.getAttribute("instantiated_by_use"))return!0;return!1}(Q,r.svgInvalidAncestorsRegEx)});if(!X||X&&!X.length)F&&F([],{});else{var $={};V.filter(function(Q){return Q.nodeName.replace("svg:","")==="clipPath"}).forEach(function(Q){var Z=Q.getAttribute("id");$[Z]=r.util.toArray(Q.getElementsByTagName("*")).filter(function(it){return r.svgValidTagNamesRegEx.test(it.nodeName.replace("svg:",""))})}),r.gradientDefs[P]=r.getGradientDefs(E),r.cssRules[P]=r.getCSSRules(E),r.clipPaths[P]=$,r.parseElements(X,function(Q,Z){F&&(F(Q,A,Z,V),delete r.gradientDefs[P],delete r.cssRules[P],delete r.clipPaths[P])},l(A),k,W)}}};var D=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+r.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+r.reNum+"))?\\s+(.*)");n(r,{parseFontDeclaration:function(E,F){var k=E.match(D);if(k){var W=k[1],N=k[3],L=k[4],P=k[5],A=k[6];W&&(F.fontStyle=W),N&&(F.fontWeight=isNaN(parseFloat(N))?N:parseFloat(N)),L&&(F.fontSize=i(L)),A&&(F.fontFamily=A),P&&(F.lineHeight=P==="normal"?1:P)}},getGradientDefs:function(E){var F,k=w(E,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),W=0,N={};for(W=k.length;W--;)(F=k[W]).getAttribute("xlink:href")&&O(E,F),N[F.getAttribute("id")]=F;return N},parseAttributes:function(E,F,k){if(E){var W,N,L,P={};k===void 0&&(k=E.getAttribute("svgUid")),E.parentNode&&r.svgValidParentsRegEx.test(E.parentNode.nodeName)&&(P=r.parseAttributes(E.parentNode,F,k));var A=F.reduce(function(it,rt){return(W=E.getAttribute(rt))&&(it[rt]=W),it},{}),V=n(function(it,rt){var at={};for(var ht in r.cssRules[rt])if(I(it,ht.split(" ")))for(var lt in r.cssRules[rt][ht])at[lt]=r.cssRules[rt][ht][lt];return at}(E,k),r.parseStyleAttribute(E));A=n(A,V),V[g]&&E.setAttribute(g,V[g]),N=L=P.fontSize||r.Text.DEFAULT_SVG_FONT_SIZE,A[c]&&(A[c]=N=i(A[c],L));var H,X,$={};for(var Q in A)X=y(H=_(Q),A[Q],P,N),$[H]=X;$&&$.font&&r.parseFontDeclaration($.font,$);var Z=n(P,$);return r.svgValidParentsRegEx.test(E.nodeName)?Z:function(it){for(var rt in h)if(it[h[rt]]!==void 0&&it[rt]!==""){if(it[rt]===void 0){if(!r.Object.prototype[rt])continue;it[rt]=r.Object.prototype[rt]}if(it[rt].indexOf("url(")!==0){var at=new r.Color(it[rt]);it[rt]=at.setAlpha(t(at.getAlpha()*it[h[rt]],2)).toRgba()}}return it}(Z)}},parseElements:function(E,F,k,W,N){new r.ElementsParser(E,F,k,W,N).parse()},parseStyleAttribute:function(E){var F={},k=E.getAttribute("style");return k&&(typeof k=="string"?function(W,N){var L,P;W.replace(/;\s*$/,"").split(";").forEach(function(A){var V=A.split(":");L=V[0].trim().toLowerCase(),P=V[1].trim(),N[L]=P})}(k,F):function(W,N){var L,P;for(var A in W)W[A]!==void 0&&(L=A.toLowerCase(),P=W[A],N[L]=P)}(k,F)),F},parsePointsAttribute:function(E){if(!E)return null;var F,k,W=[];for(F=0,k=(E=(E=E.replace(/,/g," ").trim()).split(/\s+/)).length;F<k;F+=2)W.push({x:parseFloat(E[F]),y:parseFloat(E[F+1])});return W},getCSSRules:function(E){var F,k,W=E.getElementsByTagName("style"),N={};for(F=0,k=W.length;F<k;F++){var L=W[F].textContent;(L=L.replace(/\/\*[\s\S]*?\*\//g,"")).trim()!==""&&L.split("}").filter(function(P){return P.trim()}).forEach(function(P){var A=P.split("{"),V={},H=A[1].trim().split(";").filter(function(Z){return Z.trim()});for(F=0,k=H.length;F<k;F++){var X=H[F].split(":"),$=X[0].trim(),Q=X[1].trim();V[$]=Q}(P=A[0].trim()).split(",").forEach(function(Z){(Z=Z.replace(/^svg/i,"").trim())!==""&&(N[Z]?r.util.object.extend(N[Z],V):N[Z]=r.util.object.clone(V))})})}return N},loadSVGFromURL:function(E,F,k,W){E=E.replace(/^\n\s*/,"").trim(),new r.util.request(E,{method:"get",onComplete:function(N){var L=N.responseXML;if(!L||!L.documentElement)return F&&F(null),!1;r.parseSVGDocument(L.documentElement,function(P,A,V,H){F&&F(P,A,V,H)},k,W)}})},loadSVGFromString:function(E,F,k,W){var N=new r.window.DOMParser().parseFromString(E.trim(),"text/xml");r.parseSVGDocument(N.documentElement,function(L,P,A,V){F(L,P,A,V)},k,W)}})}(e),m.ElementsParser=function(s,r,n,l,t,i){this.elements=s,this.callback=r,this.options=n,this.reviver=l,this.svgUid=n&&n.svgUid||0,this.parsingOptions=t,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=i},(Y=m.ElementsParser.prototype).parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},Y.createObjects=function(){var s=this;this.elements.forEach(function(r,n){r.setAttribute("svgUid",s.svgUid),s.createObject(r,n)})},Y.findTag=function(s){return m[m.util.string.capitalize(s.tagName.replace("svg:",""))]},Y.createObject=function(s,r){var n=this.findTag(s);if(n&&n.fromElement)try{n.fromElement(s,this.createCallback(r,s),this.options)}catch(l){m.log(l)}else this.checkIfDone()},Y.createCallback=function(s,r){var n=this;return function(l){var t;n.resolveGradient(l,r,"fill"),n.resolveGradient(l,r,"stroke"),l instanceof m.Image&&l._originalElement&&(t=l.parsePreserveAspectRatioAttribute(r)),l._removeTransformMatrix(t),n.resolveClipPath(l,r),n.reviver&&n.reviver(r,l),n.instances[s]=l,n.checkIfDone()}},Y.extractPropertyDefinition=function(s,r,n){var l=s[r],t=this.regexUrl;if(t.test(l)){t.lastIndex=0;var i=t.exec(l)[1];return t.lastIndex=0,m[n][this.svgUid][i]}},Y.resolveGradient=function(s,r,n){var l=this.extractPropertyDefinition(s,n,"gradientDefs");if(l){var t=r.getAttribute(n+"-opacity"),i=m.Gradient.fromElement(l,s,t,this.options);s.set(n,i)}},Y.createClipPathCallback=function(s,r){return function(n){n._removeTransformMatrix(),n.fillRule=n.clipRule,r.push(n)}},Y.resolveClipPath=function(s,r){var n,l,t,i,o=this.extractPropertyDefinition(s,"clipPath","clipPaths");if(o){t=[],l=m.util.invertTransform(s.calcTransformMatrix());for(var f=o[0].parentNode,h=r;h.parentNode&&h.getAttribute("clip-path")!==s.clipPath;)h=h.parentNode;h.parentNode.appendChild(f);for(var c=0;c<o.length;c++)n=o[c],this.findTag(n).fromElement(n,this.createClipPathCallback(s,t),this.options);o=t.length===1?t[0]:new m.Group(t),i=m.util.multiplyTransformMatrices(l,o.calcTransformMatrix()),o.clipPath&&this.resolveClipPath(o,h);var g=m.util.qrDecompose(i);o.flipX=!1,o.flipY=!1,o.set("scaleX",g.scaleX),o.set("scaleY",g.scaleY),o.angle=g.angle,o.skewX=g.skewX,o.skewY=0,o.setPositionByOrigin({x:g.translateX,y:g.translateY},"center","center"),s.clipPath=o}else delete s.clipPath},Y.checkIfDone=function(){--this.numElements==0&&(this.instances=this.instances.filter(function(s){return s!=null}),this.callback(this.instances,this.elements))},function(s){var r=s.fabric||(s.fabric={});function n(l,t){this.x=l,this.y=t}r.Point?r.warn("fabric.Point is already defined"):(r.Point=n,n.prototype={type:"point",constructor:n,add:function(l){return new n(this.x+l.x,this.y+l.y)},addEquals:function(l){return this.x+=l.x,this.y+=l.y,this},scalarAdd:function(l){return new n(this.x+l,this.y+l)},scalarAddEquals:function(l){return this.x+=l,this.y+=l,this},subtract:function(l){return new n(this.x-l.x,this.y-l.y)},subtractEquals:function(l){return this.x-=l.x,this.y-=l.y,this},scalarSubtract:function(l){return new n(this.x-l,this.y-l)},scalarSubtractEquals:function(l){return this.x-=l,this.y-=l,this},multiply:function(l){return new n(this.x*l,this.y*l)},multiplyEquals:function(l){return this.x*=l,this.y*=l,this},divide:function(l){return new n(this.x/l,this.y/l)},divideEquals:function(l){return this.x/=l,this.y/=l,this},eq:function(l){return this.x===l.x&&this.y===l.y},lt:function(l){return this.x<l.x&&this.y<l.y},lte:function(l){return this.x<=l.x&&this.y<=l.y},gt:function(l){return this.x>l.x&&this.y>l.y},gte:function(l){return this.x>=l.x&&this.y>=l.y},lerp:function(l,t){return t===void 0&&(t=.5),t=Math.max(Math.min(1,t),0),new n(this.x+(l.x-this.x)*t,this.y+(l.y-this.y)*t)},distanceFrom:function(l){var t=this.x-l.x,i=this.y-l.y;return Math.sqrt(t*t+i*i)},midPointFrom:function(l){return this.lerp(l)},min:function(l){return new n(Math.min(this.x,l.x),Math.min(this.y,l.y))},max:function(l){return new n(Math.max(this.x,l.x),Math.max(this.y,l.y))},toString:function(){return this.x+","+this.y},setXY:function(l,t){return this.x=l,this.y=t,this},setX:function(l){return this.x=l,this},setY:function(l){return this.y=l,this},setFromPoint:function(l){return this.x=l.x,this.y=l.y,this},swap:function(l){var t=this.x,i=this.y;this.x=l.x,this.y=l.y,l.x=t,l.y=i},clone:function(){return new n(this.x,this.y)}})}(e),function(s){var r=s.fabric||(s.fabric={});function n(l){this.status=l,this.points=[]}r.Intersection?r.warn("fabric.Intersection is already defined"):(r.Intersection=n,r.Intersection.prototype={constructor:n,appendPoint:function(l){return this.points.push(l),this},appendPoints:function(l){return this.points=this.points.concat(l),this}},r.Intersection.intersectLineLine=function(l,t,i,o){var f,h=(o.x-i.x)*(l.y-i.y)-(o.y-i.y)*(l.x-i.x),c=(t.x-l.x)*(l.y-i.y)-(t.y-l.y)*(l.x-i.x),g=(o.y-i.y)*(t.x-l.x)-(o.x-i.x)*(t.y-l.y);if(g!==0){var _=h/g,y=c/g;0<=_&&_<=1&&0<=y&&y<=1?(f=new n("Intersection")).appendPoint(new r.Point(l.x+_*(t.x-l.x),l.y+_*(t.y-l.y))):f=new n}else f=new n(h===0||c===0?"Coincident":"Parallel");return f},r.Intersection.intersectLinePolygon=function(l,t,i){var o,f,h,c,g=new n,_=i.length;for(c=0;c<_;c++)o=i[c],f=i[(c+1)%_],h=n.intersectLineLine(l,t,o,f),g.appendPoints(h.points);return g.points.length>0&&(g.status="Intersection"),g},r.Intersection.intersectPolygonPolygon=function(l,t){var i,o=new n,f=l.length;for(i=0;i<f;i++){var h=l[i],c=l[(i+1)%f],g=n.intersectLinePolygon(h,c,t);o.appendPoints(g.points)}return o.points.length>0&&(o.status="Intersection"),o},r.Intersection.intersectPolygonRectangle=function(l,t,i){var o=t.min(i),f=t.max(i),h=new r.Point(f.x,o.y),c=new r.Point(o.x,f.y),g=n.intersectLinePolygon(o,h,l),_=n.intersectLinePolygon(h,f,l),y=n.intersectLinePolygon(f,c,l),x=n.intersectLinePolygon(c,o,l),w=new n;return w.appendPoints(g.points),w.appendPoints(_.points),w.appendPoints(y.points),w.appendPoints(x.points),w.points.length>0&&(w.status="Intersection"),w})}(e),function(s){var r=s.fabric||(s.fabric={});function n(t){t?this._tryParsingColor(t):this.setSource([0,0,0,1])}function l(t,i,o){return o<0&&(o+=1),o>1&&(o-=1),o<1/6?t+6*(i-t)*o:o<.5?i:o<2/3?t+(i-t)*(2/3-o)*6:t}r.Color?r.warn("fabric.Color is already defined."):(r.Color=n,r.Color.prototype={_tryParsingColor:function(t){var i;t in n.colorNameMap&&(t=n.colorNameMap[t]),t==="transparent"&&(i=[255,255,255,0]),i||(i=n.sourceFromHex(t)),i||(i=n.sourceFromRgb(t)),i||(i=n.sourceFromHsl(t)),i||(i=[0,0,0,1]),i&&this.setSource(i)},_rgbToHsl:function(t,i,o){t/=255,i/=255,o/=255;var f,h,c,g=r.util.array.max([t,i,o]),_=r.util.array.min([t,i,o]);if(c=(g+_)/2,g===_)f=h=0;else{var y=g-_;switch(h=c>.5?y/(2-g-_):y/(g+_),g){case t:f=(i-o)/y+(i<o?6:0);break;case i:f=(o-t)/y+2;break;case o:f=(t-i)/y+4}f/=6}return[Math.round(360*f),Math.round(100*h),Math.round(100*c)]},getSource:function(){return this._source},setSource:function(t){this._source=t},toRgb:function(){var t=this.getSource();return"rgb("+t[0]+","+t[1]+","+t[2]+")"},toRgba:function(){var t=this.getSource();return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"},toHsl:function(){var t=this.getSource(),i=this._rgbToHsl(t[0],t[1],t[2]);return"hsl("+i[0]+","+i[1]+"%,"+i[2]+"%)"},toHsla:function(){var t=this.getSource(),i=this._rgbToHsl(t[0],t[1],t[2]);return"hsla("+i[0]+","+i[1]+"%,"+i[2]+"%,"+t[3]+")"},toHex:function(){var t,i,o,f=this.getSource();return t=(t=f[0].toString(16)).length===1?"0"+t:t,i=(i=f[1].toString(16)).length===1?"0"+i:i,o=(o=f[2].toString(16)).length===1?"0"+o:o,t.toUpperCase()+i.toUpperCase()+o.toUpperCase()},toHexa:function(){var t,i=this.getSource();return t=(t=(t=Math.round(255*i[3])).toString(16)).length===1?"0"+t:t,this.toHex()+t.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(t){var i=this.getSource();return i[3]=t,this.setSource(i),this},toGrayscale:function(){var t=this.getSource(),i=parseInt((.3*t[0]+.59*t[1]+.11*t[2]).toFixed(0),10),o=t[3];return this.setSource([i,i,i,o]),this},toBlackWhite:function(t){var i=this.getSource(),o=(.3*i[0]+.59*i[1]+.11*i[2]).toFixed(0),f=i[3];return t=t||127,o=Number(o)<Number(t)?0:255,this.setSource([o,o,o,f]),this},overlayWith:function(t){t instanceof n||(t=new n(t));var i,o=[],f=this.getAlpha(),h=this.getSource(),c=t.getSource();for(i=0;i<3;i++)o.push(Math.round(.5*h[i]+.5*c[i]));return o[3]=f,this.setSource(o),this}},r.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,r.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,r.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,r.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},r.Color.fromRgb=function(t){return n.fromSource(n.sourceFromRgb(t))},r.Color.sourceFromRgb=function(t){var i=t.match(n.reRGBa);if(i){var o=parseInt(i[1],10)/(/%$/.test(i[1])?100:1)*(/%$/.test(i[1])?255:1),f=parseInt(i[2],10)/(/%$/.test(i[2])?100:1)*(/%$/.test(i[2])?255:1),h=parseInt(i[3],10)/(/%$/.test(i[3])?100:1)*(/%$/.test(i[3])?255:1);return[parseInt(o,10),parseInt(f,10),parseInt(h,10),i[4]?parseFloat(i[4]):1]}},r.Color.fromRgba=n.fromRgb,r.Color.fromHsl=function(t){return n.fromSource(n.sourceFromHsl(t))},r.Color.sourceFromHsl=function(t){var i=t.match(n.reHSLa);if(i){var o,f,h,c=(parseFloat(i[1])%360+360)%360/360,g=parseFloat(i[2])/(/%$/.test(i[2])?100:1),_=parseFloat(i[3])/(/%$/.test(i[3])?100:1);if(g===0)o=f=h=_;else{var y=_<=.5?_*(g+1):_+g-_*g,x=2*_-y;o=l(x,y,c+1/3),f=l(x,y,c),h=l(x,y,c-1/3)}return[Math.round(255*o),Math.round(255*f),Math.round(255*h),i[4]?parseFloat(i[4]):1]}},r.Color.fromHsla=n.fromHsl,r.Color.fromHex=function(t){return n.fromSource(n.sourceFromHex(t))},r.Color.sourceFromHex=function(t){if(t.match(n.reHex)){var i=t.slice(t.indexOf("#")+1),o=i.length===3||i.length===4,f=i.length===8||i.length===4,h=o?i.charAt(0)+i.charAt(0):i.substring(0,2),c=o?i.charAt(1)+i.charAt(1):i.substring(2,4),g=o?i.charAt(2)+i.charAt(2):i.substring(4,6),_=f?o?i.charAt(3)+i.charAt(3):i.substring(6,8):"FF";return[parseInt(h,16),parseInt(c,16),parseInt(g,16),parseFloat((parseInt(_,16)/255).toFixed(2))]}},r.Color.fromSource=function(t){var i=new n;return i.setSource(t),i})}(e),function(s){var r=s.fabric||(s.fabric={}),n=["e","se","s","sw","w","nw","n","ne","e"],l=["ns","nesw","ew","nwse"],t={},i="left",o="top",f="right",h="bottom",c="center",g={top:h,bottom:o,left:f,right:i,center:c},_=r.util.radiansToDegrees,y=Math.sign||function(L){return(L>0)-(L<0)||+L};function x(L,P){var A=L.angle+_(Math.atan2(P.y,P.x))+360;return Math.round(A%360/45)}function w(L,P){var A=P.transform.target,V=A.canvas,H=r.util.object.clone(P);H.target=A,V&&V.fire("object:"+L,H),A.fire(L,P)}function I(L,P){var A=P.canvas,V=L[A.uniScaleKey];return A.uniformScaling&&!V||!A.uniformScaling&&V}function R(L){return L.originX===c&&L.originY===c}function U(L,P,A){var V=L.lockScalingX,H=L.lockScalingY;return!((!V||!H)&&(P||!V&&!H||!A)&&(!V||P!=="x")&&(!H||P!=="y"))}function G(L,P,A,V){return{e:L,transform:P,pointer:{x:A,y:V}}}function K(L){return function(P,A,V,H){var X=A.target,$=X.getCenterPoint(),Q=X.translateToOriginPoint($,A.originX,A.originY),Z=L(P,A,V,H);return X.setPositionByOrigin(Q,A.originX,A.originY),Z}}function O(L,P){return function(A,V,H,X){var $=P(A,V,H,X);return $&&w(L,G(A,V,H,X)),$}}function D(L,P,A,V,H){var X=L.target,$=X.controls[L.corner],Q=X.canvas.getZoom(),Z=X.padding/Q,it=X.toLocalPoint(new r.Point(V,H),P,A);return it.x>=Z&&(it.x-=Z),it.x<=-Z&&(it.x+=Z),it.y>=Z&&(it.y-=Z),it.y<=Z&&(it.y+=Z),it.x-=$.offsetX,it.y-=$.offsetY,it}function E(L){return L.flipX!==L.flipY}function F(L,P,A,V,H){if(L[P]!==0){var X=H/L._getTransformedDimensions()[V]*L[A];L.set(A,X)}}function k(L,P,A,V){var H,X=P.target,$=X._getTransformedDimensions(0,X.skewY),Q=D(P,P.originX,P.originY,A,V),Z=Math.abs(2*Q.x)-$.x,it=X.skewX;Z<2?H=0:(H=_(Math.atan2(Z/X.scaleX,$.y/X.scaleY)),P.originX===i&&P.originY===h&&(H=-H),P.originX===f&&P.originY===o&&(H=-H),E(X)&&(H=-H));var rt=it!==H;if(rt){var at=X._getTransformedDimensions().y;X.set("skewX",H),F(X,"skewY","scaleY","y",at)}return rt}function W(L,P,A,V){var H,X=P.target,$=X._getTransformedDimensions(X.skewX,0),Q=D(P,P.originX,P.originY,A,V),Z=Math.abs(2*Q.y)-$.y,it=X.skewY;Z<2?H=0:(H=_(Math.atan2(Z/X.scaleY,$.x/X.scaleX)),P.originX===i&&P.originY===h&&(H=-H),P.originX===f&&P.originY===o&&(H=-H),E(X)&&(H=-H));var rt=it!==H;if(rt){var at=X._getTransformedDimensions().x;X.set("skewY",H),F(X,"skewX","scaleX","x",at)}return rt}function N(L,P,A,V,H){H=H||{};var X,$,Q,Z,it,rt,at=P.target,ht=at.lockScalingX,lt=at.lockScalingY,ft=H.by,yt=I(L,at),Ct=U(at,ft,yt),Ot=P.gestureScale;if(Ct)return!1;if(Ot)$=P.scaleX*Ot,Q=P.scaleY*Ot;else{if(X=D(P,P.originX,P.originY,A,V),it=ft!=="y"?y(X.x):1,rt=ft!=="x"?y(X.y):1,P.signX||(P.signX=it),P.signY||(P.signY=rt),at.lockScalingFlip&&(P.signX!==it||P.signY!==rt))return!1;if(Z=at._getTransformedDimensions(),yt&&!ft){var Jt=Math.abs(X.x)+Math.abs(X.y),xt=P.original,Ut=Jt/(Math.abs(Z.x*xt.scaleX/at.scaleX)+Math.abs(Z.y*xt.scaleY/at.scaleY));$=xt.scaleX*Ut,Q=xt.scaleY*Ut}else $=Math.abs(X.x*at.scaleX/Z.x),Q=Math.abs(X.y*at.scaleY/Z.y);R(P)&&($*=2,Q*=2),P.signX!==it&&ft!=="y"&&(P.originX=g[P.originX],$*=-1,P.signX=it),P.signY!==rt&&ft!=="x"&&(P.originY=g[P.originY],Q*=-1,P.signY=rt)}var Fe=at.scaleX,ve=at.scaleY;return ft?(ft==="x"&&at.set("scaleX",$),ft==="y"&&at.set("scaleY",Q)):(!ht&&at.set("scaleX",$),!lt&&at.set("scaleY",Q)),Fe!==at.scaleX||ve!==at.scaleY}t.scaleCursorStyleHandler=function(L,P,A){var V=I(L,A),H="";if(P.x!==0&&P.y===0?H="x":P.x===0&&P.y!==0&&(H="y"),U(A,H,V))return"not-allowed";var X=x(A,P);return n[X]+"-resize"},t.skewCursorStyleHandler=function(L,P,A){var V="not-allowed";if(P.x!==0&&A.lockSkewingY||P.y!==0&&A.lockSkewingX)return V;var H=x(A,P)%4;return l[H]+"-resize"},t.scaleSkewCursorStyleHandler=function(L,P,A){return L[A.canvas.altActionKey]?t.skewCursorStyleHandler(L,P,A):t.scaleCursorStyleHandler(L,P,A)},t.rotationWithSnapping=O("rotating",K(function(L,P,A,V){var H=P,X=H.target,$=X.translateToOriginPoint(X.getCenterPoint(),H.originX,H.originY);if(X.lockRotation)return!1;var Q,Z=Math.atan2(H.ey-$.y,H.ex-$.x),it=Math.atan2(V-$.y,A-$.x),rt=_(it-Z+H.theta);if(X.snapAngle>0){var at=X.snapAngle,ht=X.snapThreshold||at,lt=Math.ceil(rt/at)*at,ft=Math.floor(rt/at)*at;Math.abs(rt-ft)<ht?rt=ft:Math.abs(rt-lt)<ht&&(rt=lt)}return rt<0&&(rt=360+rt),rt%=360,Q=X.angle!==rt,X.angle=rt,Q})),t.scalingEqually=O("scaling",K(function(L,P,A,V){return N(L,P,A,V)})),t.scalingX=O("scaling",K(function(L,P,A,V){return N(L,P,A,V,{by:"x"})})),t.scalingY=O("scaling",K(function(L,P,A,V){return N(L,P,A,V,{by:"y"})})),t.scalingYOrSkewingX=function(L,P,A,V){return L[P.target.canvas.altActionKey]?t.skewHandlerX(L,P,A,V):t.scalingY(L,P,A,V)},t.scalingXOrSkewingY=function(L,P,A,V){return L[P.target.canvas.altActionKey]?t.skewHandlerY(L,P,A,V):t.scalingX(L,P,A,V)},t.changeWidth=O("resizing",K(function(L,P,A,V){var H=P.target,X=D(P,P.originX,P.originY,A,V),$=H.strokeWidth/(H.strokeUniform?H.scaleX:1),Q=R(P)?2:1,Z=H.width,it=Math.abs(X.x*Q/H.scaleX)-$;return H.set("width",Math.max(it,0)),Z!==it})),t.skewHandlerX=function(L,P,A,V){var H,X=P.target,$=X.skewX,Q=P.originY;return!X.lockSkewingX&&($===0?H=D(P,c,c,A,V).x>0?i:f:($>0&&(H=Q===o?i:f),$<0&&(H=Q===o?f:i),E(X)&&(H=H===i?f:i)),P.originX=H,O("skewing",K(k))(L,P,A,V))},t.skewHandlerY=function(L,P,A,V){var H,X=P.target,$=X.skewY,Q=P.originX;return!X.lockSkewingY&&($===0?H=D(P,c,c,A,V).y>0?o:h:($>0&&(H=Q===i?o:h),$<0&&(H=Q===i?h:o),E(X)&&(H=H===o?h:o)),P.originY=H,O("skewing",K(W))(L,P,A,V))},t.dragHandler=function(L,P,A,V){var H=P.target,X=A-P.offsetX,$=V-P.offsetY,Q=!H.get("lockMovementX")&&H.left!==X,Z=!H.get("lockMovementY")&&H.top!==$;return Q&&H.set("left",X),Z&&H.set("top",$),(Q||Z)&&w("moving",G(L,P,A,V)),Q||Z},t.scaleOrSkewActionName=function(L,P,A){var V=L[A.canvas.altActionKey];return P.x===0?V?"skewX":"scaleY":P.y===0?V?"skewY":"scaleX":void 0},t.rotationStyleHandler=function(L,P,A){return A.lockRotation?"not-allowed":P.cursorStyle},t.fireEvent=w,t.wrapWithFixedAnchor=K,t.wrapWithFireEvent=O,t.getLocalPoint=D,r.controlsUtils=t}(e),function(s){var r=s.fabric||(s.fabric={}),n=r.util.degreesToRadians,l=r.controlsUtils;l.renderCircleControl=function(t,i,o,f,h){f=f||{};var c,g=this.sizeX||f.cornerSize||h.cornerSize,_=this.sizeY||f.cornerSize||h.cornerSize,y=f.transparentCorners!==void 0?f.transparentCorners:h.transparentCorners,x=y?"stroke":"fill",w=!y&&(f.cornerStrokeColor||h.cornerStrokeColor),I=i,R=o;t.save(),t.fillStyle=f.cornerColor||h.cornerColor,t.strokeStyle=f.cornerStrokeColor||h.cornerStrokeColor,g>_?(c=g,t.scale(1,_/g),R=o*g/_):_>g?(c=_,t.scale(g/_,1),I=i*_/g):c=g,t.lineWidth=1,t.beginPath(),t.arc(I,R,c/2,0,2*Math.PI,!1),t[x](),w&&t.stroke(),t.restore()},l.renderSquareControl=function(t,i,o,f,h){f=f||{};var c=this.sizeX||f.cornerSize||h.cornerSize,g=this.sizeY||f.cornerSize||h.cornerSize,_=f.transparentCorners!==void 0?f.transparentCorners:h.transparentCorners,y=_?"stroke":"fill",x=!_&&(f.cornerStrokeColor||h.cornerStrokeColor),w=c/2,I=g/2;t.save(),t.fillStyle=f.cornerColor||h.cornerColor,t.strokeStyle=f.cornerStrokeColor||h.cornerStrokeColor,t.lineWidth=1,t.translate(i,o),t.rotate(n(h.angle)),t[y+"Rect"](-w,-I,c,g),x&&t.strokeRect(-w,-I,c,g),t.restore()}}(e),function(s){var r=s.fabric||(s.fabric={});r.Control=function(n){for(var l in n)this[l]=n[l]},r.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(n,l){return l.cursorStyle},getActionName:function(n,l){return l.actionName},getVisibility:function(n,l){var t=n._controlsVisibility;return t&&t[l]!==void 0?t[l]:this.visible},setVisibility:function(n){this.visible=n},positionHandler:function(n,l){return r.util.transformPoint({x:this.x*n.x+this.offsetX,y:this.y*n.y+this.offsetY},l)},calcCornerCoords:function(n,l,t,i,o){var f,h,c,g,_=o?this.touchSizeX:this.sizeX,y=o?this.touchSizeY:this.sizeY;if(_&&y&&_!==y){var x=Math.atan2(y,_),w=Math.sqrt(_*_+y*y)/2,I=x-r.util.degreesToRadians(n),R=Math.PI/2-x-r.util.degreesToRadians(n);f=w*r.util.cos(I),h=w*r.util.sin(I),c=w*r.util.cos(R),g=w*r.util.sin(R)}else w=.7071067812*(_&&y?_:l),I=r.util.degreesToRadians(45-n),f=c=w*r.util.cos(I),h=g=w*r.util.sin(I);return{tl:{x:t-g,y:i-c},tr:{x:t+f,y:i-h},bl:{x:t-f,y:i+h},br:{x:t+g,y:i+c}}},render:function(n,l,t,i,o){((i=i||{}).cornerStyle||o.cornerStyle)==="circle"?r.controlsUtils.renderCircleControl.call(this,n,l,t,i,o):r.controlsUtils.renderSquareControl.call(this,n,l,t,i,o)}}}(e),function(){function s(n,l){var t,i,o,f,h=n.getAttribute("style"),c=n.getAttribute("offset")||0;if(c=(c=parseFloat(c)/(/%$/.test(c)?100:1))<0?0:c>1?1:c,h){var g=h.split(/\s*;\s*/);for(g[g.length-1]===""&&g.pop(),f=g.length;f--;){var _=g[f].split(/\s*:\s*/),y=_[0].trim(),x=_[1].trim();y==="stop-color"?t=x:y==="stop-opacity"&&(o=x)}}return t||(t=n.getAttribute("stop-color")||"rgb(0,0,0)"),o||(o=n.getAttribute("stop-opacity")),i=(t=new m.Color(t)).getAlpha(),o=isNaN(parseFloat(o))?1:parseFloat(o),o*=i*l,{offset:c,color:t.toRgb(),opacity:o}}var r=m.util.object.clone;m.Gradient=m.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(n){n||(n={}),n.coords||(n.coords={});var l,t=this;Object.keys(n).forEach(function(i){t[i]=n[i]}),this.id?this.id+="_"+m.Object.__uid++:this.id=m.Object.__uid++,l={x1:n.coords.x1||0,y1:n.coords.y1||0,x2:n.coords.x2||0,y2:n.coords.y2||0},this.type==="radial"&&(l.r1=n.coords.r1||0,l.r2=n.coords.r2||0),this.coords=l,this.colorStops=n.colorStops.slice()},addColorStop:function(n){for(var l in n){var t=new m.Color(n[l]);this.colorStops.push({offset:parseFloat(l),color:t.toRgb(),opacity:t.getAlpha()})}return this},toObject:function(n){var l={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return m.util.populateWithProperties(this,l,n),l},toSVG:function(n,l){var t,i,o,f,h=r(this.coords,!0),c=(l=l||{},r(this.colorStops,!0)),g=h.r1>h.r2,_=this.gradientTransform?this.gradientTransform.concat():m.iMatrix.concat(),y=-this.offsetX,x=-this.offsetY,w=!!l.additionalTransform,I=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(c.sort(function(K,O){return K.offset-O.offset}),I==="objectBoundingBox"?(y/=n.width,x/=n.height):(y+=n.width/2,x+=n.height/2),n.type==="path"&&this.gradientUnits!=="percentage"&&(y-=n.pathOffset.x,x-=n.pathOffset.y),_[4]-=y,_[5]-=x,f='id="SVGID_'+this.id+'" gradientUnits="'+I+'"',f+=' gradientTransform="'+(w?l.additionalTransform+" ":"")+m.util.matrixToSVG(_)+'" ',this.type==="linear"?o=["<linearGradient ",f,' x1="',h.x1,'" y1="',h.y1,'" x2="',h.x2,'" y2="',h.y2,`">
`]:this.type==="radial"&&(o=["<radialGradient ",f,' cx="',g?h.x1:h.x2,'" cy="',g?h.y1:h.y2,'" r="',g?h.r1:h.r2,'" fx="',g?h.x2:h.x1,'" fy="',g?h.y2:h.y1,`">
`]),this.type==="radial"){if(g)for((c=c.concat()).reverse(),t=0,i=c.length;t<i;t++)c[t].offset=1-c[t].offset;var R=Math.min(h.r1,h.r2);if(R>0){var U=R/Math.max(h.r1,h.r2);for(t=0,i=c.length;t<i;t++)c[t].offset+=U*(1-c[t].offset)}}for(t=0,i=c.length;t<i;t++){var G=c[t];o.push("<stop ",'offset="',100*G.offset+"%",'" style="stop-color:',G.color,G.opacity!==void 0?";stop-opacity: "+G.opacity:";",`"/>
`)}return o.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),o.join("")},toLive:function(n){var l,t,i,o=m.util.object.clone(this.coords);if(this.type){for(this.type==="linear"?l=n.createLinearGradient(o.x1,o.y1,o.x2,o.y2):this.type==="radial"&&(l=n.createRadialGradient(o.x1,o.y1,o.r1,o.x2,o.y2,o.r2)),t=0,i=this.colorStops.length;t<i;t++){var f=this.colorStops[t].color,h=this.colorStops[t].opacity,c=this.colorStops[t].offset;h!==void 0&&(f=new m.Color(f).setAlpha(h).toRgba()),l.addColorStop(c,f)}return l}}}),m.util.object.extend(m.Gradient,{fromElement:function(n,l,t,i){var o=parseFloat(t)/(/%$/.test(t)?100:1);o=o<0?0:o>1?1:o,isNaN(o)&&(o=1);var f,h,c,g,_=n.getElementsByTagName("stop"),y=n.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",x=n.getAttribute("gradientTransform")||"",w=[],I=0,R=0;for(n.nodeName==="linearGradient"||n.nodeName==="LINEARGRADIENT"?(f="linear",h=function(U){return{x1:U.getAttribute("x1")||0,y1:U.getAttribute("y1")||0,x2:U.getAttribute("x2")||"100%",y2:U.getAttribute("y2")||0}}(n)):(f="radial",h=function(U){return{x1:U.getAttribute("fx")||U.getAttribute("cx")||"50%",y1:U.getAttribute("fy")||U.getAttribute("cy")||"50%",r1:0,x2:U.getAttribute("cx")||"50%",y2:U.getAttribute("cy")||"50%",r2:U.getAttribute("r")||"50%"}}(n)),c=_.length;c--;)w.push(s(_[c],o));return g=m.parseTransformAttribute(x),function(U,G,K,O){var D,E;Object.keys(G).forEach(function(F){(D=G[F])==="Infinity"?E=1:D==="-Infinity"?E=0:(E=parseFloat(G[F],10),typeof D=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(D)&&(E*=.01,O==="pixels"&&(F!=="x1"&&F!=="x2"&&F!=="r2"||(E*=K.viewBoxWidth||K.width),F!=="y1"&&F!=="y2"||(E*=K.viewBoxHeight||K.height)))),G[F]=E})}(0,h,i,y),y==="pixels"&&(I=-l.left,R=-l.top),new m.Gradient({id:n.getAttribute("id"),type:f,coords:h,colorStops:w,gradientUnits:y,gradientTransform:g,offsetX:I,offsetY:R})}})}(),tt=m.util.toFixed,m.Pattern=m.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(s,r){if(s||(s={}),this.id=m.Object.__uid++,this.setOptions(s),!s.source||s.source&&typeof s.source!="string")r&&r(this);else{var n=this;this.source=m.util.createImage(),m.util.loadImage(s.source,function(l,t){n.source=l,r&&r(n,t)},null,this.crossOrigin)}},toObject:function(s){var r,n,l=m.Object.NUM_FRACTION_DIGITS;return typeof this.source.src=="string"?r=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(r=this.source.toDataURL()),n={type:"pattern",source:r,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:tt(this.offsetX,l),offsetY:tt(this.offsetY,l),patternTransform:this.patternTransform?this.patternTransform.concat():null},m.util.populateWithProperties(this,n,s),n},toSVG:function(s){var r=typeof this.source=="function"?this.source():this.source,n=r.width/s.width,l=r.height/s.height,t=this.offsetX/s.width,i=this.offsetY/s.height,o="";return this.repeat!=="repeat-x"&&this.repeat!=="no-repeat"||(l=1,i&&(l+=Math.abs(i))),this.repeat!=="repeat-y"&&this.repeat!=="no-repeat"||(n=1,t&&(n+=Math.abs(t))),r.src?o=r.src:r.toDataURL&&(o=r.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+t+'" y="'+i+'" width="'+n+'" height="'+l+`">
<image x="0" y="0" width="`+r.width+'" height="'+r.height+'" xlink:href="'+o+`"></image>
</pattern>
`},setOptions:function(s){for(var r in s)this[r]=s[r]},toLive:function(s){var r=this.source;return!r||r.src!==void 0&&(!r.complete||r.naturalWidth===0||r.naturalHeight===0)?"":s.createPattern(r,this.repeat)}}),function(s){var r=s.fabric||(s.fabric={}),n=r.util.toFixed;r.Shadow?r.warn("fabric.Shadow is already defined."):(r.Shadow=r.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(l){for(var t in typeof l=="string"&&(l=this._parseShadow(l)),l)this[t]=l[t];this.id=r.Object.__uid++},_parseShadow:function(l){var t=l.trim(),i=r.Shadow.reOffsetsAndBlur.exec(t)||[];return{color:(t.replace(r.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(i[1],10)||0,offsetY:parseFloat(i[2],10)||0,blur:parseFloat(i[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(l){var t=40,i=40,o=r.Object.NUM_FRACTION_DIGITS,f=r.util.rotateVector({x:this.offsetX,y:this.offsetY},r.util.degreesToRadians(-l.angle)),h=new r.Color(this.color);return l.width&&l.height&&(t=100*n((Math.abs(f.x)+this.blur)/l.width,o)+20,i=100*n((Math.abs(f.y)+this.blur)/l.height,o)+20),l.flipX&&(f.x*=-1),l.flipY&&(f.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+i+'%" height="'+(100+2*i)+'%" x="-'+t+'%" width="'+(100+2*t)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+n(this.blur?this.blur/2:0,o)+`"></feGaussianBlur>
	<feOffset dx="`+n(f.x,o)+'" dy="'+n(f.y,o)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+h.toRgb()+'" flood-opacity="'+h.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var l={},t=r.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(i){this[i]!==t[i]&&(l[i]=this[i])},this),l}}),r.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(e),function(){if(m.StaticCanvas)m.warn("fabric.StaticCanvas is already defined.");else{var s=m.util.object.extend,r=m.util.getElementOffset,n=m.util.removeFromArray,l=m.util.toFixed,t=m.util.transformPoint,i=m.util.invertTransform,o=m.util.getNodeCanvas,f=m.util.createCanvasElement,h=new Error("Could not initialize `canvas` element");m.StaticCanvas=m.util.createClass(m.CommonMethods,{initialize:function(c,g){g||(g={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(c,g)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:m.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(c,g){var _=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(c),this._initOptions(g),this.interactive||this._initRetinaScaling(),g.overlayImage&&this.setOverlayImage(g.overlayImage,_),g.backgroundImage&&this.setBackgroundImage(g.backgroundImage,_),g.backgroundColor&&this.setBackgroundColor(g.backgroundColor,_),g.overlayColor&&this.setOverlayColor(g.overlayColor,_),this.calcOffset()},_isRetinaScaling:function(){return m.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,m.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var c=m.devicePixelRatio;this.__initRetinaScaling(c,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(c,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(c,g,_){g.setAttribute("width",this.width*c),g.setAttribute("height",this.height*c),_.scale(c,c)},calcOffset:function(){return this._offset=r(this.lowerCanvasEl),this},setOverlayImage:function(c,g,_){return this.__setBgOverlayImage("overlayImage",c,g,_)},setBackgroundImage:function(c,g,_){return this.__setBgOverlayImage("backgroundImage",c,g,_)},setOverlayColor:function(c,g){return this.__setBgOverlayColor("overlayColor",c,g)},setBackgroundColor:function(c,g){return this.__setBgOverlayColor("backgroundColor",c,g)},__setBgOverlayImage:function(c,g,_,y){return typeof g=="string"?m.util.loadImage(g,function(x,w){if(x){var I=new m.Image(x,y);this[c]=I,I.canvas=this}_&&_(x,w)},this,y&&y.crossOrigin):(y&&g.setOptions(y),this[c]=g,g&&(g.canvas=this),_&&_(g,!1)),this},__setBgOverlayColor:function(c,g,_){return this[c]=g,this._initGradient(g,c),this._initPattern(g,c,_),this},_createCanvasElement:function(){var c=f();if(!c||(c.style||(c.style={}),c.getContext===void 0))throw h;return c},_initOptions:function(c){var g=this.lowerCanvasEl;this._setOptions(c),this.width=this.width||parseInt(g.width,10)||0,this.height=this.height||parseInt(g.height,10)||0,this.lowerCanvasEl.style&&(g.width=this.width,g.height=this.height,g.style.width=this.width+"px",g.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(c){c&&c.getContext?this.lowerCanvasEl=c:this.lowerCanvasEl=m.util.getById(c)||this._createCanvasElement(),m.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(c,g){return this.setDimensions({width:c},g)},setHeight:function(c,g){return this.setDimensions({height:c},g)},setDimensions:function(c,g){var _;for(var y in g=g||{},c)_=c[y],g.cssOnly||(this._setBackstoreDimension(y,c[y]),_+="px",this.hasLostContext=!0),g.backstoreOnly||this._setCssDimension(y,_);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),g.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(c,g){return this.lowerCanvasEl[c]=g,this.upperCanvasEl&&(this.upperCanvasEl[c]=g),this.cacheCanvasEl&&(this.cacheCanvasEl[c]=g),this[c]=g,this},_setCssDimension:function(c,g){return this.lowerCanvasEl.style[c]=g,this.upperCanvasEl&&(this.upperCanvasEl.style[c]=g),this.wrapperEl&&(this.wrapperEl.style[c]=g),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(c){var g,_,y,x=this._activeObject,w=this.backgroundImage,I=this.overlayImage;for(this.viewportTransform=c,_=0,y=this._objects.length;_<y;_++)(g=this._objects[_]).group||g.setCoords(!0);return x&&x.setCoords(),w&&w.setCoords(!0),I&&I.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(c,g){var _=c,y=this.viewportTransform.slice(0);c=t(c,i(this.viewportTransform)),y[0]=g,y[3]=g;var x=t(c,y);return y[4]+=_.x-x.x,y[5]+=_.y-x.y,this.setViewportTransform(y)},setZoom:function(c){return this.zoomToPoint(new m.Point(0,0),c),this},absolutePan:function(c){var g=this.viewportTransform.slice(0);return g[4]=-c.x,g[5]=-c.y,this.setViewportTransform(g)},relativePan:function(c){return this.absolutePan(new m.Point(-c.x-this.viewportTransform[4],-c.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(c){this.stateful&&c.setupState(),c._set("canvas",this),c.setCoords(),this.fire("object:added",{target:c}),c.fire("added")},_onObjectRemoved:function(c){this.fire("object:removed",{target:c}),c.fire("removed"),delete c.canvas},clearContext:function(c){return c.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var c=this.contextContainer;return this.renderCanvas(c,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=m.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var c={},g=this.width,_=this.height,y=i(this.viewportTransform);return c.tl=t({x:0,y:0},y),c.br=t({x:g,y:_},y),c.tr=new m.Point(c.br.x,c.tl.y),c.bl=new m.Point(c.tl.x,c.br.y),this.vptCoords=c,c},cancelRequestedRender:function(){this.isRendering&&(m.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(c,g){var _=this.viewportTransform,y=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(c),m.util.setImageSmoothing(c,this.imageSmoothingEnabled),this.fire("before:render",{ctx:c}),this._renderBackground(c),c.save(),c.transform(_[0],_[1],_[2],_[3],_[4],_[5]),this._renderObjects(c,g),c.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(c),y&&(y.canvas=this,y.shouldCache(),y._transformDone=!0,y.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(c)),this._renderOverlay(c),this.controlsAboveOverlay&&this.interactive&&this.drawControls(c),this.fire("after:render",{ctx:c})},drawClipPathOnCanvas:function(c){var g=this.viewportTransform,_=this.clipPath;c.save(),c.transform(g[0],g[1],g[2],g[3],g[4],g[5]),c.globalCompositeOperation="destination-in",_.transform(c),c.scale(1/_.zoomX,1/_.zoomY),c.drawImage(_._cacheCanvas,-_.cacheTranslationX,-_.cacheTranslationY),c.restore()},_renderObjects:function(c,g){var _,y;for(_=0,y=g.length;_<y;++_)g[_]&&g[_].render(c)},_renderBackgroundOrOverlay:function(c,g){var _=this[g+"Color"],y=this[g+"Image"],x=this.viewportTransform,w=this[g+"Vpt"];if(_||y){if(_){c.save(),c.beginPath(),c.moveTo(0,0),c.lineTo(this.width,0),c.lineTo(this.width,this.height),c.lineTo(0,this.height),c.closePath(),c.fillStyle=_.toLive?_.toLive(c,this):_,w&&c.transform(x[0],x[1],x[2],x[3],x[4],x[5]),c.transform(1,0,0,1,_.offsetX||0,_.offsetY||0);var I=_.gradientTransform||_.patternTransform;I&&c.transform(I[0],I[1],I[2],I[3],I[4],I[5]),c.fill(),c.restore()}y&&(c.save(),w&&c.transform(x[0],x[1],x[2],x[3],x[4],x[5]),y.render(c),c.restore())}},_renderBackground:function(c){this._renderBackgroundOrOverlay(c,"background")},_renderOverlay:function(c){this._renderBackgroundOrOverlay(c,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new m.Point(this.width/2,this.height/2)},centerObjectH:function(c){return this._centerObject(c,new m.Point(this.getCenterPoint().x,c.getCenterPoint().y))},centerObjectV:function(c){return this._centerObject(c,new m.Point(c.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(c){var g=this.getCenterPoint();return this._centerObject(c,g)},viewportCenterObject:function(c){var g=this.getVpCenter();return this._centerObject(c,g)},viewportCenterObjectH:function(c){var g=this.getVpCenter();return this._centerObject(c,new m.Point(g.x,c.getCenterPoint().y)),this},viewportCenterObjectV:function(c){var g=this.getVpCenter();return this._centerObject(c,new m.Point(c.getCenterPoint().x,g.y))},getVpCenter:function(){var c=this.getCenterPoint(),g=i(this.viewportTransform);return t(c,g)},_centerObject:function(c,g){return c.setPositionByOrigin(g,"center","center"),c.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(c){return this.toDatalessObject(c)},toObject:function(c){return this._toObjectMethod("toObject",c)},toDatalessObject:function(c){return this._toObjectMethod("toDatalessObject",c)},_toObjectMethod:function(c,g){var _=this.clipPath,y={version:m.version,objects:this._toObjects(c,g)};return _&&!_.excludeFromExport&&(y.clipPath=this._toObject(this.clipPath,c,g)),s(y,this.__serializeBgOverlay(c,g)),m.util.populateWithProperties(this,y,g),y},_toObjects:function(c,g){return this._objects.filter(function(_){return!_.excludeFromExport}).map(function(_){return this._toObject(_,c,g)},this)},_toObject:function(c,g,_){var y;this.includeDefaultValues||(y=c.includeDefaultValues,c.includeDefaultValues=!1);var x=c[g](_);return this.includeDefaultValues||(c.includeDefaultValues=y),x},__serializeBgOverlay:function(c,g){var _={},y=this.backgroundImage,x=this.overlayImage,w=this.backgroundColor,I=this.overlayColor;return w&&w.toObject?w.excludeFromExport||(_.background=w.toObject(g)):w&&(_.background=w),I&&I.toObject?I.excludeFromExport||(_.overlay=I.toObject(g)):I&&(_.overlay=I),y&&!y.excludeFromExport&&(_.backgroundImage=this._toObject(y,c,g)),x&&!x.excludeFromExport&&(_.overlayImage=this._toObject(x,c,g)),_},svgViewportTransformation:!0,toSVG:function(c,g){c||(c={}),c.reviver=g;var _=[];return this._setSVGPreamble(_,c),this._setSVGHeader(_,c),this.clipPath&&_.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(_,"background"),this._setSVGBgOverlayImage(_,"backgroundImage",g),this._setSVGObjects(_,g),this.clipPath&&_.push(`</g>
`),this._setSVGBgOverlayColor(_,"overlay"),this._setSVGBgOverlayImage(_,"overlayImage",g),_.push("</svg>"),_.join("")},_setSVGPreamble:function(c,g){g.suppressPreamble||c.push('<?xml version="1.0" encoding="',g.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(c,g){var _,y=g.width||this.width,x=g.height||this.height,w='viewBox="0 0 '+this.width+" "+this.height+'" ',I=m.Object.NUM_FRACTION_DIGITS;g.viewBox?w='viewBox="'+g.viewBox.x+" "+g.viewBox.y+" "+g.viewBox.width+" "+g.viewBox.height+'" ':this.svgViewportTransformation&&(_=this.viewportTransform,w='viewBox="'+l(-_[4]/_[0],I)+" "+l(-_[5]/_[3],I)+" "+l(this.width/_[0],I)+" "+l(this.height/_[3],I)+'" '),c.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',y,'" ','height="',x,'" ',w,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",m.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(g),`</defs>
`)},createSVGClipPathMarkup:function(c){var g=this.clipPath;return g?(g.clipPathId="CLIPPATH_"+m.Object.__uid++,'<clipPath id="'+g.clipPathId+`" >
`+this.clipPath.toClipPathSVG(c.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var c=this;return["background","overlay"].map(function(g){var _=c[g+"Color"];if(_&&_.toLive){var y=c[g+"Vpt"],x=c.viewportTransform,w={width:c.width/(y?x[0]:1),height:c.height/(y?x[3]:1)};return _.toSVG(w,{additionalTransform:y?m.util.matrixToSVG(x):""})}}).join("")},createSVGFontFacesMarkup:function(){var c,g,_,y,x,w,I,R,U="",G={},K=m.fontPaths,O=[];for(this._objects.forEach(function E(F){O.push(F),F._objects&&F._objects.forEach(E)}),I=0,R=O.length;I<R;I++)if(g=(c=O[I]).fontFamily,c.type.indexOf("text")!==-1&&!G[g]&&K[g]&&(G[g]=!0,c.styles))for(x in _=c.styles)for(w in y=_[x])!G[g=y[w].fontFamily]&&K[g]&&(G[g]=!0);for(var D in G)U+=[`		@font-face {
`,"			font-family: '",D,`';
`,"			src: url('",K[D],`');
`,`		}
`].join("");return U&&(U=['	<style type="text/css">',`<![CDATA[
`,U,"]]>",`</style>
`].join("")),U},_setSVGObjects:function(c,g){var _,y,x,w=this._objects;for(y=0,x=w.length;y<x;y++)(_=w[y]).excludeFromExport||this._setSVGObject(c,_,g)},_setSVGObject:function(c,g,_){c.push(g.toSVG(_))},_setSVGBgOverlayImage:function(c,g,_){this[g]&&!this[g].excludeFromExport&&this[g].toSVG&&c.push(this[g].toSVG(_))},_setSVGBgOverlayColor:function(c,g){var _=this[g+"Color"],y=this.viewportTransform,x=this.width,w=this.height;if(_)if(_.toLive){var I=_.repeat,R=m.util.invertTransform(y),U=this[g+"Vpt"]?m.util.matrixToSVG(R):"";c.push('<rect transform="'+U+" translate(",x/2,",",w/2,')"',' x="',_.offsetX-x/2,'" y="',_.offsetY-w/2,'" ','width="',I==="repeat-y"||I==="no-repeat"?_.source.width:x,'" height="',I==="repeat-x"||I==="no-repeat"?_.source.height:w,'" fill="url(#SVGID_'+_.id+')"',`></rect>
`)}else c.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',_,'"',`></rect>
`)},sendToBack:function(c){if(!c)return this;var g,_,y,x=this._activeObject;if(c===x&&c.type==="activeSelection")for(g=(y=x._objects).length;g--;)_=y[g],n(this._objects,_),this._objects.unshift(_);else n(this._objects,c),this._objects.unshift(c);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(c){if(!c)return this;var g,_,y,x=this._activeObject;if(c===x&&c.type==="activeSelection")for(y=x._objects,g=0;g<y.length;g++)_=y[g],n(this._objects,_),this._objects.push(_);else n(this._objects,c),this._objects.push(c);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(c,g){if(!c)return this;var _,y,x,w,I,R=this._activeObject,U=0;if(c===R&&c.type==="activeSelection")for(I=R._objects,_=0;_<I.length;_++)y=I[_],(x=this._objects.indexOf(y))>0+U&&(w=x-1,n(this._objects,y),this._objects.splice(w,0,y)),U++;else(x=this._objects.indexOf(c))!==0&&(w=this._findNewLowerIndex(c,x,g),n(this._objects,c),this._objects.splice(w,0,c));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(c,g,_){var y,x;if(_){for(y=g,x=g-1;x>=0;--x)if(c.intersectsWithObject(this._objects[x])||c.isContainedWithinObject(this._objects[x])||this._objects[x].isContainedWithinObject(c)){y=x;break}}else y=g-1;return y},bringForward:function(c,g){if(!c)return this;var _,y,x,w,I,R=this._activeObject,U=0;if(c===R&&c.type==="activeSelection")for(_=(I=R._objects).length;_--;)y=I[_],(x=this._objects.indexOf(y))<this._objects.length-1-U&&(w=x+1,n(this._objects,y),this._objects.splice(w,0,y)),U++;else(x=this._objects.indexOf(c))!==this._objects.length-1&&(w=this._findNewUpperIndex(c,x,g),n(this._objects,c),this._objects.splice(w,0,c));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(c,g,_){var y,x,w;if(_){for(y=g,x=g+1,w=this._objects.length;x<w;++x)if(c.intersectsWithObject(this._objects[x])||c.isContainedWithinObject(this._objects[x])||this._objects[x].isContainedWithinObject(c)){y=x;break}}else y=g+1;return y},moveTo:function(c,g){return n(this._objects,c),this._objects.splice(g,0,c),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(m.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(c){c.dispose&&c.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),m.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),m.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),s(m.StaticCanvas.prototype,m.Observable),s(m.StaticCanvas.prototype,m.Collection),s(m.StaticCanvas.prototype,m.DataURLExporter),s(m.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(c){var g=f();if(!g||!g.getContext)return null;var _=g.getContext("2d");return _&&c==="setLineDash"?_.setLineDash!==void 0:null}}),m.StaticCanvas.prototype.toJSON=m.StaticCanvas.prototype.toObject,m.isLikelyNode&&(m.StaticCanvas.prototype.createPNGStream=function(){var c=o(this.lowerCanvasEl);return c&&c.createPNGStream()},m.StaticCanvas.prototype.createJPEGStream=function(c){var g=o(this.lowerCanvasEl);return g&&g.createJPEGStream(c)})}}(),m.BaseBrush=m.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(s){s.strokeStyle=this.color,s.lineWidth=this.width,s.lineCap=this.strokeLineCap,s.miterLimit=this.strokeMiterLimit,s.lineJoin=this.strokeLineJoin,s.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(s){var r=this.canvas.viewportTransform;s.save(),s.transform(r[0],r[1],r[2],r[3],r[4],r[5])},_setShadow:function(){if(this.shadow){var s=this.canvas,r=this.shadow,n=s.contextTop,l=s.getZoom();s&&s._isRetinaScaling()&&(l*=m.devicePixelRatio),n.shadowColor=r.color,n.shadowBlur=r.blur*l,n.shadowOffsetX=r.offsetX*l,n.shadowOffsetY=r.offsetY*l}},needsFullRender:function(){return new m.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var s=this.canvas.contextTop;s.shadowColor="",s.shadowBlur=s.shadowOffsetX=s.shadowOffsetY=0},_isOutSideCanvas:function(s){return s.x<0||s.x>this.canvas.getWidth()||s.y<0||s.y>this.canvas.getHeight()}}),m.PencilBrush=m.util.createClass(m.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(s){this.canvas=s,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(s,r,n){var l=r.midPointFrom(n);return s.quadraticCurveTo(r.x,r.y,l.x,l.y),l},onMouseDown:function(s,r){this.canvas._isMainEvent(r.e)&&(this.drawStraightLine=r.e[this.straightLineKey],this._prepareForDrawing(s),this._captureDrawingPath(s),this._render())},onMouseMove:function(s,r){if(this.canvas._isMainEvent(r.e)&&(this.drawStraightLine=r.e[this.straightLineKey],(this.limitedToCanvasSize!==!0||!this._isOutSideCanvas(s))&&this._captureDrawingPath(s)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var n=this._points,l=n.length,t=this.canvas.contextTop;this._saveAndTransform(t),this.oldEnd&&(t.beginPath(),t.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(t,n[l-2],n[l-1],!0),t.stroke(),t.restore()}},onMouseUp:function(s){return!this.canvas._isMainEvent(s.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(s){var r=new m.Point(s.x,s.y);this._reset(),this._addPoint(r),this.canvas.contextTop.moveTo(r.x,r.y)},_addPoint:function(s){return!(this._points.length>1&&s.eq(this._points[this._points.length-1])||(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(s),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(s){var r=new m.Point(s.x,s.y);return this._addPoint(r)},_render:function(s){var r,n,l=this._points[0],t=this._points[1];if(s=s||this.canvas.contextTop,this._saveAndTransform(s),s.beginPath(),this._points.length===2&&l.x===t.x&&l.y===t.y){var i=this.width/1e3;l=new m.Point(l.x,l.y),t=new m.Point(t.x,t.y),l.x-=i,t.x+=i}for(s.moveTo(l.x,l.y),r=1,n=this._points.length;r<n;r++)this._drawSegment(s,l,t),l=this._points[r],t=this._points[r+1];s.lineTo(l.x,l.y),s.stroke(),s.restore()},convertPointsToSVGPath:function(s){var r=this.width/1e3;return m.util.getSmoothPathFromPoints(s,r)},_isEmptySVGPath:function(s){return m.util.joinPath(s)==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(s){var r=new m.Path(s,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,r.shadow=new m.Shadow(this.shadow)),r},decimatePoints:function(s,r){if(s.length<=2)return s;var n,l=this.canvas.getZoom(),t=Math.pow(r/l,2),i=s.length-1,o=s[0],f=[o];for(n=1;n<i-1;n++)Math.pow(o.x-s[n].x,2)+Math.pow(o.y-s[n].y,2)>=t&&(o=s[n],f.push(o));return f.push(s[i]),f},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var s=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(s))this.canvas.requestRenderAll();else{var r=this.createPath(s);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:r}),this.canvas.add(r),this.canvas.requestRenderAll(),r.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:r})}}}),m.CircleBrush=m.util.createClass(m.BaseBrush,{width:10,initialize:function(s){this.canvas=s,this.points=[]},drawDot:function(s){var r=this.addPoint(s),n=this.canvas.contextTop;this._saveAndTransform(n),this.dot(n,r),n.restore()},dot:function(s,r){s.fillStyle=r.fill,s.beginPath(),s.arc(r.x,r.y,r.radius,0,2*Math.PI,!1),s.closePath(),s.fill()},onMouseDown:function(s){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(s)},_render:function(){var s,r,n=this.canvas.contextTop,l=this.points;for(this._saveAndTransform(n),s=0,r=l.length;s<r;s++)this.dot(n,l[s]);n.restore()},onMouseMove:function(s){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(s)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(s),this._render()):this.drawDot(s))},onMouseUp:function(){var s,r,n=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var l=[];for(s=0,r=this.points.length;s<r;s++){var t=this.points[s],i=new m.Circle({radius:t.radius,left:t.x,top:t.y,originX:"center",originY:"center",fill:t.fill});this.shadow&&(i.shadow=new m.Shadow(this.shadow)),l.push(i)}var o=new m.Group(l);o.canvas=this.canvas,this.canvas.fire("before:path:created",{path:o}),this.canvas.add(o),this.canvas.fire("path:created",{path:o}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=n,this.canvas.requestRenderAll()},addPoint:function(s){var r=new m.Point(s.x,s.y),n=m.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,l=new m.Color(this.color).setAlpha(m.util.getRandomInt(0,100)/100).toRgba();return r.radius=n,r.fill=l,this.points.push(r),r}}),m.SprayBrush=m.util.createClass(m.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(s){this.canvas=s,this.sprayChunks=[]},onMouseDown:function(s){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(s),this.render(this.sprayChunkPoints)},onMouseMove:function(s){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(s)||(this.addSprayChunk(s),this.render(this.sprayChunkPoints))},onMouseUp:function(){var s=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var r=[],n=0,l=this.sprayChunks.length;n<l;n++)for(var t=this.sprayChunks[n],i=0,o=t.length;i<o;i++){var f=new m.Rect({width:t[i].width,height:t[i].width,left:t[i].x+1,top:t[i].y+1,originX:"center",originY:"center",fill:this.color});r.push(f)}this.optimizeOverlapping&&(r=this._getOptimizedRects(r));var h=new m.Group(r);this.shadow&&h.set("shadow",new m.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:h}),this.canvas.add(h),this.canvas.fire("path:created",{path:h}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=s,this.canvas.requestRenderAll()},_getOptimizedRects:function(s){var r,n,l,t={};for(n=0,l=s.length;n<l;n++)t[r=s[n].left+""+s[n].top]||(t[r]=s[n]);var i=[];for(r in t)i.push(t[r]);return i},render:function(s){var r,n,l=this.canvas.contextTop;for(l.fillStyle=this.color,this._saveAndTransform(l),r=0,n=s.length;r<n;r++){var t=s[r];t.opacity!==void 0&&(l.globalAlpha=t.opacity),l.fillRect(t.x,t.y,t.width,t.width)}l.restore()},_render:function(){var s,r,n=this.canvas.contextTop;for(n.fillStyle=this.color,this._saveAndTransform(n),s=0,r=this.sprayChunks.length;s<r;s++)this.render(this.sprayChunks[s]);n.restore()},addSprayChunk:function(s){this.sprayChunkPoints=[];var r,n,l,t,i=this.width/2;for(t=0;t<this.density;t++){r=m.util.getRandomInt(s.x-i,s.x+i),n=m.util.getRandomInt(s.y-i,s.y+i),l=this.dotWidthVariance?m.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var o=new m.Point(r,n);o.width=l,this.randomOpacity&&(o.opacity=m.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(o)}this.sprayChunks.push(this.sprayChunkPoints)}}),m.PatternBrush=m.util.createClass(m.PencilBrush,{getPatternSrc:function(){var s=m.util.createCanvasElement(),r=s.getContext("2d");return s.width=s.height=25,r.fillStyle=this.color,r.beginPath(),r.arc(10,10,10,0,2*Math.PI,!1),r.closePath(),r.fill(),s},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(s){return s.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(s){this.callSuper("_setBrushStyles",s),s.strokeStyle=this.getPattern(s)},createPath:function(s){var r=this.callSuper("createPath",s),n=r._getLeftTopCoords().scalarAdd(r.strokeWidth/2);return r.stroke=new m.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-n.x,offsetY:-n.y}),r}}),function(){var s=m.util.getPointer,r=m.util.degreesToRadians,n=m.util.isTouchEvent;for(var l in m.Canvas=m.util.createClass(m.StaticCanvas,{initialize:function(t,i){i||(i={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(t,i),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=m.PencilBrush&&new m.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var t,i,o,f=this.getActiveObjects();if(f.length>0&&!this.preserveObjectStacking){i=[],o=[];for(var h=0,c=this._objects.length;h<c;h++)t=this._objects[h],f.indexOf(t)===-1?i.push(t):o.push(t);f.length>1&&(this._activeObject._objects=o),i.push.apply(i,o)}else i=this._objects;return i},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var t=this.contextContainer;return this.renderCanvas(t,this._chooseObjectsToRender()),this},renderTopLayer:function(t){t.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(t),this.contextTopDirty=!0),t.restore()},renderTop:function(){var t=this.contextTop;return this.clearContext(t),this.renderTopLayer(t),this.fire("after:render"),this},_normalizePointer:function(t,i){var o=t.calcTransformMatrix(),f=m.util.invertTransform(o),h=this.restorePointerVpt(i);return m.util.transformPoint(h,f)},isTargetTransparent:function(t,i,o){if(t.shouldCache()&&t._cacheCanvas&&t!==this._activeObject){var f=this._normalizePointer(t,{x:i,y:o}),h=Math.max(t.cacheTranslationX+f.x*t.zoomX,0),c=Math.max(t.cacheTranslationY+f.y*t.zoomY,0);return m.util.isTransparent(t._cacheContext,Math.round(h),Math.round(c),this.targetFindTolerance)}var g=this.contextCache,_=t.selectionBackgroundColor,y=this.viewportTransform;return t.selectionBackgroundColor="",this.clearContext(g),g.save(),g.transform(y[0],y[1],y[2],y[3],y[4],y[5]),t.render(g),g.restore(),t.selectionBackgroundColor=_,m.util.isTransparent(g,i,o,this.targetFindTolerance)},_isSelectionKeyPressed:function(t){return Array.isArray(this.selectionKey)?!!this.selectionKey.find(function(i){return t[i]===!0}):t[this.selectionKey]},_shouldClearSelection:function(t,i){var o=this.getActiveObjects(),f=this._activeObject;return!i||i&&f&&o.length>1&&o.indexOf(i)===-1&&f!==i&&!this._isSelectionKeyPressed(t)||i&&!i.evented||i&&!i.selectable&&f&&f!==i},_shouldCenterTransform:function(t,i,o){var f;if(t)return i==="scale"||i==="scaleX"||i==="scaleY"||i==="resizing"?f=this.centeredScaling||t.centeredScaling:i==="rotate"&&(f=this.centeredRotation||t.centeredRotation),f?!o:o},_getOriginFromCorner:function(t,i){var o={x:t.originX,y:t.originY};return i==="ml"||i==="tl"||i==="bl"?o.x="right":i!=="mr"&&i!=="tr"&&i!=="br"||(o.x="left"),i==="tl"||i==="mt"||i==="tr"?o.y="bottom":i!=="bl"&&i!=="mb"&&i!=="br"||(o.y="top"),o},_getActionFromCorner:function(t,i,o,f){if(!i||!t)return"drag";var h=f.controls[i];return h.getActionName(o,h,f)},_setupCurrentTransform:function(t,i,o){if(i){var f=this.getPointer(t),h=i.__corner,c=i.controls[h],g=o&&h?c.getActionHandler(t,i,c):m.controlsUtils.dragHandler,_=this._getActionFromCorner(o,h,t,i),y=this._getOriginFromCorner(i,h),x=t[this.centeredKey],w={target:i,action:_,actionHandler:g,corner:h,scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,offsetX:f.x-i.left,offsetY:f.y-i.top,originX:y.x,originY:y.y,ex:f.x,ey:f.y,lastX:f.x,lastY:f.y,theta:r(i.angle),width:i.width*i.scaleX,shiftKey:t.shiftKey,altKey:x,original:m.util.saveObjectTransform(i)};this._shouldCenterTransform(i,_,x)&&(w.originX="center",w.originY="center"),w.original.originX=y.x,w.original.originY=y.y,this._currentTransform=w,this._beforeTransform(t)}},setCursor:function(t){this.upperCanvasEl.style.cursor=t},_drawSelection:function(t){var i=this._groupSelector,o=new m.Point(i.ex,i.ey),f=m.util.transformPoint(o,this.viewportTransform),h=new m.Point(i.ex+i.left,i.ey+i.top),c=m.util.transformPoint(h,this.viewportTransform),g=Math.min(f.x,c.x),_=Math.min(f.y,c.y),y=Math.max(f.x,c.x),x=Math.max(f.y,c.y),w=this.selectionLineWidth/2;this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(g,_,y-g,x-_)),this.selectionLineWidth&&this.selectionBorderColor&&(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,g+=w,_+=w,y-=w,x-=w,m.Object.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(g,_,y-g,x-_))},findTarget:function(t,i){if(!this.skipTargetFind){var o,f,h=this.getPointer(t,!0),c=this._activeObject,g=this.getActiveObjects(),_=n(t),y=g.length>1&&!i||g.length===1;if(this.targets=[],y&&c._findTargetCorner(h,_)||g.length>1&&!i&&c===this._searchPossibleTargets([c],h))return c;if(g.length===1&&c===this._searchPossibleTargets([c],h)){if(!this.preserveObjectStacking)return c;o=c,f=this.targets,this.targets=[]}var x=this._searchPossibleTargets(this._objects,h);return t[this.altSelectionKey]&&x&&o&&x!==o&&(x=o,this.targets=f),x}},_checkTarget:function(t,i,o){if(i&&i.visible&&i.evented&&i.containsPoint(t)&&(!this.perPixelTargetFind&&!i.perPixelTargetFind||i.isEditing||!this.isTargetTransparent(i,o.x,o.y)))return!0},_searchPossibleTargets:function(t,i){for(var o,f,h=t.length;h--;){var c=t[h],g=c.group?this._normalizePointer(c.group,i):i;if(this._checkTarget(g,c,i)){(o=t[h]).subTargetCheck&&o instanceof m.Group&&(f=this._searchPossibleTargets(o._objects,i))&&this.targets.push(f);break}}return o},restorePointerVpt:function(t){return m.util.transformPoint(t,m.util.invertTransform(this.viewportTransform))},getPointer:function(t,i){if(this._absolutePointer&&!i)return this._absolutePointer;if(this._pointer&&i)return this._pointer;var o,f=s(t),h=this.upperCanvasEl,c=h.getBoundingClientRect(),g=c.width||0,_=c.height||0;g&&_||("top"in c&&"bottom"in c&&(_=Math.abs(c.top-c.bottom)),"right"in c&&"left"in c&&(g=Math.abs(c.right-c.left))),this.calcOffset(),f.x=f.x-this._offset.left,f.y=f.y-this._offset.top,i||(f=this.restorePointerVpt(f));var y=this.getRetinaScaling();return y!==1&&(f.x/=y,f.y/=y),o=g===0||_===0?{width:1,height:1}:{width:h.width/g,height:h.height/_},{x:f.x*o.width,y:f.y*o.height}},_createUpperCanvas:function(){var t=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),i=this.lowerCanvasEl,o=this.upperCanvasEl;o?o.className="":(o=this._createCanvasElement(),this.upperCanvasEl=o),m.util.addClass(o,"upper-canvas "+t),this.wrapperEl.appendChild(o),this._copyCanvasStyle(i,o),this._applyCanvasStyle(o),this.contextTop=o.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=m.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),m.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),m.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(t){var i=this.width||t.width,o=this.height||t.height;m.util.setStyle(t,{position:"absolute",width:i+"px",height:o+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),t.width=i,t.height=o,m.util.makeElementUnselectable(t)},_copyCanvasStyle:function(t,i){i.style.cssText=t.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var t=this._activeObject;return t?t.type==="activeSelection"&&t._objects?t._objects.slice(0):[t]:[]},_onObjectRemoved:function(t){t===this._activeObject&&(this.fire("before:selection:cleared",{target:t}),this._discardActiveObject(),this.fire("selection:cleared",{target:t}),t.fire("deselected")),t===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",t)},_fireSelectionEvents:function(t,i){var o=!1,f=this.getActiveObjects(),h=[],c=[];t.forEach(function(g){f.indexOf(g)===-1&&(o=!0,g.fire("deselected",{e:i,target:g}),c.push(g))}),f.forEach(function(g){t.indexOf(g)===-1&&(o=!0,g.fire("selected",{e:i,target:g}),h.push(g))}),t.length>0&&f.length>0?o&&this.fire("selection:updated",{e:i,selected:h,deselected:c}):f.length>0?this.fire("selection:created",{e:i,selected:h}):t.length>0&&this.fire("selection:cleared",{e:i,deselected:c})},setActiveObject:function(t,i){var o=this.getActiveObjects();return this._setActiveObject(t,i),this._fireSelectionEvents(o,i),this},_setActiveObject:function(t,i){return this._activeObject!==t&&!!this._discardActiveObject(i,t)&&!t.onSelect({e:i})&&(this._activeObject=t,!0)},_discardActiveObject:function(t,i){var o=this._activeObject;if(o){if(o.onDeselect({e:t,object:i}))return!1;this._activeObject=null}return!0},discardActiveObject:function(t){var i=this.getActiveObjects(),o=this.getActiveObject();return i.length&&this.fire("before:selection:cleared",{target:o,e:t}),this._discardActiveObject(t),this._fireSelectionEvents(i,t),this},dispose:function(){var t=this.wrapperEl;return this.removeListeners(),t.removeChild(this.upperCanvasEl),t.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(i){m.util.cleanUpJsdomNode(this[i]),this[i]=void 0}.bind(this)),t.parentNode&&t.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,m.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(t){var i=this._activeObject;i&&i._renderControls(t)},_toObject:function(t,i,o){var f=this._realizeGroupTransformOnObject(t),h=this.callSuper("_toObject",t,i,o);return this._unwindGroupTransformOnObject(t,f),h},_realizeGroupTransformOnObject:function(t){if(t.group&&t.group.type==="activeSelection"&&this._activeObject===t.group){var i={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(o){i[o]=t[o]}),m.util.addTransformToObject(t,this._activeObject.calcOwnMatrix()),i}return null},_unwindGroupTransformOnObject:function(t,i){i&&t.set(i)},_setSVGObject:function(t,i,o){var f=this._realizeGroupTransformOnObject(i);this.callSuper("_setSVGObject",t,i,o),this._unwindGroupTransformOnObject(i,f)},setViewportTransform:function(t){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),m.StaticCanvas.prototype.setViewportTransform.call(this,t)}}),m.StaticCanvas)l!=="prototype"&&(m.Canvas[l]=m.StaticCanvas[l])}(),function(){var s=m.util.addListener,r=m.util.removeListener,n={passive:!1};function l(t,i){return t.button&&t.button===i-1}m.util.object.extend(m.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(s,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(t,i){var o=this.upperCanvasEl,f=this._getEventPrefix();t(m.window,"resize",this._onResize),t(o,f+"down",this._onMouseDown),t(o,f+"move",this._onMouseMove,n),t(o,f+"out",this._onMouseOut),t(o,f+"enter",this._onMouseEnter),t(o,"wheel",this._onMouseWheel),t(o,"contextmenu",this._onContextMenu),t(o,"dblclick",this._onDoubleClick),t(o,"dragover",this._onDragOver),t(o,"dragenter",this._onDragEnter),t(o,"dragleave",this._onDragLeave),t(o,"drop",this._onDrop),this.enablePointerEvents||t(o,"touchstart",this._onTouchStart,n),typeof eventjs<"u"&&i in eventjs&&(eventjs[i](o,"gesture",this._onGesture),eventjs[i](o,"drag",this._onDrag),eventjs[i](o,"orientation",this._onOrientationChange),eventjs[i](o,"shake",this._onShake),eventjs[i](o,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(r,"remove");var t=this._getEventPrefix();r(m.document,t+"up",this._onMouseUp),r(m.document,"touchend",this._onTouchEnd,n),r(m.document,t+"move",this._onMouseMove,n),r(m.document,"touchmove",this._onMouseMove,n)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(t,i){this.__onTransformGesture&&this.__onTransformGesture(t,i)},_onDrag:function(t,i){this.__onDrag&&this.__onDrag(t,i)},_onMouseWheel:function(t){this.__onMouseWheel(t)},_onMouseOut:function(t){var i=this._hoveredTarget;this.fire("mouse:out",{target:i,e:t}),this._hoveredTarget=null,i&&i.fire("mouseout",{e:t});var o=this;this._hoveredTargets.forEach(function(f){o.fire("mouse:out",{target:i,e:t}),f&&i.fire("mouseout",{e:t})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(f){f.isEditing&&f.hiddenTextarea.focus()})},_onMouseEnter:function(t){this._currentTransform||this.findTarget(t)||(this.fire("mouse:over",{target:null,e:t}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(t,i){this.__onOrientationChange&&this.__onOrientationChange(t,i)},_onShake:function(t,i){this.__onShake&&this.__onShake(t,i)},_onLongPress:function(t,i){this.__onLongPress&&this.__onLongPress(t,i)},_onDragOver:function(t){t.preventDefault();var i=this._simpleEventHandler("dragover",t);this._fireEnterLeaveEvents(i,t)},_onDrop:function(t){return this._simpleEventHandler("drop:before",t),this._simpleEventHandler("drop",t)},_onContextMenu:function(t){return this.stopContextMenu&&(t.stopPropagation(),t.preventDefault()),!1},_onDoubleClick:function(t){this._cacheTransformEventData(t),this._handleEvent(t,"dblclick"),this._resetTransformEventData(t)},getPointerId:function(t){var i=t.changedTouches;return i?i[0]&&i[0].identifier:this.enablePointerEvents?t.pointerId:-1},_isMainEvent:function(t){return t.isPrimary===!0||t.isPrimary!==!1&&(t.type==="touchend"&&t.touches.length===0||!t.changedTouches||t.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(t){t.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),this._resetTransformEventData();var i=this.upperCanvasEl,o=this._getEventPrefix();s(m.document,"touchend",this._onTouchEnd,n),s(m.document,"touchmove",this._onMouseMove,n),r(i,o+"down",this._onMouseDown)},_onMouseDown:function(t){this.__onMouseDown(t),this._resetTransformEventData();var i=this.upperCanvasEl,o=this._getEventPrefix();r(i,o+"move",this._onMouseMove,n),s(m.document,o+"up",this._onMouseUp),s(m.document,o+"move",this._onMouseMove,n)},_onTouchEnd:function(t){if(!(t.touches.length>0)){this.__onMouseUp(t),this._resetTransformEventData(),this.mainTouchId=null;var i=this._getEventPrefix();r(m.document,"touchend",this._onTouchEnd,n),r(m.document,"touchmove",this._onMouseMove,n);var o=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){s(o.upperCanvasEl,i+"down",o._onMouseDown),o._willAddMouseDown=0},400)}},_onMouseUp:function(t){this.__onMouseUp(t),this._resetTransformEventData();var i=this.upperCanvasEl,o=this._getEventPrefix();this._isMainEvent(t)&&(r(m.document,o+"up",this._onMouseUp),r(m.document,o+"move",this._onMouseMove,n),s(i,o+"move",this._onMouseMove,n))},_onMouseMove:function(t){!this.allowTouchScrolling&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)},_onResize:function(){this.calcOffset()},_shouldRender:function(t){var i=this._activeObject;return!!(!!i!=!!t||i&&t&&i!==t)||(i&&i.isEditing,!1)},__onMouseUp:function(t){var i,o=this._currentTransform,f=this._groupSelector,h=!1,c=!f||f.left===0&&f.top===0;if(this._cacheTransformEventData(t),i=this._target,this._handleEvent(t,"up:before"),l(t,3))this.fireRightClick&&this._handleEvent(t,"up",3,c);else{if(l(t,2))return this.fireMiddleClick&&this._handleEvent(t,"up",2,c),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(t);else if(this._isMainEvent(t)){if(o&&(this._finalizeCurrentTransform(t),h=o.actionPerformed),!c){var g=i===this._activeObject;this._maybeGroupObjects(t),h||(h=this._shouldRender(i)||!g&&i===this._activeObject)}var _,y;if(i){if(_=i._findTargetCorner(this.getPointer(t,!0),m.util.isTouchEvent(t)),i.selectable&&i!==this._activeObject&&i.activeOn==="up")this.setActiveObject(i,t),h=!0;else{var x=i.controls[_],w=x&&x.getMouseUpHandler(t,i,x);w&&w(t,o,(y=this.getPointer(t)).x,y.y)}i.isMoving=!1}if(o&&(o.target!==i||o.corner!==_)){var I=o.target&&o.target.controls[o.corner],R=I&&I.getMouseUpHandler(t,i,x);y=y||this.getPointer(t),R&&R(t,o,y.x,y.y)}this._setCursorFromEvent(t,i),this._handleEvent(t,"up",1,c),this._groupSelector=null,this._currentTransform=null,i&&(i.__corner=0),h?this.requestRenderAll():c||this.renderTop()}}},_simpleEventHandler:function(t,i){var o=this.findTarget(i),f=this.targets,h={e:i,target:o,subTargets:f};if(this.fire(t,h),o&&o.fire(t,h),!f)return o;for(var c=0;c<f.length;c++)f[c].fire(t,h);return o},_handleEvent:function(t,i,o,f){var h=this._target,c=this.targets||[],g={e:t,target:h,subTargets:c,button:o||1,isClick:f||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};i==="up"&&(g.currentTarget=this.findTarget(t),g.currentSubTargets=this.targets),this.fire("mouse:"+i,g),h&&h.fire("mouse"+i,g);for(var _=0;_<c.length;_++)c[_].fire("mouse"+i,g)},_finalizeCurrentTransform:function(t){var i=this._currentTransform,o=i.target,f={e:t,target:o,transform:i,action:i.action};o._scaling&&(o._scaling=!1),o.setCoords(),(i.actionPerformed||this.stateful&&o.hasStateChanged())&&this._fire("modified",f)},_onMouseDownInDrawingMode:function(t){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(t).requestRenderAll();var i=this.getPointer(t);this.freeDrawingBrush.onMouseDown(i,{e:t,pointer:i}),this._handleEvent(t,"down")},_onMouseMoveInDrawingMode:function(t){if(this._isCurrentlyDrawing){var i=this.getPointer(t);this.freeDrawingBrush.onMouseMove(i,{e:t,pointer:i})}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")},_onMouseUpInDrawingMode:function(t){var i=this.getPointer(t);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:t,pointer:i}),this._handleEvent(t,"up")},__onMouseDown:function(t){this._cacheTransformEventData(t),this._handleEvent(t,"down:before");var i=this._target;if(l(t,3))this.fireRightClick&&this._handleEvent(t,"down",3);else if(l(t,2))this.fireMiddleClick&&this._handleEvent(t,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(t);else if(this._isMainEvent(t)&&!this._currentTransform){var o=this._pointer;this._previousPointer=o;var f=this._shouldRender(i),h=this._shouldGroup(t,i);if(this._shouldClearSelection(t,i)?this.discardActiveObject(t):h&&(this._handleGrouping(t,i),i=this._activeObject),!this.selection||i&&(i.selectable||i.isEditing||i===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),i){var c=i===this._activeObject;i.selectable&&i.activeOn==="down"&&this.setActiveObject(i,t);var g=i._findTargetCorner(this.getPointer(t,!0),m.util.isTouchEvent(t));if(i.__corner=g,i===this._activeObject&&(g||!h)){this._setupCurrentTransform(t,i,c);var _=i.controls[g],y=(o=this.getPointer(t),_&&_.getMouseDownHandler(t,i,_));y&&y(t,this._currentTransform,o.x,o.y)}}this._handleEvent(t,"down"),(f||h)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(t){this._resetTransformEventData(),this._pointer=this.getPointer(t,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(t)||null},_beforeTransform:function(t){var i=this._currentTransform;this.stateful&&i.target.saveState(),this.fire("before:transform",{e:t,transform:i})},__onMouseMove:function(t){var i,o;if(this._handleEvent(t,"move:before"),this._cacheTransformEventData(t),this.isDrawingMode)this._onMouseMoveInDrawingMode(t);else if(this._isMainEvent(t)){var f=this._groupSelector;f?(o=this._absolutePointer,f.left=o.x-f.ex,f.top=o.y-f.ey,this.renderTop()):this._currentTransform?this._transformObject(t):(i=this.findTarget(t)||null,this._setCursorFromEvent(t,i),this._fireOverOutEvents(i,t)),this._handleEvent(t,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(t,i){var o=this._hoveredTarget,f=this._hoveredTargets,h=this.targets,c=Math.max(f.length,h.length);this.fireSyntheticInOutEvents(t,i,{oldTarget:o,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var g=0;g<c;g++)this.fireSyntheticInOutEvents(h[g],i,{oldTarget:f[g],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=t,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(t,i){var o=this._draggedoverTarget,f=this._hoveredTargets,h=this.targets,c=Math.max(f.length,h.length);this.fireSyntheticInOutEvents(t,i,{oldTarget:o,evtOut:"dragleave",evtIn:"dragenter"});for(var g=0;g<c;g++)this.fireSyntheticInOutEvents(h[g],i,{oldTarget:f[g],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=t},fireSyntheticInOutEvents:function(t,i,o){var f,h,c,g=o.oldTarget,_=g!==t,y=o.canvasEvtIn,x=o.canvasEvtOut;_&&(f={e:i,target:t,previousTarget:g},h={e:i,target:g,nextTarget:t}),c=t&&_,g&&_&&(x&&this.fire(x,h),g.fire(o.evtOut,h)),c&&(y&&this.fire(y,f),t.fire(o.evtIn,f))},__onMouseWheel:function(t){this._cacheTransformEventData(t),this._handleEvent(t,"wheel"),this._resetTransformEventData()},_transformObject:function(t){var i=this.getPointer(t),o=this._currentTransform;o.reset=!1,o.shiftKey=t.shiftKey,o.altKey=t[this.centeredKey],this._performTransformAction(t,o,i),o.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(t,i,o){var f=o.x,h=o.y,c=i.action,g=!1,_=i.actionHandler;_&&(g=_(t,i,f,h)),c==="drag"&&g&&(i.target.isMoving=!0,this.setCursor(i.target.moveCursor||this.moveCursor)),i.actionPerformed=i.actionPerformed||g},_fire:m.controlsUtils.fireEvent,_setCursorFromEvent:function(t,i){if(!i)return this.setCursor(this.defaultCursor),!1;var o=i.hoverCursor||this.hoverCursor,f=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,h=(!f||!f.contains(i))&&i._findTargetCorner(this.getPointer(t,!0));h?this.setCursor(this.getCornerCursor(h,i,t)):(i.subTargetCheck&&this.targets.concat().reverse().map(function(c){o=c.hoverCursor||o}),this.setCursor(o))},getCornerCursor:function(t,i,o){var f=i.controls[t];return f.cursorStyleHandler(o,f,i)}})}(),st=Math.min,nt=Math.max,m.util.object.extend(m.Canvas.prototype,{_shouldGroup:function(s,r){var n=this._activeObject;return n&&this._isSelectionKeyPressed(s)&&r&&r.selectable&&this.selection&&(n!==r||n.type==="activeSelection")&&!r.onSelect({e:s})},_handleGrouping:function(s,r){var n=this._activeObject;n.__corner||(r!==n||(r=this.findTarget(s,!0))&&r.selectable)&&(n&&n.type==="activeSelection"?this._updateActiveSelection(r,s):this._createActiveSelection(r,s))},_updateActiveSelection:function(s,r){var n=this._activeObject,l=n._objects.slice(0);n.contains(s)?(n.removeWithUpdate(s),this._hoveredTarget=s,this._hoveredTargets=this.targets.concat(),n.size()===1&&this._setActiveObject(n.item(0),r)):(n.addWithUpdate(s),this._hoveredTarget=n,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(l,r)},_createActiveSelection:function(s,r){var n=this.getActiveObjects(),l=this._createGroup(s);this._hoveredTarget=l,this._setActiveObject(l,r),this._fireSelectionEvents(n,r)},_createGroup:function(s){var r=this._objects,n=r.indexOf(this._activeObject)<r.indexOf(s)?[this._activeObject,s]:[s,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new m.ActiveSelection(n,{canvas:this})},_groupSelectedObjects:function(s){var r,n=this._collectObjects(s);n.length===1?this.setActiveObject(n[0],s):n.length>1&&(r=new m.ActiveSelection(n.reverse(),{canvas:this}),this.setActiveObject(r,s))},_collectObjects:function(s){for(var r,n=[],l=this._groupSelector.ex,t=this._groupSelector.ey,i=l+this._groupSelector.left,o=t+this._groupSelector.top,f=new m.Point(st(l,i),st(t,o)),h=new m.Point(nt(l,i),nt(t,o)),c=!this.selectionFullyContained,g=l===i&&t===o,_=this._objects.length;_--&&!((r=this._objects[_])&&r.selectable&&r.visible&&(c&&r.intersectsWithRect(f,h,!0)||r.isContainedWithinRect(f,h,!0)||c&&r.containsPoint(f,null,!0)||c&&r.containsPoint(h,null,!0))&&(n.push(r),g)););return n.length>1&&(n=n.filter(function(y){return!y.onSelect({e:s})})),n},_maybeGroupObjects:function(s){this.selection&&this._groupSelector&&this._groupSelectedObjects(s),this.setCursor(this.defaultCursor),this._groupSelector=null}}),m.util.object.extend(m.StaticCanvas.prototype,{toDataURL:function(s){s||(s={});var r=s.format||"png",n=s.quality||1,l=(s.multiplier||1)*(s.enableRetinaScaling?this.getRetinaScaling():1),t=this.toCanvasElement(l,s);return m.util.toDataURL(t,r,n)},toCanvasElement:function(s,r){s=s||1;var n=((r=r||{}).width||this.width)*s,l=(r.height||this.height)*s,t=this.getZoom(),i=this.width,o=this.height,f=t*s,h=this.viewportTransform,c=(h[4]-(r.left||0))*s,g=(h[5]-(r.top||0))*s,_=this.interactive,y=[f,0,0,f,c,g],x=this.enableRetinaScaling,w=m.util.createCanvasElement(),I=this.contextTop;return w.width=n,w.height=l,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=y,this.width=n,this.height=l,this.calcViewportBoundaries(),this.renderCanvas(w.getContext("2d"),this._objects),this.viewportTransform=h,this.width=i,this.height=o,this.calcViewportBoundaries(),this.interactive=_,this.enableRetinaScaling=x,this.contextTop=I,w}}),m.util.object.extend(m.StaticCanvas.prototype,{loadFromJSON:function(s,r,n){if(s){var l=typeof s=="string"?JSON.parse(s):m.util.object.clone(s),t=this,i=l.clipPath,o=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete l.clipPath,this._enlivenObjects(l.objects,function(f){t.clear(),t._setBgOverlay(l,function(){i?t._enlivenObjects([i],function(h){t.clipPath=h[0],t.__setupCanvas.call(t,l,f,o,r)}):t.__setupCanvas.call(t,l,f,o,r)})},n),this}},__setupCanvas:function(s,r,n,l){var t=this;r.forEach(function(i,o){t.insertAt(i,o)}),this.renderOnAddRemove=n,delete s.objects,delete s.backgroundImage,delete s.overlayImage,delete s.background,delete s.overlay,this._setOptions(s),this.renderAll(),l&&l()},_setBgOverlay:function(s,r){var n={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(s.backgroundImage||s.overlayImage||s.background||s.overlay){var l=function(){n.backgroundImage&&n.overlayImage&&n.backgroundColor&&n.overlayColor&&r&&r()};this.__setBgOverlay("backgroundImage",s.backgroundImage,n,l),this.__setBgOverlay("overlayImage",s.overlayImage,n,l),this.__setBgOverlay("backgroundColor",s.background,n,l),this.__setBgOverlay("overlayColor",s.overlay,n,l)}else r&&r()},__setBgOverlay:function(s,r,n,l){var t=this;if(!r)return n[s]=!0,void(l&&l());s==="backgroundImage"||s==="overlayImage"?m.util.enlivenObjects([r],function(i){t[s]=i[0],n[s]=!0,l&&l()}):this["set"+m.util.string.capitalize(s,!0)](r,function(){n[s]=!0,l&&l()})},_enlivenObjects:function(s,r,n){s&&s.length!==0?m.util.enlivenObjects(s,function(l){r&&r(l)},null,n):r&&r([])},_toDataURL:function(s,r){this.clone(function(n){r(n.toDataURL(s))})},_toDataURLWithMultiplier:function(s,r,n){this.clone(function(l){n(l.toDataURLWithMultiplier(s,r))})},clone:function(s,r){var n=JSON.stringify(this.toJSON(r));this.cloneWithoutData(function(l){l.loadFromJSON(n,function(){s&&s(l)})})},cloneWithoutData:function(s){var r=m.util.createCanvasElement();r.width=this.width,r.height=this.height;var n=new m.Canvas(r);this.backgroundImage?(n.setBackgroundImage(this.backgroundImage.src,function(){n.renderAll(),s&&s(n)}),n.backgroundImageOpacity=this.backgroundImageOpacity,n.backgroundImageStretch=this.backgroundImageStretch):s&&s(n)}}),function(s){var r=s.fabric||(s.fabric={}),n=r.util.object.extend,l=r.util.object.clone,t=r.util.toFixed,i=r.util.string.capitalize,o=r.util.degreesToRadians,f=!r.isLikelyNode;r.Object||(r.Object=r.util.createClass(r.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:f,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(h){h&&this.setOptions(h)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=r.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(h){var c=r.perfLimitSizeTotal,g=h.width,_=h.height,y=r.maxCacheSideLimit,x=r.minCacheSideLimit;if(g<=y&&_<=y&&g*_<=c)return g<x&&(h.width=x),_<x&&(h.height=x),h;var w=g/_,I=r.util.limitDimsByArea(w,c),R=r.util.capValue,U=R(x,I.x,y),G=R(x,I.y,y);return g>U&&(h.zoomX/=g/U,h.width=U,h.capped=!0),_>G&&(h.zoomY/=_/G,h.height=G,h.capped=!0),h},_getCacheCanvasDimensions:function(){var h=this.getTotalObjectScaling(),c=this._getTransformedDimensions(0,0),g=c.x*h.scaleX/this.scaleX,_=c.y*h.scaleY/this.scaleY;return{width:g+2,height:_+2,zoomX:h.scaleX,zoomY:h.scaleY,x:g,y:_}},_updateCacheCanvas:function(){var h=this.canvas;if(this.noScaleCache&&h&&h._currentTransform){var c=h._currentTransform.target,g=h._currentTransform.action;if(this===c&&g.slice&&g.slice(0,5)==="scale")return!1}var _,y,x=this._cacheCanvas,w=this._limitCacheSize(this._getCacheCanvasDimensions()),I=r.minCacheSideLimit,R=w.width,U=w.height,G=w.zoomX,K=w.zoomY,O=R!==this.cacheWidth||U!==this.cacheHeight,D=this.zoomX!==G||this.zoomY!==K,E=O||D,F=0,k=0,W=!1;if(O){var N=this._cacheCanvas.width,L=this._cacheCanvas.height,P=R>N||U>L;W=P||(R<.9*N||U<.9*L)&&N>I&&L>I,P&&!w.capped&&(R>I||U>I)&&(F=.1*R,k=.1*U)}return this instanceof r.Text&&this.path&&(E=!0,W=!0,F+=this.getHeightOfLine(0)*this.zoomX,k+=this.getHeightOfLine(0)*this.zoomY),!!E&&(W?(x.width=Math.ceil(R+F),x.height=Math.ceil(U+k)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,x.width,x.height)),_=w.x/2,y=w.y/2,this.cacheTranslationX=Math.round(x.width/2-_)+_,this.cacheTranslationY=Math.round(x.height/2-y)+y,this.cacheWidth=R,this.cacheHeight=U,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(G,K),this.zoomX=G,this.zoomY=K,!0)},setOptions:function(h){this._setOptions(h),this._initGradient(h.fill,"fill"),this._initGradient(h.stroke,"stroke"),this._initPattern(h.fill,"fill"),this._initPattern(h.stroke,"stroke")},transform:function(h){var c=this.group&&!this.group._transformDone||this.group&&this.canvas&&h===this.canvas.contextTop,g=this.calcTransformMatrix(!c);h.transform(g[0],g[1],g[2],g[3],g[4],g[5])},toObject:function(h){var c=r.Object.NUM_FRACTION_DIGITS,g={type:this.type,version:r.version,originX:this.originX,originY:this.originY,left:t(this.left,c),top:t(this.top,c),width:t(this.width,c),height:t(this.height,c),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:t(this.strokeWidth,c),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:t(this.strokeMiterLimit,c),scaleX:t(this.scaleX,c),scaleY:t(this.scaleY,c),angle:t(this.angle,c),flipX:this.flipX,flipY:this.flipY,opacity:t(this.opacity,c),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:t(this.skewX,c),skewY:t(this.skewY,c)};return this.clipPath&&!this.clipPath.excludeFromExport&&(g.clipPath=this.clipPath.toObject(h),g.clipPath.inverted=this.clipPath.inverted,g.clipPath.absolutePositioned=this.clipPath.absolutePositioned),r.util.populateWithProperties(this,g,h),this.includeDefaultValues||(g=this._removeDefaultValues(g)),g},toDatalessObject:function(h){return this.toObject(h)},_removeDefaultValues:function(h){var c=r.util.getKlass(h.type).prototype;return c.stateProperties.forEach(function(g){g!=="left"&&g!=="top"&&(h[g]===c[g]&&delete h[g],Array.isArray(h[g])&&Array.isArray(c[g])&&h[g].length===0&&c[g].length===0&&delete h[g])}),h},toString:function(){return"#<fabric."+i(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var h=r.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(h.scaleX),scaleY:Math.abs(h.scaleY)}},getTotalObjectScaling:function(){var h=this.getObjectScaling(),c=h.scaleX,g=h.scaleY;if(this.canvas){var _=this.canvas.getZoom(),y=this.canvas.getRetinaScaling();c*=_*y,g*=_*y}return{scaleX:c,scaleY:g}},getObjectOpacity:function(){var h=this.opacity;return this.group&&(h*=this.group.getObjectOpacity()),h},_set:function(h,c){var g=h==="scaleX"||h==="scaleY",_=this[h]!==c,y=!1;return g&&(c=this._constrainScale(c)),h==="scaleX"&&c<0?(this.flipX=!this.flipX,c*=-1):h==="scaleY"&&c<0?(this.flipY=!this.flipY,c*=-1):h!=="shadow"||!c||c instanceof r.Shadow?h==="dirty"&&this.group&&this.group.set("dirty",c):c=new r.Shadow(c),this[h]=c,_&&(y=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(h)>-1?(this.dirty=!0,y&&this.group.set("dirty",!0)):y&&this.stateProperties.indexOf(h)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:r.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(h){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(h.save(),this._setupCompositeOperation(h),this.drawSelectionBackground(h),this.transform(h),this._setOpacity(h),this._setShadow(h,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(h)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(h),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),h.restore())},renderCache:function(h){h=h||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,h.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!(this.paintFirst!=="stroke"||!this.hasFill()||!this.hasStroke()||typeof this.shadow!="object")||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(h,c){if(h.save(),c.inverted?h.globalCompositeOperation="destination-out":h.globalCompositeOperation="destination-in",c.absolutePositioned){var g=r.util.invertTransform(this.calcTransformMatrix());h.transform(g[0],g[1],g[2],g[3],g[4],g[5])}c.transform(h),h.scale(1/c.zoomX,1/c.zoomY),h.drawImage(c._cacheCanvas,-c.cacheTranslationX,-c.cacheTranslationY),h.restore()},drawObject:function(h,c){var g=this.fill,_=this.stroke;c?(this.fill="black",this.stroke="",this._setClippingProperties(h)):this._renderBackground(h),this._render(h),this._drawClipPath(h,this.clipPath),this.fill=g,this.stroke=_},_drawClipPath:function(h,c){c&&(c.canvas=this.canvas,c.shouldCache(),c._transformDone=!0,c.renderCache({forClipping:!0}),this.drawClipPathOnCache(h,c))},drawCacheOnCanvas:function(h){h.scale(1/this.zoomX,1/this.zoomY),h.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(h){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!h&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!h){var c=this.cacheWidth/this.zoomX,g=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-c/2,-g/2,c,g)}return!0}return!1},_renderBackground:function(h){if(this.backgroundColor){var c=this._getNonTransformedDimensions();h.fillStyle=this.backgroundColor,h.fillRect(-c.x/2,-c.y/2,c.x,c.y),this._removeShadow(h)}},_setOpacity:function(h){this.group&&!this.group._transformDone?h.globalAlpha=this.getObjectOpacity():h.globalAlpha*=this.opacity},_setStrokeStyles:function(h,c){var g=c.stroke;g&&(h.lineWidth=c.strokeWidth,h.lineCap=c.strokeLineCap,h.lineDashOffset=c.strokeDashOffset,h.lineJoin=c.strokeLineJoin,h.miterLimit=c.strokeMiterLimit,g.toLive?g.gradientUnits==="percentage"||g.gradientTransform||g.patternTransform?this._applyPatternForTransformedGradient(h,g):(h.strokeStyle=g.toLive(h,this),this._applyPatternGradientTransform(h,g)):h.strokeStyle=c.stroke)},_setFillStyles:function(h,c){var g=c.fill;g&&(g.toLive?(h.fillStyle=g.toLive(h,this),this._applyPatternGradientTransform(h,c.fill)):h.fillStyle=g)},_setClippingProperties:function(h){h.globalAlpha=1,h.strokeStyle="transparent",h.fillStyle="#000000"},_setLineDash:function(h,c){c&&c.length!==0&&(1&c.length&&c.push.apply(c,c),h.setLineDash(c))},_renderControls:function(h,c){var g,_,y,x=this.getViewportTransform(),w=this.calcTransformMatrix();_=(c=c||{}).hasBorders!==void 0?c.hasBorders:this.hasBorders,y=c.hasControls!==void 0?c.hasControls:this.hasControls,w=r.util.multiplyTransformMatrices(x,w),g=r.util.qrDecompose(w),h.save(),h.translate(g.translateX,g.translateY),h.lineWidth=1*this.borderScaleFactor,this.group||(h.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(g.angle-=180),h.rotate(o(this.group?g.angle:this.angle)),c.forActiveSelection||this.group?_&&this.drawBordersInGroup(h,g,c):_&&this.drawBorders(h,c),y&&this.drawControls(h,c),h.restore()},_setShadow:function(h){if(this.shadow){var c,g=this.shadow,_=this.canvas,y=_&&_.viewportTransform[0]||1,x=_&&_.viewportTransform[3]||1;c=g.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),_&&_._isRetinaScaling()&&(y*=r.devicePixelRatio,x*=r.devicePixelRatio),h.shadowColor=g.color,h.shadowBlur=g.blur*r.browserShadowBlurConstant*(y+x)*(c.scaleX+c.scaleY)/4,h.shadowOffsetX=g.offsetX*y*c.scaleX,h.shadowOffsetY=g.offsetY*x*c.scaleY}},_removeShadow:function(h){this.shadow&&(h.shadowColor="",h.shadowBlur=h.shadowOffsetX=h.shadowOffsetY=0)},_applyPatternGradientTransform:function(h,c){if(!c||!c.toLive)return{offsetX:0,offsetY:0};var g=c.gradientTransform||c.patternTransform,_=-this.width/2+c.offsetX||0,y=-this.height/2+c.offsetY||0;return c.gradientUnits==="percentage"?h.transform(this.width,0,0,this.height,_,y):h.transform(1,0,0,1,_,y),g&&h.transform(g[0],g[1],g[2],g[3],g[4],g[5]),{offsetX:_,offsetY:y}},_renderPaintInOrder:function(h){this.paintFirst==="stroke"?(this._renderStroke(h),this._renderFill(h)):(this._renderFill(h),this._renderStroke(h))},_render:function(){},_renderFill:function(h){this.fill&&(h.save(),this._setFillStyles(h,this),this.fillRule==="evenodd"?h.fill("evenodd"):h.fill(),h.restore())},_renderStroke:function(h){if(this.stroke&&this.strokeWidth!==0){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(h),h.save(),this.strokeUniform&&this.group){var c=this.getObjectScaling();h.scale(1/c.scaleX,1/c.scaleY)}else this.strokeUniform&&h.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(h,this.strokeDashArray),this._setStrokeStyles(h,this),h.stroke(),h.restore()}},_applyPatternForTransformedGradient:function(h,c){var g,_=this._limitCacheSize(this._getCacheCanvasDimensions()),y=r.util.createCanvasElement(),x=this.canvas.getRetinaScaling(),w=_.x/this.scaleX/x,I=_.y/this.scaleY/x;y.width=w,y.height=I,(g=y.getContext("2d")).beginPath(),g.moveTo(0,0),g.lineTo(w,0),g.lineTo(w,I),g.lineTo(0,I),g.closePath(),g.translate(w/2,I/2),g.scale(_.zoomX/this.scaleX/x,_.zoomY/this.scaleY/x),this._applyPatternGradientTransform(g,c),g.fillStyle=c.toLive(h),g.fill(),h.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),h.scale(x*this.scaleX/_.zoomX,x*this.scaleY/_.zoomY),h.strokeStyle=g.createPattern(y,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var h=r.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",h.scaleX),this.set("scaleY",h.scaleY),this.angle=h.angle,this.skewX=h.skewX,this.skewY=0}},_removeTransformMatrix:function(h){var c=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),c=r.util.transformPoint(c,this.transformMatrix)),this.transformMatrix=null,h&&(this.scaleX*=h.scaleX,this.scaleY*=h.scaleY,this.cropX=h.cropX,this.cropY=h.cropY,c.x+=h.offsetLeft,c.y+=h.offsetTop,this.width=h.width,this.height=h.height),this.setPositionByOrigin(c,"center","center")},clone:function(h,c){var g=this.toObject(c);this.constructor.fromObject?this.constructor.fromObject(g,h):r.Object._fromObject("Object",g,h)},cloneAsImage:function(h,c){var g=this.toCanvasElement(c);return h&&h(new r.Image(g)),this},toCanvasElement:function(h){h||(h={});var c=r.util,g=c.saveObjectTransform(this),_=this.group,y=this.shadow,x=Math.abs,w=(h.multiplier||1)*(h.enableRetinaScaling?r.devicePixelRatio:1);delete this.group,h.withoutTransform&&c.resetObjectTransform(this),h.withoutShadow&&(this.shadow=null);var I,R,U,G,K=r.util.createCanvasElement(),O=this.getBoundingRect(!0,!0),D=this.shadow,E={x:0,y:0};D&&(R=D.blur,I=D.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),E.x=2*Math.round(x(D.offsetX)+R)*x(I.scaleX),E.y=2*Math.round(x(D.offsetY)+R)*x(I.scaleY)),U=O.width+E.x,G=O.height+E.y,K.width=Math.ceil(U),K.height=Math.ceil(G);var F=new r.StaticCanvas(K,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});h.format==="jpeg"&&(F.backgroundColor="#fff"),this.setPositionByOrigin(new r.Point(F.width/2,F.height/2),"center","center");var k=this.canvas;F.add(this);var W=F.toCanvasElement(w||1,h);return this.shadow=y,this.set("canvas",k),_&&(this.group=_),this.set(g).setCoords(),F._objects=[],F.dispose(),F=null,W},toDataURL:function(h){return h||(h={}),r.util.toDataURL(this.toCanvasElement(h),h.format||"png",h.quality||1)},isType:function(h){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===h},complexity:function(){return 1},toJSON:function(h){return this.toObject(h)},rotate:function(h){var c=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return c&&this._setOriginToCenter(),this.set("angle",h),c&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(h,c){c=c||this.canvas.getPointer(h);var g=new r.Point(c.x,c.y),_=this._getLeftTopCoords();return this.angle&&(g=r.util.rotatePoint(g,_,o(-this.angle))),{x:g.x-_.x,y:g.y-_.y}},_setupCompositeOperation:function(h){this.globalCompositeOperation&&(h.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){r.runningAnimations&&r.runningAnimations.cancelByTarget(this)}}),r.util.createAccessors&&r.util.createAccessors(r.Object),n(r.Object.prototype,r.Observable),r.Object.NUM_FRACTION_DIGITS=2,r.Object.ENLIVEN_PROPS=["clipPath"],r.Object._fromObject=function(h,c,g,_){var y=r[h];c=l(c,!0),r.util.enlivenPatterns([c.fill,c.stroke],function(x){x[0]!==void 0&&(c.fill=x[0]),x[1]!==void 0&&(c.stroke=x[1]),r.util.enlivenObjectEnlivables(c,c,function(){var w=_?new y(c[_],c):new y(c);g&&g(w)})})},r.Object.__uid=0)}(e),ot=m.util.degreesToRadians,ct={left:-.5,center:0,right:.5},ut={top:-.5,center:0,bottom:.5},m.util.object.extend(m.Object.prototype,{translateToGivenOrigin:function(s,r,n,l,t){var i,o,f,h=s.x,c=s.y;return typeof r=="string"?r=ct[r]:r-=.5,typeof l=="string"?l=ct[l]:l-=.5,typeof n=="string"?n=ut[n]:n-=.5,typeof t=="string"?t=ut[t]:t-=.5,o=t-n,((i=l-r)||o)&&(f=this._getTransformedDimensions(),h=s.x+i*f.x,c=s.y+o*f.y),new m.Point(h,c)},translateToCenterPoint:function(s,r,n){var l=this.translateToGivenOrigin(s,r,n,"center","center");return this.angle?m.util.rotatePoint(l,s,ot(this.angle)):l},translateToOriginPoint:function(s,r,n){var l=this.translateToGivenOrigin(s,"center","center",r,n);return this.angle?m.util.rotatePoint(l,s,ot(this.angle)):l},getCenterPoint:function(){var s=new m.Point(this.left,this.top);return this.translateToCenterPoint(s,this.originX,this.originY)},getPointByOrigin:function(s,r){var n=this.getCenterPoint();return this.translateToOriginPoint(n,s,r)},toLocalPoint:function(s,r,n){var l,t,i=this.getCenterPoint();return l=r!==void 0&&n!==void 0?this.translateToGivenOrigin(i,"center","center",r,n):new m.Point(this.left,this.top),t=new m.Point(s.x,s.y),this.angle&&(t=m.util.rotatePoint(t,i,-ot(this.angle))),t.subtractEquals(l)},setPositionByOrigin:function(s,r,n){var l=this.translateToCenterPoint(s,r,n),t=this.translateToOriginPoint(l,this.originX,this.originY);this.set("left",t.x),this.set("top",t.y)},adjustPosition:function(s){var r,n,l=ot(this.angle),t=this.getScaledWidth(),i=m.util.cos(l)*t,o=m.util.sin(l)*t;r=typeof this.originX=="string"?ct[this.originX]:this.originX-.5,n=typeof s=="string"?ct[s]:s-.5,this.left+=i*(n-r),this.top+=o*(n-r),this.setCoords(),this.originX=s},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var s=this.getCenterPoint();this.originX="center",this.originY="center",this.left=s.x,this.top=s.y},_resetOrigin:function(){var s=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=s.x,this.top=s.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){var s=m.util,r=s.degreesToRadians,n=s.multiplyTransformMatrices,l=s.transformPoint;s.object.extend(m.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(t,i){return i?t?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),t?this.aCoords:this.lineCoords)},getCoords:function(t,i){return o=this._getCoords(t,i),[new m.Point(o.tl.x,o.tl.y),new m.Point(o.tr.x,o.tr.y),new m.Point(o.br.x,o.br.y),new m.Point(o.bl.x,o.bl.y)];var o},intersectsWithRect:function(t,i,o,f){var h=this.getCoords(o,f);return m.Intersection.intersectPolygonRectangle(h,t,i).status==="Intersection"},intersectsWithObject:function(t,i,o){return m.Intersection.intersectPolygonPolygon(this.getCoords(i,o),t.getCoords(i,o)).status==="Intersection"||t.isContainedWithinObject(this,i,o)||this.isContainedWithinObject(t,i,o)},isContainedWithinObject:function(t,i,o){for(var f=this.getCoords(i,o),h=i?t.aCoords:t.lineCoords,c=0,g=t._getImageLines(h);c<4;c++)if(!t.containsPoint(f[c],g))return!1;return!0},isContainedWithinRect:function(t,i,o,f){var h=this.getBoundingRect(o,f);return h.left>=t.x&&h.left+h.width<=i.x&&h.top>=t.y&&h.top+h.height<=i.y},containsPoint:function(t,i,o,f){var h=this._getCoords(o,f),c=(i=i||this._getImageLines(h),this._findCrossPoints(t,i));return c!==0&&c%2==1},isOnScreen:function(t){if(!this.canvas)return!1;var i=this.canvas.vptCoords.tl,o=this.canvas.vptCoords.br;return!!this.getCoords(!0,t).some(function(f){return f.x<=o.x&&f.x>=i.x&&f.y<=o.y&&f.y>=i.y})||!!this.intersectsWithRect(i,o,!0,t)||this._containsCenterOfCanvas(i,o,t)},_containsCenterOfCanvas:function(t,i,o){var f={x:(t.x+i.x)/2,y:(t.y+i.y)/2};return!!this.containsPoint(f,null,!0,o)},isPartiallyOnScreen:function(t){if(!this.canvas)return!1;var i=this.canvas.vptCoords.tl,o=this.canvas.vptCoords.br;return!!this.intersectsWithRect(i,o,!0,t)||this.getCoords(!0,t).every(function(f){return(f.x>=o.x||f.x<=i.x)&&(f.y>=o.y||f.y<=i.y)})&&this._containsCenterOfCanvas(i,o,t)},_getImageLines:function(t){return{topline:{o:t.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:t.tl}}},_findCrossPoints:function(t,i){var o,f,h,c=0;for(var g in i)if(!((h=i[g]).o.y<t.y&&h.d.y<t.y||h.o.y>=t.y&&h.d.y>=t.y||(h.o.x===h.d.x&&h.o.x>=t.x?f=h.o.x:(o=(h.d.y-h.o.y)/(h.d.x-h.o.x),f=-(t.y-0*t.x-(h.o.y-o*h.o.x))/(0-o)),f>=t.x&&(c+=1),c!==2)))break;return c},getBoundingRect:function(t,i){var o=this.getCoords(t,i);return s.makeBoundingBoxFromPoints(o)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:t===0?1e-4:t},scale:function(t){return this._set("scaleX",t),this._set("scaleY",t),this.setCoords()},scaleToWidth:function(t,i){var o=this.getBoundingRect(i).width/this.getScaledWidth();return this.scale(t/this.width/o)},scaleToHeight:function(t,i){var o=this.getBoundingRect(i).height/this.getScaledHeight();return this.scale(t/this.height/o)},calcLineCoords:function(){var t=this.getViewportTransform(),i=this.padding,o=r(this.angle),f=s.cos(o)*i,h=s.sin(o)*i,c=f+h,g=f-h,_=this.calcACoords(),y={tl:l(_.tl,t),tr:l(_.tr,t),bl:l(_.bl,t),br:l(_.br,t)};return i&&(y.tl.x-=g,y.tl.y-=c,y.tr.x+=c,y.tr.y-=g,y.bl.x-=c,y.bl.y+=g,y.br.x+=g,y.br.y+=c),y},calcOCoords:function(){var t=this._calcRotateMatrix(),i=this._calcTranslateMatrix(),o=this.getViewportTransform(),f=n(o,i),h=n(f,t),c=(h=n(h,[1/o[0],0,0,1/o[3],0,0]),this._calculateCurrentDimensions()),g={};return this.forEachControl(function(_,y,x){g[y]=_.positionHandler(c,h,x)}),g},calcACoords:function(){var t=this._calcRotateMatrix(),i=this._calcTranslateMatrix(),o=n(i,t),f=this._getTransformedDimensions(),h=f.x/2,c=f.y/2;return{tl:l({x:-h,y:-c},o),tr:l({x:h,y:-c},o),bl:l({x:-h,y:c},o),br:l({x:h,y:c},o)}},setCoords:function(t){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),t||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return s.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var t=this.getCenterPoint();return[1,0,0,1,t.x,t.y]},transformMatrixKey:function(t){var i="_",o="";return!t&&this.group&&(o=this.group.transformMatrixKey(t)+i),o+this.top+i+this.left+i+this.scaleX+i+this.scaleY+i+this.skewX+i+this.skewY+i+this.angle+i+this.originX+i+this.originY+i+this.width+i+this.height+i+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(t){var i=this.calcOwnMatrix();if(t||!this.group)return i;var o=this.transformMatrixKey(t),f=this.matrixCache||(this.matrixCache={});return f.key===o?f.value:(this.group&&(i=n(this.group.calcTransformMatrix(!1),i)),f.key=o,f.value=i,i)},calcOwnMatrix:function(){var t=this.transformMatrixKey(!0),i=this.ownMatrixCache||(this.ownMatrixCache={});if(i.key===t)return i.value;var o=this._calcTranslateMatrix(),f={angle:this.angle,translateX:o[4],translateY:o[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return i.key=t,i.value=s.composeMatrix(f),i.value},_getNonTransformedDimensions:function(){var t=this.strokeWidth;return{x:this.width+t,y:this.height+t}},_getTransformedDimensions:function(t,i){t===void 0&&(t=this.skewX),i===void 0&&(i=this.skewY);var o,f,h,c=t===0&&i===0;if(this.strokeUniform?(f=this.width,h=this.height):(f=(o=this._getNonTransformedDimensions()).x,h=o.y),c)return this._finalizeDimensions(f*this.scaleX,h*this.scaleY);var g=s.sizeAfterTransform(f,h,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:t,skewY:i});return this._finalizeDimensions(g.x,g.y)},_finalizeDimensions:function(t,i){return this.strokeUniform?{x:t+this.strokeWidth,y:i+this.strokeWidth}:{x:t,y:i}},_calculateCurrentDimensions:function(){var t=this.getViewportTransform(),i=this._getTransformedDimensions();return l(i,t,!0).scalarAdd(2*this.padding)}})}(),m.util.object.extend(m.Object.prototype,{sendToBack:function(){return this.group?m.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?m.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(s){return this.group?m.StaticCanvas.prototype.sendBackwards.call(this.group,this,s):this.canvas&&this.canvas.sendBackwards(this,s),this},bringForward:function(s){return this.group?m.StaticCanvas.prototype.bringForward.call(this.group,this,s):this.canvas&&this.canvas.bringForward(this,s),this},moveTo:function(s){return this.group&&this.group.type!=="activeSelection"?m.StaticCanvas.prototype.moveTo.call(this.group,this,s):this.canvas&&this.canvas.moveTo(this,s),this}}),function(){function s(n,l){if(l){if(l.toLive)return n+": url(#SVGID_"+l.id+"); ";var t=new m.Color(l),i=n+": "+t.toRgb()+"; ",o=t.getAlpha();return o!==1&&(i+=n+"-opacity: "+o.toString()+"; "),i}return n+": none; "}var r=m.util.toFixed;m.util.object.extend(m.Object.prototype,{getSvgStyles:function(n){var l=this.fillRule?this.fillRule:"nonzero",t=this.strokeWidth?this.strokeWidth:"0",i=this.strokeDashArray?this.strokeDashArray.join(" "):"none",o=this.strokeDashOffset?this.strokeDashOffset:"0",f=this.strokeLineCap?this.strokeLineCap:"butt",h=this.strokeLineJoin?this.strokeLineJoin:"miter",c=this.strokeMiterLimit?this.strokeMiterLimit:"4",g=this.opacity!==void 0?this.opacity:"1",_=this.visible?"":" visibility: hidden;",y=n?"":this.getSvgFilter(),x=s("fill",this.fill);return[s("stroke",this.stroke),"stroke-width: ",t,"; ","stroke-dasharray: ",i,"; ","stroke-linecap: ",f,"; ","stroke-dashoffset: ",o,"; ","stroke-linejoin: ",h,"; ","stroke-miterlimit: ",c,"; ",x,"fill-rule: ",l,"; ","opacity: ",g,";",y,_].join("")},getSvgSpanStyles:function(n,l){var t="; ",i=n.fontFamily?"font-family: "+(n.fontFamily.indexOf("'")===-1&&n.fontFamily.indexOf('"')===-1?"'"+n.fontFamily+"'":n.fontFamily)+t:"",o=n.strokeWidth?"stroke-width: "+n.strokeWidth+t:"",f=n.fontSize?"font-size: "+n.fontSize+"px"+t:"",h=n.fontStyle?"font-style: "+n.fontStyle+t:"",c=n.fontWeight?"font-weight: "+n.fontWeight+t:"",g=n.fill?s("fill",n.fill):"",_=n.stroke?s("stroke",n.stroke):"",y=this.getSvgTextDecoration(n);return y&&(y="text-decoration: "+y+t),[_,o,i,f,h,c,y,g,n.deltaY?"baseline-shift: "+-n.deltaY+"; ":"",l?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(n){return["overline","underline","line-through"].filter(function(l){return n[l.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(n,l){var t=n?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+m.util.matrixToSVG(t)+(l||"")+'" '},_setSVGBg:function(n){if(this.backgroundColor){var l=m.Object.NUM_FRACTION_DIGITS;n.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',r(-this.width/2,l),'" y="',r(-this.height/2,l),'" width="',r(this.width,l),'" height="',r(this.height,l),`"></rect>
`)}},toSVG:function(n){return this._createBaseSVGMarkup(this._toSVG(n),{reviver:n})},toClipPathSVG:function(n){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(n),{reviver:n})},_createBaseClipPathSVGMarkup:function(n,l){var t=(l=l||{}).reviver,i=l.additionalTransform||"",o=[this.getSvgTransform(!0,i),this.getSvgCommons()].join(""),f=n.indexOf("COMMON_PARTS");return n[f]=o,t?t(n.join("")):n.join("")},_createBaseSVGMarkup:function(n,l){var t,i,o=(l=l||{}).noStyle,f=l.reviver,h=o?"":'style="'+this.getSvgStyles()+'" ',c=l.withShadow?'style="'+this.getSvgFilter()+'" ':"",g=this.clipPath,_=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",y=g&&g.absolutePositioned,x=this.stroke,w=this.fill,I=this.shadow,R=[],U=n.indexOf("COMMON_PARTS"),G=l.additionalTransform;return g&&(g.clipPathId="CLIPPATH_"+m.Object.__uid++,i='<clipPath id="'+g.clipPathId+`" >
`+g.toClipPathSVG(f)+`</clipPath>
`),y&&R.push("<g ",c,this.getSvgCommons(),` >
`),R.push("<g ",this.getSvgTransform(!1),y?"":c+this.getSvgCommons(),` >
`),t=[h,_,o?"":this.addPaintOrder()," ",G?'transform="'+G+'" ':""].join(""),n[U]=t,w&&w.toLive&&R.push(w.toSVG(this)),x&&x.toLive&&R.push(x.toSVG(this)),I&&R.push(I.toSVG(this)),g&&R.push(i),R.push(n.join("")),R.push(`</g>
`),y&&R.push(`</g>
`),f?f(R.join("")):R.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var s=m.util.object.extend,r="stateProperties";function n(t,i,o){var f={};o.forEach(function(h){f[h]=t[h]}),s(t[i],f,!0)}function l(t,i,o){if(t===i)return!0;if(Array.isArray(t)){if(!Array.isArray(i)||t.length!==i.length)return!1;for(var f=0,h=t.length;f<h;f++)if(!l(t[f],i[f]))return!1;return!0}if(t&&typeof t=="object"){var c,g=Object.keys(t);if(!i||typeof i!="object"||!o&&g.length!==Object.keys(i).length)return!1;for(f=0,h=g.length;f<h;f++)if((c=g[f])!=="canvas"&&c!=="group"&&!l(t[c],i[c]))return!1;return!0}}m.util.object.extend(m.Object.prototype,{hasStateChanged:function(t){var i="_"+(t=t||r);return Object.keys(this[i]).length<this[t].length||!l(this[i],this,!0)},saveState:function(t){var i=t&&t.propertySet||r,o="_"+i;return this[o]?(n(this,o,this[i]),t&&t.stateProperties&&n(this,o,t.stateProperties),this):this.setupState(t)},setupState:function(t){var i=(t=t||{}).propertySet||r;return t.propertySet=i,this["_"+i]={},this.saveState(t),this}})}(),function(){var s=m.util.degreesToRadians;m.util.object.extend(m.Object.prototype,{_findTargetCorner:function(r,n){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var l,t,i,o=r.x,f=r.y,h=Object.keys(this.oCoords),c=h.length-1;for(this.__corner=0;c>=0;c--)if(i=h[c],this.isControlVisible(i)&&(t=this._getImageLines(n?this.oCoords[i].touchCorner:this.oCoords[i].corner),(l=this._findCrossPoints({x:o,y:f},t))!==0&&l%2==1))return this.__corner=i,i;return!1},forEachControl:function(r){for(var n in this.controls)r(this.controls[n],n,this)},_setCornerCoords:function(){var r=this.oCoords;for(var n in r){var l=this.controls[n];r[n].corner=l.calcCornerCoords(this.angle,this.cornerSize,r[n].x,r[n].y,!1),r[n].touchCorner=l.calcCornerCoords(this.angle,this.touchCornerSize,r[n].x,r[n].y,!0)}},drawSelectionBackground:function(r){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;r.save();var n=this.getCenterPoint(),l=this._calculateCurrentDimensions(),t=this.canvas.viewportTransform;return r.translate(n.x,n.y),r.scale(1/t[0],1/t[3]),r.rotate(s(this.angle)),r.fillStyle=this.selectionBackgroundColor,r.fillRect(-l.x/2,-l.y/2,l.x,l.y),r.restore(),this},drawBorders:function(r,n){n=n||{};var l=this._calculateCurrentDimensions(),t=this.borderScaleFactor,i=l.x+t,o=l.y+t,f=n.hasControls!==void 0?n.hasControls:this.hasControls,h=!1;return r.save(),r.strokeStyle=n.borderColor||this.borderColor,this._setLineDash(r,n.borderDashArray||this.borderDashArray),r.strokeRect(-i/2,-o/2,i,o),f&&(r.beginPath(),this.forEachControl(function(c,g,_){c.withConnection&&c.getVisibility(_,g)&&(h=!0,r.moveTo(c.x*i,c.y*o),r.lineTo(c.x*i+c.offsetX,c.y*o+c.offsetY))}),h&&r.stroke()),r.restore(),this},drawBordersInGroup:function(r,n,l){l=l||{};var t=m.util.sizeAfterTransform(this.width,this.height,n),i=this.strokeWidth,o=this.strokeUniform,f=this.borderScaleFactor,h=t.x+i*(o?this.canvas.getZoom():n.scaleX)+f,c=t.y+i*(o?this.canvas.getZoom():n.scaleY)+f;return r.save(),this._setLineDash(r,l.borderDashArray||this.borderDashArray),r.strokeStyle=l.borderColor||this.borderColor,r.strokeRect(-h/2,-c/2,h,c),r.restore(),this},drawControls:function(r,n){n=n||{},r.save();var l,t,i=this.canvas.getRetinaScaling();return r.setTransform(i,0,0,i,0,0),r.strokeStyle=r.fillStyle=n.cornerColor||this.cornerColor,this.transparentCorners||(r.strokeStyle=n.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(r,n.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(l=this.group.calcTransformMatrix()),this.forEachControl(function(o,f,h){t=h.oCoords[f],o.getVisibility(h,f)&&(l&&(t=m.util.transformPoint(t,l)),o.render(r,t.x,t.y,n,h))}),r.restore(),this},isControlVisible:function(r){return this.controls[r]&&this.controls[r].getVisibility(this,r)},setControlVisible:function(r,n){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[r]=n,this},setControlsVisibility:function(r){for(var n in r||(r={}),r)this.setControlVisible(n,r[n]);return this},onDeselect:function(){},onSelect:function(){}})}(),m.util.object.extend(m.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(s,r){var n=function(){},l=(r=r||{}).onComplete||n,t=r.onChange||n,i=this;return m.util.animate({target:this,startValue:s.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(o){s.set("left",o),i.requestRenderAll(),t()},onComplete:function(){s.setCoords(),l()}})},fxCenterObjectV:function(s,r){var n=function(){},l=(r=r||{}).onComplete||n,t=r.onChange||n,i=this;return m.util.animate({target:this,startValue:s.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(o){s.set("top",o),i.requestRenderAll(),t()},onComplete:function(){s.setCoords(),l()}})},fxRemove:function(s,r){var n=function(){},l=(r=r||{}).onComplete||n,t=r.onChange||n,i=this;return m.util.animate({target:this,startValue:s.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(o){s.set("opacity",o),i.requestRenderAll(),t()},onComplete:function(){i.remove(s),l()}})}}),m.util.object.extend(m.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var s,r,n=[],l=[];for(s in arguments[0])n.push(s);for(var t=0,i=n.length;t<i;t++)s=n[t],r=t!==i-1,l.push(this._animate(s,arguments[0][s],arguments[1],r));return l}return this._animate.apply(this,arguments)},_animate:function(s,r,n,l){var t,i=this;r=r.toString(),n=n?m.util.object.clone(n):{},~s.indexOf(".")&&(t=s.split("."));var o=i.colorProperties.indexOf(s)>-1||t&&i.colorProperties.indexOf(t[1])>-1,f=t?this.get(t[0])[t[1]]:this.get(s);"from"in n||(n.from=f),o||(r=~r.indexOf("=")?f+parseFloat(r.replace("=","")):parseFloat(r));var h={target:this,startValue:n.from,endValue:r,byValue:n.by,easing:n.easing,duration:n.duration,abort:n.abort&&function(c,g,_){return n.abort.call(i,c,g,_)},onChange:function(c,g,_){t?i[t[0]][t[1]]=c:i.set(s,c),l||n.onChange&&n.onChange(c,g,_)},onComplete:function(c,g,_){l||(i.setCoords(),n.onComplete&&n.onComplete(c,g,_))}};return o?m.util.animateColor(h.startValue,h.endValue,h.duration,h):m.util.animate(h)}}),function(s){var r=s.fabric||(s.fabric={}),n=r.util.object.extend,l=r.util.object.clone,t={x1:1,x2:1,y1:1,y2:1};function i(o,f){var h=o.origin,c=o.axis1,g=o.axis2,_=o.dimension,y=f.nearest,x=f.center,w=f.farthest;return function(){switch(this.get(h)){case y:return Math.min(this.get(c),this.get(g));case x:return Math.min(this.get(c),this.get(g))+.5*this.get(_);case w:return Math.max(this.get(c),this.get(g))}}}r.Line?r.warn("fabric.Line is already defined"):(r.Line=r.util.createClass(r.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:r.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(o,f){o||(o=[0,0,0,0]),this.callSuper("initialize",f),this.set("x1",o[0]),this.set("y1",o[1]),this.set("x2",o[2]),this.set("y2",o[3]),this._setWidthHeight(f)},_setWidthHeight:function(o){o||(o={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in o?o.left:this._getLeftToOriginX(),this.top="top"in o?o.top:this._getTopToOriginY()},_set:function(o,f){return this.callSuper("_set",o,f),t[o]!==void 0&&this._setWidthHeight(),this},_getLeftToOriginX:i({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:i({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(o){o.beginPath();var f=this.calcLinePoints();o.moveTo(f.x1,f.y1),o.lineTo(f.x2,f.y2),o.lineWidth=this.strokeWidth;var h=o.strokeStyle;o.strokeStyle=this.stroke||o.fillStyle,this.stroke&&this._renderStroke(o),o.strokeStyle=h},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(o){return n(this.callSuper("toObject",o),this.calcLinePoints())},_getNonTransformedDimensions:function(){var o=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(o.y-=this.strokeWidth),this.height===0&&(o.x-=this.strokeWidth)),o},calcLinePoints:function(){var o=this.x1<=this.x2?-1:1,f=this.y1<=this.y2?-1:1,h=o*this.width*.5,c=f*this.height*.5;return{x1:h,x2:o*this.width*-.5,y1:c,y2:f*this.height*-.5}},_toSVG:function(){var o=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',o.x1,'" y1="',o.y1,'" x2="',o.x2,'" y2="',o.y2,`" />
`]}}),r.Line.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),r.Line.fromElement=function(o,f,h){h=h||{};var c=r.parseAttributes(o,r.Line.ATTRIBUTE_NAMES),g=[c.x1||0,c.y1||0,c.x2||0,c.y2||0];f(new r.Line(g,n(c,h)))},r.Line.fromObject=function(o,f){var h=l(o,!0);h.points=[o.x1,o.y1,o.x2,o.y2],r.Object._fromObject("Line",h,function(c){delete c.points,f&&f(c)},"points")})}(e),function(s){var r=s.fabric||(s.fabric={}),n=r.util.degreesToRadians;r.Circle?r.warn("fabric.Circle is already defined."):(r.Circle=r.util.createClass(r.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:r.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(l,t){return this.callSuper("_set",l,t),l==="radius"&&this.setRadius(t),this},toObject:function(l){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(l))},_toSVG:function(){var l,t=(this.endAngle-this.startAngle)%360;if(t===0)l=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,`" />
`];else{var i=n(this.startAngle),o=n(this.endAngle),f=this.radius;l=['<path d="M '+r.util.cos(i)*f+" "+r.util.sin(i)*f," A "+f+" "+f," 0 ",+(t>180?"1":"0")+" 1"," "+r.util.cos(o)*f+" "+r.util.sin(o)*f,'" ',"COMMON_PARTS",` />
`]}return l},_render:function(l){l.beginPath(),l.arc(0,0,this.radius,n(this.startAngle),n(this.endAngle),!1),this._renderPaintInOrder(l)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(l){return this.radius=l,this.set("width",2*l).set("height",2*l)}}),r.Circle.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),r.Circle.fromElement=function(l,t){var i,o=r.parseAttributes(l,r.Circle.ATTRIBUTE_NAMES);if(!("radius"in(i=o)&&i.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");o.left=(o.left||0)-o.radius,o.top=(o.top||0)-o.radius,t(new r.Circle(o))},r.Circle.fromObject=function(l,t){r.Object._fromObject("Circle",l,t)})}(e),function(s){var r=s.fabric||(s.fabric={});r.Triangle?r.warn("fabric.Triangle is already defined"):(r.Triangle=r.util.createClass(r.Object,{type:"triangle",width:100,height:100,_render:function(n){var l=this.width/2,t=this.height/2;n.beginPath(),n.moveTo(-l,t),n.lineTo(0,-t),n.lineTo(l,t),n.closePath(),this._renderPaintInOrder(n)},_toSVG:function(){var n=this.width/2,l=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-n+" "+l,"0 "+-l,n+" "+l].join(","),'" />']}}),r.Triangle.fromObject=function(n,l){return r.Object._fromObject("Triangle",n,l)})}(e),function(s){var r=s.fabric||(s.fabric={}),n=2*Math.PI;r.Ellipse?r.warn("fabric.Ellipse is already defined."):(r.Ellipse=r.util.createClass(r.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:r.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(l){this.callSuper("initialize",l),this.set("rx",l&&l.rx||0),this.set("ry",l&&l.ry||0)},_set:function(l,t){switch(this.callSuper("_set",l,t),l){case"rx":this.rx=t,this.set("width",2*t);break;case"ry":this.ry=t,this.set("height",2*t)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(l){return this.callSuper("toObject",["rx","ry"].concat(l))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(l){l.beginPath(),l.save(),l.transform(1,0,0,this.ry/this.rx,0,0),l.arc(0,0,this.rx,0,n,!1),l.restore(),this._renderPaintInOrder(l)}}),r.Ellipse.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),r.Ellipse.fromElement=function(l,t){var i=r.parseAttributes(l,r.Ellipse.ATTRIBUTE_NAMES);i.left=(i.left||0)-i.rx,i.top=(i.top||0)-i.ry,t(new r.Ellipse(i))},r.Ellipse.fromObject=function(l,t){r.Object._fromObject("Ellipse",l,t)})}(e),function(s){var r=s.fabric||(s.fabric={}),n=r.util.object.extend;r.Rect?r.warn("fabric.Rect is already defined"):(r.Rect=r.util.createClass(r.Object,{stateProperties:r.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:r.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(l){this.callSuper("initialize",l),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(l){var t=this.rx?Math.min(this.rx,this.width/2):0,i=this.ry?Math.min(this.ry,this.height/2):0,o=this.width,f=this.height,h=-this.width/2,c=-this.height/2,g=t!==0||i!==0,_=.4477152502;l.beginPath(),l.moveTo(h+t,c),l.lineTo(h+o-t,c),g&&l.bezierCurveTo(h+o-_*t,c,h+o,c+_*i,h+o,c+i),l.lineTo(h+o,c+f-i),g&&l.bezierCurveTo(h+o,c+f-_*i,h+o-_*t,c+f,h+o-t,c+f),l.lineTo(h+t,c+f),g&&l.bezierCurveTo(h+_*t,c+f,h,c+f-_*i,h,c+f-i),l.lineTo(h,c+i),g&&l.bezierCurveTo(h,c+_*i,h+_*t,c,h+t,c),l.closePath(),this._renderPaintInOrder(l)},toObject:function(l){return this.callSuper("toObject",["rx","ry"].concat(l))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),r.Rect.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),r.Rect.fromElement=function(l,t,i){if(!l)return t(null);i=i||{};var o=r.parseAttributes(l,r.Rect.ATTRIBUTE_NAMES);o.left=o.left||0,o.top=o.top||0,o.height=o.height||0,o.width=o.width||0;var f=new r.Rect(n(i?r.util.object.clone(i):{},o));f.visible=f.visible&&f.width>0&&f.height>0,t(f)},r.Rect.fromObject=function(l,t){return r.Object._fromObject("Rect",l,t)})}(e),function(s){var r=s.fabric||(s.fabric={}),n=r.util.object.extend,l=r.util.array.min,t=r.util.array.max,i=r.util.toFixed,o=r.util.projectStrokeOnPoints;r.Polyline?r.warn("fabric.Polyline is already defined"):(r.Polyline=r.util.createClass(r.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:r.Object.prototype.cacheProperties.concat("points"),initialize:function(f,h){h=h||{},this.points=f||[],this.callSuper("initialize",h),this._setPositionDimensions(h)},_projectStrokeOnPoints:function(){return o(this.points,this,!0)},_setPositionDimensions:function(f){var h,c=this._calcDimensions(f),g=this.exactBoundingBox?this.strokeWidth:0;this.width=c.width-g,this.height=c.height-g,f.fromSVG||(h=this.translateToGivenOrigin({x:c.left-this.strokeWidth/2+g/2,y:c.top-this.strokeWidth/2+g/2},"left","top",this.originX,this.originY)),f.left===void 0&&(this.left=f.fromSVG?c.left:h.x),f.top===void 0&&(this.top=f.fromSVG?c.top:h.y),this.pathOffset={x:c.left+this.width/2+g/2,y:c.top+this.height/2+g/2}},_calcDimensions:function(){var f=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,h=l(f,"x")||0,c=l(f,"y")||0;return{left:h,top:c,width:(t(f,"x")||0)-h,height:(t(f,"y")||0)-c}},toObject:function(f){return n(this.callSuper("toObject",f),{points:this.points.concat()})},_toSVG:function(){for(var f=[],h=this.pathOffset.x,c=this.pathOffset.y,g=r.Object.NUM_FRACTION_DIGITS,_=0,y=this.points.length;_<y;_++)f.push(i(this.points[_].x-h,g),",",i(this.points[_].y-c,g)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',f.join(""),`" />
`]},commonRender:function(f){var h,c=this.points.length,g=this.pathOffset.x,_=this.pathOffset.y;if(!c||isNaN(this.points[c-1].y))return!1;f.beginPath(),f.moveTo(this.points[0].x-g,this.points[0].y-_);for(var y=0;y<c;y++)h=this.points[y],f.lineTo(h.x-g,h.y-_);return!0},_render:function(f){this.commonRender(f)&&this._renderPaintInOrder(f)},complexity:function(){return this.get("points").length}}),r.Polyline.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat(),r.Polyline.fromElementGenerator=function(f){return function(h,c,g){if(!h)return c(null);g||(g={});var _=r.parsePointsAttribute(h.getAttribute("points")),y=r.parseAttributes(h,r[f].ATTRIBUTE_NAMES);y.fromSVG=!0,c(new r[f](_,n(y,g)))}},r.Polyline.fromElement=r.Polyline.fromElementGenerator("Polyline"),r.Polyline.fromObject=function(f,h){return r.Object._fromObject("Polyline",f,h,"points")})}(e),function(s){var r=s.fabric||(s.fabric={}),n=r.util.projectStrokeOnPoints;r.Polygon?r.warn("fabric.Polygon is already defined"):(r.Polygon=r.util.createClass(r.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return n(this.points,this)},_render:function(l){this.commonRender(l)&&(l.closePath(),this._renderPaintInOrder(l))}}),r.Polygon.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat(),r.Polygon.fromElement=r.Polyline.fromElementGenerator("Polygon"),r.Polygon.fromObject=function(l,t){r.Object._fromObject("Polygon",l,t,"points")})}(e),function(s){var r=s.fabric||(s.fabric={}),n=r.util.array.min,l=r.util.array.max,t=r.util.object.extend,i=r.util.object.clone,o=r.util.toFixed;r.Path?r.warn("fabric.Path is already defined"):(r.Path=r.util.createClass(r.Object,{type:"path",path:null,cacheProperties:r.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:r.Object.prototype.stateProperties.concat("path"),initialize:function(f,h){delete(h=i(h||{})).path,this.callSuper("initialize",h),this._setPath(f||[],h)},_setPath:function(f,h){this.path=r.util.makePathSimpler(Array.isArray(f)?f:r.util.parsePath(f)),r.Polyline.prototype._setPositionDimensions.call(this,h||{})},_renderPathCommands:function(f){var h,c=0,g=0,_=0,y=0,x=0,w=0,I=-this.pathOffset.x,R=-this.pathOffset.y;f.beginPath();for(var U=0,G=this.path.length;U<G;++U)switch((h=this.path[U])[0]){case"L":_=h[1],y=h[2],f.lineTo(_+I,y+R);break;case"M":c=_=h[1],g=y=h[2],f.moveTo(_+I,y+R);break;case"C":_=h[5],y=h[6],x=h[3],w=h[4],f.bezierCurveTo(h[1]+I,h[2]+R,x+I,w+R,_+I,y+R);break;case"Q":f.quadraticCurveTo(h[1]+I,h[2]+R,h[3]+I,h[4]+R),_=h[3],y=h[4],x=h[1],w=h[2];break;case"z":case"Z":_=c,y=g,f.closePath()}},_render:function(f){this._renderPathCommands(f),this._renderPaintInOrder(f)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(f){return t(this.callSuper("toObject",f),{path:this.path.map(function(h){return h.slice()})})},toDatalessObject:function(f){var h=this.toObject(["sourcePath"].concat(f));return h.sourcePath&&delete h.path,h},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',r.util.joinPath(this.path),'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var f=r.Object.NUM_FRACTION_DIGITS;return" translate("+o(-this.pathOffset.x,f)+", "+o(-this.pathOffset.y,f)+")"},toClipPathSVG:function(f){var h=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:f,additionalTransform:h})},toSVG:function(f){var h=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:f,additionalTransform:h})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var f,h,c=[],g=[],_=0,y=0,x=0,w=0,I=0,R=this.path.length;I<R;++I){switch((f=this.path[I])[0]){case"L":x=f[1],w=f[2],h=[];break;case"M":_=x=f[1],y=w=f[2],h=[];break;case"C":h=r.util.getBoundsOfCurve(x,w,f[1],f[2],f[3],f[4],f[5],f[6]),x=f[5],w=f[6];break;case"Q":h=r.util.getBoundsOfCurve(x,w,f[1],f[2],f[1],f[2],f[3],f[4]),x=f[3],w=f[4];break;case"z":case"Z":x=_,w=y}h.forEach(function(K){c.push(K.x),g.push(K.y)}),c.push(x),g.push(w)}var U=n(c)||0,G=n(g)||0;return{left:U,top:G,width:(l(c)||0)-U,height:(l(g)||0)-G}}}),r.Path.fromObject=function(f,h){if(typeof f.sourcePath=="string"){var c=f.sourcePath;r.loadSVGFromURL(c,function(g){var _=g[0];_.setOptions(f),h&&h(_)})}else r.Object._fromObject("Path",f,h,"path")},r.Path.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat(["d"]),r.Path.fromElement=function(f,h,c){var g=r.parseAttributes(f,r.Path.ATTRIBUTE_NAMES);g.fromSVG=!0,h(new r.Path(g.d,t(g,c)))})}(e),function(s){var r=s.fabric||(s.fabric={}),n=r.util.array.min,l=r.util.array.max;r.Group||(r.Group=r.util.createClass(r.Object,r.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(t,i,o){i=i||{},this._objects=[],o&&this.callSuper("initialize",i),this._objects=t||[];for(var f=this._objects.length;f--;)this._objects[f].group=this;if(o)this._updateObjectsACoords();else{var h=i&&i.centerPoint;i.originX!==void 0&&(this.originX=i.originX),i.originY!==void 0&&(this.originY=i.originY),h||this._calcBounds(),this._updateObjectsCoords(h),delete i.centerPoint,this.callSuper("initialize",i)}this.setCoords()},_updateObjectsACoords:function(){for(var t=this._objects.length;t--;)this._objects[t].setCoords(!0)},_updateObjectsCoords:function(t){t=t||this.getCenterPoint();for(var i=this._objects.length;i--;)this._updateObjectCoords(this._objects[i],t)},_updateObjectCoords:function(t,i){var o=t.left,f=t.top;t.set({left:o-i.x,top:f-i.y}),t.group=this,t.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(t){var i=!!this.group;return this._restoreObjectsState(),r.util.resetObjectTransform(this),t&&(i&&r.util.removeTransformFromObject(t,this.group.calcTransformMatrix()),this._objects.push(t),t.group=this,t._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,i?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(t){return this._restoreObjectsState(),r.util.resetObjectTransform(this),this.remove(t),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(t){this.dirty=!0,t.group=this,t._set("canvas",this.canvas)},_onObjectRemoved:function(t){this.dirty=!0,delete t.group},_set:function(t,i){var o=this._objects.length;if(this.useSetOnGroup)for(;o--;)this._objects[o].setOnGroup(t,i);if(t==="canvas")for(;o--;)this._objects[o]._set(t,i);r.Object.prototype._set.call(this,t,i)},toObject:function(t){var i=this.includeDefaultValues,o=this._objects.filter(function(h){return!h.excludeFromExport}).map(function(h){var c=h.includeDefaultValues;h.includeDefaultValues=i;var g=h.toObject(t);return h.includeDefaultValues=c,g}),f=r.Object.prototype.toObject.call(this,t);return f.objects=o,f},toDatalessObject:function(t){var i,o=this.sourcePath;if(o)i=o;else{var f=this.includeDefaultValues;i=this._objects.map(function(c){var g=c.includeDefaultValues;c.includeDefaultValues=f;var _=c.toDatalessObject(t);return c.includeDefaultValues=g,_})}var h=r.Object.prototype.toDatalessObject.call(this,t);return h.objects=i,h},render:function(t){this._transformDone=!0,this.callSuper("render",t),this._transformDone=!1},shouldCache:function(){var t=r.Object.prototype.shouldCache.call(this);if(t){for(var i=0,o=this._objects.length;i<o;i++)if(this._objects[i].willDrawShadow())return this.ownCaching=!1,!1}return t},willDrawShadow:function(){if(r.Object.prototype.willDrawShadow.call(this))return!0;for(var t=0,i=this._objects.length;t<i;t++)if(this._objects[t].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(t){for(var i=0,o=this._objects.length;i<o;i++)this._objects[i].render(t);this._drawClipPath(t,this.clipPath)},isCacheDirty:function(t){if(this.callSuper("isCacheDirty",t))return!0;if(!this.statefullCache)return!1;for(var i=0,o=this._objects.length;i<o;i++)if(this._objects[i].isCacheDirty(!0)){if(this._cacheCanvas){var f=this.cacheWidth/this.zoomX,h=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-f/2,-h/2,f,h)}return!0}return!1},_restoreObjectsState:function(){var t=this.calcOwnMatrix();return this._objects.forEach(function(i){r.util.addTransformToObject(i,t),delete i.group,i.setCoords()}),this},destroy:function(){return this._objects.forEach(function(t){t.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(t){t.dispose&&t.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var t=this._objects,i=this.canvas;this._objects=[];var o=this.toObject();delete o.objects;var f=new r.ActiveSelection([]);return f.set(o),f.type="activeSelection",i.remove(this),t.forEach(function(h){h.group=f,h.dirty=!0,i.add(h)}),f.canvas=i,f._objects=t,i._activeObject=f,f.setCoords(),f}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(t){t.setCoords(!0)}),this},_calcBounds:function(t){for(var i,o,f,h,c=[],g=[],_=["tr","br","bl","tl"],y=0,x=this._objects.length,w=_.length;y<x;++y){for(f=(i=this._objects[y]).calcACoords(),h=0;h<w;h++)o=_[h],c.push(f[o].x),g.push(f[o].y);i.aCoords=f}this._getBounds(c,g,t)},_getBounds:function(t,i,o){var f=new r.Point(n(t),n(i)),h=new r.Point(l(t),l(i)),c=f.y||0,g=f.x||0,_=h.x-f.x||0,y=h.y-f.y||0;this.width=_,this.height=y,o||this.setPositionByOrigin({x:g,y:c},"left","top")},_toSVG:function(t){for(var i=["<g ","COMMON_PARTS",` >
`],o=0,f=this._objects.length;o<f;o++)i.push("		",this._objects[o].toSVG(t));return i.push(`</g>
`),i},getSvgStyles:function(){var t=this.opacity!==void 0&&this.opacity!==1?"opacity: "+this.opacity+";":"",i=this.visible?"":" visibility: hidden;";return[t,this.getSvgFilter(),i].join("")},toClipPathSVG:function(t){for(var i=[],o=0,f=this._objects.length;o<f;o++)i.push("	",this._objects[o].toClipPathSVG(t));return this._createBaseClipPathSVGMarkup(i,{reviver:t})}}),r.Group.fromObject=function(t,i){var o=t.objects,f=r.util.object.clone(t,!0);delete f.objects,typeof o!="string"?r.util.enlivenObjects(o,function(h){var c=r.util.object.clone(t,!0);delete c.objects,r.util.enlivenObjectEnlivables(t,c,function(){i&&i(new r.Group(h,c,!0))})}):r.loadSVGFromURL(o,function(h){var c=r.util.groupSVGElements(h,t,o);c.set(f),i&&i(c)})})}(e),function(s){var r=s.fabric||(s.fabric={});r.ActiveSelection||(r.ActiveSelection=r.util.createClass(r.Group,{type:"activeSelection",initialize:function(n,l){l=l||{},this._objects=n||[];for(var t=this._objects.length;t--;)this._objects[t].group=this;l.originX&&(this.originX=l.originX),l.originY&&(this.originY=l.originY),this._calcBounds(),this._updateObjectsCoords(),r.Object.prototype.initialize.call(this,l),this.setCoords()},toGroup:function(){var n=this._objects.concat();this._objects=[];var l=r.Object.prototype.toObject.call(this),t=new r.Group([]);if(delete l.type,t.set(l),n.forEach(function(o){o.canvas.remove(o),o.group=t}),t._objects=n,!this.canvas)return t;var i=this.canvas;return i.add(t),i._activeObject=t,t.setCoords(),t},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(n,l,t){n.save(),n.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",n,l),(t=t||{}).hasControls===void 0&&(t.hasControls=!1),t.forActiveSelection=!0;for(var i=0,o=this._objects.length;i<o;i++)this._objects[i]._renderControls(n,t);n.restore()}}),r.ActiveSelection.fromObject=function(n,l){r.util.enlivenObjects(n.objects,function(t){delete n.objects,l&&l(new r.ActiveSelection(t,n,!0))})})}(e),function(s){var r=m.util.object.extend;s.fabric||(s.fabric={}),s.fabric.Image?m.warn("fabric.Image is already defined."):(m.Image=m.util.createClass(m.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:m.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:m.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(n,l){l||(l={}),this.filters=[],this.cacheKey="texture"+m.Object.__uid++,this.callSuper("initialize",l),this._initElement(n,l)},getElement:function(){return this._element||{}},setElement:function(n,l){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=n,this._originalElement=n,this._initConfig(l),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(n){var l=m.filterBackend;l&&l.evictCachesForKey&&l.evictCachesForKey(n)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(n){m.util.cleanUpJsdomNode(this[n]),this[n]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var n=this.getElement();return{width:n.naturalWidth||n.width,height:n.naturalHeight||n.height}},_stroke:function(n){if(this.stroke&&this.strokeWidth!==0){var l=this.width/2,t=this.height/2;n.beginPath(),n.moveTo(-l,-t),n.lineTo(l,-t),n.lineTo(l,t),n.lineTo(-l,t),n.lineTo(-l,-t),n.closePath()}},toObject:function(n){var l=[];this.filters.forEach(function(i){i&&l.push(i.toObject())});var t=r(this.callSuper("toObject",["cropX","cropY"].concat(n)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:l});return this.resizeFilter&&(t.resizeFilter=this.resizeFilter.toObject()),t},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var n,l=[],t=[],i=this._element,o=-this.width/2,f=-this.height/2,h="",c="";if(!i)return[];if(this.hasCrop()){var g=m.Object.__uid++;l.push('<clipPath id="imageCrop_'+g+`">
`,'	<rect x="'+o+'" y="'+f+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),h=' clip-path="url(#imageCrop_'+g+')" '}if(this.imageSmoothing||(c='" image-rendering="optimizeSpeed'),t.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',o-this.cropX,'" y="',f-this.cropY,'" width="',i.width||i.naturalWidth,'" height="',i.height||i.height,c,'"',h,`></image>
`),this.stroke||this.strokeDashArray){var _=this.fill;this.fill=null,n=["	<rect ",'x="',o,'" y="',f,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=_}return this.paintFirst!=="fill"?l.concat(n,t):l.concat(t,n)},getSrc:function(n){var l=n?this._element:this._originalElement;return l?l.toDataURL?l.toDataURL():this.srcFromAttribute?l.getAttribute("src"):l.src:this.src||""},setSrc:function(n,l,t){return m.util.loadImage(n,function(i,o){this.setElement(i,t),this._setWidthHeight(),l&&l(this,o)},this,t&&t.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var n=this.resizeFilter,l=this.minimumScaleTrigger,t=this.getTotalObjectScaling(),i=t.scaleX,o=t.scaleY,f=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!n||i>l&&o>l)return this._element=f,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=i,void(this._lastScaleY=o);m.filterBackend||(m.filterBackend=m.initFilterBackend());var h=m.util.createCanvasElement(),c=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,g=f.width,_=f.height;h.width=g,h.height=_,this._element=h,this._lastScaleX=n.scaleX=i,this._lastScaleY=n.scaleY=o,m.filterBackend.applyFilters([n],f,g,_,this._element,c),this._filterScalingX=h.width/this._originalElement.width,this._filterScalingY=h.height/this._originalElement.height},applyFilters:function(n){if(n=(n=n||this.filters||[]).filter(function(f){return f&&!f.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),n.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var l=this._originalElement,t=l.naturalWidth||l.width,i=l.naturalHeight||l.height;if(this._element===this._originalElement){var o=m.util.createCanvasElement();o.width=t,o.height=i,this._element=o,this._filteredEl=o}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,t,i),this._lastScaleX=1,this._lastScaleY=1;return m.filterBackend||(m.filterBackend=m.initFilterBackend()),m.filterBackend.applyFilters(n,this._originalElement,t,i,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(n){m.util.setImageSmoothing(n,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(n),this._renderPaintInOrder(n)},drawCacheOnCanvas:function(n){m.util.setImageSmoothing(n,this.imageSmoothing),m.Object.prototype.drawCacheOnCanvas.call(this,n)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(n){var l=this._element;if(l){var t=this._filterScalingX,i=this._filterScalingY,o=this.width,f=this.height,h=Math.min,c=Math.max,g=c(this.cropX,0),_=c(this.cropY,0),y=l.naturalWidth||l.width,x=l.naturalHeight||l.height,w=g*t,I=_*i,R=h(o*t,y-w),U=h(f*i,x-I),G=-o/2,K=-f/2,O=h(o,y/t-g),D=h(f,x/i-_);l&&n.drawImage(l,w,I,R,U,G,K,O,D)}},_needsResize:function(){var n=this.getTotalObjectScaling();return n.scaleX!==this._lastScaleX||n.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(n,l){this.setElement(m.util.getById(n),l),m.util.addClass(this.getElement(),m.Image.CSS_CANVAS)},_initConfig:function(n){n||(n={}),this.setOptions(n),this._setWidthHeight(n)},_initFilters:function(n,l){n&&n.length?m.util.enlivenObjects(n,function(t){l&&l(t)},"fabric.Image.filters"):l&&l()},_setWidthHeight:function(n){n||(n={});var l=this.getElement();this.width=n.width||l.naturalWidth||l.width||0,this.height=n.height||l.naturalHeight||l.height||0},parsePreserveAspectRatioAttribute:function(){var n,l=m.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),t=this._element.width,i=this._element.height,o=1,f=1,h=0,c=0,g=0,_=0,y=this.width,x=this.height,w={width:y,height:x};return!l||l.alignX==="none"&&l.alignY==="none"?(o=y/t,f=x/i):(l.meetOrSlice==="meet"&&(n=(y-t*(o=f=m.util.findScaleToFit(this._element,w)))/2,l.alignX==="Min"&&(h=-n),l.alignX==="Max"&&(h=n),n=(x-i*f)/2,l.alignY==="Min"&&(c=-n),l.alignY==="Max"&&(c=n)),l.meetOrSlice==="slice"&&(n=t-y/(o=f=m.util.findScaleToCover(this._element,w)),l.alignX==="Mid"&&(g=n/2),l.alignX==="Max"&&(g=n),n=i-x/f,l.alignY==="Mid"&&(_=n/2),l.alignY==="Max"&&(_=n),t=y/o,i=x/f)),{width:t,height:i,scaleX:o,scaleY:f,offsetLeft:h,offsetTop:c,cropX:g,cropY:_}}}),m.Image.CSS_CANVAS="canvas-img",m.Image.prototype.getSvgSrc=m.Image.prototype.getSrc,m.Image.fromObject=function(n,l){var t=m.util.object.clone(n);m.util.loadImage(t.src,function(i,o){o?l&&l(null,!0):m.Image.prototype._initFilters.call(t,t.filters,function(f){t.filters=f||[],m.Image.prototype._initFilters.call(t,[t.resizeFilter],function(h){t.resizeFilter=h[0],m.util.enlivenObjectEnlivables(t,t,function(){var c=new m.Image(i,t);l(c,!1)})})})},null,t.crossOrigin)},m.Image.fromURL=function(n,l,t){m.util.loadImage(n,function(i,o){l&&l(new m.Image(i,t),o)},null,t&&t.crossOrigin)},m.Image.ATTRIBUTE_NAMES=m.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),m.Image.fromElement=function(n,l,t){var i=m.parseAttributes(n,m.Image.ATTRIBUTE_NAMES);m.Image.fromURL(i["xlink:href"],l,r(t?m.util.object.clone(t):{},i))})}(e),m.util.object.extend(m.Object.prototype,{_getAngleValueForStraighten:function(){var s=this.angle%360;return s>0?90*Math.round((s-1)/90):90*Math.round(s/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(s){var r=function(){},n=(s=s||{}).onComplete||r,l=s.onChange||r,t=this;return m.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(i){t.rotate(i),l()},onComplete:function(){t.setCoords(),n()}})}}),m.util.object.extend(m.StaticCanvas.prototype,{straightenObject:function(s){return s.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(s){return s.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function s(n,l){var t="precision "+l+` float;
void main(){}`,i=n.createShader(n.FRAGMENT_SHADER);return n.shaderSource(i,t),n.compileShader(i),!!n.getShaderParameter(i,n.COMPILE_STATUS)}function r(n){n&&n.tileSize&&(this.tileSize=n.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}m.isWebglSupported=function(n){if(m.isLikelyNode)return!1;n=n||m.WebglFilterBackend.prototype.tileSize;var l=document.createElement("canvas"),t=l.getContext("webgl")||l.getContext("experimental-webgl"),i=!1;if(t){m.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),i=m.maxTextureSize>=n;for(var o=["highp","mediump","lowp"],f=0;f<3;f++)if(s(t,o[f])){m.webGlPrecision=o[f];break}}return this.isSupported=i,i},m.WebglFilterBackend=r,r.prototype={tileSize:2048,resources:{},setupGLContext:function(n,l){this.dispose(),this.createWebGLCanvas(n,l),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(n,l)},chooseFastestCopyGLTo2DMethod:function(n,l){var t,i=window.performance!==void 0;try{new ImageData(1,1),t=!0}catch{t=!1}var o=typeof ArrayBuffer<"u",f=typeof Uint8ClampedArray<"u";if(i&&t&&o&&f){var h=m.util.createCanvasElement(),c=new ArrayBuffer(n*l*4);if(m.forceGLPutImageData)return this.imageBuffer=c,void(this.copyGLTo2D=Ft);var g,_,y={imageBuffer:c,destinationWidth:n,destinationHeight:l,targetCanvas:h};h.width=n,h.height=l,g=window.performance.now(),_t.call(y,this.gl,y),_=window.performance.now()-g,g=window.performance.now(),Ft.call(y,this.gl,y),_>window.performance.now()-g?(this.imageBuffer=c,this.copyGLTo2D=Ft):this.copyGLTo2D=_t}},createWebGLCanvas:function(n,l){var t=m.util.createCanvasElement();t.width=n,t.height=l;var i={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},o=t.getContext("webgl",i);o||(o=t.getContext("experimental-webgl",i)),o&&(o.clearColor(0,0,0,0),this.canvas=t,this.gl=o)},applyFilters:function(n,l,t,i,o,f){var h,c=this.gl;f&&(h=this.getCachedTexture(f,l));var g={originalWidth:l.width||l.originalWidth,originalHeight:l.height||l.originalHeight,sourceWidth:t,sourceHeight:i,destinationWidth:t,destinationHeight:i,context:c,sourceTexture:this.createTexture(c,t,i,!h&&l),targetTexture:this.createTexture(c,t,i),originalTexture:h||this.createTexture(c,t,i,!h&&l),passes:n.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:o},_=c.createFramebuffer();return c.bindFramebuffer(c.FRAMEBUFFER,_),n.forEach(function(y){y&&y.applyTo(g)}),function(y){var x=y.targetCanvas,w=x.width,I=x.height,R=y.destinationWidth,U=y.destinationHeight;w===R&&I===U||(x.width=R,x.height=U)}(g),this.copyGLTo2D(c,g),c.bindTexture(c.TEXTURE_2D,null),c.deleteTexture(g.sourceTexture),c.deleteTexture(g.targetTexture),c.deleteFramebuffer(_),o.getContext("2d").setTransform(1,0,0,1,0,0),g},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(n,l,t,i){var o=n.createTexture();return n.bindTexture(n.TEXTURE_2D,o),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),i?n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,i):n.texImage2D(n.TEXTURE_2D,0,n.RGBA,l,t,0,n.RGBA,n.UNSIGNED_BYTE,null),o},getCachedTexture:function(n,l){if(this.textureCache[n])return this.textureCache[n];var t=this.createTexture(this.gl,l.width,l.height,l);return this.textureCache[n]=t,t},evictCachesForKey:function(n){this.textureCache[n]&&(this.gl.deleteTexture(this.textureCache[n]),delete this.textureCache[n])},copyGLTo2D:_t,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var n=this.gl,l={renderer:"",vendor:""};if(!n)return l;var t=n.getExtension("WEBGL_debug_renderer_info");if(t){var i=n.getParameter(t.UNMASKED_RENDERER_WEBGL),o=n.getParameter(t.UNMASKED_VENDOR_WEBGL);i&&(l.renderer=i.toLowerCase()),o&&(l.vendor=o.toLowerCase())}return this.gpuInfo=l,l}}}(),function(){var s=function(){};function r(){}m.Canvas2dFilterBackend=r,r.prototype={evictCachesForKey:s,dispose:s,clearWebGLCaches:s,resources:{},applyFilters:function(n,l,t,i,o){var f=o.getContext("2d");f.drawImage(l,0,0,t,i);var h={sourceWidth:t,sourceHeight:i,imageData:f.getImageData(0,0,t,i),originalEl:l,originalImageData:f.getImageData(0,0,t,i),canvasEl:o,ctx:f,filterBackend:this};return n.forEach(function(c){c.applyTo(h)}),h.imageData.width===t&&h.imageData.height===i||(o.width=h.imageData.width,o.height=h.imageData.height),f.putImageData(h.imageData,0,0),h}}}(),m.Image=m.Image||{},m.Image.filters=m.Image.filters||{},m.Image.filters.BaseFilter=m.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(s){s&&this.setOptions(s)},setOptions:function(s){for(var r in s)this[r]=s[r]},createProgram:function(s,r,n){r=r||this.fragmentSource,n=n||this.vertexSource,m.webGlPrecision!=="highp"&&(r=r.replace(/precision highp float/g,"precision "+m.webGlPrecision+" float"));var l=s.createShader(s.VERTEX_SHADER);if(s.shaderSource(l,n),s.compileShader(l),!s.getShaderParameter(l,s.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+s.getShaderInfoLog(l));var t=s.createShader(s.FRAGMENT_SHADER);if(s.shaderSource(t,r),s.compileShader(t),!s.getShaderParameter(t,s.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+s.getShaderInfoLog(t));var i=s.createProgram();if(s.attachShader(i,l),s.attachShader(i,t),s.linkProgram(i),!s.getProgramParameter(i,s.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+s.getProgramInfoLog(i));var o=this.getAttributeLocations(s,i),f=this.getUniformLocations(s,i)||{};return f.uStepW=s.getUniformLocation(i,"uStepW"),f.uStepH=s.getUniformLocation(i,"uStepH"),{program:i,attributeLocations:o,uniformLocations:f}},getAttributeLocations:function(s,r){return{aPosition:s.getAttribLocation(r,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(s,r,n){var l=r.aPosition,t=s.createBuffer();s.bindBuffer(s.ARRAY_BUFFER,t),s.enableVertexAttribArray(l),s.vertexAttribPointer(l,2,s.FLOAT,!1,0,0),s.bufferData(s.ARRAY_BUFFER,n,s.STATIC_DRAW)},_setupFrameBuffer:function(s){var r,n,l=s.context;s.passes>1?(r=s.destinationWidth,n=s.destinationHeight,s.sourceWidth===r&&s.sourceHeight===n||(l.deleteTexture(s.targetTexture),s.targetTexture=s.filterBackend.createTexture(l,r,n)),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,s.targetTexture,0)):(l.bindFramebuffer(l.FRAMEBUFFER,null),l.finish())},_swapTextures:function(s){s.passes--,s.pass++;var r=s.targetTexture;s.targetTexture=s.sourceTexture,s.sourceTexture=r},isNeutralState:function(){var s=this.mainParameter,r=m.Image.filters[this.type].prototype;if(s){if(Array.isArray(r[s])){for(var n=r[s].length;n--;)if(this[s][n]!==r[s][n])return!1;return!0}return r[s]===this[s]}return!1},applyTo:function(s){s.webgl?(this._setupFrameBuffer(s),this.applyToWebGL(s),this._swapTextures(s)):this.applyTo2d(s)},retrieveShader:function(s){return s.programCache.hasOwnProperty(this.type)||(s.programCache[this.type]=this.createProgram(s.context)),s.programCache[this.type]},applyToWebGL:function(s){var r=s.context,n=this.retrieveShader(s);s.pass===0&&s.originalTexture?r.bindTexture(r.TEXTURE_2D,s.originalTexture):r.bindTexture(r.TEXTURE_2D,s.sourceTexture),r.useProgram(n.program),this.sendAttributeData(r,n.attributeLocations,s.aPosition),r.uniform1f(n.uniformLocations.uStepW,1/s.sourceWidth),r.uniform1f(n.uniformLocations.uStepH,1/s.sourceHeight),this.sendUniformData(r,n.uniformLocations),r.viewport(0,0,s.destinationWidth,s.destinationHeight),r.drawArrays(r.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(s,r,n){s.activeTexture(n),s.bindTexture(s.TEXTURE_2D,r),s.activeTexture(s.TEXTURE0)},unbindAdditionalTexture:function(s,r){s.activeTexture(r),s.bindTexture(s.TEXTURE_2D,null),s.activeTexture(s.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(s){this[this.mainParameter]=s},sendUniformData:function(){},createHelpLayer:function(s){if(!s.helpLayer){var r=document.createElement("canvas");r.width=s.sourceWidth,r.height=s.sourceHeight,s.helpLayer=r}},toObject:function(){var s={type:this.type},r=this.mainParameter;return r&&(s[r]=this[r]),s},toJSON:function(){return this.toObject()}}),m.Image.filters.BaseFilter.fromObject=function(s,r){var n=new m.Image.filters[s.type](s);return r&&r(n),n},function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass;n.ColorMatrix=l(n.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(t){this.callSuper("initialize",t),this.matrix=this.matrix.slice(0)},applyTo2d:function(t){var i,o,f,h,c,g=t.imageData.data,_=g.length,y=this.matrix,x=this.colorsOnly;for(c=0;c<_;c+=4)i=g[c],o=g[c+1],f=g[c+2],x?(g[c]=i*y[0]+o*y[1]+f*y[2]+255*y[4],g[c+1]=i*y[5]+o*y[6]+f*y[7]+255*y[9],g[c+2]=i*y[10]+o*y[11]+f*y[12]+255*y[14]):(h=g[c+3],g[c]=i*y[0]+o*y[1]+f*y[2]+h*y[3]+255*y[4],g[c+1]=i*y[5]+o*y[6]+f*y[7]+h*y[8]+255*y[9],g[c+2]=i*y[10]+o*y[11]+f*y[12]+h*y[13]+255*y[14],g[c+3]=i*y[15]+o*y[16]+f*y[17]+h*y[18]+255*y[19])},getUniformLocations:function(t,i){return{uColorMatrix:t.getUniformLocation(i,"uColorMatrix"),uConstants:t.getUniformLocation(i,"uConstants")}},sendUniformData:function(t,i){var o=this.matrix,f=[o[0],o[1],o[2],o[3],o[5],o[6],o[7],o[8],o[10],o[11],o[12],o[13],o[15],o[16],o[17],o[18]],h=[o[4],o[9],o[14],o[19]];t.uniformMatrix4fv(i.uColorMatrix,!1,f),t.uniform4fv(i.uConstants,h)}}),r.Image.filters.ColorMatrix.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass;n.Brightness=l(n.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(t){if(this.brightness!==0){var i,o=t.imageData.data,f=o.length,h=Math.round(255*this.brightness);for(i=0;i<f;i+=4)o[i]=o[i]+h,o[i+1]=o[i+1]+h,o[i+2]=o[i+2]+h}},getUniformLocations:function(t,i){return{uBrightness:t.getUniformLocation(i,"uBrightness")}},sendUniformData:function(t,i){t.uniform1f(i.uBrightness,this.brightness)}}),r.Image.filters.Brightness.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(s){var r=s.fabric||(s.fabric={}),n=r.util.object.extend,l=r.Image.filters,t=r.util.createClass;l.Convolute=t(l.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(i){var o=Math.sqrt(this.matrix.length),f=this.type+"_"+o+"_"+(this.opaque?1:0),h=this.fragmentSource[f];return i.programCache.hasOwnProperty(f)||(i.programCache[f]=this.createProgram(i.context,h)),i.programCache[f]},applyTo2d:function(i){var o,f,h,c,g,_,y,x,w,I,R,U,G,K=i.imageData,O=K.data,D=this.matrix,E=Math.round(Math.sqrt(D.length)),F=Math.floor(E/2),k=K.width,W=K.height,N=i.ctx.createImageData(k,W),L=N.data,P=this.opaque?1:0;for(R=0;R<W;R++)for(I=0;I<k;I++){for(g=4*(R*k+I),o=0,f=0,h=0,c=0,G=0;G<E;G++)for(U=0;U<E;U++)_=I+U-F,(y=R+G-F)<0||y>=W||_<0||_>=k||(x=4*(y*k+_),w=D[G*E+U],o+=O[x]*w,f+=O[x+1]*w,h+=O[x+2]*w,P||(c+=O[x+3]*w));L[g]=o,L[g+1]=f,L[g+2]=h,L[g+3]=P?O[g+3]:c}i.imageData=N},getUniformLocations:function(i,o){return{uMatrix:i.getUniformLocation(o,"uMatrix"),uOpaque:i.getUniformLocation(o,"uOpaque"),uHalfSize:i.getUniformLocation(o,"uHalfSize"),uSize:i.getUniformLocation(o,"uSize")}},sendUniformData:function(i,o){i.uniform1fv(o.uMatrix,this.matrix)},toObject:function(){return n(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),r.Image.filters.Convolute.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass;n.Grayscale=l(n.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(t){var i,o,f=t.imageData.data,h=f.length,c=this.mode;for(i=0;i<h;i+=4)c==="average"?o=(f[i]+f[i+1]+f[i+2])/3:c==="lightness"?o=(Math.min(f[i],f[i+1],f[i+2])+Math.max(f[i],f[i+1],f[i+2]))/2:c==="luminosity"&&(o=.21*f[i]+.72*f[i+1]+.07*f[i+2]),f[i]=o,f[i+1]=o,f[i+2]=o},retrieveShader:function(t){var i=this.type+"_"+this.mode;if(!t.programCache.hasOwnProperty(i)){var o=this.fragmentSource[this.mode];t.programCache[i]=this.createProgram(t.context,o)}return t.programCache[i]},getUniformLocations:function(t,i){return{uMode:t.getUniformLocation(i,"uMode")}},sendUniformData:function(t,i){t.uniform1i(i.uMode,1)},isNeutralState:function(){return!1}}),r.Image.filters.Grayscale.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass;n.Invert=l(n.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(t){var i,o=t.imageData.data,f=o.length;for(i=0;i<f;i+=4)o[i]=255-o[i],o[i+1]=255-o[i+1],o[i+2]=255-o[i+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(t,i){return{uInvert:t.getUniformLocation(i,"uInvert")}},sendUniformData:function(t,i){t.uniform1i(i.uInvert,this.invert)}}),r.Image.filters.Invert.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(s){var r=s.fabric||(s.fabric={}),n=r.util.object.extend,l=r.Image.filters,t=r.util.createClass;l.Noise=t(l.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(i){if(this.noise!==0){var o,f,h=i.imageData.data,c=h.length,g=this.noise;for(o=0,c=h.length;o<c;o+=4)f=(.5-Math.random())*g,h[o]+=f,h[o+1]+=f,h[o+2]+=f}},getUniformLocations:function(i,o){return{uNoise:i.getUniformLocation(o,"uNoise"),uSeed:i.getUniformLocation(o,"uSeed")}},sendUniformData:function(i,o){i.uniform1f(o.uNoise,this.noise/255),i.uniform1f(o.uSeed,Math.random())},toObject:function(){return n(this.callSuper("toObject"),{noise:this.noise})}}),r.Image.filters.Noise.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass;n.Pixelate=l(n.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(t){var i,o,f,h,c,g,_,y,x,w,I,R=t.imageData,U=R.data,G=R.height,K=R.width;for(o=0;o<G;o+=this.blocksize)for(f=0;f<K;f+=this.blocksize)for(h=U[i=4*o*K+4*f],c=U[i+1],g=U[i+2],_=U[i+3],w=Math.min(o+this.blocksize,G),I=Math.min(f+this.blocksize,K),y=o;y<w;y++)for(x=f;x<I;x++)U[i=4*y*K+4*x]=h,U[i+1]=c,U[i+2]=g,U[i+3]=_},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(t,i){return{uBlocksize:t.getUniformLocation(i,"uBlocksize"),uStepW:t.getUniformLocation(i,"uStepW"),uStepH:t.getUniformLocation(i,"uStepH")}},sendUniformData:function(t,i){t.uniform1f(i.uBlocksize,this.blocksize)}}),r.Image.filters.Pixelate.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(s){var r=s.fabric||(s.fabric={}),n=r.util.object.extend,l=r.Image.filters,t=r.util.createClass;l.RemoveColor=t(l.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(i){var o,f,h,c,g=i.imageData.data,_=255*this.distance,y=new r.Color(this.color).getSource(),x=[y[0]-_,y[1]-_,y[2]-_],w=[y[0]+_,y[1]+_,y[2]+_];for(o=0;o<g.length;o+=4)f=g[o],h=g[o+1],c=g[o+2],f>x[0]&&h>x[1]&&c>x[2]&&f<w[0]&&h<w[1]&&c<w[2]&&(g[o+3]=0)},getUniformLocations:function(i,o){return{uLow:i.getUniformLocation(o,"uLow"),uHigh:i.getUniformLocation(o,"uHigh")}},sendUniformData:function(i,o){var f=new r.Color(this.color).getSource(),h=parseFloat(this.distance),c=[0+f[0]/255-h,0+f[1]/255-h,0+f[2]/255-h,1],g=[f[0]/255+h,f[1]/255+h,f[2]/255+h,1];i.uniform4fv(o.uLow,c),i.uniform4fv(o.uHigh,g)},toObject:function(){return n(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),r.Image.filters.RemoveColor.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass,t={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var i in t)n[i]=l(n.ColorMatrix,{type:i,matrix:t[i],mainParameter:!1,colorsOnly:!0}),r.Image.filters[i].fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(s){var r=s.fabric,n=r.Image.filters,l=r.util.createClass;n.BlendColor=l(n.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(t){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[t]+`}
}`},retrieveShader:function(t){var i,o=this.type+"_"+this.mode;return t.programCache.hasOwnProperty(o)||(i=this.buildSource(this.mode),t.programCache[o]=this.createProgram(t.context,i)),t.programCache[o]},applyTo2d:function(t){var i,o,f,h,c,g,_,y=t.imageData.data,x=y.length,w=1-this.alpha;i=(_=new r.Color(this.color).getSource())[0]*this.alpha,o=_[1]*this.alpha,f=_[2]*this.alpha;for(var I=0;I<x;I+=4)switch(h=y[I],c=y[I+1],g=y[I+2],this.mode){case"multiply":y[I]=h*i/255,y[I+1]=c*o/255,y[I+2]=g*f/255;break;case"screen":y[I]=255-(255-h)*(255-i)/255,y[I+1]=255-(255-c)*(255-o)/255,y[I+2]=255-(255-g)*(255-f)/255;break;case"add":y[I]=h+i,y[I+1]=c+o,y[I+2]=g+f;break;case"diff":case"difference":y[I]=Math.abs(h-i),y[I+1]=Math.abs(c-o),y[I+2]=Math.abs(g-f);break;case"subtract":y[I]=h-i,y[I+1]=c-o,y[I+2]=g-f;break;case"darken":y[I]=Math.min(h,i),y[I+1]=Math.min(c,o),y[I+2]=Math.min(g,f);break;case"lighten":y[I]=Math.max(h,i),y[I+1]=Math.max(c,o),y[I+2]=Math.max(g,f);break;case"overlay":y[I]=i<128?2*h*i/255:255-2*(255-h)*(255-i)/255,y[I+1]=o<128?2*c*o/255:255-2*(255-c)*(255-o)/255,y[I+2]=f<128?2*g*f/255:255-2*(255-g)*(255-f)/255;break;case"exclusion":y[I]=i+h-2*i*h/255,y[I+1]=o+c-2*o*c/255,y[I+2]=f+g-2*f*g/255;break;case"tint":y[I]=i+h*w,y[I+1]=o+c*w,y[I+2]=f+g*w}},getUniformLocations:function(t,i){return{uColor:t.getUniformLocation(i,"uColor")}},sendUniformData:function(t,i){var o=new r.Color(this.color).getSource();o[0]=this.alpha*o[0]/255,o[1]=this.alpha*o[1]/255,o[2]=this.alpha*o[2]/255,o[3]=this.alpha,t.uniform4fv(i.uColor,o)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),r.Image.filters.BlendColor.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(s){var r=s.fabric,n=r.Image.filters,l=r.util.createClass;n.BlendImage=l(n.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(t){var i=this.type+"_"+this.mode,o=this.fragmentSource[this.mode];return t.programCache.hasOwnProperty(i)||(t.programCache[i]=this.createProgram(t.context,o)),t.programCache[i]},applyToWebGL:function(t){var i=t.context,o=this.createTexture(t.filterBackend,this.image);this.bindAdditionalTexture(i,o,i.TEXTURE1),this.callSuper("applyToWebGL",t),this.unbindAdditionalTexture(i,i.TEXTURE1)},createTexture:function(t,i){return t.getCachedTexture(i.cacheKey,i._element)},calculateMatrix:function(){var t=this.image,i=t._element.width,o=t._element.height;return[1/t.scaleX,0,0,0,1/t.scaleY,0,-t.left/i,-t.top/o,1]},applyTo2d:function(t){var i,o,f,h,c,g,_,y,x,w,I,R=t.imageData,U=t.filterBackend.resources,G=R.data,K=G.length,O=R.width,D=R.height,E=this.image;U.blendImage||(U.blendImage=r.util.createCanvasElement()),w=(x=U.blendImage).getContext("2d"),x.width!==O||x.height!==D?(x.width=O,x.height=D):w.clearRect(0,0,O,D),w.setTransform(E.scaleX,0,0,E.scaleY,E.left,E.top),w.drawImage(E._element,0,0,O,D),I=w.getImageData(0,0,O,D).data;for(var F=0;F<K;F+=4)switch(c=G[F],g=G[F+1],_=G[F+2],y=G[F+3],i=I[F],o=I[F+1],f=I[F+2],h=I[F+3],this.mode){case"multiply":G[F]=c*i/255,G[F+1]=g*o/255,G[F+2]=_*f/255,G[F+3]=y*h/255;break;case"mask":G[F+3]=h}},getUniformLocations:function(t,i){return{uTransformMatrix:t.getUniformLocation(i,"uTransformMatrix"),uImage:t.getUniformLocation(i,"uImage")}},sendUniformData:function(t,i){var o=this.calculateMatrix();t.uniform1i(i.uImage,1),t.uniformMatrix3fv(i.uTransformMatrix,!1,o)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),r.Image.filters.BlendImage.fromObject=function(t,i){r.Image.fromObject(t.image,function(o){var f=r.util.object.clone(t);f.image=o,i(new r.Image.filters.BlendImage(f))})}}(e),function(s){var r=s.fabric||(s.fabric={}),n=Math.pow,l=Math.floor,t=Math.sqrt,i=Math.abs,o=Math.round,f=Math.sin,h=Math.ceil,c=r.Image.filters,g=r.util.createClass;c.Resize=g(c.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(_,y){return{uDelta:_.getUniformLocation(y,"uDelta"),uTaps:_.getUniformLocation(y,"uTaps")}},sendUniformData:function(_,y){_.uniform2fv(y.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),_.uniform1fv(y.uTaps,this.taps)},retrieveShader:function(_){var y=this.getFilterWindow(),x=this.type+"_"+y;if(!_.programCache.hasOwnProperty(x)){var w=this.generateShader(y);_.programCache[x]=this.createProgram(_.context,w)}return _.programCache[x]},getFilterWindow:function(){var _=this.tempScale;return Math.ceil(this.lanczosLobes/_)},getTaps:function(){for(var _=this.lanczosCreate(this.lanczosLobes),y=this.tempScale,x=this.getFilterWindow(),w=new Array(x),I=1;I<=x;I++)w[I-1]=_(I*y);return w},generateShader:function(_){for(var y=new Array(_),x=this.fragmentSourceTOP,w=1;w<=_;w++)y[w-1]=w+".0 * uDelta";return x+="uniform float uTaps["+_+`];
`,x+=`void main() {
`,x+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,x+=`  float sum = 1.0;
`,y.forEach(function(I,R){x+="  color += texture2D(uTexture, vTexCoord + "+I+") * uTaps["+R+`];
`,x+="  color += texture2D(uTexture, vTexCoord - "+I+") * uTaps["+R+`];
`,x+="  sum += 2.0 * uTaps["+R+`];
`}),x+=`  gl_FragColor = color / sum;
`,x+="}"},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(_){_.webgl?(_.passes++,this.width=_.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=_.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),_.destinationWidth=this.dW,this._setupFrameBuffer(_),this.applyToWebGL(_),this._swapTextures(_),_.sourceWidth=_.destinationWidth,this.height=_.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),_.destinationHeight=this.dH,this._setupFrameBuffer(_),this.applyToWebGL(_),this._swapTextures(_),_.sourceHeight=_.destinationHeight):this.applyTo2d(_)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(_){return function(y){if(y>=_||y<=-_)return 0;if(y<11920929e-14&&y>-11920929e-14)return 1;var x=(y*=Math.PI)/_;return f(y)/y*f(x)/x}},applyTo2d:function(_){var y=_.imageData,x=this.scaleX,w=this.scaleY;this.rcpScaleX=1/x,this.rcpScaleY=1/w;var I,R=y.width,U=y.height,G=o(R*x),K=o(U*w);this.resizeType==="sliceHack"?I=this.sliceByTwo(_,R,U,G,K):this.resizeType==="hermite"?I=this.hermiteFastResize(_,R,U,G,K):this.resizeType==="bilinear"?I=this.bilinearFiltering(_,R,U,G,K):this.resizeType==="lanczos"&&(I=this.lanczosResize(_,R,U,G,K)),_.imageData=I},sliceByTwo:function(_,y,x,w,I){var R,U,G=_.imageData,K=.5,O=!1,D=!1,E=y*K,F=x*K,k=r.filterBackend.resources,W=0,N=0,L=y,P=0;for(k.sliceByTwo||(k.sliceByTwo=document.createElement("canvas")),((R=k.sliceByTwo).width<1.5*y||R.height<x)&&(R.width=1.5*y,R.height=x),(U=R.getContext("2d")).clearRect(0,0,1.5*y,x),U.putImageData(G,0,0),w=l(w),I=l(I);!O||!D;)y=E,x=F,w<l(E*K)?E=l(E*K):(E=w,O=!0),I<l(F*K)?F=l(F*K):(F=I,D=!0),U.drawImage(R,W,N,y,x,L,P,E,F),W=L,N=P,P+=F;return U.getImageData(W,N,w,I)},lanczosResize:function(_,y,x,w,I){var R=_.imageData.data,U=_.ctx.createImageData(w,I),G=U.data,K=this.lanczosCreate(this.lanczosLobes),O=this.rcpScaleX,D=this.rcpScaleY,E=2/this.rcpScaleX,F=2/this.rcpScaleY,k=h(O*this.lanczosLobes/2),W=h(D*this.lanczosLobes/2),N={},L={},P={};return function A(V){var H,X,$,Q,Z,it,rt,at,ht,lt,ft;for(L.x=(V+.5)*O,P.x=l(L.x),H=0;H<I;H++){for(L.y=(H+.5)*D,P.y=l(L.y),Z=0,it=0,rt=0,at=0,ht=0,X=P.x-k;X<=P.x+k;X++)if(!(X<0||X>=y)){lt=l(1e3*i(X-L.x)),N[lt]||(N[lt]={});for(var yt=P.y-W;yt<=P.y+W;yt++)yt<0||yt>=x||(ft=l(1e3*i(yt-L.y)),N[lt][ft]||(N[lt][ft]=K(t(n(lt*E,2)+n(ft*F,2))/1e3)),($=N[lt][ft])>0&&(Z+=$,it+=$*R[Q=4*(yt*y+X)],rt+=$*R[Q+1],at+=$*R[Q+2],ht+=$*R[Q+3]))}G[Q=4*(H*w+V)]=it/Z,G[Q+1]=rt/Z,G[Q+2]=at/Z,G[Q+3]=ht/Z}return++V<w?A(V):U}(0)},bilinearFiltering:function(_,y,x,w,I){var R,U,G,K,O,D,E,F,k,W=0,N=this.rcpScaleX,L=this.rcpScaleY,P=4*(y-1),A=_.imageData.data,V=_.ctx.createImageData(w,I),H=V.data;for(G=0;G<I;G++)for(K=0;K<w;K++)for(O=N*K-(R=l(N*K)),D=L*G-(U=l(L*G)),k=4*(U*y+R),E=0;E<4;E++)F=A[k+E]*(1-O)*(1-D)+A[k+4+E]*O*(1-D)+A[k+P+E]*D*(1-O)+A[k+P+4+E]*O*D,H[W++]=F;return V},hermiteFastResize:function(_,y,x,w,I){for(var R=this.rcpScaleX,U=this.rcpScaleY,G=h(R/2),K=h(U/2),O=_.imageData.data,D=_.ctx.createImageData(w,I),E=D.data,F=0;F<I;F++)for(var k=0;k<w;k++){for(var W=4*(k+F*w),N=0,L=0,P=0,A=0,V=0,H=0,X=0,$=(F+.5)*U,Q=l(F*U);Q<(F+1)*U;Q++)for(var Z=i($-(Q+.5))/K,it=(k+.5)*R,rt=Z*Z,at=l(k*R);at<(k+1)*R;at++){var ht=i(it-(at+.5))/G,lt=t(rt+ht*ht);lt>1&&lt<-1||(N=2*lt*lt*lt-3*lt*lt+1)>0&&(X+=N*O[3+(ht=4*(at+Q*y))],P+=N,O[ht+3]<255&&(N=N*O[ht+3]/250),A+=N*O[ht],V+=N*O[ht+1],H+=N*O[ht+2],L+=N)}E[W]=A/L,E[W+1]=V/L,E[W+2]=H/L,E[W+3]=X/P}return D},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),r.Image.filters.Resize.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass;n.Contrast=l(n.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(t){if(this.contrast!==0){var i,o=t.imageData.data,f=o.length,h=Math.floor(255*this.contrast),c=259*(h+255)/(255*(259-h));for(i=0;i<f;i+=4)o[i]=c*(o[i]-128)+128,o[i+1]=c*(o[i+1]-128)+128,o[i+2]=c*(o[i+2]-128)+128}},getUniformLocations:function(t,i){return{uContrast:t.getUniformLocation(i,"uContrast")}},sendUniformData:function(t,i){t.uniform1f(i.uContrast,this.contrast)}}),r.Image.filters.Contrast.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass;n.Saturation=l(n.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(t){if(this.saturation!==0){var i,o,f=t.imageData.data,h=f.length,c=-this.saturation;for(i=0;i<h;i+=4)o=Math.max(f[i],f[i+1],f[i+2]),f[i]+=o!==f[i]?(o-f[i])*c:0,f[i+1]+=o!==f[i+1]?(o-f[i+1])*c:0,f[i+2]+=o!==f[i+2]?(o-f[i+2])*c:0}},getUniformLocations:function(t,i){return{uSaturation:t.getUniformLocation(i,"uSaturation")}},sendUniformData:function(t,i){t.uniform1f(i.uSaturation,-this.saturation)}}),r.Image.filters.Saturation.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass;n.Vibrance=l(n.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(t){if(this.vibrance!==0){var i,o,f,h,c=t.imageData.data,g=c.length,_=-this.vibrance;for(i=0;i<g;i+=4)o=Math.max(c[i],c[i+1],c[i+2]),f=(c[i]+c[i+1]+c[i+2])/3,h=2*Math.abs(o-f)/255*_,c[i]+=o!==c[i]?(o-c[i])*h:0,c[i+1]+=o!==c[i+1]?(o-c[i+1])*h:0,c[i+2]+=o!==c[i+2]?(o-c[i+2])*h:0}},getUniformLocations:function(t,i){return{uVibrance:t.getUniformLocation(i,"uVibrance")}},sendUniformData:function(t,i){t.uniform1f(i.uVibrance,-this.vibrance)}}),r.Image.filters.Vibrance.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass;n.Blur=l(n.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(t){t.webgl?(this.aspectRatio=t.sourceWidth/t.sourceHeight,t.passes++,this._setupFrameBuffer(t),this.horizontal=!0,this.applyToWebGL(t),this._swapTextures(t),this._setupFrameBuffer(t),this.horizontal=!1,this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)},applyTo2d:function(t){t.imageData=this.simpleBlur(t)},simpleBlur:function(t){var i,o,f=t.filterBackend.resources,h=t.imageData.width,c=t.imageData.height;f.blurLayer1||(f.blurLayer1=r.util.createCanvasElement(),f.blurLayer2=r.util.createCanvasElement()),i=f.blurLayer1,o=f.blurLayer2,i.width===h&&i.height===c||(o.width=i.width=h,o.height=i.height=c);var g,_,y,x,w=i.getContext("2d"),I=o.getContext("2d"),R=.06*this.blur*.5;for(w.putImageData(t.imageData,0,0),I.clearRect(0,0,h,c),x=-15;x<=15;x++)y=R*(_=x/15)*h+(g=(Math.random()-.5)/4),I.globalAlpha=1-Math.abs(_),I.drawImage(i,y,g),w.drawImage(o,0,0),I.globalAlpha=1,I.clearRect(0,0,o.width,o.height);for(x=-15;x<=15;x++)y=R*(_=x/15)*c+(g=(Math.random()-.5)/4),I.globalAlpha=1-Math.abs(_),I.drawImage(i,g,y),w.drawImage(o,0,0),I.globalAlpha=1,I.clearRect(0,0,o.width,o.height);t.ctx.drawImage(i,0,0);var U=t.ctx.getImageData(0,0,i.width,i.height);return w.globalAlpha=1,w.clearRect(0,0,i.width,i.height),U},getUniformLocations:function(t,i){return{delta:t.getUniformLocation(i,"uDelta")}},sendUniformData:function(t,i){var o=this.chooseRightDelta();t.uniform2fv(i.delta,o)},chooseRightDelta:function(){var t,i=1,o=[0,0];return this.horizontal?this.aspectRatio>1&&(i=1/this.aspectRatio):this.aspectRatio<1&&(i=this.aspectRatio),t=i*this.blur*.12,this.horizontal?o[0]=t:o[1]=t,o}}),n.Blur.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass;n.Gamma=l(n.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(t){this.gamma=[1,1,1],n.BaseFilter.prototype.initialize.call(this,t)},applyTo2d:function(t){var i,o=t.imageData.data,f=this.gamma,h=o.length,c=1/f[0],g=1/f[1],_=1/f[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),i=0,h=256;i<h;i++)this.rVals[i]=255*Math.pow(i/255,c),this.gVals[i]=255*Math.pow(i/255,g),this.bVals[i]=255*Math.pow(i/255,_);for(i=0,h=o.length;i<h;i+=4)o[i]=this.rVals[o[i]],o[i+1]=this.gVals[o[i+1]],o[i+2]=this.bVals[o[i+2]]},getUniformLocations:function(t,i){return{uGamma:t.getUniformLocation(i,"uGamma")}},sendUniformData:function(t,i){t.uniform3fv(i.uGamma,this.gamma)}}),r.Image.filters.Gamma.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass;n.Composed=l(n.BaseFilter,{type:"Composed",subFilters:[],initialize:function(t){this.callSuper("initialize",t),this.subFilters=this.subFilters.slice(0)},applyTo:function(t){t.passes+=this.subFilters.length-1,this.subFilters.forEach(function(i){i.applyTo(t)})},toObject:function(){return r.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(t){return t.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(t){return!t.isNeutralState()})}}),r.Image.filters.Composed.fromObject=function(t,i){var o=(t.subFilters||[]).map(function(h){return new r.Image.filters[h.type](h)}),f=new r.Image.filters.Composed({subFilters:o});return i&&i(f),f}}(e),function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass;n.HueRotation=l(n.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var t=this.rotation*Math.PI,i=r.util.cos(t),o=r.util.sin(t),f=1/3,h=Math.sqrt(f)*o,c=1-i;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=i+c/3,this.matrix[1]=f*c-h,this.matrix[2]=f*c+h,this.matrix[5]=f*c+h,this.matrix[6]=i+f*c,this.matrix[7]=f*c-h,this.matrix[10]=f*c-h,this.matrix[11]=f*c+h,this.matrix[12]=i+f*c},isNeutralState:function(t){return this.calculateMatrix(),n.BaseFilter.prototype.isNeutralState.call(this,t)},applyTo:function(t){this.calculateMatrix(),n.BaseFilter.prototype.applyTo.call(this,t)}}),r.Image.filters.HueRotation.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(s){var r=s.fabric||(s.fabric={}),n=r.util.object.clone;if(r.Text)r.warn("fabric.Text is already defined");else{var l="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");r.Text=r.util.createClass(r.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:r.Object.prototype.stateProperties.concat(l),cacheProperties:r.Object.prototype.cacheProperties.concat(l),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(t,i){this.styles=i&&i.styles||{},this.text=t,this.__skipDimension=!0,this.callSuper("initialize",i),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var t=this.path;t&&(t.segmentsInfo=r.util.getPathSegmentsInfo(t.path))},getMeasuringContext:function(){return r._measuringContext||(r._measuringContext=this.canvas&&this.canvas.contextCache||r.util.createCanvasElement().getContext("2d")),r._measuringContext},_splitText:function(){var t=this._splitTextIntoLines(this.text);return this.textLines=t.lines,this._textLines=t.graphemeLines,this._unwrappedTextLines=t._unwrappedLines,this._text=t.graphemeText,t},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var t,i,o,f,h,c,g,_=0,y=this._textLines.length;_<y;_++)if((this.textAlign==="justify"||_!==y-1&&!this.isEndOfWrapping(_))&&(f=0,h=this._textLines[_],(i=this.getLineWidth(_))<this.width&&(g=this.textLines[_].match(this._reSpacesAndTabs)))){o=g.length,t=(this.width-i)/o;for(var x=0,w=h.length;x<=w;x++)c=this.__charBounds[_][x],this._reSpaceAndTab.test(h[x])?(c.width+=t,c.kernedWidth+=t,c.left+=f,f+=t):c.left+=f}},isEndOfWrapping:function(t){return t===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var t=this.callSuper("_getCacheCanvasDimensions"),i=this.fontSize;return t.width+=i*t.zoomX,t.height+=i*t.zoomY,t},_render:function(t){var i=this.path;i&&!i.isNotVisible()&&i._render(t),this._setTextStyles(t),this._renderTextLinesBackground(t),this._renderTextDecoration(t,"underline"),this._renderText(t),this._renderTextDecoration(t,"overline"),this._renderTextDecoration(t,"linethrough")},_renderText:function(t){this.paintFirst==="stroke"?(this._renderTextStroke(t),this._renderTextFill(t)):(this._renderTextFill(t),this._renderTextStroke(t))},_setTextStyles:function(t,i,o){if(t.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":t.textBaseline="middle";break;case"ascender":t.textBaseline="top";break;case"descender":t.textBaseline="bottom"}t.font=this._getFontDeclaration(i,o)},calcTextWidth:function(){for(var t=this.getLineWidth(0),i=1,o=this._textLines.length;i<o;i++){var f=this.getLineWidth(i);f>t&&(t=f)}return t},_renderTextLine:function(t,i,o,f,h,c){this._renderChars(t,i,o,f,h,c)},_renderTextLinesBackground:function(t){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var i,o,f,h,c,g,_,y=t.fillStyle,x=this._getLeftOffset(),w=this._getTopOffset(),I=0,R=0,U=this.path,G=0,K=this._textLines.length;G<K;G++)if(i=this.getHeightOfLine(G),this.textBackgroundColor||this.styleHas("textBackgroundColor",G)){f=this._textLines[G],o=this._getLineLeftOffset(G),R=0,I=0,h=this.getValueOfPropertyAt(G,0,"textBackgroundColor");for(var O=0,D=f.length;O<D;O++)c=this.__charBounds[G][O],g=this.getValueOfPropertyAt(G,O,"textBackgroundColor"),U?(t.save(),t.translate(c.renderLeft,c.renderTop),t.rotate(c.angle),t.fillStyle=g,g&&t.fillRect(-c.width/2,-i/this.lineHeight*(1-this._fontSizeFraction),c.width,i/this.lineHeight),t.restore()):g!==h?(_=x+o+I,this.direction==="rtl"&&(_=this.width-_-R),t.fillStyle=h,h&&t.fillRect(_,w,R,i/this.lineHeight),I=c.left,R=c.width,h=g):R+=c.kernedWidth;g&&!U&&(_=x+o+I,this.direction==="rtl"&&(_=this.width-_-R),t.fillStyle=g,t.fillRect(_,w,R,i/this.lineHeight)),w+=i}else w+=i;t.fillStyle=y,this._removeShadow(t)}},getFontCache:function(t){var i=t.fontFamily.toLowerCase();r.charWidthsCache[i]||(r.charWidthsCache[i]={});var o=r.charWidthsCache[i],f=t.fontStyle.toLowerCase()+"_"+(t.fontWeight+"").toLowerCase();return o[f]||(o[f]={}),o[f]},_measureChar:function(t,i,o,f){var h,c,g,_,y=this.getFontCache(i),x=o+t,w=this._getFontDeclaration(i)===this._getFontDeclaration(f),I=i.fontSize/this.CACHE_FONT_SIZE;if(o&&y[o]!==void 0&&(g=y[o]),y[t]!==void 0&&(_=h=y[t]),w&&y[x]!==void 0&&(_=(c=y[x])-g),h===void 0||g===void 0||c===void 0){var R=this.getMeasuringContext();this._setTextStyles(R,i,!0)}return h===void 0&&(_=h=R.measureText(t).width,y[t]=h),g===void 0&&w&&o&&(g=R.measureText(o).width,y[o]=g),w&&c===void 0&&(c=R.measureText(x).width,y[x]=c,_=c-g),{width:h*I,kernedWidth:_*I}},getHeightOfChar:function(t,i){return this.getValueOfPropertyAt(t,i,"fontSize")},measureLine:function(t){var i=this._measureLine(t);return this.charSpacing!==0&&(i.width-=this._getWidthOfCharSpacing()),i.width<0&&(i.width=0),i},_measureLine:function(t){var i,o,f,h,c,g,_=0,y=this._textLines[t],x=new Array(y.length),w=0,I=this.path,R=this.pathSide==="right";for(this.__charBounds[t]=x,i=0;i<y.length;i++)o=y[i],h=this._getGraphemeBox(o,t,i,f),x[i]=h,_+=h.kernedWidth,f=o;if(x[i]={left:h?h.left+h.width:0,width:0,kernedWidth:0,height:this.fontSize},I){switch(g=I.segmentsInfo[I.segmentsInfo.length-1].length,(c=r.util.getPointOnPath(I.path,0,I.segmentsInfo)).x+=I.pathOffset.x,c.y+=I.pathOffset.y,this.textAlign){case"left":w=R?g-_:0;break;case"center":w=(g-_)/2;break;case"right":w=R?0:g-_}for(w+=this.pathStartOffset*(R?-1:1),i=R?y.length-1:0;R?i>=0:i<y.length;R?i--:i++)h=x[i],w>g?w%=g:w<0&&(w+=g),this._setGraphemeOnPath(w,h,c),w+=h.kernedWidth}return{width:_,numOfSpaces:0}},_setGraphemeOnPath:function(t,i,o){var f=t+i.kernedWidth/2,h=this.path,c=r.util.getPointOnPath(h.path,f,h.segmentsInfo);i.renderLeft=c.x-o.x,i.renderTop=c.y-o.y,i.angle=c.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(t,i,o,f,h){var c,g=this.getCompleteStyleDeclaration(i,o),_=f?this.getCompleteStyleDeclaration(i,o-1):{},y=this._measureChar(t,g,f,_),x=y.kernedWidth,w=y.width;this.charSpacing!==0&&(w+=c=this._getWidthOfCharSpacing(),x+=c);var I={width:w,left:0,height:g.fontSize,kernedWidth:x,deltaY:g.deltaY};if(o>0&&!h){var R=this.__charBounds[i][o-1];I.left=R.left+R.width+y.kernedWidth-y.width}return I},getHeightOfLine:function(t){if(this.__lineHeights[t])return this.__lineHeights[t];for(var i=this._textLines[t],o=this.getHeightOfChar(t,0),f=1,h=i.length;f<h;f++)o=Math.max(this.getHeightOfChar(t,f),o);return this.__lineHeights[t]=o*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var t,i=0,o=0,f=this._textLines.length;o<f;o++)t=this.getHeightOfLine(o),i+=o===f-1?t/this.lineHeight:t;return i},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(t,i){t.save();for(var o=0,f=this._getLeftOffset(),h=this._getTopOffset(),c=0,g=this._textLines.length;c<g;c++){var _=this.getHeightOfLine(c),y=_/this.lineHeight,x=this._getLineLeftOffset(c);this._renderTextLine(i,t,this._textLines[c],f+x,h+o+y,c),o+=_}t.restore()},_renderTextFill:function(t){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(t,"fillText")},_renderTextStroke:function(t){(this.stroke&&this.strokeWidth!==0||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())},_renderChars:function(t,i,o,f,h,c){var g,_,y,x,w,I=this.getHeightOfLine(c),R=this.textAlign.indexOf("justify")!==-1,U="",G=0,K=this.path,O=!R&&this.charSpacing===0&&this.isEmptyStyles(c)&&!K,D=this.direction==="ltr",E=this.direction==="ltr"?1:-1,F=i.canvas.getAttribute("dir");if(i.save(),F!==this.direction&&(i.canvas.setAttribute("dir",D?"ltr":"rtl"),i.direction=D?"ltr":"rtl",i.textAlign=D?"left":"right"),h-=I*this._fontSizeFraction/this.lineHeight,O)return this._renderChar(t,i,c,0,o.join(""),f,h,I),void i.restore();for(var k=0,W=o.length-1;k<=W;k++)x=k===W||this.charSpacing||K,U+=o[k],y=this.__charBounds[c][k],G===0?(f+=E*(y.kernedWidth-y.width),G+=y.width):G+=y.kernedWidth,R&&!x&&this._reSpaceAndTab.test(o[k])&&(x=!0),x||(g=g||this.getCompleteStyleDeclaration(c,k),_=this.getCompleteStyleDeclaration(c,k+1),x=this._hasStyleChanged(g,_)),x&&(K?(i.save(),i.translate(y.renderLeft,y.renderTop),i.rotate(y.angle),this._renderChar(t,i,c,k,U,-G/2,0,I),i.restore()):(w=f,this._renderChar(t,i,c,k,U,w,h,I)),U="",g=_,f+=E*G,G=0);i.restore()},_applyPatternGradientTransformText:function(t){var i,o=r.util.createCanvasElement(),f=this.width+this.strokeWidth,h=this.height+this.strokeWidth;return o.width=f,o.height=h,(i=o.getContext("2d")).beginPath(),i.moveTo(0,0),i.lineTo(f,0),i.lineTo(f,h),i.lineTo(0,h),i.closePath(),i.translate(f/2,h/2),i.fillStyle=t.toLive(i),this._applyPatternGradientTransform(i,t),i.fill(),i.createPattern(o,"no-repeat")},handleFiller:function(t,i,o){var f,h;return o.toLive?o.gradientUnits==="percentage"||o.gradientTransform||o.patternTransform?(f=-this.width/2,h=-this.height/2,t.translate(f,h),t[i]=this._applyPatternGradientTransformText(o),{offsetX:f,offsetY:h}):(t[i]=o.toLive(t,this),this._applyPatternGradientTransform(t,o)):(t[i]=o,{offsetX:0,offsetY:0})},_setStrokeStyles:function(t,i){return t.lineWidth=i.strokeWidth,t.lineCap=this.strokeLineCap,t.lineDashOffset=this.strokeDashOffset,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,this.handleFiller(t,"strokeStyle",i.stroke)},_setFillStyles:function(t,i){return this.handleFiller(t,"fillStyle",i.fill)},_renderChar:function(t,i,o,f,h,c,g){var _,y,x=this._getStyleDeclaration(o,f),w=this.getCompleteStyleDeclaration(o,f),I=t==="fillText"&&w.fill,R=t==="strokeText"&&w.stroke&&w.strokeWidth;(R||I)&&(i.save(),I&&(_=this._setFillStyles(i,w)),R&&(y=this._setStrokeStyles(i,w)),i.font=this._getFontDeclaration(w),x&&x.textBackgroundColor&&this._removeShadow(i),x&&x.deltaY&&(g+=x.deltaY),I&&i.fillText(h,c-_.offsetX,g-_.offsetY),R&&i.strokeText(h,c-y.offsetX,g-y.offsetY),i.restore())},setSuperscript:function(t,i){return this._setScript(t,i,this.superscript)},setSubscript:function(t,i){return this._setScript(t,i,this.subscript)},_setScript:function(t,i,o){var f=this.get2DCursorLocation(t,!0),h=this.getValueOfPropertyAt(f.lineIndex,f.charIndex,"fontSize"),c=this.getValueOfPropertyAt(f.lineIndex,f.charIndex,"deltaY"),g={fontSize:h*o.size,deltaY:c+h*o.baseline};return this.setSelectionStyles(g,t,i),this},_hasStyleChanged:function(t,i){return t.fill!==i.fill||t.stroke!==i.stroke||t.strokeWidth!==i.strokeWidth||t.fontSize!==i.fontSize||t.fontFamily!==i.fontFamily||t.fontWeight!==i.fontWeight||t.fontStyle!==i.fontStyle||t.deltaY!==i.deltaY},_hasStyleChangedForSvg:function(t,i){return this._hasStyleChanged(t,i)||t.overline!==i.overline||t.underline!==i.underline||t.linethrough!==i.linethrough},_getLineLeftOffset:function(t){var i=this.getLineWidth(t),o=this.width-i,f=this.textAlign,h=this.direction,c=0,g=this.isEndOfWrapping(t);return f==="justify"||f==="justify-center"&&!g||f==="justify-right"&&!g||f==="justify-left"&&!g?0:(f==="center"&&(c=o/2),f==="right"&&(c=o),f==="justify-center"&&(c=o/2),f==="justify-right"&&(c=o),h==="rtl"&&(c-=o),c)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var t=this._forceClearCache;return t||(t=this.hasStateChanged("_dimensionAffectingProps")),t&&(this.dirty=!0,this._forceClearCache=!1),t},getLineWidth:function(t){if(this.__lineWidths[t]!==void 0)return this.__lineWidths[t];var i=this.measureLine(t).width;return this.__lineWidths[t]=i,i},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(t,i,o){var f=this._getStyleDeclaration(t,i);return f&&f[o]!==void 0?f[o]:this[o]},_renderTextDecoration:function(t,i){if(this[i]||this.styleHas(i)){for(var o,f,h,c,g,_,y,x,w,I,R,U,G,K,O,D,E=this._getLeftOffset(),F=this._getTopOffset(),k=this.path,W=this._getWidthOfCharSpacing(),N=this.offsets[i],L=0,P=this._textLines.length;L<P;L++)if(o=this.getHeightOfLine(L),this[i]||this.styleHas(i,L)){y=this._textLines[L],K=o/this.lineHeight,c=this._getLineLeftOffset(L),I=0,R=0,x=this.getValueOfPropertyAt(L,0,i),D=this.getValueOfPropertyAt(L,0,"fill"),w=F+K*(1-this._fontSizeFraction),f=this.getHeightOfChar(L,0),g=this.getValueOfPropertyAt(L,0,"deltaY");for(var A=0,V=y.length;A<V;A++)if(U=this.__charBounds[L][A],G=this.getValueOfPropertyAt(L,A,i),O=this.getValueOfPropertyAt(L,A,"fill"),h=this.getHeightOfChar(L,A),_=this.getValueOfPropertyAt(L,A,"deltaY"),k&&G&&O)t.save(),t.fillStyle=D,t.translate(U.renderLeft,U.renderTop),t.rotate(U.angle),t.fillRect(-U.kernedWidth/2,N*h+_,U.kernedWidth,this.fontSize/15),t.restore();else if((G!==x||O!==D||h!==f||_!==g)&&R>0){var H=E+c+I;this.direction==="rtl"&&(H=this.width-H-R),x&&D&&(t.fillStyle=D,t.fillRect(H,w+N*f+g,R,this.fontSize/15)),I=U.left,R=U.width,x=G,D=O,f=h,g=_}else R+=U.kernedWidth;H=E+c+I,this.direction==="rtl"&&(H=this.width-H-R),t.fillStyle=O,G&&O&&t.fillRect(H,w+N*f+g,R-W,this.fontSize/15),F+=o}else F+=o;this._removeShadow(t)}},_getFontDeclaration:function(t,i){var o=t||this,f=this.fontFamily,h=r.Text.genericFonts.indexOf(f.toLowerCase())>-1,c=f===void 0||f.indexOf("'")>-1||f.indexOf(",")>-1||f.indexOf('"')>-1||h?o.fontFamily:'"'+o.fontFamily+'"';return[r.isLikelyNode?o.fontWeight:o.fontStyle,r.isLikelyNode?o.fontStyle:o.fontWeight,i?this.CACHE_FONT_SIZE+"px":o.fontSize+"px",c].join(" ")},render:function(t){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",t)))},_splitTextIntoLines:function(t){for(var i=t.split(this._reNewline),o=new Array(i.length),f=[`
`],h=[],c=0;c<i.length;c++)o[c]=r.util.string.graphemeSplit(i[c]),h=h.concat(o[c],f);return h.pop(),{_unwrappedLines:o,lines:i,graphemeText:h,graphemeLines:o}},toObject:function(t){var i=l.concat(t),o=this.callSuper("toObject",i);return o.styles=n(this.styles,!0),o.path&&(o.path=this.path.toObject()),o},set:function(t,i){this.callSuper("set",t,i);var o=!1,f=!1;if(typeof t=="object")for(var h in t)h==="path"&&this.setPathInfo(),o=o||this._dimensionAffectingProps.indexOf(h)!==-1,f=f||h==="path";else o=this._dimensionAffectingProps.indexOf(t)!==-1,f=t==="path";return f&&this.setPathInfo(),o&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),r.Text.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),r.Text.DEFAULT_SVG_FONT_SIZE=16,r.Text.fromElement=function(t,i,o){if(!t)return i(null);var f=r.parseAttributes(t,r.Text.ATTRIBUTE_NAMES),h=f.textAnchor||"left";if((o=r.util.object.extend(o?n(o):{},f)).top=o.top||0,o.left=o.left||0,f.textDecoration){var c=f.textDecoration;c.indexOf("underline")!==-1&&(o.underline=!0),c.indexOf("overline")!==-1&&(o.overline=!0),c.indexOf("line-through")!==-1&&(o.linethrough=!0),delete o.textDecoration}"dx"in f&&(o.left+=f.dx),"dy"in f&&(o.top+=f.dy),"fontSize"in o||(o.fontSize=r.Text.DEFAULT_SVG_FONT_SIZE);var g="";"textContent"in t?g=t.textContent:"firstChild"in t&&t.firstChild!==null&&"data"in t.firstChild&&t.firstChild.data!==null&&(g=t.firstChild.data),g=g.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var _=o.strokeWidth;o.strokeWidth=0;var y=new r.Text(g,o),x=y.getScaledHeight()/y.height,w=((y.height+y.strokeWidth)*y.lineHeight-y.height)*x,I=y.getScaledHeight()+w,R=0;h==="center"&&(R=y.getScaledWidth()/2),h==="right"&&(R=y.getScaledWidth()),y.set({left:y.left-R,top:y.top-(I-y.fontSize*(.07+y._fontSizeFraction))/y.lineHeight,strokeWidth:_!==void 0?_:1}),i(y)},r.Text.fromObject=function(t,i){var o=n(t),f=t.path;return delete o.path,r.Object._fromObject("Text",o,function(h){f?r.Object._fromObject("Path",f,function(c){h.set("path",c),i(h)},"path"):i(h)},"text")},r.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],r.util.createAccessors&&r.util.createAccessors(r.Text)}}(e),m.util.object.extend(m.Text.prototype,{isEmptyStyles:function(s){if(!this.styles||s!==void 0&&!this.styles[s])return!0;var r=s===void 0?this.styles:{line:this.styles[s]};for(var n in r)for(var l in r[n])for(var t in r[n][l])return!1;return!0},styleHas:function(s,r){if(!this.styles||!s||s===""||r!==void 0&&!this.styles[r])return!1;var n=r===void 0?this.styles:{0:this.styles[r]};for(var l in n)for(var t in n[l])if(n[l][t][s]!==void 0)return!0;return!1},cleanStyle:function(s){if(!this.styles||!s||s==="")return!1;var r,n,l=this.styles,t=0,i=!0,o=0;for(var f in l){for(var h in r=0,l[f]){var c;t++,(c=l[f][h]).hasOwnProperty(s)?(n?c[s]!==n&&(i=!1):n=c[s],c[s]===this[s]&&delete c[s]):i=!1,Object.keys(c).length!==0?r++:delete l[f][h]}r===0&&delete l[f]}for(var g=0;g<this._textLines.length;g++)o+=this._textLines[g].length;i&&t===o&&(this[s]=n,this.removeStyle(s))},removeStyle:function(s){if(this.styles&&s&&s!==""){var r,n,l,t=this.styles;for(n in t){for(l in r=t[n])delete r[l][s],Object.keys(r[l]).length===0&&delete r[l];Object.keys(r).length===0&&delete t[n]}}},_extendStyles:function(s,r){var n=this.get2DCursorLocation(s);this._getLineStyle(n.lineIndex)||this._setLineStyle(n.lineIndex),this._getStyleDeclaration(n.lineIndex,n.charIndex)||this._setStyleDeclaration(n.lineIndex,n.charIndex,{}),m.util.object.extend(this._getStyleDeclaration(n.lineIndex,n.charIndex),r)},get2DCursorLocation:function(s,r){s===void 0&&(s=this.selectionStart);for(var n=r?this._unwrappedTextLines:this._textLines,l=n.length,t=0;t<l;t++){if(s<=n[t].length)return{lineIndex:t,charIndex:s};s-=n[t].length+this.missingNewlineOffset(t)}return{lineIndex:t-1,charIndex:n[t-1].length<s?n[t-1].length:s}},getSelectionStyles:function(s,r,n){s===void 0&&(s=this.selectionStart||0),r===void 0&&(r=this.selectionEnd||s);for(var l=[],t=s;t<r;t++)l.push(this.getStyleAtPosition(t,n));return l},getStyleAtPosition:function(s,r){var n=this.get2DCursorLocation(s);return(r?this.getCompleteStyleDeclaration(n.lineIndex,n.charIndex):this._getStyleDeclaration(n.lineIndex,n.charIndex))||{}},setSelectionStyles:function(s,r,n){r===void 0&&(r=this.selectionStart||0),n===void 0&&(n=this.selectionEnd||r);for(var l=r;l<n;l++)this._extendStyles(l,s);return this._forceClearCache=!0,this},_getStyleDeclaration:function(s,r){var n=this.styles&&this.styles[s];return n?n[r]:null},getCompleteStyleDeclaration:function(s,r){for(var n,l=this._getStyleDeclaration(s,r)||{},t={},i=0;i<this._styleProperties.length;i++)t[n=this._styleProperties[i]]=l[n]===void 0?this[n]:l[n];return t},_setStyleDeclaration:function(s,r,n){this.styles[s][r]=n},_deleteStyleDeclaration:function(s,r){delete this.styles[s][r]},_getLineStyle:function(s){return!!this.styles[s]},_setLineStyle:function(s){this.styles[s]={}},_deleteLineStyle:function(s){delete this.styles[s]}}),function(){function s(r){r.textDecoration&&(r.textDecoration.indexOf("underline")>-1&&(r.underline=!0),r.textDecoration.indexOf("line-through")>-1&&(r.linethrough=!0),r.textDecoration.indexOf("overline")>-1&&(r.overline=!0),delete r.textDecoration)}m.IText=m.util.createClass(m.Text,m.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(r,n){this.callSuper("initialize",r,n),this.initBehavior()},setSelectionStart:function(r){r=Math.max(r,0),this._updateAndFire("selectionStart",r)},setSelectionEnd:function(r){r=Math.min(r,this.text.length),this._updateAndFire("selectionEnd",r)},_updateAndFire:function(r,n){this[r]!==n&&(this._fireSelectionChanged(),this[r]=n),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(r){this.clearContextTop(),this.callSuper("render",r),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(r){this.callSuper("_render",r)},clearContextTop:function(r){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var n=this.canvas.contextTop,l=this.canvas.viewportTransform;n.save(),n.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this.transform(n),this._clearTextArea(n),r||n.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var r=this._getCursorBoundaries(),n=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(r,n):this.renderSelection(r,n),n.restore()}},_clearTextArea:function(r){var n=this.width+4,l=this.height+4;r.clearRect(-n/2,-l/2,n,l)},_getCursorBoundaries:function(r){r===void 0&&(r=this.selectionStart);var n=this._getLeftOffset(),l=this._getTopOffset(),t=this._getCursorBoundariesOffsets(r);return{left:n,top:l,leftOffset:t.left,topOffset:t.top}},_getCursorBoundariesOffsets:function(r){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var n,l,t,i,o=0,f=0,h=this.get2DCursorLocation(r);t=h.charIndex,l=h.lineIndex;for(var c=0;c<l;c++)o+=this.getHeightOfLine(c);n=this._getLineLeftOffset(l);var g=this.__charBounds[l][t];return g&&(f=g.left),this.charSpacing!==0&&t===this._textLines[l].length&&(f-=this._getWidthOfCharSpacing()),i={top:o,left:n+(f>0?f:0)},this.direction==="rtl"&&(i.left*=-1),this.cursorOffsetCache=i,this.cursorOffsetCache},renderCursor:function(r,n){var l=this.get2DCursorLocation(),t=l.lineIndex,i=l.charIndex>0?l.charIndex-1:0,o=this.getValueOfPropertyAt(t,i,"fontSize"),f=this.scaleX*this.canvas.getZoom(),h=this.cursorWidth/f,c=r.topOffset,g=this.getValueOfPropertyAt(t,i,"deltaY");c+=(1-this._fontSizeFraction)*this.getHeightOfLine(t)/this.lineHeight-o*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(r,n),n.fillStyle=this.cursorColor||this.getValueOfPropertyAt(t,i,"fill"),n.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,n.fillRect(r.left+r.leftOffset-h/2,c+r.top+g,h,o)},renderSelection:function(r,n){for(var l=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,t=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,i=this.textAlign.indexOf("justify")!==-1,o=this.get2DCursorLocation(l),f=this.get2DCursorLocation(t),h=o.lineIndex,c=f.lineIndex,g=o.charIndex<0?0:o.charIndex,_=f.charIndex<0?0:f.charIndex,y=h;y<=c;y++){var x,w=this._getLineLeftOffset(y)||0,I=this.getHeightOfLine(y),R=0,U=0;if(y===h&&(R=this.__charBounds[h][g].left),y>=h&&y<c)U=i&&!this.isEndOfWrapping(y)?this.width:this.getLineWidth(y)||5;else if(y===c)if(_===0)U=this.__charBounds[c][_].left;else{var G=this._getWidthOfCharSpacing();U=this.__charBounds[c][_-1].left+this.__charBounds[c][_-1].width-G}x=I,(this.lineHeight<1||y===c&&this.lineHeight>1)&&(I/=this.lineHeight);var K=r.left+w+R,O=U-R,D=I,E=0;this.inCompositionMode?(n.fillStyle=this.compositionColor||"black",D=1,E=I):n.fillStyle=this.selectionColor,this.direction==="rtl"&&(K=this.width-K-O),n.fillRect(K,r.top+r.topOffset+E,O,D),r.topOffset+=x}},getCurrentCharFontSize:function(){var r=this._getCurrentCharIndex();return this.getValueOfPropertyAt(r.l,r.c,"fontSize")},getCurrentCharColor:function(){var r=this._getCurrentCharIndex();return this.getValueOfPropertyAt(r.l,r.c,"fill")},_getCurrentCharIndex:function(){var r=this.get2DCursorLocation(this.selectionStart,!0),n=r.charIndex>0?r.charIndex-1:0;return{l:r.lineIndex,c:n}}}),m.IText.fromObject=function(r,n){if(s(r),r.styles)for(var l in r.styles)for(var t in r.styles[l])s(r.styles[l][t]);m.Object._fromObject("IText",r,n,"text")}}(),mt=m.util.object.clone,m.util.object.extend(m.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var s=this;this.on("added",function(){var r=s.canvas;r&&(r._hasITextHandlers||(r._hasITextHandlers=!0,s._initCanvasHandlers(r)),r._iTextInstances=r._iTextInstances||[],r._iTextInstances.push(s))})},initRemovedHandler:function(){var s=this;this.on("removed",function(){var r=s.canvas;r&&(r._iTextInstances=r._iTextInstances||[],m.util.removeFromArray(r._iTextInstances,s),r._iTextInstances.length===0&&(r._hasITextHandlers=!1,s._removeCanvasHandlers(r)))})},_initCanvasHandlers:function(s){s._mouseUpITextHandler=function(){s._iTextInstances&&s._iTextInstances.forEach(function(r){r.__isMousedown=!1})},s.on("mouse:up",s._mouseUpITextHandler)},_removeCanvasHandlers:function(s){s.off("mouse:up",s._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(s,r,n,l){var t;return t={isAborted:!1,abort:function(){this.isAborted=!0}},s.animate("_currentCursorOpacity",r,{duration:n,onComplete:function(){t.isAborted||s[l]()},onChange:function(){s.canvas&&s.selectionStart===s.selectionEnd&&s.renderCursorOrSelection()},abort:function(){return t.isAborted}}),t},_onTickComplete:function(){var s=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){s._currentTickCompleteState=s._animateCursor(s,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(s){var r=this,n=s?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){r._tick()},n)},abortCursorAnimation:function(){var s=this._currentTickState||this._currentTickCompleteState,r=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,s&&r&&r.clearContext(r.contextTop||r.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(s){var r=0,n=s-1;if(this._reSpace.test(this._text[n]))for(;this._reSpace.test(this._text[n]);)r++,n--;for(;/\S/.test(this._text[n])&&n>-1;)r++,n--;return s-r},findWordBoundaryRight:function(s){var r=0,n=s;if(this._reSpace.test(this._text[n]))for(;this._reSpace.test(this._text[n]);)r++,n++;for(;/\S/.test(this._text[n])&&n<this._text.length;)r++,n++;return s+r},findLineBoundaryLeft:function(s){for(var r=0,n=s-1;!/\n/.test(this._text[n])&&n>-1;)r++,n--;return s-r},findLineBoundaryRight:function(s){for(var r=0,n=s;!/\n/.test(this._text[n])&&n<this._text.length;)r++,n++;return s+r},searchWordBoundary:function(s,r){for(var n=this._text,l=this._reSpace.test(n[s])?s-1:s,t=n[l],i=m.reNonWord;!i.test(t)&&l>0&&l<n.length;)t=n[l+=r];return i.test(t)&&(l+=r===1?0:1),l},selectWord:function(s){s=s||this.selectionStart;var r=this.searchWordBoundary(s,-1),n=this.searchWordBoundary(s,1);this.selectionStart=r,this.selectionEnd=n,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(s){s=s||this.selectionStart;var r=this.findLineBoundaryLeft(s),n=this.findLineBoundaryRight(s);return this.selectionStart=r,this.selectionEnd=n,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(s){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(s),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(s){s._iTextInstances&&s._iTextInstances.forEach(function(r){r.selected=!1,r.isEditing&&r.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(s){if(this.__isMousedown&&this.isEditing){var r=this.getSelectionStartFromPointer(s.e),n=this.selectionStart,l=this.selectionEnd;(r===this.__selectionStartOnMouseDown&&n!==l||n!==r&&l!==r)&&(r>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=r):(this.selectionStart=r,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===n&&this.selectionEnd===l||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(s,r,n){var l=n.slice(0,s),t=m.util.string.graphemeSplit(l).length;if(s===r)return{selectionStart:t,selectionEnd:t};var i=n.slice(s,r);return{selectionStart:t,selectionEnd:t+m.util.string.graphemeSplit(i).length}},fromGraphemeToStringSelection:function(s,r,n){var l=n.slice(0,s).join("").length;return s===r?{selectionStart:l,selectionEnd:l}:{selectionStart:l,selectionEnd:l+n.slice(s,r).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var s=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=s.selectionStart,this.hiddenTextarea.selectionEnd=s.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var s=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=s.selectionEnd,this.inCompositionMode||(this.selectionStart=s.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var s=this._calcTextareaPosition();this.hiddenTextarea.style.left=s.left,this.hiddenTextarea.style.top=s.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var s=this.inCompositionMode?this.compositionStart:this.selectionStart,r=this._getCursorBoundaries(s),n=this.get2DCursorLocation(s),l=n.lineIndex,t=n.charIndex,i=this.getValueOfPropertyAt(l,t,"fontSize")*this.lineHeight,o=r.leftOffset,f=this.calcTransformMatrix(),h={x:r.left+o,y:r.top+r.topOffset+i},c=this.canvas.getRetinaScaling(),g=this.canvas.upperCanvasEl,_=g.width/c,y=g.height/c,x=_-i,w=y-i,I=g.clientWidth/_,R=g.clientHeight/y;return h=m.util.transformPoint(h,f),(h=m.util.transformPoint(h,this.canvas.viewportTransform)).x*=I,h.y*=R,h.x<0&&(h.x=0),h.x>x&&(h.x=x),h.y<0&&(h.y=0),h.y>w&&(h.y=w),h.x+=this.canvas._offset.left,h.y+=this.canvas._offset.top,{left:h.x+"px",top:h.y+"px",fontSize:i+"px",charHeight:i}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var s=this._textBeforeEdit!==this.text,r=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,r&&(r.blur&&r.blur(),r.parentNode&&r.parentNode.removeChild(r)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),s&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),s&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var s in this.styles)this._textLines[s]||delete this.styles[s]},removeStyleFromTo:function(s,r){var n,l,t=this.get2DCursorLocation(s,!0),i=this.get2DCursorLocation(r,!0),o=t.lineIndex,f=t.charIndex,h=i.lineIndex,c=i.charIndex;if(o!==h){if(this.styles[o])for(n=f;n<this._unwrappedTextLines[o].length;n++)delete this.styles[o][n];if(this.styles[h])for(n=c;n<this._unwrappedTextLines[h].length;n++)(l=this.styles[h][n])&&(this.styles[o]||(this.styles[o]={}),this.styles[o][f+n-c]=l);for(n=o+1;n<=h;n++)delete this.styles[n];this.shiftLineStyles(h,o-h)}else if(this.styles[o]){l=this.styles[o];var g,_,y=c-f;for(n=f;n<c;n++)delete l[n];for(_ in this.styles[o])(g=parseInt(_,10))>=c&&(l[g-y]=l[_],delete l[_])}},shiftLineStyles:function(s,r){var n=mt(this.styles);for(var l in this.styles){var t=parseInt(l,10);t>s&&(this.styles[t+r]=n[t],n[t-r]||delete this.styles[t])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(s,r,n,l){var t,i={},o=!1,f=this._unwrappedTextLines[s].length===r;for(var h in n||(n=1),this.shiftLineStyles(s,n),this.styles[s]&&(t=this.styles[s][r===0?r:r-1]),this.styles[s]){var c=parseInt(h,10);c>=r&&(o=!0,i[c-r]=this.styles[s][h],f&&r===0||delete this.styles[s][h])}var g=!1;for(o&&!f&&(this.styles[s+n]=i,g=!0),g&&n--;n>0;)l&&l[n-1]?this.styles[s+n]={0:mt(l[n-1])}:t?this.styles[s+n]={0:mt(t)}:delete this.styles[s+n],n--;this._forceClearCache=!0},insertCharStyleObject:function(s,r,n,l){this.styles||(this.styles={});var t=this.styles[s],i=t?mt(t):{};for(var o in n||(n=1),i){var f=parseInt(o,10);f>=r&&(t[f+n]=i[f],i[f-n]||delete t[f])}if(this._forceClearCache=!0,l)for(;n--;)Object.keys(l[n]).length&&(this.styles[s]||(this.styles[s]={}),this.styles[s][r+n]=mt(l[n]));else if(t)for(var h=t[r?r-1:1];h&&n--;)this.styles[s][r+n]=mt(h)},insertNewStyleBlock:function(s,r,n){for(var l=this.get2DCursorLocation(r,!0),t=[0],i=0,o=0;o<s.length;o++)s[o]===`
`?t[++i]=0:t[i]++;for(t[0]>0&&(this.insertCharStyleObject(l.lineIndex,l.charIndex,t[0],n),n=n&&n.slice(t[0]+1)),i&&this.insertNewlineStyleObject(l.lineIndex,l.charIndex+t[0],i),o=1;o<i;o++)t[o]>0?this.insertCharStyleObject(l.lineIndex+o,0,t[o],n):n&&this.styles[l.lineIndex+o]&&n[0]&&(this.styles[l.lineIndex+o][0]=n[0]),n=n&&n.slice(t[o]+1);t[o]>0&&this.insertCharStyleObject(l.lineIndex+o,0,t[o],n)},setSelectionStartEndWithShift:function(s,r,n){n<=s?(r===s?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=s),this.selectionStart=n):n>s&&n<r?this._selectionDirection==="right"?this.selectionEnd=n:this.selectionStart=n:(r===s?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=r),this.selectionEnd=n)},setSelectionInBoundaries:function(){var s=this.text.length;this.selectionStart>s?this.selectionStart=s:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>s?this.selectionEnd=s:this.selectionEnd<0&&(this.selectionEnd=0)}}),m.util.object.extend(m.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(s){if(this.canvas){this.__newClickTime=+new Date;var r=s.pointer;this.isTripleClick(r)&&(this.fire("tripleclick",s),this._stopEvent(s.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=r,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(s){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===s.x&&this.__lastPointer.y===s.y},_stopEvent:function(s){s.preventDefault&&s.preventDefault(),s.stopPropagation&&s.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(s){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(s.e))},tripleClickHandler:function(s){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(s.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(s){!this.canvas||!this.editable||s.e.button&&s.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(s.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(s){!this.canvas||!this.editable||s.e.button&&s.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(s){if(this.__isMousedown=!1,!(!this.editable||this.group||s.transform&&s.transform.actionPerformed||s.e.button&&s.e.button!==1)){if(this.canvas){var r=this.canvas._activeObject;if(r&&r!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(s.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(s){var r=this.getSelectionStartFromPointer(s),n=this.selectionStart,l=this.selectionEnd;s.shiftKey?this.setSelectionStartEndWithShift(n,l,r):(this.selectionStart=r,this.selectionEnd=r),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(s){for(var r,n=this.getLocalPointer(s),l=0,t=0,i=0,o=0,f=0,h=0,c=this._textLines.length;h<c&&i<=n.y;h++)i+=this.getHeightOfLine(h)*this.scaleY,f=h,h>0&&(o+=this._textLines[h-1].length+this.missingNewlineOffset(h-1));t=this._getLineLeftOffset(f)*this.scaleX,r=this._textLines[f],this.direction==="rtl"&&(n.x=this.width*this.scaleX-n.x+t);for(var g=0,_=r.length;g<_&&(l=t,(t+=this.__charBounds[f][g].kernedWidth*this.scaleX)<=n.x);g++)o++;return this._getNewSelectionStartFromOffset(n,l,t,o,_)},_getNewSelectionStartFromOffset:function(s,r,n,l,t){var i=s.x-r,o=n-s.x,f=l+(o>i||o<0?0:1);return this.flipX&&(f=t-f),f>this._text.length&&(f=this._text.length),f}}),m.util.object.extend(m.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=m.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var s=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+s.top+"; left: "+s.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; paddingtop: "+s.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):m.document.body.appendChild(this.hiddenTextarea),m.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),m.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),m.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),m.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),m.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),m.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),m.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),m.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),m.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(m.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(s){if(this.isEditing){var r=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(s.keyCode in r)this[r[s.keyCode]](s);else{if(!(s.keyCode in this.ctrlKeysMapDown)||!s.ctrlKey&&!s.metaKey)return;this[this.ctrlKeysMapDown[s.keyCode]](s)}s.stopImmediatePropagation(),s.preventDefault(),s.keyCode>=33&&s.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(s){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:s.keyCode in this.ctrlKeysMapUp&&(s.ctrlKey||s.metaKey)&&(this[this.ctrlKeysMapUp[s.keyCode]](s),s.stopImmediatePropagation(),s.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(s){var r=this.fromPaste;if(this.fromPaste=!1,s&&s.stopPropagation(),this.isEditing){var n,l,t,i,o,f=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,h=this._text.length,c=f.length,g=c-h,_=this.selectionStart,y=this.selectionEnd,x=_!==y;if(this.hiddenTextarea.value==="")return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var w=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),I=_>w.selectionStart;x?(n=this._text.slice(_,y),g+=y-_):c<h&&(n=I?this._text.slice(y+g,y):this._text.slice(_,_-g)),l=f.slice(w.selectionEnd-g,w.selectionEnd),n&&n.length&&(l.length&&(t=this.getSelectionStyles(_,_+1,!1),t=l.map(function(){return t[0]})),x?(i=_,o=y):I?(i=y-n.length,o=y):(i=y,o=y+n.length),this.removeStyleFromTo(i,o)),l.length&&(r&&l.join("")===m.copiedText&&!m.disableStyleCopyPaste&&(t=m.copiedTextStyle),this.insertNewStyleBlock(l,_,t)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(s){this.compositionStart=s.target.selectionStart,this.compositionEnd=s.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(m.copiedText=this.getSelectedText(),m.disableStyleCopyPaste?m.copiedTextStyle=null:m.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(s){return s&&s.clipboardData||m.window.clipboardData},_getWidthBeforeCursor:function(s,r){var n,l=this._getLineLeftOffset(s);return r>0&&(l+=(n=this.__charBounds[s][r-1]).left+n.width),l},getDownCursorOffset:function(s,r){var n=this._getSelectionForOffset(s,r),l=this.get2DCursorLocation(n),t=l.lineIndex;if(t===this._textLines.length-1||s.metaKey||s.keyCode===34)return this._text.length-n;var i=l.charIndex,o=this._getWidthBeforeCursor(t,i),f=this._getIndexOnLine(t+1,o);return this._textLines[t].slice(i).length+f+1+this.missingNewlineOffset(t)},_getSelectionForOffset:function(s,r){return s.shiftKey&&this.selectionStart!==this.selectionEnd&&r?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(s,r){var n=this._getSelectionForOffset(s,r),l=this.get2DCursorLocation(n),t=l.lineIndex;if(t===0||s.metaKey||s.keyCode===33)return-n;var i=l.charIndex,o=this._getWidthBeforeCursor(t,i),f=this._getIndexOnLine(t-1,o),h=this._textLines[t].slice(0,i),c=this.missingNewlineOffset(t-1);return-this._textLines[t-1].length+f-h.length+(1-c)},_getIndexOnLine:function(s,r){for(var n,l,t=this._textLines[s],i=this._getLineLeftOffset(s),o=0,f=0,h=t.length;f<h;f++)if((i+=n=this.__charBounds[s][f].width)>r){l=!0;var c=i-n,g=i,_=Math.abs(c-r);o=Math.abs(g-r)<_?f:f-1;break}return l||(o=t.length-1),o},moveCursorDown:function(s){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",s)},moveCursorUp:function(s){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",s)},_moveCursorUpOrDown:function(s,r){var n=this["get"+s+"CursorOffset"](r,this._selectionDirection==="right");r.shiftKey?this.moveCursorWithShift(n):this.moveCursorWithoutShift(n),n!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(s){var r=this._selectionDirection==="left"?this.selectionStart+s:this.selectionEnd+s;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,r),s!==0},moveCursorWithoutShift:function(s){return s<0?(this.selectionStart+=s,this.selectionEnd=this.selectionStart):(this.selectionEnd+=s,this.selectionStart=this.selectionEnd),s!==0},moveCursorLeft:function(s){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",s)},_move:function(s,r,n){var l;if(s.altKey)l=this["findWordBoundary"+n](this[r]);else{if(!s.metaKey&&s.keyCode!==35&&s.keyCode!==36)return this[r]+=n==="Left"?-1:1,!0;l=this["findLineBoundary"+n](this[r])}if(typeof l!==void 0&&this[r]!==l)return this[r]=l,!0},_moveLeft:function(s,r){return this._move(s,r,"Left")},_moveRight:function(s,r){return this._move(s,r,"Right")},moveCursorLeftWithoutShift:function(s){var r=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(r=this._moveLeft(s,"selectionStart")),this.selectionEnd=this.selectionStart,r},moveCursorLeftWithShift:function(s){return this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd?this._moveLeft(s,"selectionEnd"):this.selectionStart!==0?(this._selectionDirection="left",this._moveLeft(s,"selectionStart")):void 0},moveCursorRight:function(s){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",s)},_moveCursorLeftOrRight:function(s,r){var n="moveCursor"+s+"With";this._currentCursorOpacity=1,r.shiftKey?n+="Shift":n+="outShift",this[n](r)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(s){return this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd?this._moveRight(s,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(s,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(s){var r=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(r=this._moveRight(s,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,r},removeChars:function(s,r){r===void 0&&(r=s+1),this.removeStyleFromTo(s,r),this._text.splice(s,r-s),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(s,r,n,l){l===void 0&&(l=n),l>n&&this.removeStyleFromTo(n,l);var t=m.util.string.graphemeSplit(s);this.insertNewStyleBlock(t,n,r),this._text=[].concat(this._text.slice(0,n),t,this._text.slice(l)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var s=m.util.toFixed,r=/  +/g;m.util.object.extend(m.Text.prototype,{_toSVG:function(){var n=this._getSVGLeftTopOffsets(),l=this._getSVGTextAndBg(n.textTop,n.textLeft);return this._wrapSVGTextAndBg(l)},toSVG:function(n){return this._createBaseSVGMarkup(this._toSVG(),{reviver:n,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(n){var l=this.getSvgTextDecoration(this);return[n.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",l?'text-decoration="'+l+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",n.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(n,l){var t,i=[],o=[],f=n;this._setSVGBg(o);for(var h=0,c=this._textLines.length;h<c;h++)t=this._getLineLeftOffset(h),(this.textBackgroundColor||this.styleHas("textBackgroundColor",h))&&this._setSVGTextLineBg(o,h,l+t,f),this._setSVGTextLineText(i,h,l+t,f),f+=this.getHeightOfLine(h);return{textSpans:i,textBgRects:o}},_createTextCharSpan:function(n,l,t,i){var o=n!==n.trim()||n.match(r),f=this.getSvgSpanStyles(l,o),h=f?'style="'+f+'"':"",c=l.deltaY,g="",_=m.Object.NUM_FRACTION_DIGITS;return c&&(g=' dy="'+s(c,_)+'" '),['<tspan x="',s(t,_),'" y="',s(i,_),'" ',g,h,">",m.util.string.escapeXml(n),"</tspan>"].join("")},_setSVGTextLineText:function(n,l,t,i){var o,f,h,c,g,_=this.getHeightOfLine(l),y=this.textAlign.indexOf("justify")!==-1,x="",w=0,I=this._textLines[l];i+=_*(1-this._fontSizeFraction)/this.lineHeight;for(var R=0,U=I.length-1;R<=U;R++)g=R===U||this.charSpacing,x+=I[R],h=this.__charBounds[l][R],w===0?(t+=h.kernedWidth-h.width,w+=h.width):w+=h.kernedWidth,y&&!g&&this._reSpaceAndTab.test(I[R])&&(g=!0),g||(o=o||this.getCompleteStyleDeclaration(l,R),f=this.getCompleteStyleDeclaration(l,R+1),g=this._hasStyleChangedForSvg(o,f)),g&&(c=this._getStyleDeclaration(l,R)||{},n.push(this._createTextCharSpan(x,c,t,i)),x="",o=f,t+=w,w=0)},_pushTextBgRect:function(n,l,t,i,o,f){var h=m.Object.NUM_FRACTION_DIGITS;n.push("		<rect ",this._getFillAttributes(l),' x="',s(t,h),'" y="',s(i,h),'" width="',s(o,h),'" height="',s(f,h),`"></rect>
`)},_setSVGTextLineBg:function(n,l,t,i){for(var o,f,h=this._textLines[l],c=this.getHeightOfLine(l)/this.lineHeight,g=0,_=0,y=this.getValueOfPropertyAt(l,0,"textBackgroundColor"),x=0,w=h.length;x<w;x++)o=this.__charBounds[l][x],(f=this.getValueOfPropertyAt(l,x,"textBackgroundColor"))!==y?(y&&this._pushTextBgRect(n,y,t+_,i,g,c),_=o.left,g=o.width,y=f):g+=o.kernedWidth;f&&this._pushTextBgRect(n,f,t+_,i,g,c)},_getFillAttributes:function(n){var l=n&&typeof n=="string"?new m.Color(n):"";return l&&l.getSource()&&l.getAlpha()!==1?'opacity="'+l.getAlpha()+'" fill="'+l.setAlpha(1).toRgb()+'"':'fill="'+n+'"'},_getSVGLineTopOffset:function(n){for(var l,t=0,i=0;i<n;i++)t+=this.getHeightOfLine(i);return l=this.getHeightOfLine(i),{lineTop:t,offset:(this._fontSizeMult-this._fontSizeFraction)*l/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(n){return m.Object.prototype.getSvgStyles.call(this,n)+" white-space: pre;"}})}(),function(s){var r=s.fabric||(s.fabric={});r.Textbox=r.util.createClass(r.IText,r.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:r.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(n){for(var l=0,t=0,i=0,o={},f=0;f<n.graphemeLines.length;f++)n.graphemeText[i]===`
`&&f>0?(t=0,i++,l++):!this.splitByGrapheme&&this._reSpaceAndTab.test(n.graphemeText[i])&&f>0&&(t++,i++),o[f]={line:l,offset:t},i+=n.graphemeLines[f].length,t+=n.graphemeLines[f].length;return o},styleHas:function(n,l){if(this._styleMap&&!this.isWrapping){var t=this._styleMap[l];t&&(l=t.line)}return r.Text.prototype.styleHas.call(this,n,l)},isEmptyStyles:function(n){if(!this.styles)return!0;var l,t,i=0,o=!1,f=this._styleMap[n],h=this._styleMap[n+1];for(var c in f&&(n=f.line,i=f.offset),h&&(o=h.line===n,l=h.offset),t=n===void 0?this.styles:{line:this.styles[n]})for(var g in t[c])if(g>=i&&(!o||g<l))for(var _ in t[c][g])return!1;return!0},_getStyleDeclaration:function(n,l){if(this._styleMap&&!this.isWrapping){var t=this._styleMap[n];if(!t)return null;n=t.line,l=t.offset+l}return this.callSuper("_getStyleDeclaration",n,l)},_setStyleDeclaration:function(n,l,t){var i=this._styleMap[n];n=i.line,l=i.offset+l,this.styles[n][l]=t},_deleteStyleDeclaration:function(n,l){var t=this._styleMap[n];n=t.line,l=t.offset+l,delete this.styles[n][l]},_getLineStyle:function(n){var l=this._styleMap[n];return!!this.styles[l.line]},_setLineStyle:function(n){var l=this._styleMap[n];this.styles[l.line]={}},_wrapText:function(n,l){var t,i=[];for(this.isWrapping=!0,t=0;t<n.length;t++)i=i.concat(this._wrapLine(n[t],t,l));return this.isWrapping=!1,i},_measureWord:function(n,l,t){var i,o=0;t=t||0;for(var f=0,h=n.length;f<h;f++)o+=this._getGraphemeBox(n[f],l,f+t,i,!0).kernedWidth,i=n[f];return o},_wrapLine:function(n,l,t,i){var o=0,f=this.splitByGrapheme,h=[],c=[],g=f?r.util.string.graphemeSplit(n):n.split(this._wordJoiners),_="",y=0,x=f?"":" ",w=0,I=0,R=0,U=!0,G=this._getWidthOfCharSpacing();i=i||0,g.length===0&&g.push([]),t-=i;for(var K=0;K<g.length;K++)_=f?g[K]:r.util.string.graphemeSplit(g[K]),w=this._measureWord(_,l,y),y+=_.length,(o+=I+w-G)>t&&!U?(h.push(c),c=[],o=w,U=!0):o+=G,U||f||c.push(x),c=c.concat(_),I=f?0:this._measureWord([x],l,y),y++,U=!1,w>R&&(R=w);return K&&h.push(c),R+i>this.dynamicMinWidth&&(this.dynamicMinWidth=R-G+i),h},isEndOfWrapping:function(n){return!this._styleMap[n+1]||this._styleMap[n+1].line!==this._styleMap[n].line},missingNewlineOffset:function(n){return this.splitByGrapheme?this.isEndOfWrapping(n)?1:0:1},_splitTextIntoLines:function(n){for(var l=r.Text.prototype._splitTextIntoLines.call(this,n),t=this._wrapText(l.lines,this.width),i=new Array(t.length),o=0;o<t.length;o++)i[o]=t[o].join("");return l.lines=i,l.graphemeLines=t,l},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var n={};for(var l in this._styleMap)this._textLines[l]&&(n[this._styleMap[l].line]=1);for(var l in this.styles)n[l]||delete this.styles[l]},toObject:function(n){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(n))}}),r.Textbox.fromObject=function(n,l){return r.Object._fromObject("Textbox",n,l,"text")}}(e),function(){var s=m.controlsUtils,r=s.scaleSkewCursorStyleHandler,n=s.scaleCursorStyleHandler,l=s.scalingEqually,t=s.scalingYOrSkewingX,i=s.scalingXOrSkewingY,o=s.scaleOrSkewActionName,f=m.Object.prototype.controls;if(f.ml=new m.Control({x:-.5,y:0,cursorStyleHandler:r,actionHandler:i,getActionName:o}),f.mr=new m.Control({x:.5,y:0,cursorStyleHandler:r,actionHandler:i,getActionName:o}),f.mb=new m.Control({x:0,y:.5,cursorStyleHandler:r,actionHandler:t,getActionName:o}),f.mt=new m.Control({x:0,y:-.5,cursorStyleHandler:r,actionHandler:t,getActionName:o}),f.tl=new m.Control({x:-.5,y:-.5,cursorStyleHandler:n,actionHandler:l}),f.tr=new m.Control({x:.5,y:-.5,cursorStyleHandler:n,actionHandler:l}),f.bl=new m.Control({x:-.5,y:.5,cursorStyleHandler:n,actionHandler:l}),f.br=new m.Control({x:.5,y:.5,cursorStyleHandler:n,actionHandler:l}),f.mtr=new m.Control({x:0,y:-.5,actionHandler:s.rotationWithSnapping,cursorStyleHandler:s.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),m.Textbox){var h=m.Textbox.prototype.controls={};h.mtr=f.mtr,h.tr=f.tr,h.br=f.br,h.tl=f.tl,h.bl=f.bl,h.mt=f.mt,h.mb=f.mb,h.mr=new m.Control({x:.5,y:0,actionHandler:s.changeWidth,cursorStyleHandler:r,actionName:"resizing"}),h.ml=new m.Control({x:-.5,y:0,actionHandler:s.changeWidth,cursorStyleHandler:r,actionName:"resizing"})}}()},192:()=>{},898:()=>{},245:()=>{}},Nr={};function ge(u){var e=Nr[u];if(e!==void 0)return e.exports;var a=Nr[u]={exports:{}};return ma[u](a,a.exports,ge),a.exports}ge.d=(u,e)=>{for(var a in e)ge.o(e,a)&&!ge.o(u,a)&&Object.defineProperty(u,a,{enumerable:!0,get:e[a]})},ge.o=(u,e)=>Object.prototype.hasOwnProperty.call(u,e);var kn={};(()=>{let u;ge.d(kn,{R:()=>u}),u=typeof document<"u"&&typeof window<"u"?ge(653).fabric:{version:"5.2.1"}})();var St=kn.R;/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Camera Enhancer JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2023, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 3.3.4 (js 20230414)
 * @fileoverview Dynamsoft JavaScript Library for Camera Enhancer
 * More info on DCE JS: https://www.dynamsoft.com/camera-enhancer/docs/programming/javascript/?ver=latest
 */const wi=typeof self>"u";let Ae,Zt,ei,ui,Mt;if(typeof navigator<"u"&&(Ae=navigator,Zt=Ae.userAgent,ei=Ae.platform,ui=Ae.mediaDevices),!wi){const u={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Ae.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:ei,search:"Win"},Mac:{str:ei},Linux:{str:ei}};let a="unknownBrowser",d=0,p="unknownOS";for(let v in u){const b=u[v]||{};let C=b.str||Zt,S=b.search||v,T=b.verStr||Zt,M=b.verSearch||v;if(M instanceof Array||(M=[M]),C.indexOf(S)!=-1){a=v;for(let B of M){let j=T.indexOf(B);if(j!=-1){d=parseFloat(T.substring(j+B.length+1));break}}break}}for(let v in e){const b=e[v]||{};let C=b.str||Zt,S=b.search||v;if(C.indexOf(S)!=-1){p=v;break}}p=="Linux"&&Zt.indexOf("Windows NT")!=-1&&(p="HarmonyOS"),Mt={browser:a,version:d,OS:p}}wi&&(Mt={browser:"ssr",version:0,OS:"ssr"});const va=typeof WebAssembly<"u"&&Zt&&!(/Safari/.test(Zt)&&!/Chrome/.test(Zt)&&/\(.+\s11_2_([2-6]).*\)/.test(Zt)),_a=!(typeof Worker>"u"),An=!(!ui||!ui.getUserMedia),ya=async()=>{let u=!1;if(An)try{(await ui.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()}),u=!0}catch{}return u};Mt.browser==="Chrome"&&Mt.version>66||Mt.browser==="Safari"&&Mt.version>13||Mt.browser==="OPR"&&Mt.version>43||Mt.browser==="Edge"&&Mt.version;const ba=(()=>{if(!wi&&document.currentScript){let u=document.currentScript.src,e=u.indexOf("?");if(e!=-1)u=u.substring(0,e);else{let a=u.indexOf("#");a!=-1&&(u=u.substring(0,a))}return u.substring(0,u.lastIndexOf("/")+1)}return"./"})();class ne{constructor(e,a){this._zIndex=null,this._drawingLayer=null,this._drawingLayerId=null,this._mapStyle=new Map,this.mapEvent_Callbacks=new Map([["selected",new Map],["deselected",new Map],["mousedown",new Map],["mouseup",new Map],["dblclick",new Map],["mouseover",new Map],["mouseout",new Map]]),this.mapNoteName_Content=new Map([]),this.isDrawingItem=!0,this._setFabricObject(e),this._mediaType=e.type,this.styleSelector="default",this.styleId=a}get mediaType(){return this._mediaType}get drawingLayerId(){return this._drawingLayerId}_setFabricObject(e){this._fabricObject=e,this._fabricObject.on("selected",()=>{this.styleSelector="selected"}),this._fabricObject.on("deselected",()=>{this._fabricObject.canvas&&this._fabricObject.canvas.getActiveObjects().includes(this._fabricObject)?this.styleSelector="selected":this.styleSelector="default",this._fabricObject.type==="textbox"&&(this._fabricObject.isEditing&&this._fabricObject.exitEditing(),this._fabricObject.selected=!1)}),e.getDrawingItem=()=>this}_getFabricObject(){return this._fabricObject}_on(e,a){if(!a)return;const d=e.toLowerCase(),p=this.mapEvent_Callbacks.get(d);if(!p)throw new Error(`Event '${e}' does not exist.`);let v=p.get(a);v||(v=b=>{const C=b.e;if(!C)return void(a&&a.apply(this,[{targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null}]));const S={targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null};if(this._drawingLayer){let T,M,B,j;const q=C.target.getBoundingClientRect();T=q.left,M=q.top,B=T+window.scrollX,j=M+window.scrollY;const J=this._drawingLayer.fabricCanvas.lowerCanvasEl.width,z=this._drawingLayer.fabricCanvas.lowerCanvasEl.height,Y=parseFloat(window.getComputedStyle(this._drawingLayer.fabricCanvas.lowerCanvasEl).width),tt=parseFloat(window.getComputedStyle(this._drawingLayer.fabricCanvas.lowerCanvasEl).height),st=Y/tt,nt=J/z,ot=this._drawingLayer._getObjectFit();let ct,ut,mt,m,dt=1;if(ot==="contain")st<nt?(dt=Y/J,ct=T+this.get("x")*dt,ut=M+this.get("y")*dt+(tt-z*dt)/2,mt=B+this.get("x")*dt,m=j+this.get("y")*dt+(tt-z*dt)/2):(dt=tt/z,ct=T+this.get("x")*dt+(Y-J*dt)/2,ut=M+this.get("y")*dt,mt=B+this.get("x")*dt+(Y-J*dt)/2,m=j+this.get("y")*dt);else if(ot==="cover")if(st<nt){dt=tt/z;let _t=this.get("x")*dt-(J*dt-Y)/2;_t=Math.max(_t,0),_t=Math.min(_t,Y),ct=T+_t,ut=M+this.get("y")*dt,mt=B+_t,m=j+this.get("y")*dt}else{dt=Y/J;let _t=this.get("y")*dt-(z*dt-tt)/2;_t=Math.max(_t,0),_t=Math.min(_t,tt),ct=T+this.get("x")*dt,ut=M+_t,mt=B+this.get("x")*dt,m=j+_t}S.itemClientX=Math.round(ct),S.itemClientY=Math.round(ut),S.itemPageX=Math.round(mt),S.itemPageY=Math.round(m)}for(let T of Object.getOwnPropertyNames(S))Object.defineProperty(C,T,{value:S[T],writable:!0});a&&a.apply(this,[C])},p.set(a,v),this._fabricObject.on(d==="dblclick"?"mousedblclick":d,v))}on(e,a){this._on(e,a)}_off(e,a){const d=e.toLowerCase(),p=this.mapEvent_Callbacks.get(d);if(!p)throw new Error(`Event '${e}' does not exist.`);let v=p.get(a);v&&(p.delete(a),this._fabricObject.off(d==="dblclick"?"mousedblclick":d,v))}off(e,a){this._off(e,a)}_setEditable(e){const a=this._fabricObject;e?(a.selectable=!0,a.hasControls=!0,a.hoverCursor=null):(a.selectable=!1,a.hasControls=!1,a.hoverCursor="default")}hasNote(e){return this.mapNoteName_Content.has(e)}addNote(e,a){if(this.hasNote(e.name)&&!a)throw new Error("A note with the same name already exists, please use a different name.");const d=e.content?JSON.parse(JSON.stringify(e.content)):e.content;this.mapNoteName_Content.set(e.name,[d])}getNote(e){const a=this.mapNoteName_Content.get(e);return a?a.length===1?{name:e,content:a[0]?JSON.parse(JSON.stringify(a[0])):a[0]}:{name:e,content:JSON.parse(JSON.stringify(a))}:null}getNotes(){const e=[];for(let a of this.mapNoteName_Content){let d=a[1].length===1?a[1][0]:a[1];d=d&&JSON.parse(JSON.stringify(d)),e.push({name:a[0],content:d})}return e}updateNote(e,a,d){const p=this.mapNoteName_Content.get(e);if(!p)throw new Error("The note name does not exist.");d||(p.length=0),a=a&&JSON.parse(JSON.stringify(a)),p.push(a)}deleteNote(e){this.mapNoteName_Content.delete(e)}clearNotes(){this.mapNoteName_Content.clear()}_extendSet(e,a){return!1}_extendGet(e){}set(e,a){if(!this._extendSet(e,a))if(e==="x"){const d=this._fabricObject.group;d?(this._fabricObject.set("left",a-d.left-d.width/2),d.addWithUpdate()):this._fabricObject.set("left",a)}else if(e==="y"){const d=this._fabricObject.group;d?(this._fabricObject.set("top",a-d.top-d.height/2),d.addWithUpdate()):this._fabricObject.set("top",a)}else e==="styleId"?this.styleId=a:this._fabricObject.set(e,a);["vertices","startPoint","endPoint","x","y","left","top","width","height","scaleX","scaleY","skewX","skewY","padding","angle","strokeWidth"].includes(e)&&this._fabricObject.setCoords()}get(e){let a=this._extendGet(e);if(a===void 0)if(e==="x"){const d=this._fabricObject.group;a=d?this._fabricObject.get("left")+d.left+d.width/2:this._fabricObject.get("left")}else if(e==="y"){const d=this._fabricObject.group;a=d?this._fabricObject.get("top")+d.top+d.height/2:this._fabricObject.get("top")}else a=["type","mediaType"].includes(e)?this.mediaType:e==="styleSelector"?this.styleSelector:e==="styleId"?this.styleId:e==="drawingLayerId"?this.drawingLayerId:this._fabricObject.get(e);return a}setAttribute(e,a){this.set(e,a)}getAttribute(e){return this.get(e)}}ne.arrMediaTypes=["rect","arc","polygon","image","text","line","path"],ne.arrStyleSelectors=["default","selected"];const Hr=u=>{let e=(a=>a.split(`
`).map(d=>d.split("	")))(u);return(a=>{for(let d=0;;d++){let p=-1;for(let v=0;v<a.length;v++){let b=a[v][d];b!==void 0&&b.length>p&&(p=b.length)}if(p===-1)break;for(let v=0;v<a.length;v++){if(d>=a[v].length-1)continue;let b=" ".repeat(p+2-a[v][d].length);a[v][d]=a[v][d].concat(b)}}})(e),(a=>{let d="";for(let p=0;p<a.length;p++)d=d.concat(...a[p],p===a.length-1?"":`
`);return d})(e)};class wa extends ne{constructor(e,a,d,p,v){if(typeof p!="number"||p<=0)throw new RangeError("Invalid width.");super(new St.Textbox(Hr(e),{left:a,top:d,width:p}),v),this._mediaType="text",this._text=e}_extendSet(e,a){if(e==="text")return this._text=a,this._fabricObject.set("text",Hr(a)),!0}_extendGet(e){if(e==="text")return this._text}}typeof document<"u"&&typeof window<"u"&&(St.StaticCanvas.prototype.dispose=function(){return this.isRendering&&(St.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(u){u.dispose&&u.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),St.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},St.Object.prototype.transparentCorners=!1,St.Object.prototype.cornerSize=20,St.Object.prototype.touchCornerSize=100,St.Object.prototype.cornerColor="rgb(254,142,20)",St.Object.prototype.cornerStyle="circle",St.Object.prototype.strokeUniform=!0,St.Object.prototype.hasBorders=!1,St.Canvas.prototype.containerClass="",St.Canvas.prototype.getPointer=function(u,e){if(this._absolutePointer&&!e)return this._absolutePointer;if(this._pointer&&e)return this._pointer;var a,d=this.upperCanvasEl,p=St.util.getPointer(u,d),v=d.getBoundingClientRect(),b=v.width||0,C=v.height||0;b&&C||("top"in v&&"bottom"in v&&(C=Math.abs(v.top-v.bottom)),"right"in v&&"left"in v&&(b=Math.abs(v.right-v.left))),this.calcOffset(),p.x=p.x-this._offset.left,p.y=p.y-this._offset.top,e||(p=this.restorePointerVpt(p));var S=this.getRetinaScaling();if(S!==1&&(p.x/=S,p.y/=S),b!==0&&C!==0){var T=window.getComputedStyle(d).objectFit,M=d.width,B=d.height,j=b,q=C;a={width:M/j,height:B/q};var J,z,Y=M/B,tt=j/q;return T==="contain"?Y>tt?(J=j,z=j/Y,{x:p.x*a.width,y:(p.y-(q-z)/2)*a.width}):(J=q*Y,z=q,{x:(p.x-(j-J)/2)*a.height,y:p.y*a.height}):T==="cover"?Y>tt?{x:(M-a.height*j)/2+p.x*a.height,y:p.y*a.height}:{x:p.x*a.width,y:(B-a.width*q)/2+p.y*a.width}:{x:p.x*a.width,y:p.y*a.height}}return a={width:1,height:1},{x:p.x*a.width,y:p.y*a.height}},St.Canvas.prototype._onTouchStart=function(u){var e=this.findTarget(u);!this.allowTouchScrolling&&u.cancelable&&u.preventDefault&&u.preventDefault(),e&&u.cancelable&&u.preventDefault&&u.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(u)),this.__onMouseDown(u),this._resetTransformEventData();var a=this.upperCanvasEl,d=this._getEventPrefix();St.util.addListener(St.document,"touchend",this._onTouchEnd,{passive:!1}),St.util.addListener(St.document,"touchmove",this._onMouseMove,{passive:!1}),St.util.removeListener(a,d+"down",this._onMouseDown)},St.Textbox.prototype._wrapLine=function(u,e,a,d){const p=u.match(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/g),v=!(!p||!p.length);var b=0,C=this.splitByGrapheme||v,S=[],T=[],M=C?St.util.string.graphemeSplit(u):u.split(this._wordJoiners),B="",j=0,q=C?"":" ",J=0,z=0,Y=0,tt=!0,st=this._getWidthOfCharSpacing();d=d||0,M.length===0&&M.push([]),a-=d;for(var nt=0;nt<M.length;nt++)B=C?M[nt]:St.util.string.graphemeSplit(M[nt]),J=this._measureWord(B,e,j),j+=B.length,(b+=z+J-st)>a&&!tt?(S.push(T),T=[],b=J,tt=!0):b+=st,tt||C||T.push(q),T=T.concat(B),z=C?0:this._measureWord([q],e,j),j++,tt=!1,J>Y&&(Y=J);return nt&&S.push(T),Y+d>this.dynamicMinWidth&&(this.dynamicMinWidth=Y-st+d),S});class Ca{constructor(e,a,d,p){let v,b;switch(this.mapMediaType_Style=new Map,this.mode="viewer",this.onSelectionChange=null,this._arrDrwaingItem=[],this._arrFabricObject=[],this._visible=!0,e.hasOwnProperty("getFabricCanvas")?this.fabricCanvas=e.getFabricCanvas():(this.fabricCanvas=new St.Canvas(e,Object.assign(p,{allowTouchScrolling:!0})),this.fabricCanvas.setDimensions({width:"100%",height:"100%"},{cssOnly:!0}),this.fabricCanvas.lowerCanvasEl.className="",this.fabricCanvas.upperCanvasEl.className="",this.fabricCanvas.on("selection:created",function(C){const S=C.selected,T=[];for(let M of S){const B=M.getDrawingItem()._drawingLayer;B&&!T.includes(B)&&T.push(B)}for(let M of T){const B=[];for(let j of S){const q=j.getDrawingItem();q._drawingLayer===M&&B.push(q)}setTimeout(()=>{M.onSelectionChange&&M.onSelectionChange(B,[])},0)}}),this.fabricCanvas.on("before:selection:cleared",function(C){const S=this.getActiveObjects(),T=[];for(let M of S){const B=M.getDrawingItem()._drawingLayer;B&&!T.includes(B)&&T.push(B)}for(let M of T){const B=[];for(let j of S){const q=j.getDrawingItem();q._drawingLayer===M&&B.push(q)}setTimeout(()=>{const j=[];for(let q of B)M.hasDrawingItem(q)&&j.push(q);j.length>0&&M.onSelectionChange&&M.onSelectionChange([],j)},0)}}),this.fabricCanvas.on("selection:updated",function(C){const S=C.selected,T=C.deselected,M=[];for(let B of S){const j=B.getDrawingItem()._drawingLayer;j&&!M.includes(j)&&M.push(j)}for(let B of T){const j=B.getDrawingItem()._drawingLayer;j&&!M.includes(j)&&M.push(j)}for(let B of M){const j=[],q=[];for(let J of S){const z=J.getDrawingItem();z._drawingLayer===B&&j.push(z)}for(let J of T){const z=J.getDrawingItem();z._drawingLayer===B&&q.push(z)}setTimeout(()=>{B.onSelectionChange&&B.onSelectionChange(j,q)},0)}}),this.fabricCanvas.wrapperEl.style.position="absolute",e.getFabricCanvas=()=>this.fabricCanvas),this.id=a,this._mapDrawingStyles=d,a){case 1:v=d.get(1),b=d.get(5);break;case 2:v=d.get(2),b=d.get(6);break;case 3:v=d.get(3),b=d.get(7);break;default:v=d.get(4),b=d.get(8)}for(let C of ne.arrMediaTypes)this.mapMediaType_Style.set(C,{default:v,selected:b})}getId(){return this.id}_getDrawingStyle(e,a){if(typeof e!="number")throw new Error("Invalid style id.");const d=this._mapDrawingStyles.get(e);return d?a?JSON.parse(JSON.stringify(d)):d:null}setVisible(e){if(e){for(let a of this._arrFabricObject)a.visible=!0;this._visible=!0}else{for(let a of this._arrFabricObject)a.visible=!1;this._visible=!1}this.fabricCanvas.renderAll()}isVisible(){return this._visible}_getItemCurrentStyleId(e){return e.styleId?e.styleId:this.mapMediaType_Style.get(e._mediaType)[e.styleSelector].styleId}_getItemCurrentStyle(e){return e.styleId?this._getDrawingStyle(e.styleId):e._mapStyle.get(e.styleSelector)||null}_changeMediaTypeCurStyleInStyleSelector(e,a,d,p){let v;switch(e){case"rect":v=this.fabricCanvas.getObjects("rect");break;case"arc":v=this.fabricCanvas.getObjects("circle");break;case"polygon":v=this.fabricCanvas.getObjects("polygon");break;case"image":v=this.fabricCanvas.getObjects("image");break;case"text":v=this.fabricCanvas.getObjects("textbox");break;case"line":v=this.fabricCanvas.getObjects("line");break;case"path":v=this.fabricCanvas.getObjects("path")}for(let b of v){if(!this._arrFabricObject.includes(b))continue;const C=b.getDrawingItem();C.styleSelector===a&&this._changeItemStyle(C,d,!0)}p||this.fabricCanvas.renderAll()}_changeItemStyle(e,a,d){if(!e||!a)return;const p=e._getFabricObject();typeof e.styleId=="number"&&(a=this._getDrawingStyle(e.styleId)),p.strokeWidth=a.lineWidth,a.paintMode==="fill"?(p.fill=a.fillStyle,p.stroke=a.fillStyle):a.paintMode==="stroke"?(p.fill="transparent",p.stroke=a.strokeStyle):a.paintMode==="strokeAndFill"&&(p.fill=a.fillStyle,p.stroke=a.strokeStyle),p.fontFamily&&(p.fontFamily=a.fontFamily),p.fontSize&&(p.fontSize=a.fontSize),p.group||(p.dirty=!0),d||this.fabricCanvas.renderAll()}_updateGroupItem(e,a,d){if(!e||!a)return;const p=e.getChildItems();if(d==="add"){if(p.includes(a))return;const v=a._getFabricObject();if(this.fabricCanvas.getObjects().includes(v)){if(!this._arrFabricObject.includes(v))throw new Error("Existed in other drawing layers.");a._zIndex=null}else{let b;if(a.styleId)b=this._getDrawingStyle(a.styleId);else{b=this.mapMediaType_Style.get(a._mediaType)[e.styleSelector];const C=()=>{this._changeItemStyle(a,this.mapMediaType_Style.get(a._mediaType).selected,!0)},S=()=>{this._changeItemStyle(a,this.mapMediaType_Style.get(a._mediaType).default,!0)};a._on("selected",C),a._on("deselected",S),a._funcChangeStyleToSelected=C,a._funcChangeStyleToDefault=S}a._drawingLayer=this,a._drawingLayerId=this.id,this._changeItemStyle(a,b,!0)}e._fabricObject.addWithUpdate(a._getFabricObject())}else{if(d!=="remove"||!p.includes(a))return;a._zIndex=null,a._drawingLayer=null,a._drawingLayerId=null,a._off("selected",a._funcChangeStyleToSelected),a._off("deselected",a._funcChangeStyleToDefault),a._funcChangeStyleToSelected=null,a._funcChangeStyleToDefault=null,e._fabricObject.removeWithUpdate(a._getFabricObject())}this.fabricCanvas.renderAll()}_addDrawingItem(e,a){let d=e._getFabricObject();const p=this.fabricCanvas.getObjects();let v,b;if(p.includes(d)){if(this._arrFabricObject.includes(d))return;throw new Error("Existed in other drawing layers.")}if(e._mediaType==="group"){v=e.getChildItems();for(let T of v)if(T._drawingLayer&&T._drawingLayer!==this)throw new Error("The childItems of DT_Group have existed in other drawing layers.")}if(a&&typeof a=="object"&&!Array.isArray(a))for(let T in a)d.set(T,a[T]);if(v){for(let T of v){const M=this.mapMediaType_Style.get(T._mediaType);for(let B of ne.arrStyleSelectors)T._mapStyle.set(B,M[B]);if(T.styleId)b=this._getDrawingStyle(T.styleId);else{b=M.default;const B=()=>{this._changeItemStyle(T,this.mapMediaType_Style.get(T._mediaType).selected,!0)},j=()=>{this._changeItemStyle(T,this.mapMediaType_Style.get(T._mediaType).default,!0)};T._on("selected",B),T._on("deselected",j),T._funcChangeStyleToSelected=B,T._funcChangeStyleToDefault=j}T._drawingLayer=this,T._drawingLayerId=this.id,this._changeItemStyle(T,b,!0)}d.dirty=!0,this.fabricCanvas.renderAll()}else{const T=this.mapMediaType_Style.get(e._mediaType);for(let M of ne.arrStyleSelectors)e._mapStyle.set(M,T[M]);if(e.styleId)b=this._getDrawingStyle(e.styleId);else{b=T.default;const M=()=>{this._changeItemStyle(e,this.mapMediaType_Style.get(e._mediaType).selected)},B=()=>{this._changeItemStyle(e,this.mapMediaType_Style.get(e._mediaType).default)};e._on("selected",M),e._on("deselected",B),e._funcChangeStyleToSelected=M,e._funcChangeStyleToDefault=B}this._changeItemStyle(e,b)}e._zIndex=this.id,e._drawingLayer=this,e._drawingLayerId=this.id;const C=this._arrFabricObject.length;let S=p.length;if(C)S=p.indexOf(this._arrFabricObject[C-1])+1;else for(let T=0;T<p.length;T++)if(e._zIndex<p[T].getDrawingItem()._zIndex){S=T;break}this._arrDrwaingItem.push(e),this._arrFabricObject.push(d),this._visible?d.visible=!0:d.visible=!1,this.fabricCanvas.insertAt(d,S,!1)}addDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if(this.mode==="viewer")e._setEditable(!1);else{if(this.mode!=="editor")throw new Error("Illegal 'mode'.");e._setEditable(!0)}this._addDrawingItem(e)}addDrawingItems(e){for(let a of e)this.addDrawingItem(a)}removeDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if(!this.hasDrawingItem(e))return;if(e._zIndex=null,e._drawingLayer=null,e._drawingLayerId=null,e._mediaType==="group"){const d=e.getChildItems();for(let p of d)p._zIndex=null,p._drawingLayer=null,p._drawingLayerId=null,p._off("selected",p._funcChangeStyleToSelected),p._off("deselected",p._funcChangeStyleToDefault),p._funcChangeStyleToSelected=null,p._funcChangeStyleToDefault=null,p._mapStyle.clear()}else e._off("selected",e._funcChangeStyleToSelected),e._off("deselected",e._funcChangeStyleToDefault),e._funcChangeStyleToSelected=null,e._funcChangeStyleToDefault=null,e._mapStyle.clear();const a=e._getFabricObject();e.styleSelector==="selected"&&(a.group?a.group.removeWithUpdate(a):this.fabricCanvas._activeObject=null,e.styleSelector="default"),this.fabricCanvas.remove(a),this._arrDrwaingItem.splice(this._arrDrwaingItem.indexOf(e),1),this._arrFabricObject.splice(this._arrFabricObject.indexOf(a),1)}removeDrawingItems(e){for(let a of e)this.removeDrawingItem(a)}setDrawingItems(e){this.clearDrawingItems(),this.addDrawingItems(e)}getDrawingItems(e){return e&&typeof e=="function"?this._arrDrwaingItem.filter(e):Array.from(this._arrDrwaingItem)}getSelectedDrawingItems(){const e=this.fabricCanvas.getActiveObjects(),a=[];for(let d of e)this._arrFabricObject.includes(d)&&a.push(d.getDrawingItem());return a}hasDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");return this._arrDrwaingItem.includes(e)}clearDrawingItems(){this.removeDrawingItems(Array.from(this._arrDrwaingItem))}setDrawingStyle(e,a,d){a=a?a.toLocaleLowerCase():"all",d=d?d.toLocaleLowerCase():"all";let p,v=this._getDrawingStyle(e);if(a==="all"){const b=this.mapMediaType_Style.keys();for(let C of b)if(p=this.mapMediaType_Style.get(C),d==="all")for(let S of ne.arrStyleSelectors){this._changeMediaTypeCurStyleInStyleSelector(C,S,v,!0),p[S]=v;for(let T of this._arrDrwaingItem)T._mapStyle.set(S,v)}else{this._changeMediaTypeCurStyleInStyleSelector(C,d,v,!0),p[d]=v;for(let S of this._arrDrwaingItem)S._mapStyle.set(d,v)}this.fabricCanvas.renderAll()}else if(p=this.mapMediaType_Style.get(a),d==="all")for(let b of ne.arrStyleSelectors){this._changeMediaTypeCurStyleInStyleSelector(a,b,v,!0),p[b]=v;for(let C of this._arrDrwaingItem)C._mediaType===a&&C._mapStyle.set(b,v)}else{this._changeMediaTypeCurStyleInStyleSelector(a,d,v,!0),p[d]=v;for(let b of this._arrDrwaingItem)b._mediaType===a&&b._mapStyle.set(d,v)}}setMode(e){if((e=e.toLocaleLowerCase())==="viewer"){for(let a of this._arrDrwaingItem)a._setEditable(!1);this.fabricCanvas.discardActiveObject(),this.fabricCanvas.renderAll(),this.mode="viewer"}else{if(e!=="editor")throw new RangeError("Invalid value.");for(let a of this._arrDrwaingItem)a._setEditable(!0);this.mode="editor"}this._manager._switchPointerEvent()}getMode(){return this.mode}_setDimensions(e,a){this.fabricCanvas.setDimensions(e,a)}_setObjectFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`Unsupported value '${e}'.`);this.fabricCanvas.lowerCanvasEl.style.objectFit=e,this.fabricCanvas.upperCanvasEl.style.objectFit=e}_getObjectFit(){return this.fabricCanvas.lowerCanvasEl.style.objectFit}renderAll(){for(let e of this._arrDrwaingItem){const a=this._getItemCurrentStyle(e);this._changeItemStyle(e,a,!0)}this.fabricCanvas.renderAll()}dispose(){this.clearDrawingItems(),this._manager._arrDrawingLayer.length===1&&(this.fabricCanvas.wrapperEl.style.pointerEvents="none",this.fabricCanvas.dispose(),this._arrDrwaingItem.length=0,this._arrFabricObject.length=0)}}class xa{constructor(){this._arrDrawingLayer=[],this._mapDrawingStyles=new Map([[1,{id:1,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[2,{id:2,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[3,{id:3,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[4,{id:4,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[5,{id:5,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[6,{id:6,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[7,{id:7,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[8,{id:8,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}]]),this._defaultStyleTemplate={lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}}createDrawingStyle(e){if(!e)throw new Error("Invalid style definition.");let a;if(e.hasOwnProperty("id")){if(this._mapDrawingStyles.has(e.id))throw new Error("Existing drawing style id.");a=e.id}else{let p=100;for(;this._mapDrawingStyles.has(p);)p++;a=p}const d=JSON.parse(JSON.stringify(e));d.id=a;for(let p in this._defaultStyleTemplate)d.hasOwnProperty(p)||(d[p]=this._defaultStyleTemplate[p]);return this._mapDrawingStyles.set(a,d),d.id}_getDrawingStyle(e,a){if(typeof e!="number")throw new Error("Invalid style id.");const d=this._mapDrawingStyles.get(e);return d?a?JSON.parse(JSON.stringify(d)):d:null}getDrawingStyle(e){return this._getDrawingStyle(e,!0)}getDrawingStyles(){return JSON.parse(JSON.stringify(Array.from(this._mapDrawingStyles.values())))}_updateDrawingStyle(e,a){const d=this._mapDrawingStyles.get(e);if(d)for(let p in a)d.hasOwnProperty(p)&&(d[p]=a[p])}updateDrawingStyle(e,a){this._updateDrawingStyle(e,a);for(let d of this._arrDrawingLayer)d.renderAll()}createDrawingLayer(e,a){const d=v=>{for(let b of this._arrDrawingLayer)if(b.getId()===v)return!0;return!1};if(a===void 0){for(let v=100;;v++)if(!d(v)){a=v;break}}else if(d(a))throw new Error("Existed drawing layer id.");const p=new Ca(e,a,this._mapDrawingStyles,{enableRetinaScaling:!1});return p._manager=this,this._arrDrawingLayer.push(p),this._switchPointerEvent(),p}deleteDrawingLayer(e){const a=this.getDrawingLayer(e);if(!a)return;const d=this._arrDrawingLayer;a.dispose(),d.splice(d.indexOf(a),1),this._switchPointerEvent()}clearDrawingLayers(){for(let e of this._arrDrawingLayer)e.dispose();this._arrDrawingLayer.length=0}getDrawingLayer(e){for(let a of this._arrDrawingLayer)if(a.getId()===e)return a;return null}getDrawingLayers(){return Array.from(this._arrDrawingLayer)}getSelectedDrawingItems(){if(!this._arrDrawingLayer.length)return;const e=this._arrDrawingLayer[0].fabricCanvas.getActiveObjects(),a=[];for(let d of e)a.push(d.getDrawingItem());return a}setDimensions(e,a){this._arrDrawingLayer.length&&this._arrDrawingLayer[0]._setDimensions(e,a)}setObjectFit(e){for(let a of this._arrDrawingLayer)a&&a._setObjectFit(e)}getObjectFit(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0]._getObjectFit():null}setVisible(e){this._arrDrawingLayer.length&&(this._arrDrawingLayer[0].fabricCanvas.wrapperEl.style.display=e?"block":"none")}_switchPointerEvent(){if(this._arrDrawingLayer.length)for(let e of this._arrDrawingLayer)e.getMode()}}class Sa{constructor(e){this._controlTarget=null,this._arrUsers=[],this._mapAction_UserArgs=new Map,this._mapProperty_UserValue=new Map,this._mapAction_Callbacks=new Map,this._controlTarget=e}setControlTarget(e){this._controlTarget=e}getControlTarget(){return this._controlTarget}register(e){this._arrUsers.includes(e)||this._arrUsers.push(e)}logout(e){const a=this._arrUsers.indexOf(e);a!==-1&&(this.clearUserDisiredAction({user:e}),this.clearUserDisiredValue({user:e}),this._arrUsers.splice(a,1))}getRegisteredUsers(){return this._arrUsers}ifUserExisted(e){return this._arrUsers.includes(e)}setDisiredValue(e,a,d,p){if(!this._arrUsers.includes(e))throw new Error("Unregistered user.");p&&(this._controlTarget[a]=d),this._mapProperty_UserValue.get(a)?this._mapProperty_UserValue.get(a).set(e,d):this._mapProperty_UserValue.set(a,new Map([[e,d]]))}clearUserDisiredValue(e){if(e&&(e.user||e.property)){if(e.property&&e.user){const a=this._mapProperty_UserValue.get(e.property);if(!a)return;a.delete(e.user)}else if(e.property)this._mapProperty_UserValue.delete(e.property);else if(e.user)for(let a of this._mapProperty_UserValue.values())a.delete(e.user)}else this._mapProperty_UserValue=new Map}getValue(e){if(!this._controlTarget)throw new Error("Control target is not set.");return this._controlTarget[e]}getPropertyDisiredValue(e){if(this._mapProperty_UserValue.get(e)){const a=[],d=this._mapProperty_UserValue.get(e);for(let p of d.values())a.push(p);return a}return null}setDisiredAction(e,a,d,p){if(!this._arrUsers.includes(e))throw new Error("Unregistered user.");return d||(d=[]),p?this._controlTarget[a](...d):(this._mapAction_UserArgs.get(a)?this._mapAction_UserArgs.get(a).set(e,d):this._mapAction_UserArgs.set(a,new Map([[e,d]])),this._render(a))}clearUserDisiredAction(e){if(e&&(e.user||e.actionName)){if(e.actionName&&e.user){const a=this._mapAction_UserArgs.get(e.actionName);if(!a)return;a.delete(e.user)}else if(e.actionName)this._mapAction_UserArgs.delete(e.actionName);else if(e.user)for(let a of this._mapAction_UserArgs.values())a.delete(e.user);this.render()}else this._mapAction_UserArgs=new Map}addCallback(e,a){const d=this._mapAction_Callbacks.get(e);d?d.push(a):this._mapAction_Callbacks.set(e,[a])}removeCallback(e,a){const d=this._mapAction_Callbacks.get(e);if(!d)return;const p=d.indexOf(a);p!==-1&&d.splice(p,1)}clearCallback(e){e?this._mapAction_Callbacks.delete(e):this._mapAction_Callbacks.clear()}_fireCallback(e){const a=this._mapAction_Callbacks.get(e);if(a)for(let d of a){if(!d)return;setTimeout(d.bind(this._controlTarget),0)}}_render(e){const a=this._mapAction_UserArgs.get(e);if(!a)throw new Error("Unrecorded action.");if(a.size===this._arrUsers.length){let d=[];for(let p of a.values())p.length>0&&(d=p);if(this._controlTarget[e]){const p=this._controlTarget[e](...d);return this._mapAction_UserArgs.delete(e),this._fireCallback(e),p}}}render(e){if(e)return this._render(e);for(let a of this._mapAction_UserArgs.keys())this._render(a)}}class Wt{static multiply(e,a){const d=[];for(let p=0;p<3;p++){const v=a.slice(3*p,3*p+3);for(let b=0;b<3;b++){const C=[e[b],e[b+3],e[b+6]].reduce((S,T,M)=>S+T*v[M],0);d.push(C)}}return d}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(e,a,d){return Wt.multiply(e,[1,0,0,0,1,0,a,d,1])}static rotate(e,a){var d=Math.cos(a),p=Math.sin(a);return Wt.multiply(e,[d,-p,0,p,d,0,0,0,1])}static scale(e,a,d){return Wt.multiply(e,[a,0,0,0,d,0,0,0,1])}}var vt;(function(u){u.GREY="grey",u.GREY32="grey32",u.RGBA="rgba",u.RBGA="rbga",u.GRBA="grba",u.GBRA="gbra",u.BRGA="brga",u.BGRA="bgra"})(vt||(vt={}));const Bt=(u,e,a,d)=>{let p=e+Math.round((u-e)/a)*a;return d&&(p=Math.min(p,d)),p};class et{constructor(){this._maxCvsSideLength=void 0,this._defaultMaxCvsSideLength=null,this._predefinedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],this._mapCameraResolutions=new Map,this._bWebGLSupported=!0,this.extraBindings=[],this._singleFrameMode=!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia),this._cvsSingleFrameMode=null,this._cvsOriginalImage=null,this._imgWidth=0,this._imgHeight=0,this._singleFrameModeIpt=null,this._clickIptSingleFrameMode=()=>{if(this.singleFrameMode&&!this.getDrawingLayers().some(e=>e.getMode()=="editor")){if(!this._singleFrameModeIpt){const e=document.createElement("input");this._singleFrameModeIpt=e,e.setAttribute("type","file"),e.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp"),e.setAttribute("capture",""),e.addEventListener("change",async()=>{const a=e.files[0];e.value="";const d=await(async T=>{let M=null,B=null;if(typeof createImageBitmap<"u")try{if(M=await createImageBitmap(T),M)return M}catch{}var j;return M||(B=await(j=T,new Promise((q,J)=>{let z=URL.createObjectURL(j),Y=new Image;Y.dbrObjUrl=z,Y.src=z,Y.onload=()=>{q(Y)},Y.onerror=tt=>{J(new Error("Can't convert blob to image : "+(tt instanceof Event?tt.type:tt)))}}))),B})(a),p=d instanceof HTMLImageElement?d.naturalWidth:d.width,v=d instanceof HTMLImageElement?d.naturalHeight:d.height;this._imgWidth=p,this._imgHeight=v;const b=T=>{const M=Date.now();if(p===0||v===0)return null;if(T instanceof HTMLImageElement&&!T.complete)throw new Error("The source is not loaded.");const B=this._scanRegion,j=this.getFrameSize(p,v,B,this.maxCvsSideLength);if(!j)return null;let q=!0;p===j.sWidth&&v===j.sHeight&&(q=!1);const J=this.mapPixelFormatString_Enum.get(this.framePixelFormat.toLowerCase()),z={data:null,region:B?JSON.parse(JSON.stringify(B)):null,sx:j.sx,sy:j.sy,width:j.dWidth,height:j.dHeight,colorMode:null,pixelFormat:null,timeSpent:null,timeStamp:null,isCropped:q,toCanvas:this._toCanvas,_sWidth:j.sWidth,_sHeight:j.sHeight,_bUseWebGL:null},Y=this._getImageData(T,p,v,j,null,{pixelFormat:J});if(!Y)return null;const tt=Date.now();return et._onLog&&et._onLog("DCE: _getVideoData(region?) END: "+tt),z.data=Y.data,z.pixelFormat=z.colorMode=Y.pixelFormat,z._bUseWebGL=Y._bUseWebGL,z.timeSpent=tt-M,z.timeStamp=tt,Y.pixelFormat===vt.GREY?z.stride=z.width:z.stride=4*z.width,z};(T=>{let M=this._cvsSingleFrameMode;if(!M){if(M=document.createElement("canvas"),!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(M),M.style.position="absolute",M.style.width="100%",M.style.height="100%",M.style.left="0",M.style.top="0",M.style.objectFit="contain",M.style.pointerEvents="none",this._cvsSingleFrameMode=M}M.width==p&&M.height==v||(M.width=p,M.height=v);const B=M.getContext("2d");B.clearRect(0,0,M.width,M.height),B.drawImage(T,0,0)})(d),this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let T of this._arrScanRegionOverlays)T&&this._updateScanRegionOverlay(T);let C;this._updateDrawingLayersSize();try{C=b(d)}catch(T){throw T}const S=this.mapCameraEvents.get("singleframeacquired");for(let T of S)if(T)try{const M={data:new Uint8Array(C.data),region:JSON.parse(JSON.stringify(C.region)),sx:C.sx,sy:C.sy,width:C.width,height:C.height,stride:C.stride,colorMode:C.colorMode,pixelFormat:C.pixelFormat,timeSpent:C.timeSpent,timeStamp:C.timeStamp,isCropped:C.isCropped,toCanvas:C.toCanvas,_sWidth:C._sWidth,_sHeight:C._sHeight,_bUseWebGL:C._bUseWebGL};await T.apply(this,[M])}catch(M){console.error(M)}}),e.style.position="fixed",e.style.left="-1px",e.style.top="-1px",e.style.width="1px",e.style.height="1px",e.style.backgroundColor="transparent",e.style.color="transparent",document.body.appendChild(e)}this._singleFrameModeIpt.click()}},this.styleEls=[],this._framePixelFormat=void 0,this._defaultFramePixelFormat="rgba",this.mapPixelFormatString_Enum=new Map([["grey",vt.GREY],["grey32",vt.GREY32],["rgba",vt.RGBA],["rbga",vt.RBGA],["grba",vt.GRBA],["gbra",vt.GBRA],["brga",vt.BRGA],["bgra",vt.BGRA]]),this.shaderPixelFormat=vt.RGBA,this.maxVideoCvsLength=3,this._reusedCvs=null,this._reusedWebGLCvs=null,this._tempDataContainer=null,this._webGLTexture=null,this._webGLProgramInfo=null,this._webGLBuffers=null,this._softwareScale=1,this._scaleCenter={x:0,y:0},this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,_focusArea:null},this._tapFocusEnabled=!0,this._focusSupported=!0,this._tapDoFocus=async e=>{if(this._touchMoved)return void(this._touchMoved=!1);if(!this._tapFocusEnabled||!this._bOpen||this.singleFrameMode||!this._video||this._video.paused||!this._videoTrack||!this._focusSupported||this.getDrawingLayers().some(ct=>ct.getMode()=="editor"))return;if(!this._focusParameters.fds&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,!this._focusParameters.fds))return void(this._focusSupported=!1);if(this._focusParameters.kTimeout==null&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus==1)return;let a,d,p,v;if(this._focusParameters.taskBackToContinous&&(clearTimeout(this._focusParameters.taskBackToContinous),this._focusParameters.taskBackToContinous=null),e instanceof MouseEvent)a=e.clientX,d=e.clientY;else{if(!(e instanceof TouchEvent))throw new Error("Unknown event type.");if(!e.changedTouches.length)return;a=e.changedTouches[0].clientX,d=e.changedTouches[0].clientY}const b=this.getVideoFit(),C=this._video.videoWidth,S=this._video.videoHeight,T=this._elContainer.getBoundingClientRect(),M=T.left,B=T.top,j=window.getComputedStyle(this._elContainer),q=parseFloat(j.width),J=parseFloat(j.height),z=q/J,Y=C/S;let tt=1;if(b==="contain")Y>z?(tt=q/C,p=(a-M)/tt,v=(d-B-(J-q/Y)/2)/tt):(tt=J/S,v=(d-B)/tt,p=(a-M-(q-J*Y)/2)/tt);else{if(b!=="cover")throw new Error("Unsupported object-fit.");Y>z?(tt=J/S,v=(d-B)/tt,p=(a-M+(J*Y-q)/2)/tt):(tt=q/C,p=(a-M)/tt,v=(d-B+(q/Y-J)/2)/tt)}const st={x:p+"px",y:v+"px"},nt=2*Math.round(Math.min(C,S)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px",ot=nt;await this._setLocalFocus(st,nt,ot,this._focusParameters.tapFocusMinDistance,this._focusParameters.tapFocusMaxDistance),this._focusParameters.taskBackToContinous=setTimeout(()=>{this._videoTrack&&this._videoTrack.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch(()=>{})},this._focusParameters.focusBackToContinousTime)},this._touchMoved=!1,this._touchMoveEvent=()=>{this._touchMoved=!0},this._recordedStates={},this.playCallbackInfo=null,this._toCanvas=function(){const e=document.createElement("canvas");let a;if(e.width=this.width,e.height=this.height,(this.pixelFormat||this.colorMode)==="grey"){a=new Uint8ClampedArray(this.width*this.height*4);for(let p=0;p<a.length;p+=4)a[p]=this.data[p/4],a[p+1]=this.data[p/4],a[p+2]=this.data[p/4],a[p+3]=255}else a=new Uint8ClampedArray(this.data.buffer);const d=new ImageData(a,this.width,this.height);return e.getContext("2d").putImageData(d,0,0),e},this._onCameraSelChange=async()=>{await this.selectCamera(this._selCam.value),this._bOpen||this.stop()},this._onResolutionSelChange=async()=>{let e,a;if(this._selRsl&&this._selRsl.selectedIndex!=-1){let d=this._selRsl.options[this._selRsl.selectedIndex];e=d.getAttribute("data-width"),a=d.getAttribute("data-height")}await this.setResolution(e,a),this._bOpen||this.stop()},this._onCloseBtnClick=()=>{this.close(!0)},this._bOpen=!1,this.isCameraEnhancer=!0,this.isDisposed=!1,this.disposed=!1,this.videoSrc=null,this.videoSettings={video:{width:{ideal:1280},height:{ideal:720},facingMode:{ideal:"environment"}}},this.iPlayRound=0,this.promisePlay=null,this._ifSaveLastUsedCamera=!1,this.ifSkipCameraInspection=!1,this._allCameras=[],this._currentCamera=null,this._videoTrack=null,this._lastDeviceId=void 0,this._vc_bPlayingVideoBeforeHide=!1,this._ev_documentHideEvent=()=>{if(!this.singleFrameMode)if(document.visibilityState==="visible"){if(et._onLog&&et._onLog("DCE: document visible."),this._bOpen&&this._vc_bPlayingVideoBeforeHide){if(this.videoSrc)this._video.play();else if(this._video.srcObject){const e=this._video.srcObject.getTracks()[0];this._video.srcObject.active&&e&&!e.muted?this._video.play():this.play()}}}else document.visibilityState==="hidden"&&(et._onLog&&et._onLog("DCE: document hidden."),["iPhone","iPad"].includes(Mt.OS)?(this._vc_bPlayingVideoBeforeHide=!0,this._video&&this._video.pause()):this._video&&!this._video.paused?(this._vc_bPlayingVideoBeforeHide=!0,this._video.pause()):this._vc_bPlayingVideoBeforeHide=!1)},this.containerClassName="dce-video-container",this._elContainer=null,this._videoContainer=null,this._video=null,this.videoFit="contain",this._cvsScanRegion=null,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=2,this._bShowScanRegionMask=!0,this._bShowScanRegionLaser=void 0,this._defaultBShowScanRegionLaser=!1,this._scanRegion=null,this._arrScanRegionOverlays=[],this._layerBaseCvs=null,this._drawingLayerOfTip=null,this._tipArgs={x:void 0,y:void 0,width:void 0,duration:void 0,autoShowSuggestedTip:void 0},this._hideTipTimeoutId=null,this.onTipSuggested=null,this._cvsViewDecorator=null,this._decoratorType=[],this._decoratorArea=null,this._viewDecoratorInfo={rectangle:{lineWidth:4,strokeStyle:"rgb(254,142,20)",fillStyle:"transparent",maskFillStyle:"transparent"},focus:{lineWidth:4,strokeStyle:"rgb(254,142,20)",fillStyle:"transparent",maskFillStyle:"transparent"},crossline:{lineWidth:2,strokeStyle:"rgb(254,142,20)"},crosshair:{lineWidth:4,strokeStyle:"rgb(254,142,20)"}},this._croppingRegions=void 0,this._defaultCroppingRegions=[null],this.bIncreaseRegionIndexAuto=!0,this._croppingRegionIndex=0,this._loopInterval=void 0,this._defaultLoopInterval=0,this._maxNumberOfFramesInBuffer=void 0,this._defaultMaxNumberOfFramesInBuffer=1,this._frameQueue=[],this._bFetchingLoopStarted=!1,this._refreshInterval=void 0,this._defaultRefreshInterval=-1,this._updateLayersTimeout=500,this._updateLayers=()=>{this._cvsScanRegion&&(this._cvsScanRegion.style.display="none"),this._divScanLight&&(this._divScanLight.style.display="none"),this._cvsViewDecorator&&(this._cvsViewDecorator.style.display="none");for(let e of this._arrScanRegionOverlays)e&&(e.style.display="none");this._resizeTimeoutId&&clearTimeout(this._resizeTimeoutId),this._resizeTimeoutId=setTimeout(()=>{if(!this.isDisposed||!this.disposed){this.ifShowScanRegionMask&&this.showScanRegionMask(),this.ifShowScanRegionLaser&&this.showScanRegionLaser(),this._cvsViewDecorator&&this.showViewDecorator(),this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let e of this._arrScanRegionOverlays)e&&(e.style.display="",this._updateScanRegionOverlay(e));this._updateDrawingLayersSize(),this._updateVideoContainerStyle()}},this._updateLayersTimeout)},this._windowResizeListener=()=>{this._windowWidth!==document.documentElement.clientWidth&&(this._windowWidth=document.documentElement.clientWidth,this._updateLayers())},this.mapCameraEvents=new Map([["cameraopen",[]],["cameraclose",[]],["camerachange",[]],["resolutionchange",[]],["played",[]],["singleframeacquired",[]],["frameaddedtobuffer",[]]]),this._controler=null}static getVersion(){return this._version}static async detectEnvironment(){return await(async()=>({wasm:va,worker:_a,getUserMedia:An,camera:await ya(),browser:Mt.browser,version:Mt.version,OS:Mt.OS}))()}static set engineResourcePath(e){if(this._hasEngineResourceLoaded)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` is called.");et._engineResourcePath=(a=>{if(a==null&&(a="./"),!wi){let d=document.createElement("a");d.href=a,a=d.href}return a.endsWith("/")||(a+="/"),a})(e)}static get engineResourcePath(){return this._engineResourcePath}static isStorageAvailable(e){let a;try{a=window[e];const d="__storage_test__";return a.setItem(d,d),a.removeItem(d),!0}catch(d){return d instanceof DOMException&&(d.code===22||d.code===1014||d.name==="QuotaExceededError"||d.name==="NS_ERROR_DOM_QUOTA_REACHED")&&a&&a.length!==0}}static isDCEFrame(e){return!(!e||typeof e!="object"||Array.isArray(e))&&"data"in e&&"region"in e&&"sx"in e&&"sy"in e&&"width"in e&&"height"in e&&("colorMode"in e||"pixelFormat"in e)&&"timeSpent"in e&&"timeStamp"in e&&"isCropped"in e&&"toCanvas"in e&&"_sWidth"in e&&"_sHeight"in e&&"_bUseWebGL"in e}static async testCameraAccess(){try{if(!navigator||!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return{ok:!1,message:"Insecure context."};(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()})}catch(e){if(e.name==="OverconstrainedError"||e.name==="NotFoundError")return{ok:!1,message:"No camera detected."};if(e.name==="NotAllowedError")return{ok:!1,message:"No permission to access camera."};if(e.name==="AbortError")return{ok:!1,message:"Some problem occurred which prevented the device from being used."};if(e.name==="NotReadableError")return{ok:!1,message:"A hardware error occurred."};if(e.name==="SecurityError")return{ok:!1,message:"User media support is disabled."};throw e}return{ok:!0,message:"Successfully accessed the camera."}}set maxCvsSideLength(e){if(e<=0)throw new Error("Invalid value.");this._maxCvsSideLength=e}get maxCvsSideLength(){if(this._maxCvsSideLength!==void 0)return this._maxCvsSideLength;if(this._controler){const e=this._controler.getPropertyDisiredValue("maxCvsSideLength");if(e&&e.length===1)return e[0]}return this._defaultMaxCvsSideLength}static set defaultUIElementURL(e){et._defaultUIElementURL=e}static get defaultUIElementURL(){var e;return(e=et._defaultUIElementURL)===null||e===void 0?void 0:e.replace("@engineResourcePath/",et.engineResourcePath)}getUIElement(){return this.UIElement}async setUIElement(e){if(this._bOpen)throw new Error("It is not allowed to change the UIElement when the camera is open.");if(typeof e=="string"||e instanceof String){if(!e.trim().startsWith("<")){let d=await fetch(e);if(!d.ok)throw Error("setUIElement(elementOrUrl): Network Error: "+d.statusText);e=await d.text()}if(!e.trim().startsWith("<"))throw Error("setUIElement(elementOrUrl): Can't get valid HTMLElement.");let a=document.createElement("div");a.innerHTML=e;for(let d=0;d<a.childElementCount;++d){let p=a.children[d];p instanceof HTMLStyleElement&&(this.styleEls.push(p),document.head.append(p))}(e=a.childElementCount==1?a.children[0]:a).remove()}this.UIElement=e,this._uiOriginalState={display:e&&e.style.display,inDom:document.body.contains(e)}}appendAndShowUI(){this.UIElement&&(this.UIElement.parentNode||(this.UIElement.style.position="fixed",this.UIElement.style.left="0",this.UIElement.style.top="0",document.body.append(this.UIElement)),this.UIElement.style.display=="none"&&(this.UIElement.style.display=""))}hideUI(){this.UIElement&&(this.UIElement.style.display="none")}get singleFrameMode(){return this._singleFrameMode}set singleFrameMode(e){if(this._bOpen)throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");this._singleFrameMode=e}set frameColorMode(e){this._framePixelFormat=e}get frameColorMode(){if(this._framePixelFormat!==void 0)return this._framePixelFormat;if(this._controler){const e=this._controler.getPropertyDisiredValue("framePixelFormat")||this._controler.getPropertyDisiredValue("frameColorMode");if(e&&e.length===1)return e[0]}return this._defaultFramePixelFormat}set framePixelFormat(e){this._framePixelFormat=e}get framePixelFormat(){if(this._framePixelFormat!==void 0)return this._framePixelFormat;if(this._controler){const e=this._controler.getPropertyDisiredValue("framePixelFormat")||this._controler.getPropertyDisiredValue("frameColorMode");if(e&&e.length===1)return e[0]}return this._defaultFramePixelFormat}set bOpen(e){if(this._bOpen=e,e){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let a of this._arrScanRegionOverlays)a&&this._updateScanRegionOverlay(a);this._updateDrawingLayersSize(),this.ifShowScanRegionMask?this.showScanRegionMask():this.hideScanRegionMask(),this.ifShowScanRegionLaser?this.showScanRegionLaser():this.hideScanRegionLaser(),this.showViewDecorator(),this.showScanRegionOverlays(),this._drawingLayersManager.setVisible(!0)}else this._softwareScale=1}set ifSaveLastUsedCamera(e){e?et.isStorageAvailable("localStorage")?this._ifSaveLastUsedCamera=!0:(this._ifSaveLastUsedCamera=!1,console.warn("Local storage is unavailable")):this._ifSaveLastUsedCamera=!1}get ifSaveLastUsedCamera(){return this._ifSaveLastUsedCamera}get video(){return this._video}setVideoFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`Unsupported value '${e}'.`);if(this.videoFit=e,this._video&&(this._video.style.objectFit=e,!this.singleFrameMode)){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let a of this._arrScanRegionOverlays)a&&this._updateScanRegionOverlay(a);this._updateVideoContainerStyle(),this._drawingLayersManager.setObjectFit(e)}}getVideoFit(){return this.videoFit}_showElClassName(){this._cvsScanRegion&&this._cvsScanRegion.classList.add("cvs-scan-region-mask"),this._cvsViewDecorator&&this._cvsViewDecorator.classList.add("cvs-view-decorator"),this._scanRegionOverlayContainer&&this._scanRegionOverlayContainer.classList.add("div-scan-region-overlay-container"),this._layerBaseCvs&&this._layerBaseCvs.classList.add("cvs-drawing-layer-base"),this._layerBaseCvs&&this._layerBaseCvs.parentElement.classList.add("div-drawing-layer-container"),this._cvsOriginalImage&&this._cvsOriginalImage.classList.add("cvs-original-image"),this._cvsSingleFrameMode&&this._cvsSingleFrameMode.classList.add("cvs-single-frame")}_hideElClassName(){this._cvsScanRegion&&this._cvsScanRegion.classList.remove("cvs-scan-region-mask"),this._cvsViewDecorator&&this._cvsViewDecorator.classList.remove("cvs-view-decorator"),this._scanRegionOverlayContainer&&this._scanRegionOverlayContainer.classList.remove("div-scan-region-overlay-container"),this._layerBaseCvs&&this._layerBaseCvs.classList.remove("cvs-drawing-layer-base"),this._layerBaseCvs&&this._layerBaseCvs.parentElement.classList.remove("div-drawing-layer-container"),this._cvsOriginalImage&&this._cvsOriginalImage.classList.remove("cvs-original-image"),this._cvsSingleFrameMode&&this._cvsSingleFrameMode.classList.remove("cvs-single-frame")}set ifShowScanRegionMask(e){this._bShowScanRegionMask=e,e?this.showScanRegionMask():this.hideScanRegionMask()}get ifShowScanRegionMask(){return this._bShowScanRegionMask}showScanRegionMask(){this._cvsScanRegion&&(this._cvsScanRegion.style.display=="none"&&(this._cvsScanRegion.style.display=""),this._recordedStates.maskShow=!0)}hideScanRegionMask(){this._cvsScanRegion&&(this._cvsScanRegion.style.display="none",this._recordedStates.maskShow=!1)}set ifShowScanRegionLaser(e){this._bShowScanRegionLaser=e,e?this.showScanRegionLaser():this.hideScanRegionLaser()}get ifShowScanRegionLaser(){if(this._bShowScanRegionLaser!==void 0)return this._bShowScanRegionLaser;if(this._controler){const e=this._controler.getPropertyDisiredValue("ifShowScanRegionLaser");if(e&&e.length){let a=0;for(let d of e)d||a++;return a!==this._controler.getRegisteredUsers().length}}return this._defaultBShowScanRegionLaser}showScanRegionLaser(){this._divScanLight&&(this._divScanLight.style.display=="none"&&(this._divScanLight.style.display="block"),this._recordedStates.laserShow=!0)}hideScanRegionLaser(){this._divScanLight&&(this._divScanLight.style.display="none",this._recordedStates.laserShow=!1)}_checkValidRegion(e){return e===null||!!e&&!!(e.hasOwnProperty("regionLeft")&&e.hasOwnProperty("regionTop")&&e.hasOwnProperty("regionRight")&&e.hasOwnProperty("regionBottom")&&e.hasOwnProperty("regionMeasuredByPercentage"))&&!(e.regionLeft<0||e.regionTop<0||e.regionRight<0||e.regionBottom<0)&&(!e.regionMeasuredByPercentage||!(e.regionLeft>100||e.regionTop>100||e.regionRight>100||e.regionBottom>100))}set scanRegion(e){if(!this._checkValidRegion(e))throw new Error("Invalid region.");this._scanRegion=JSON.parse(JSON.stringify(e)),this._updateScanRegionCanvas(),this._updateScanAreaDiv();for(let a of this._arrScanRegionOverlays)a&&this._updateScanRegionOverlay(a)}setScanRegion(e){this.scanRegion=e}getScanRegion(){return JSON.parse(JSON.stringify(this._scanRegion))}_calculateCvsSize(){if(!this._bOpen)return null;let e,a,d;if(this.singleFrameMode)e=this._imgWidth,a=this._imgHeight,d="contain";else{if(!this._video)return null;e=this._video.videoWidth,a=this._video.videoHeight,d=this.getVideoFit()}return e<=0||a<=0?null:{width:e,height:a,objectFit:d}}addScanRegionOverlayCanvas(){this._assertOpen();const e=document.createElement("canvas");if(this._updateScanRegionOverlay(e),!this._scanRegionOverlayContainer){const a=document.createElement("div");if(this._scanRegionOverlayContainer=a,a.style.position="absolute",a.style.left="0",a.style.top="0",a.style.width="100%",a.style.height="100%",a.style.overflow="hidden",a.style.pointerEvents="none",this._layerBaseCvs)this._layerBaseCvs.parentElement.after(a);else if(this._cvsScanRegion)this._cvsScanRegion.after(a);else if(this._cvsOriginalImage)this._cvsOriginalImage.after(a);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(a);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(a)}this._recordedStates.overlayShow=!0}return this._scanRegionOverlayContainer.append(e),this._arrScanRegionOverlays.push(e),e}removeScanRegionOverlayCanvas(e){const a=this._arrScanRegionOverlays.indexOf(e);a!==-1&&(e.remove(),this._arrScanRegionOverlays.splice(a,1))}_updateScanRegionOverlay(e){if(!e)return;const a=this._calculateCvsSize();if(!a)return;const{width:d,height:p,objectFit:v}=a;if(d<=0||p<=0)return e.width=0,void(e.height=0);const b=this._getRegionInPixels(d,p,this._scanRegion),C=this.getFrameSize(d,p,this._scanRegion,this.maxCvsSideLength),S=C.dWidth,T=C.dHeight;e.width==S&&e.height==T||(e.width=S,e.height=T);const M=window.getComputedStyle(this._elContainer),B=parseFloat(M.width),j=parseFloat(M.height),q=B/j,J=d/p;let z,Y,tt,st,nt=1;v==="contain"?(J>q?(nt=B/d,z=0,Y=(j-p*nt)/2):(nt=j/p,z=(B-d*nt)/2,Y=0),z+=b.regionLeft*nt,Y+=b.regionTop*nt,tt=(b.regionRight-b.regionLeft)*nt,st=(b.regionBottom-b.regionTop)*nt):v==="cover"?(J>q?(nt=j/p,z=b.regionLeft*nt-(d*nt-B)/2,Y=b.regionTop*nt):(nt=B/d,z=b.regionLeft*nt,Y=b.regionTop*nt-(p*nt-j)/2),tt=(b.regionRight-b.regionLeft)*nt,st=(b.regionBottom-b.regionTop)*nt):(z=0,Y=0,tt=0,st=0),e.style.position="absolute",e.style.left=z+"px",e.style.top=Y+"px",e.style.width=tt+"px",e.style.height=st+"px"}showScanRegionOverlays(){this._scanRegionOverlayContainer&&(this._scanRegionOverlayContainer.style.display=="none"&&(this._scanRegionOverlayContainer.style.display=""),this._recordedStates.overlayShow=!0)}hideScanRegionOverlays(){this._scanRegionOverlayContainer&&(this._scanRegionOverlayContainer.style.display="none",this._recordedStates.overlayShow=!1)}setViewDecorator(e,a){if(!e)return void(this._cvsViewDecorator&&(this._cvsViewDecorator.remove(),this._cvsViewDecorator=null));if(!a)throw new Error("Invalid area.");this._assertOpen();let d=[];if(typeof e=="string"?d.push(e):Array.isArray(e)&&(d=JSON.parse(JSON.stringify(e))),!this._cvsViewDecorator){if(this._cvsViewDecorator=document.createElement("canvas"),this._scanRegionOverlayContainer)this._scanRegionOverlayContainer.after(this._cvsViewDecorator);else if(this._layerBaseCvs)this._layerBaseCvs.parentElement.after(this._cvsViewDecorator);else if(this._cvsScanRegion)this._cvsScanRegion.after(this._cvsViewDecorator);else if(this._cvsOriginalImage)this._cvsOriginalImage.after(this._cvsViewDecorator);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(this._cvsViewDecorator);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(this._cvsViewDecorator)}this._recordedStates.decoratorShow=!0}this._decoratorArea=JSON.parse(JSON.stringify(a)),this._decoratorType.length=0;const p=["rectangle","focus"],v=["crossline","crosshair"];let b=!1,C=!1;for(let S of d)S=S.toLowerCase(),p.includes(S)&&!b&&(b=!0,this._decoratorType.push(S)),v.includes(S)&&!C&&(C=!0,!this._decoratorType.includes(S)&&this._decoratorType.push(S));this._updateViewDecorator()}getViewDecorator(){return{type:JSON.parse(JSON.stringify(this._decoratorType)),area:JSON.parse(JSON.stringify(this._decoratorArea)),canvas:this._cvsViewDecorator}}showViewDecorator(){this._cvsViewDecorator&&(this._cvsViewDecorator.style.display=="none"&&(this._cvsViewDecorator.style.display=""),this._recordedStates.decoratorShow=!0)}hideViewDecorator(){this._cvsViewDecorator&&(this._cvsViewDecorator.style.display="none",this._recordedStates.decoratorShow=!1)}setViewDecoratorLineWidth(e,a){if(typeof e!="string")throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("lineWidth"))throw new Error(`It is not allowed to change the property 'lineWidth' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].lineWidth=a,this._updateViewDecorator()}setViewDecoratorStrokeStyle(e,a){if(typeof e!="string")throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("strokeStyle"))throw new Error(`It is not allowed to change the property 'strokeStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].strokeStyle=a,this._updateViewDecorator()}setViewDecoratorFillStyle(e,a){if(typeof e!="string")throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("fillStyle"))throw new Error(`It is not allowed to change the property 'fillStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].fillStyle=a,this._updateViewDecorator()}setViewDecoratorMaskFillStyle(e,a){if(typeof e!="string")throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("maskFillStyle"))throw new Error(`It is not allowed to change the property 'maskFillStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].maskFillStyle=a,this._updateViewDecorator()}_updateViewDecorator(){if(!this._bOpen||!this._cvsViewDecorator||!this._decoratorArea)return;let e;if(this.singleFrameMode)e="contain";else{if(!this._video)return;e=this.getVideoFit()}const a=this._cvsViewDecorator;a.style.position="absolute",a.style.width="100%",a.style.height="100%",a.style.left="0",a.style.top="0",a.style.objectFit=e,a.style.pointerEvents="none";const d=this.getVisibleRegion(!0),p=d.regionRight-d.regionLeft,v=d.regionBottom-d.regionTop;if(a.width==p&&a.height==v||(a.width=p,a.height=v),p<=0||v<=0)return;const b=a.getContext("2d");b.clearRect(0,0,a.width,a.height);const C=this._decoratorArea.x/100*p,S=this._decoratorArea.y/100*v,T=this._decoratorArea.width/100*p,M=this._decoratorArea.height/100*v;for(let B of this._decoratorType){if(B==="rectangle"){b.fillStyle=this._viewDecoratorInfo.rectangle.maskFillStyle,b.fillRect(0,0,a.width,a.height),b.clearRect(Math.round(C),Math.round(S),Math.round(T),Math.round(M)),b.fillStyle=this._viewDecoratorInfo.rectangle.fillStyle,b.fillRect(Math.round(C),Math.round(S),Math.round(T),Math.round(M)),b.lineWidth=this._viewDecoratorInfo.rectangle.lineWidth,b.strokeStyle=this._viewDecoratorInfo.rectangle.strokeStyle;const j=b.lineWidth/2;b.strokeRect(Math.round(C-j),Math.round(S-j),Math.round(T+b.lineWidth),Math.round(M+b.lineWidth))}if(B==="focus"){b.fillStyle=this._viewDecoratorInfo.focus.maskFillStyle,b.fillRect(0,0,a.width,a.height),b.clearRect(Math.round(C),Math.round(S),Math.round(T),Math.round(M)),b.fillStyle=this._viewDecoratorInfo.focus.fillStyle,b.fillRect(Math.round(C),Math.round(S),Math.round(T),Math.round(M)),b.lineWidth=this._viewDecoratorInfo.focus.lineWidth,b.strokeStyle=this._viewDecoratorInfo.focus.strokeStyle;const j=b.lineWidth/2,q=[0,.25,.75,1],J=[0,.25,.75,1];b.beginPath();for(let z=0;z<q.length;z++)if(z==0||z==3)for(let Y=0;Y<J.length;Y+=2)b.moveTo(Math.round(C+q[z]*T),Math.round(S+J[Y]*M)),b.lineTo(Math.round(C+q[z]*T),Math.round(S+J[Y+1]*M));for(let z=0;z<J.length;z++)if(z==0||z==3)for(let Y=0;Y<q.length;Y+=2)b.moveTo(Math.round(C+q[Y]*T-j),Math.round(S+J[z]*M)),b.lineTo(Math.round(C+q[Y+1]*T+j),Math.round(S+J[z]*M));b.stroke()}if(B==="crossline"&&(b.beginPath(),b.lineWidth=this._viewDecoratorInfo.crossline.lineWidth,b.strokeStyle=this._viewDecoratorInfo.crossline.strokeStyle,b.moveTo(Math.round(C),Math.round(S+M/2)),b.lineTo(Math.round(C+T),Math.round(S+M/2)),b.moveTo(Math.round(C+T/2),Math.round(S)),b.lineTo(Math.round(C+T/2),Math.round(S+M)),b.stroke()),B==="crosshair"){b.beginPath();const j=.05*Math.min(T,M);b.lineWidth=this._viewDecoratorInfo.crosshair.lineWidth,b.strokeStyle=this._viewDecoratorInfo.crosshair.strokeStyle,b.moveTo(Math.round(C+(T-j)/2),Math.round(S+M/2)),b.lineTo(Math.round(C+(T+j)/2),Math.round(S+M/2)),b.moveTo(Math.round(C+T/2),Math.round(S+(M-j)/2)),b.lineTo(Math.round(C+T/2),Math.round(S+(M+j)/2)),b.stroke()}}}getVisibleRegion(e){this._assertOpen();const a=this._calculateCvsSize();if(!a)return null;const{width:d,height:p,objectFit:v}=a;let b=(()=>{const C=parseFloat(window.getComputedStyle(this._elContainer).width),S=parseFloat(window.getComputedStyle(this._elContainer).height);let T,M={regionBottom:p,regionRight:d,regionLeft:0,regionTop:0,regionMeasuredByPercentage:!1};return v==="cover"?C/S<d/p?(T=S/p,M.regionLeft=Math.floor((d-C/T)/2),M.regionRight=Math.ceil(d-M.regionLeft),M.regionTop=0,M.regionBottom=p):(T=C/d,M.regionTop=Math.floor((p-S/T)/2),M.regionBottom=Math.ceil(p-M.regionTop),M.regionLeft=0,M.regionRight=d):v==="none"&&(C<d&&S<p?(M.regionLeft=Math.floor((d-C)/2),M.regionRight=Math.ceil(d-M.regionLeft),M.regionTop=Math.floor((p-S)/2),M.regionBottom=Math.ceil(p-M.regionTop)):C<d?(M.regionLeft=Math.floor((d-C)/2),M.regionRight=Math.ceil(d-M.regionLeft),M.regionTop=0,M.regionBottom=p):S<p&&(M.regionTop=Math.floor((p-S)/2),M.regionBottom=Math.ceil(p-M.regionTop),M.regionLeft=0,M.regionRight=d)),M})();return e?b.regionMeasuredByPercentage=!1:(b.regionBottom=Math.ceil(b.regionBottom/p*100),b.regionRight=Math.ceil(b.regionRight/d*100),b.regionLeft=Math.floor(b.regionLeft/d*100),b.regionTop=Math.floor(b.regionTop/p*100),b.regionMeasuredByPercentage=!0),b}setScanRegionMaskStyle(e){e&&(e.fillStyle&&(this.regionMaskFillStyle=e.fillStyle),e.strokeStyle&&(this.regionMaskStrokeStyle=e.strokeStyle),e.lineWidth&&(this.regionMaskLineWidth=e.lineWidth),this._updateScanRegionCanvas())}_getRegionInPixels(e,a,d){if(!(e<=0||a<=0))return d?d.regionMeasuredByPercentage?{regionLeft:Math.round(d.regionLeft/100*e),regionTop:Math.round(d.regionTop/100*a),regionRight:Math.round(d.regionRight/100*e),regionBottom:Math.round(d.regionBottom/100*a),regionMeasuredByPercentage:!1}:JSON.parse(JSON.stringify(d)):{regionLeft:0,regionTop:0,regionRight:e,regionBottom:a,regionMeasuredByPercentage:!1}}_updateScanRegionCanvas(){if(!this._bOpen)return;const e=this._calculateCvsSize();if(!e)return;const{width:a,height:d,objectFit:p}=e;if(a<=0||d<=0)return void(this._cvsScanRegion&&(this._cvsScanRegion.width=0,this._cvsScanRegion.height=0));const v=this._getRegionInPixels(a,d,this._scanRegion);if(!this._cvsScanRegion){if(this._cvsScanRegion=document.createElement("canvas"),this._cvsOriginalImage)this._cvsOriginalImage.after(this._cvsScanRegion);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(this._cvsScanRegion);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(this._cvsScanRegion)}this._recordedStates.maskShow=!0}const b=this._cvsScanRegion;b.style.position="absolute",b.style.width="100%",b.style.height="100%",b.style.left="0",b.style.top="0",b.style.objectFit=p,b.style.pointerEvents="none",b.width==a&&b.height==d||(b.width=a,b.height=d);const C=b.getContext("2d");if(C.clearRect(0,0,b.width,b.height),v.regionLeft!=0||v.regionRight!=a||v.regionTop!=0||v.regionBottom!=d){const S=v.regionLeft,T=v.regionTop,M=v.regionRight-v.regionLeft,B=v.regionBottom-v.regionTop;C.fillStyle=this.regionMaskFillStyle,C.fillRect(0,0,b.width,b.height),C.clearRect(Math.round(S),Math.round(T),Math.round(M),Math.round(B)),C.strokeStyle=this.regionMaskStrokeStyle,C.lineWidth=this.regionMaskLineWidth;const j=C.lineWidth/2;C.strokeRect(Math.round(S-j),Math.round(T-j),Math.round(M+C.lineWidth),Math.round(B+C.lineWidth))}}_updateScanAreaDiv(){if(!this._bOpen)return;const e=this._calculateCvsSize();if(!e)return;const{width:a,height:d,objectFit:p}=e;if(!this._divScanArea)return;if(a<=0||d<=0)return this._divScanArea.style.width="0",void(this._divScanArea.style.height="0");const v=this._getRegionInPixels(a,d,this._scanRegion),b=window.getComputedStyle(this._elContainer),C=parseFloat(b.width),S=parseFloat(b.height),T=C/S,M=a/d;let B,j,q,J,z=1;if(p==="contain")T<M?(z=C/a,B=0,j=(S-d*z)/2):(z=S/d,B=(C-a*z)/2,j=0),B+=v.regionLeft*z,j+=v.regionTop*z,q=(v.regionRight-v.regionLeft)*z,J=(v.regionBottom-v.regionTop)*z;else if(p==="cover")if(T<M){z=S/d,B=v.regionLeft*z-(a*z-C)/2,B=Math.max(B,0),B=Math.min(B,parseFloat(b.width)),j=v.regionTop*z;let Y=v.regionRight*z-(a*z-C)/2;Y=Math.max(Y,0),Y=Math.min(Y,parseFloat(b.width)),q=Y-B,J=(v.regionBottom-v.regionTop)*z}else{z=C/a,B=v.regionLeft*z,j=v.regionTop*z-(d*z-S)/2,j=Math.max(j,0),j=Math.min(j,parseFloat(b.height));let Y=v.regionBottom*z-(d*z-S)/2;Y=Math.max(Y,0),Y=Math.min(Y,parseFloat(b.height)),q=(v.regionRight-v.regionLeft)*z,J=Y-j}else B=0,j=0,q=0,J=0;this._divScanArea.style.left=B+"px",this._divScanArea.style.top=j+"px",this._divScanArea.style.width=q+"px",this._divScanArea.style.height=J+"px"}set croppingRegions(e){this._croppingRegions=e,this._bFetchingLoopStarted&&(this.bIncreaseRegionIndexAuto&&(this._croppingRegionIndex=0),this._fetchingLoop(!1))}get croppingRegions(){if(this._croppingRegions!==void 0)return this._croppingRegions;if(this._controler){const e=this._controler.getPropertyDisiredValue("croppingRegions");if(e&&e.length===1)return e[0]}return this._defaultCroppingRegions}set croppingRegionIndex(e){e<0?(this.bIncreaseRegionIndexAuto=!0,this._croppingRegionIndex=0):(this.bIncreaseRegionIndexAuto=!1,this._croppingRegionIndex=e)}get croppingRegionIndex(){return this._croppingRegionIndex}set loopInterval(e){if(e<0)throw new Error("'Invalid value.");this._loopInterval=e,this._bFetchingLoopStarted&&this._fetchingLoop(!1)}get loopInterval(){if(this._loopInterval!==void 0)return this._loopInterval;if(this._controler){const e=this._controler.getPropertyDisiredValue("loopInterval");if(e&&e.length===1)return e[0]}return this._defaultLoopInterval}set maxNumberOfFramesInBuffer(e){if(e<=0)throw new Error("Invalid value.");for(this._maxNumberOfFramesInBuffer=e;this._frameQueue&&this._frameQueue.length>this.maxNumberOfFramesInBuffer;)this._frameQueue.shift()}get maxNumberOfFramesInBuffer(){if(this._maxNumberOfFramesInBuffer!==void 0)return this._maxNumberOfFramesInBuffer;if(this._controler){const e=this._controler.getPropertyDisiredValue("maxNumberOfFramesInBuffer");if(e&&e.length===1)return e[0]}return this._defaultMaxNumberOfFramesInBuffer}get numberOfFramesInBuffer(){return this._frameQueue.length}set refreshInterval(e){this._refreshInterval=e}get refreshInterval(){if(this._refreshInterval!==void 0)return this._refreshInterval;if(this._controler){const e=this._controler.getPropertyDisiredValue("refreshInterval");if(e&&e.length===1)return e[0]}return this._defaultRefreshInterval}static async createInstance(e){let a=new et;(typeof e=="string"||e instanceof String)&&(e=JSON.parse(e));for(let d in e)a[d]=e[d];return this._hasEngineResourceLoaded=!0,et.onWarning&&(location&&location.protocol==="file:"?setTimeout(()=>{et.onWarning&&et.onWarning({id:1,message:"The page is opened over file:// and Dynamsoft Camera Enhancer may not work properly. Please open the page via https://."})},0):window.isSecureContext!==!1&&navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||setTimeout(()=>{et.onWarning&&et.onWarning({id:2,message:"Dynamsoft Camera Enhancer may not work properly in a non-secure context. Please open the page via https://."})},0)),a._drawingLayersManager=new xa,a}static async playVideo(e,a,d){return new Promise((p,v)=>{e||v(new Error("Invalid video element.")),a||v(new Error("Invalid source.")),e.onloadedmetadata=async()=>{e.onloadedmetadata=null,await e.play(),p(e)},typeof a=="string"||a instanceof String?e.src=a:e.srcObject=a,d!==void 0&&setTimeout(()=>v(new Error("Failed to play video. Timeout.")),d)})}static findBestRearCamera(e){if(!e||!e.length)return null;const a=["rear","back","rck","arrire","trasera","trs","traseira","posteriore","","","","","","","","","","arka","achterzijde","","baksidan","bagside","sau","bak","tylny","takakamera","belakang","","","spate","hts","zadn","darrere","zadn","","stranja","belakang",""];for(let d of e){const p=d.label.toLowerCase();if(p&&a.some(v=>p.includes(v))&&(["iPhone","iPad"].includes(Mt.OS)||/\b0(\b)?/.test(p)))return d.deviceId}return["Android","HarmonyOS"].includes(Mt.OS)?e[e.length-1].deviceId:null}async play(e,a,d,p){let v;if(this._video&&this.videoSrc){et._onLog&&(v=Date.now(),et._onLog("DCE: start loading static video: "+v));const S=await et.playVideo(this._video,this.videoSrc,4e3);if(et._onLog&&et._onLog("DCE: finish loading static video. Costs: "+(Date.now()-v)),!this._video)return S.pause(),this.playCallbackInfo={width:0,height:0,deviceId:null},{width:0,height:0,deviceId:null};const T={width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId};this.playCallbackInfo=JSON.parse(JSON.stringify(T));const M=this.mapCameraEvents.get("played");for(let B of M){if(!B)continue;const j=JSON.parse(JSON.stringify(T));setTimeout(()=>{this.isDisposed&&this.disposed||B.apply(this,[j])},0)}return this._recordedStates.videoPlaying=!0,T}if(this.singleFrameMode)return p&&p.notTriggerSingleFrameClick||this._clickIptSingleFrameMode(),this.playCallbackInfo={width:0,height:0,deviceId:null},{width:0,height:0,deviceId:null};if(!this._video)throw new Error("'video' is null or undefined.");const b=++this.iPlayRound;if(this.promisePlay&&(await this.promisePlay,b<this.iPlayRound))return this.playCallbackInfo={width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId},{width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId};this.promisePlay=(async()=>{var S;try{this._video&&this._video.srcObject&&this.stop(),et._onLog&&et._onLog("DCE: ======before video========");const T=()=>{if(!this._video)throw j&&j.getTracks().forEach(ot=>{ot.stop()}),this._videoTrack=null,this._currentCamera=null,new Error("'video' is null or undefined.")},M=this.getVideoSettings();let B,j;if(typeof M.video=="boolean"&&(M.video={}),e)delete M.video.facingMode,M.video.deviceId={exact:e};else if(!M.video.deviceId){if(this._lastDeviceId)delete M.video.facingMode,M.video.deviceId={exact:this._lastDeviceId};else if(this.ifSaveLastUsedCamera&&et.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete M.video.facingMode,M.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const ot=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),ct=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));ot&&ct&&(M.video.width=ot,M.video.height=ct)}else if(!this.ifSkipCameraInspection){if(M.video.facingMode){if(await this.getAllCameras(!1),!this._video)throw new Error("'video' is null or undefined.");let ot=M.video.facingMode;if(ot instanceof Array&&ot.length&&(ot=ot[0]),ot=ot.exact||ot.ideal||ot,ot==="environment"){B=!0;const ct=et.findBestRearCamera(this._allCameras);ct&&(delete M.video.facingMode,M.video.deviceId={exact:ct})}}}}a&&(M.video.width={ideal:a}),d&&(M.video.height={ideal:d}),et._onLog&&et._onLog("DCE: ======try getUserMedia========");let q=[0,500],J=null;const z=async ot=>{for(let ct of q){ct&&await new Promise(ut=>setTimeout(ut,ct)),T();try{et._onLog&&et._onLog("DCE: ask "+JSON.stringify(ot)),j=await navigator.mediaDevices.getUserMedia(ot);break}catch(ut){if(T(),ut.name==="NotFoundError"||ut.name==="NotAllowedError")throw ut;J=ut,et._onLog&&et._onLog("DCE: "+ut.message||ut)}}T()};let Y;if(await z(M),!j&&(et._onLog&&et._onLog("DCE: ======try getUserMedia again========"),Y=JSON.parse(JSON.stringify(M)),typeof Y.video=="object"&&(["iPhone","iPad"].includes(Mt.OS)?(a>=1280||d>=1280?Y.video.width=1280:a>=640||d>=640?Y.video.width=640:(a<640||d<640)&&(Y.video.width=320),delete Y.video.height):B&&!M.video.deviceId?(delete Y.video.facingMode,this._allCameras.length&&(Y.video.deviceId={ideal:this._allCameras[this._allCameras.length-1].deviceId})):Y.video=!0),et._onLog&&et._onLog("DCE: "+Y),await z(Y)),j||(q=[1e3,2e3],await z(M)),j||await z(Y),!j)throw J;const tt=()=>{const ot=j.getVideoTracks();let ct,ut;if(ot.length&&(ct=this._videoTrack=ot[0]),this._video&&ct){const mt=ct.getSettings();if(mt){for(let m of this._allCameras)if(mt.deviceId===m.deviceId){m._checked=!0,m.label=ct.label,ut=m;break}}}this._currentCamera=ut};if(await this.getAllCameras(!1),T(),B&&!this.ifSkipCameraInspection){tt();const ot=et.findBestRearCamera(this._allCameras),ct=(S=this._currentCamera)===null||S===void 0?void 0:S.deviceId;ot&&ot!=ct&&(j.getTracks().forEach(ut=>{ut.stop()}),q=[0,500,1e3,2e3],M.video.deviceId={exact:ot},await z(M))}et._onLog&&et._onLog("DCE: ======play video========"),T(),await et.playVideo(this._video,j,4e3),T(),et._onLog&&et._onLog("DCE: ======played video========"),this._bgLoading&&(this._bgLoading.style.animationPlayState="paused");const st=this._video.videoWidth+"x"+this._video.videoHeight;this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",this._video.videoWidth),this._optGotRsl.setAttribute("data-height",this._video.videoHeight),this._optGotRsl.innerText=st,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got")),et._onLog&&et._onLog("DCE: got "+st),tt(),this._renderSelCameraInfo();const nt={width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId};if(nt.deviceId&&(this._lastDeviceId=nt.deviceId,this.ifSaveLastUsedCamera&&et.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",this._lastDeviceId),M.video.width&&M.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(M.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(M.video.height))))),!p||!p.notTriggerPlayedEvent){const ot=this.mapCameraEvents.get("played");for(let ct of ot){if(!ct)continue;const ut=JSON.parse(JSON.stringify(nt));setTimeout(()=>{this.isDisposed&&this.disposed||ct.apply(this,[ut])},0)}}return this.promisePlay=null,nt}catch(T){throw this.promisePlay=null,this._bgLoading&&(this._bgLoading.style.display="none"),T.name==="NotFoundError"&&(DOMException?T=new DOMException("No camera available, please use a device with an accessible camera.",T.name):(T=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),T}})(),et._onLog&&(v=Date.now(),et._onLog("DCE: start opening camera: "+v));const C=await this.promisePlay;return et._onLog&&et._onLog("DCE: finish opening camera. Costs: "+(Date.now()-v)),this.playCallbackInfo=JSON.parse(JSON.stringify(C)),this._recordedStates.videoPlaying=!0,C}async resume(){this._assertOpen(),this._video&&(await this._video.play(),this._recordedStates.videoPlaying=!0),this.ifShowScanRegionLaser&&this.showScanRegionLaser()}pause(){this._assertOpen(),this._video&&(this._video.pause(),this._recordedStates.videoPlaying=!1),this.ifShowScanRegionLaser&&this.hideScanRegionLaser()}_bindUI(){if(!this.UIElement)throw new Error("Need to define `UIElement` before opening.");const e=[this.UIElement];for(let a=0;a<e.length;++a)for(let d of e[a].children)e.push(d);for(let a of e){if(!this._video&&a.classList.contains(this.containerClassName)){this._elContainer=a;const d=document.createElement("video");d.style.position="absolute",d.style.left="0",d.style.top="0",d.style.width="100%",d.style.height="100%",d.style.objectFit=this.getVideoFit(),d.setAttribute("playsinline","true"),d.setAttribute("muted","true"),this._video=d;const p=document.createElement("div");p.append(d),p.style.position="absolute",p.style.left="0",p.style.top="0",p.style.width="100%",p.style.height="100%",p.style.overflow="hidden",this._videoContainer=p,a.prepend(p)}else!this._divScanArea&&a.classList.contains("dce-scanarea")?this._divScanArea=a:!this._divScanLight&&a.classList.contains("dce-scanlight")?this._divScanLight=a:!this._bgLoading&&a.classList.contains("dce-bg-loading")?this._bgLoading=a:!this._bgCamera&&a.classList.contains("dce-bg-camera")?this._bgCamera=a:!this._selCam&&a.classList.contains("dce-sel-camera")?this._selCam=a:!this._selRsl&&a.classList.contains("dce-sel-resolution")?(this._selRsl=a,this.videoSrc||this.singleFrameMode||this._selRsl.options.length||(this._selRsl.innerHTML=[this._optGotRsl?"":'<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">1920x1080</option>','<option data-width="1280" data-height="720">1280x720</option>','<option data-width="640" data-height="480">640x480</option>'].join(""),this._optGotRsl=this._optGotRsl||this._selRsl.options[0])):!this._optGotRsl&&a.classList.contains("dce-opt-gotResolution")?this._optGotRsl=a:!this._btnClose&&a.classList.contains("dce-btn-close")?this._btnClose=a:!this._selMinLtr&&a.classList.contains("dlr-sel-minletter")?(this._selMinLtr=a,this._selMinLtr.options.length||(this._selMinLtr.innerHTML=[this._optGotMinLtr?"":'<option class="dlr-opt-gotMinLtr" value="got"></option>','<option value="0" selected>any letter</option>','<option value="3">3+ letters</option>','<option value="5">5+ letters</option>','<option value="8">8+ letters</option>','<option value="12">12+ letters</option>','<option value="17">17+ letters</option>','<option value="30">30+ letters</option>','<option value="50">50+ letters</option>','<option value="80">80+ letters</option>','<option value="120">120+ letters</option>'].join(""),this._optGotMinLtr=this._optGotMinLtr||this._selMinLtr.options[0])):!this._optGotMinLtr&&a.classList.contains("dlr-opt-gotMinLtr")&&(this._optGotMinLtr=a);if(this.extraBindings&&this.extraBindings.length)for(let d of this.extraBindings)try{d(a)}catch{}}if(!this._video)throw this._unbindUI(),Error(`Can not find the video container element with class '${this.containerClassName}'`);this.singleFrameMode||this.videoSrc?(this.singleFrameMode&&(this._elContainer&&(this._elContainer.addEventListener("click",this._clickIptSingleFrameMode),this._elContainer.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block")),this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._elContainer&&(["Android","HarmonyOS"].includes(Mt.OS)?(this._elContainer.addEventListener("touchend",this._tapDoFocus),this._elContainer.addEventListener("touchmove",this._touchMoveEvent)):this._elContainer.addEventListener("click",this._tapDoFocus)),this._selCam&&(this._selCam.style.display="block",this._selCam.addEventListener("change",this._onCameraSelChange)),this._selRsl&&(this._selRsl.style.display="block",this._selRsl.addEventListener("change",this._onResolutionSelChange)),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._bgLoading&&(this._bgLoading.style.display="block")),this._btnClose&&this._btnClose.addEventListener("click",this._onCloseBtnClick),document.addEventListener("visibilitychange",this._ev_documentHideEvent),window.ResizeObserver&&(this._resizeObserver||(this._resizeObserver=new ResizeObserver(a=>{for(let d of a)d.target===this._elContainer&&this._updateLayers()})),this._elContainer&&this._resizeObserver.observe(this._elContainer)),this._windowWidth=document.documentElement.clientWidth,window.addEventListener("resize",this._windowResizeListener)}_unbindUI(){this.singleFrameMode?(this._elContainer&&(this._elContainer.removeEventListener("click",this._clickIptSingleFrameMode),this._elContainer.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._bgLoading&&(this._bgLoading.style.display="none"),this._elContainer&&(this._elContainer.removeEventListener("click",this._tapDoFocus),this._elContainer.removeEventListener("touchend",this._tapDoFocus),this._elContainer.removeEventListener("touchmove",this._touchMoveEvent)),this._selCam&&this._selCam.removeEventListener("change",this._onCameraSelChange),this._selRsl&&this._selRsl.removeEventListener("change",this._onResolutionSelChange),this._btnClose&&this._btnClose.removeEventListener("click",this._onCloseBtnClick),this.hideScanRegionLaser(),this.hideViewDecorator(),this.hideScanRegionOverlays(),this._drawingLayersManager.setVisible(!1),this._hideOriginalImageCvs(),this._videoContainer&&this._videoContainer.remove(),this._video=null,this._videoContainer=null,this._elContainer=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this._divScanArea=null,this._divScanLight=null,this._cvsScanRegion&&(this._cvsScanRegion.remove(),this._cvsScanRegion=null),this._singleFrameModeIpt&&(this._singleFrameModeIpt.remove(),this._singleFrameModeIpt=null),this._cvsSingleFrameMode&&(this._cvsSingleFrameMode.remove(),this._cvsSingleFrameMode=null),document.removeEventListener("visibilitychange",this._ev_documentHideEvent),window.ResizeObserver&&this._resizeObserver&&this._resizeObserver.disconnect(),window.removeEventListener("resize",this._windowResizeListener)}_assertOpen(){if(!this._bOpen)throw Error("The camera is not open.")}async open(e){this.UIElement||await this.setUIElement(et.defaultUIElementURL),this._bindUI(),e&&this.appendAndShowUI();let a=await this.play();this.bOpen=!0,this._focusParameters.fds=null,this._focusParameters.kTimeout=void 0,this._focusSupported=!0,this._tapFocusEnabled&&!this.singleFrameMode&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,this._focusParameters.fds||(this._focusSupported=!1,this._tapFocusEnabled=!1));const d=this.mapCameraEvents.get("cameraopen");for(let p of d){if(!p)continue;const v=JSON.parse(JSON.stringify(a));setTimeout(()=>{this.isDisposed&&this.disposed||p.apply(this,[v])},0)}return a}close(e){if(!this._video)return;this.stop(),this._hideOriginalImage(!1),this.hideTip(),this._unbindUI(),e&&this.hideUI(),this.stopFetchingLoop(),this.bOpen=!1;const a=this.mapCameraEvents.get("cameraclose");for(let d of a){if(!d)continue;const p={width:0,height:0,deviceId:null};setTimeout(()=>{this.isDisposed&&this.disposed||d.apply(this,[p])},0)}}stop(){this._video&&this._video.srcObject&&(et._onLog&&et._onLog("DCE: ======stop video========"),this._video.srcObject.getTracks().forEach(e=>{e.stop()}),this._video.srcObject=null,this._videoTrack=null,this._currentCamera=null),this._video&&this.videoSrc&&(et._onLog&&et._onLog("DCE: ======stop existing video========"),this._video.pause(),this._video.currentTime=0),this._bgLoading&&(this._bgLoading.style.animationPlayState=""),this._frameQueue.length=0,this._reusedCvs&&this._reusedCvs.ctx2d&&this._reusedCvs.ctx2d.clearRect(0,0,this._reusedCvs.width,this._reusedCvs.height),this.forceLoseContext()}async getAllCameras(e=!0){let a=(await navigator.mediaDevices.enumerateDevices()).filter(v=>v.kind==="videoinput");if(e&&a&&a.length&&!a[0].deviceId){let v=await navigator.mediaDevices.getUserMedia({video:!0});a=(await navigator.mediaDevices.enumerateDevices()).filter(b=>b.kind==="videoinput"),v.getTracks().forEach(b=>{b.stop()})}const d=[],p=[];if(this._allCameras)for(let v of this._allCameras)v._checked&&p.push(v);for(let v=0;v<a.length;v++){let b,C=a[v];for(let S of p)if(C.deviceId==S.deviceId){b=S;break}b||(b={deviceId:C.deviceId,label:C.label?C.label:"camera "+v,_checked:!1}),b.deviceId&&d.push(b)}return this._allCameras=d,et._onLog&&et._onLog("DCE: "+JSON.stringify(this._allCameras)),d}_renderSelCameraInfo(){if(!this._selCam)return;let e;this._selCam.textContent="";for(let a of this._allCameras){const d=document.createElement("option");d.value=a.deviceId,d.innerText=a.label,this._selCam.append(d),a.deviceId&&this._currentCamera&&this._currentCamera.deviceId==a.deviceId&&(e=d)}this._selCam.value=e?e.value:""}getSelectedCamera(){if(!this._bOpen){let e="";const a=this.videoSettings.video.deviceId;a&&(e=a.exact||a.ideal||a);for(let d of this._allCameras)if(d.deviceId===e)return JSON.parse(JSON.stringify(d));return{deviceId:e,label:"",_checked:!1}}return this._currentCamera}async selectCamera(e){let a="";if(e&&(a=e.deviceId||e),this.videoSettings.video.deviceId={exact:a},!this._bOpen||this._video.paused)return null;let d=null;this._currentCamera&&(d=this._currentCamera.deviceId);const p=this._video.videoWidth,v=this._video.videoHeight,b=await this.play(e.deviceId||e);if(this._focusParameters.fds=null,this._focusParameters.kTimeout=void 0,this._focusSupported=!0,this._tapFocusEnabled&&!this.singleFrameMode&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,this._focusParameters.fds||(this._focusSupported=!1,this._tapFocusEnabled=!1)),d!==b.deviceId){const C=this.mapCameraEvents.get("camerachange");for(let S of C){if(!S)continue;const T=JSON.parse(JSON.stringify(b));setTimeout(()=>{this.isDisposed&&this.disposed||S.apply(this,[T])},0)}}if(p!==b.width||v!==b.height){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let S of this._arrScanRegionOverlays)S&&this._updateScanRegionOverlay(S);this._updateDrawingLayersSize(),this._updateVideoContainerStyle();const C=this.mapCameraEvents.get("resolutionchange");for(let S of C){if(!S)continue;const T=JSON.parse(JSON.stringify(b));setTimeout(()=>{this.isDisposed&&this.disposed||S.apply(this,[T])},0)}}return b}getResolution(){if(this._bOpen)return[this._video.videoWidth,this._video.videoHeight];{let e=0,a=0;const d=this.videoSettings.video.width,p=this.videoSettings.video.height;return d&&(e=d.exact||d.ideal||d),p&&(a=p.exact||p.ideal||p),[e,a]}}async setResolution(e,a){let d,p;if(e instanceof Array?(d=e[0],p=e[1]):(d=e,p=a),this.videoSettings.video.width={ideal:d},this.videoSettings.video.height={ideal:p},!this._bOpen||this._video.paused)return null;const v=this._video.videoWidth,b=this._video.videoHeight,C=await this.play(null,d,p);if(v!==C.width||b!==C.height){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let T of this._arrScanRegionOverlays)T&&this._updateScanRegionOverlay(T);this._updateDrawingLayersSize(),this._updateVideoContainerStyle();const S=this.mapCameraEvents.get("resolutionchange");for(let T of S){if(!T)continue;const M=JSON.parse(JSON.stringify(C));setTimeout(()=>{this.isDisposed&&this.disposed||T.apply(this,[M])},0)}}return C}async getResolutions(e){let a="";const d=(v,b)=>{const C=this._mapCameraResolutions.get(v);if(!C||!C.length)return!1;for(let S of C)if(S[0]===b.width&&S[1]===b.height)return!0;return!1},p=async(v,b,C)=>{const S={video:{deviceId:{exact:v},width:{ideal:b},height:{ideal:C}}};let T=null;try{T=await navigator.mediaDevices.getUserMedia(S)}catch{return null}if(!T)return null;const M=T.getVideoTracks();let B=null;try{const j=M[0].getSettings();B={width:j.width,height:j.height}}catch{const q=document.createElement("video");q.srcObject=T,B={width:q.videoWidth,height:q.videoHeight},q.srcObject=null}return M.forEach(j=>{j.stop()}),B};if(!this._bOpen){const v=this.videoSettings.video.deviceId;if(!v||(a=v.hasOwnProperty("exact")?this.videoSettings.video.deviceId.exact:v.hasOwnProperty("ideal")?this.videoSettings.video.deviceId.ideal:this.videoSettings.video.deviceId,!a))return null;let b=this._mapCameraResolutions.get(a);if(b&&!e)return this._mapCameraResolutions.get(a);this._mapCameraResolutions.set(a,[]),b=this._mapCameraResolutions.get(a);for(let C of this._predefinedResolutions){const S=await p(a,C.width,C.height);S&&!d(a,S)&&b.push([S.width,S.height])}return b}if(this._currentCamera){a=this._currentCamera.deviceId;let v=this._mapCameraResolutions.get(a);if(v&&!e)return this._mapCameraResolutions.get(a);this._mapCameraResolutions.set(a,[]),v=this._mapCameraResolutions.get(a);let b=this._videoTrack;for(let C of this._predefinedResolutions){await b.applyConstraints({width:{ideal:C.width},height:{ideal:C.height}});const S=b.getSettings(),T={width:S.width,height:S.height};d(a,T)||v.push([T.width,T.height])}return this._video.srcObject.getTracks().forEach(C=>{C.stop()}),await this.play(a,null,null,{notTriggerPlayedEvent:!0}),v}return null}on(e,a){if(!a)return;const d=this.mapCameraEvents.get(e.toLowerCase());if(!d)throw new Error(`Event '${e}' does not exist.`);d.includes(a)||d.push(a)}off(e,a){const d=this.mapCameraEvents.get(e.toLowerCase());if(!d)throw new Error(`Event '${e}' does not exist.`);const p=d.indexOf(a);p!==-1&&d.splice(p,1)}offAll(e){if(e){if(typeof e=="string"){const a=this.mapCameraEvents.get(e);a&&(a.length=0)}}else for(let a of this.mapCameraEvents.values())a&&(a.length=0)}getVideoSettings(){return JSON.parse(JSON.stringify(this.videoSettings))}updateVideoSettings(e){if(this.videoSettings=JSON.parse(JSON.stringify(e)),this._lastDeviceId=null,this._bOpen)return this.play()}isOpen(){return this._bOpen}getCapabilities(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getCapabilities()' is unavailable in singleFrameMode.");return this._videoTrack&&this._videoTrack.getCapabilities?this._videoTrack.getCapabilities():{}}getCameraSettings(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getCameraSettings()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings():null}getConstraints(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getConstraints()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getConstraints():null}async applyConstraints(e){if(this._assertOpen(),this.singleFrameMode)throw new Error("'applyConstraints()' is unavailable in singleFrameMode.");if(!this._videoTrack)throw new Error('"_videoTrack" is null.');if(!this._videoTrack.applyConstraints)throw Error("Not supported.");return await this._videoTrack.applyConstraints(e)}async turnOnTorch(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'turnOnTorch()' is unavailable in singleFrameMode.");if(this.getCapabilities().torch)return await this._videoTrack.applyConstraints({advanced:[{torch:!0}]});throw Error("Not supported.")}async turnOffTorch(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'turnOffTorch()' is unavailable in singleFrameMode.");if(this.getCapabilities().torch)return await this._videoTrack.applyConstraints({advanced:[{torch:!1}]});throw Error("Not supported.")}async setColorTemperature(e){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setColorTemperature()' is unavailable in singleFrameMode.");let a=this.getCapabilities().colorTemperature;if(!a)throw Error("Not supported.");return e<a.min?e=a.min:e>a.max&&(e=a.max),await this._videoTrack.applyConstraints({advanced:[{colorTemperature:e,whiteBalanceMode:"manual"}]})}getColorTemperature(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getColorTemperature()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().colorTemperature||0:null}async setExposureCompensation(e){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setExposureCompensation()' is unavailable in singleFrameMode.");let a=this.getCapabilities().exposureCompensation;if(!a)throw Error("Not supported.");return e<a.min?e=a.min:e>a.max&&(e=a.max),await this._videoTrack.applyConstraints({advanced:[{exposureCompensation:e}]})}getExposureCompensation(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getExposureCompensation()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().exposureCompensation||0:null}async _setHardwareScale(e){if(this._assertOpen(),this.singleFrameMode)throw new Error("'_setHardwareScale()' is unavailable in singleFrameMode.");if(e<1)throw new RangeError("Invalid value.");if(!this._videoTrack)return;const a=this.getCapabilities().zoom;if(!a)throw new Error("Not supported.");return e<a.min?e=a.min:e>a.max&&(e=a.max),e=Bt(e,a.min,a.step,a.max),await this._videoTrack.applyConstraints({advanced:[{zoom:e}]}),e}_getHardwareScale(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'_getHardwareScale()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().zoom||1:null}_setSoftwareScale(e,a){if(this._assertOpen(),this.singleFrameMode)throw new Error("'_setSoftwareScale()' is unavailable in singleFrameMode.");if(e<1)throw new RangeError("Invalid value.");a&&this._setScaleCenter(a),this._softwareScale=e,this._scaleVideo(e,a)}_getSoftwareScale(){return this._softwareScale}_setScaleCenter(e){if(this._assertOpen(),this.singleFrameMode)throw new Error("'_setScaleCenter()' is unavailable in singleFrameMode.");if(!e||typeof e.x!="string"||typeof e.y!="string")throw new Error("Invalid center.");const a=this._video.videoWidth,d=this._video.videoHeight;let p=0,v=0;if(e.x.endsWith("px"))p=parseFloat(e.x);else{if(!e.x.endsWith("%"))throw new Error("Invalid scale center.");p=parseFloat(e.x)/100*a}if(e.y.endsWith("px"))v=parseFloat(e.y);else{if(!e.y.endsWith("%"))throw new Error("Invalid scale center.");v=parseFloat(e.y)/100*d}if(p==NaN||v==NaN)throw new Error("Invalid scale center.");this._scaleCenter={x:p,y:v}}_resetScaleCenter(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'_resetScaleCenter()' is unavailable in singleFrameMode.");const e=this._video.videoWidth,a=this._video.videoHeight;this._scaleCenter={x:e/2,y:a/2}}_isVideoCenter(e){if(this._assertOpen(),this.singleFrameMode)throw new Error("'_isVideoCenter()' is unavailable in singleFrameMode.");return e&&e.x==this._video.videoWidth/2&&e.y==this._video.videoHeight/2}async _setZoom(e){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setZoom()' is unavailable in singleFrameMode.");if(e<1)throw new RangeError("Invalid value.");this._resetScaleCenter();try{if(this._isVideoCenter(this._scaleCenter)){const a=await this._setHardwareScale(e);let d=this._getHardwareScale();d==1&&a!=1&&(d=a),e>d?this._setSoftwareScale(e/d):this._setSoftwareScale(1)}else await this._setHardwareScale(1),this._setSoftwareScale(e)}catch(a){if((a.message||a)!=="Not supported.")throw a;this._setSoftwareScale(e)}}async setZoom(e){if(typeof e!="number"&&typeof e!="object")throw new TypeError("Illegal type of argument.");if(typeof e=="number")return this._setZoom(e);if(this._assertOpen(),this.singleFrameMode)throw new Error("'setZoom()' is unavailable in singleFrameMode.");if(e){if(typeof e.factor!="number")throw new TypeError("Illegal type of 'factor'.");if(e.factor<1)throw new RangeError("Invalid value.");e.centerPoint?this._setScaleCenter(e.centerPoint):this._resetScaleCenter();try{if(this._isVideoCenter(this._scaleCenter)){const a=await this._setHardwareScale(e.factor);let d=this._getHardwareScale();d==1&&a!=1&&(d=a),e.factor>d?this._setSoftwareScale(e.factor/d):this._setSoftwareScale(1)}else await this._setHardwareScale(1),this._setSoftwareScale(e.factor)}catch(a){if((a.message||a)!=="Not supported.")throw a;this._setSoftwareScale(e.factor)}}}getZoom(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getZoom()' is unavailable in singleFrameMode.");return this._videoTrack?this._getHardwareScale()*this._softwareScale:null}getZoomSettings(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getZoom()' is unavailable in singleFrameMode.");return this._videoTrack?{factor:this._getHardwareScale()*this._softwareScale}:null}async resetZoom(){await this.setZoom({factor:1})}async setFrameRate(e){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setFrameRate()' is unavailable in singleFrameMode.");let a=this.getCapabilities().frameRate;if(!a)throw Error("Not supported.");return e<a.min?e=a.min:e>a.max&&(e=a.max),await this._videoTrack.applyConstraints({width:{ideal:Math.max(this._video.videoWidth,this._video.videoHeight)},frameRate:e})}getFrameRate(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getFrameRate()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().frameRate:null}async _setFocus(e,a){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setFocus()' is unavailable in singleFrameMode.");if(typeof e!="string")throw Error("Invalid focus mode.");e=e.toLowerCase();const d=this.getCapabilities().focusMode,p=this.getCapabilities().focusDistance;if(!d)throw Error("Not supported.");if(!d.includes(e))throw Error("Unsupported mode.");if(a>=0){if(!p)throw Error("Manual focus unsupported.");return a<p.min?a=p.min:a>p.max&&(a=p.max),a=Bt(a,p.min,p.step,p.max),await this._videoTrack.applyConstraints({advanced:[{focusMode:e,focusDistance:a}]})}return await this._videoTrack.applyConstraints({advanced:[{focusMode:e}]})}async setFocus(e,a){if(typeof e=="string")return this._setFocus(e,a);if(this._assertOpen(),this.singleFrameMode)throw new Error("'setFocus()' is unavailable in singleFrameMode.");if(!e)return;const d=this.getCapabilities(),p=d.focusMode,v=d.focusDistance;if(!p)throw Error("Not supported.");if(typeof e.mode!="string")throw Error("Invalid focus mode.");const b=e.mode.toLowerCase();if(!p.includes(b))throw Error("Unsupported focus mode.");if(b!=="manual")return this._focusParameters._focusArea=null,await this._videoTrack.applyConstraints({advanced:[{focusMode:b}]});if(!v)throw Error("Manual focus unsupported.");if(e.hasOwnProperty("distance")){let C=e.distance;return C<v.min?C=v.min:C>v.max&&(C=v.max),C=Bt(C,v.min,v.step,v.max),this._focusParameters._focusArea=null,await this._videoTrack.applyConstraints({advanced:[{focusMode:b,focusDistance:C}]})}if(!e.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const C=e.area.centerPoint;let S=e.area.width,T=e.area.height;if(!S||!T){const M=this._video.videoWidth,B=this._video.videoHeight;S||(S=2*Math.round(Math.min(M,B)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),T||(T=2*Math.round(Math.min(M,B)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}this._focusParameters._focusArea={centerPoint:{x:C.x,y:C.y},width:S,height:T},await this._setLocalFocus(C,S,T)}}getFocus(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'_getHardwareScale()' is unavailable in singleFrameMode.");if(!this._videoTrack)return null;const e=this._videoTrack.getSettings().focusMode;return e?e==="continuous"?{mode:e}:{mode:e,distance:this._videoTrack.getSettings().focusDistance}:null}getFocusSettings(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'_getHardwareScale()' is unavailable in singleFrameMode.");if(!this._videoTrack)return null;const e=this._videoTrack.getSettings(),a=e.focusMode;return a?a==="manual"?this._focusParameters._focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters._focusArea))}:{mode:"manual",distance:e.focusDistance}:{mode:a}:null}async _setFocusAndGetContract(e,a){const d=j=>{if(!this._bOpen||!this._videoTrack||this.video.paused||j.focusTaskId!=this._focusParameters.curFocusTaskId){this._bOpen&&this._videoTrack&&!this.video.paused||(this._focusParameters.isDoingFocus=0);const q=new Error(`Focus task ${j.focusTaskId} canceled.`);throw q.name="DeprecatedTaskError",q}this._focusParameters.isDoingFocus===1&&Date.now()-j.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)};let p;a=Bt(a,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),await this._videoTrack.applyConstraints({advanced:[{focusMode:"manual",focusDistance:a}]}),d(e),p=this._focusParameters.oldDistance==null?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/a),Math.abs(1/this._focusParameters.fds.max-1/a))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/a)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=a,await new Promise(j=>{setTimeout(j,p)}),d(e);let v=e.focusL-e.focusW/2,b=e.focusT-e.focusH/2,C=e.focusW,S=e.focusH;if(v>=this.video.videoWidth||b>=this.video.videoHeight)throw new Error("Invalid area.");v+C>this.video.videoWidth&&(C=this.video.videoWidth-v),b+S>this.video.videoHeight&&(S=this.video.videoHeight-b);const T=this._getImageData(this.video,this.video.videoWidth,this.video.videoHeight,{sx:v,sy:b,sWidth:C,sHeight:S,dWidth:C,dHeight:S},null,{pixelFormat:vt.RGBA});if(!T)return this._setFocusAndGetContract(e,a);const M=T.data;let B=0;for(let j=0,q=M.length-8;j<q;++j){let J=M[j]-M[j+8];++j;let z=M[j]-M[j+8];++j;let Y=M[j]-M[j+8];++j,B+=J*J+z*z+Y*Y}return-B}async _doFocusDetail(e,a,d,p,v,b,C){let S;if(a=Bt(a,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),p=Bt(p,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),b?b=Bt(b,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(b=Bt(Math.sqrt((a||this._focusParameters.fds.step)*(p||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),C=await this._setFocusAndGetContract(e,b)),C<=d&&C<=v?S=3:d<v&&d<C?S=1:v<d&&v<C&&(S=2),(p-a)/2<=this._focusParameters.fds.step)return S===3||(S===1?await this._videoTrack.applyConstraints({advanced:[{focusMode:"manual",focusDistance:a}]}):S===2&&await this._videoTrack.applyConstraints({advanced:[{focusMode:"manual",focusDistance:p}]})),!0;if(S===1)return await this._doFocusDetail(e,a,d,b,C);if(S===2)return await this._doFocusDetail(e,b,C,p,v);if(S!==3)return d=await this._setFocusAndGetContract(e,a),v=await this._setFocusAndGetContract(e,p),await this._doFocusDetail(e,a,d,p,v);let T=Bt(Math.sqrt((a||this._focusParameters.fds.step)*(b||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),M=Bt(Math.sqrt((p||this._focusParameters.fds.step)*(b||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/T)<=Math.abs(1/this._focusParameters.oldDistance-1/M)){let B=await this._setFocusAndGetContract(e,T);if(B<C)return await this._doFocusDetail(e,a,d,b,C,T,B);if(B==C)return await this._doFocusDetail(e,T,B,b,C);let j=await this._setFocusAndGetContract(e,M);if(B>C&&C<j)return await this._doFocusDetail(e,T,B,M,j,b,C);if(C==j)return await this._doFocusDetail(e,b,C,M,j);if(C>j)return await this._doFocusDetail(e,b,C,p,v,M,j)}else{let B=await this._setFocusAndGetContract(e,M);if(C>B)return await this._doFocusDetail(e,b,C,p,v,M,B);if(C==B)return await this._doFocusDetail(e,b,C,M,B);let j=await this._setFocusAndGetContract(e,T);if(j>C&&C<B)return await this._doFocusDetail(e,T,j,M,B,b,C);if(j==C)return await this._doFocusDetail(e,T,j,b,C);if(j<C)return await this._doFocusDetail(e,a,d,b,C,T,j)}return!1}async _setLocalFocus(e,a,d,p,v){if(this._focusParameters.isDoingFocus==1)return!1;if(!e||typeof e.x!="string"||typeof e.y!="string")throw new Error("Invalid centerPoint.");if(!a||typeof a!="string")throw new Error("Invalid width.");if(!d||typeof d!="string")throw new Error("Invalid height.");const b=this._video.videoWidth,C=this._video.videoHeight;let S=0,T=0;if(e.x.endsWith("px"))S=parseFloat(e.x);else{if(!e.x.endsWith("%"))throw new Error("Invalid centerPoint.");S=parseFloat(e.x)/100*b}if(e.y.endsWith("px"))T=parseFloat(e.y);else{if(!e.y.endsWith("%"))throw new Error("Invalid centerPoint.");T=parseFloat(e.y)/100*C}if(S==NaN||T==NaN)throw new Error("Invalid centerPoint.");let M=0;if(a.endsWith("px"))M=parseFloat(a);else{if(!a.endsWith("%"))throw new Error("Invalid width.");M=parseFloat(a)/100*b}if(M==NaN)throw new Error("Invalid width.");let B=0;if(d.endsWith("px"))B=parseFloat(d);else{if(!d.endsWith("%"))throw new Error("Invalid height.");B=parseFloat(d)/100*C}if(B==NaN)throw new Error("Invalid height.");if(this._softwareScale!==1){const J=this._softwareScale,z=this._scaleCenter;M/=J,B/=J,S=(1-1/J)*z.x+S/J,T=(1-1/J)*z.y+T/J}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");this._focusParameters.kTimeout==null&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const j={focusL:S,focusT:T,focusW:M,focusH:B,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},q=async(J,z,Y)=>{try{(z==null||z<this._focusParameters.fds.min)&&(z=this._focusParameters.fds.min),(Y==null||Y>this._focusParameters.fds.max)&&(Y=this._focusParameters.fds.max),this._focusParameters.oldDistance=null;let tt=Bt(Math.sqrt(Y*(z||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),st=Bt(Math.sqrt((z||this._focusParameters.fds.step)*tt),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),nt=Bt(Math.sqrt(tt*Y),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),ot=await this._setFocusAndGetContract(J,nt),ct=await this._setFocusAndGetContract(J,st),ut=await this._setFocusAndGetContract(J,tt);if(ct>ut&&ut<ot){const mt=await this._doFocusDetail(J,st,ct,nt,ot,tt,ut);return this._focusParameters.isDoingFocus=0,mt}if(ct<ut&&ct<ot){let mt=await this._setFocusAndGetContract(J,z);const m=await this._doFocusDetail(J,z,mt,tt,ut,st,ct);return this._focusParameters.isDoingFocus=0,m}if(ut>ot&&ct>ot){let mt=await this._setFocusAndGetContract(J,Y);const m=await this._doFocusDetail(J,tt,ut,Y,mt,nt,ot);return this._focusParameters.isDoingFocus=0,m}if(ct==ut&&ut<ot){const mt=await this._doFocusDetail(J,st,ct,tt,ut);return this._focusParameters.isDoingFocus=0,mt}if(ut==ot&&ct>ut){const mt=await this._doFocusDetail(J,tt,ut,nt,ot);return this._focusParameters.isDoingFocus=0,mt}return q(J,z,Y)}catch(tt){if(tt.name!=="DeprecatedTaskError")throw tt}};return q(j,p,v)}async enableTapToFocus(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'enableTapToFocus()' is unavailable in singleFrameMode.");if(!this._videoTrack)throw new Error("Video is not playing.");if(!this._focusSupported)throw new Error("Tapping to focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,this._tapFocusEnabled=!1,new Error("Tapping to focus unsupported.");this._tapFocusEnabled=!0}disableTapToFocus(){this._tapFocusEnabled=!1}isTapToFocusEnabled(){return this._tapFocusEnabled}_updateVideoContainerStyle(){if(!this._video||this.singleFrameMode)return;const e=this._getSoftwareScale(),a=this._videoContainer;if(this.videoFit==="contain"&&e>1){const d=this._video.videoWidth,p=this._video.videoHeight,v=window.getComputedStyle(this._elContainer),b=parseFloat(v.width),C=parseFloat(v.height),S=d/p;if(b/C<S){let T=b/S;a.style.left="0",a.style.top=(C-T)/2/C*100+"%",a.style.width="100%",a.style.height=T/C*100+"%"}else{let T=C*S;a.style.left=(b-T)/2/b*100+"%",a.style.top="0",a.style.width=T/b*100+"%",a.style.height="100%"}}else a.style.left="0",a.style.top="0",a.style.width="100%",a.style.height="100%"}_scaleVideo(e,a){if(this._video&&!this.singleFrameMode){if(e<1)throw new RangeError("Invalid scale value.");if(a&&this._setScaleCenter(a),e===1)this._video.style.transform="";else{const d=this.getVideoFit(),p=this._video.videoWidth,v=this._video.videoHeight,b=window.getComputedStyle(this._elContainer),C=parseFloat(b.width),S=parseFloat(b.height),T=C/S,M=p/v;let B=1;d==="contain"?B=T<M?C/(p/e):S/(v/e):d==="cover"&&(B=M>T?S/(p/e):C/(v/e));const j=B*(1-1/e)*(p/2-this._scaleCenter.x),q=B*(1-1/e)*(v/2-this._scaleCenter.y);this._video.style.transform=`translate(${j}px, ${q}px) scale(${e})`}this._updateVideoContainerStyle()}}getFrameSize(e,a,d,p){if(!e||!a)return null;let v,b,C,S,T=e,M=a;const B={regionLeft:0,regionTop:0,regionRight:T,regionBottom:M,regionMeasuredByPercentage:!1};d?(d.regionMeasuredByPercentage?(B.regionLeft=d.regionLeft*T/100,B.regionTop=d.regionTop*M/100,B.regionRight=d.regionRight*T/100,B.regionBottom=d.regionBottom*M/100):(B.regionLeft=d.regionLeft,B.regionTop=d.regionTop,B.regionRight=d.regionRight,B.regionBottom=d.regionBottom),v=Math.round(B.regionLeft),b=Math.round(B.regionTop),T=Math.round(B.regionRight-B.regionLeft),M=Math.round(B.regionBottom-B.regionTop)):(v=0,b=0,T=Math.round(T),M=Math.round(M));const j=Math.max(T,M);if(p&&p>0&&j>p){const q=p/j;T>M?(C=p,S=Math.round(M*q)):(C=Math.round(T*q),S=p)}else C=T,S=M;return C<=0||S<=0?null:{sx:v,sy:b,sWidth:T,sHeight:M,dWidth:C,dHeight:S}}getFrame(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getFrame()' is unavailable in singleFrameMode.");return this._getVideoData()}getImage(){return this.getFrame()}_drawImage(e,a,d,p,v,b,C){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(!d||!p)return null;if(a instanceof HTMLVideoElement&&a.readyState!==4||a instanceof HTMLImageElement&&!a.complete)throw new Error("The source is not loaded.");let S;et._onLog&&(S=Date.now(),et._onLog("DCE: _drawImage(), START: "+S));let T=0,M=0,B=d,j=p,q=0,J=0,z=d,Y=p;v&&(v.sx&&(T=Math.round(v.sx)),v.sy&&(M=Math.round(v.sy)),v.sWidth&&(B=Math.round(v.sWidth)),v.sHeight&&(j=Math.round(v.sHeight)),v.dx&&(q=Math.round(v.dx)),v.dy&&(J=Math.round(v.dy)),v.dWidth&&(z=Math.round(v.dWidth)),v.dHeight&&(Y=Math.round(v.dHeight)));let tt=vt.RGBA;C&&C.pixelFormat&&(tt=C.pixelFormat);const st=e;if(C&&C.bUseWebGL){et._onLog&&et._onLog("DCE: _drawImage() in WebGL."),(st.width<q+z||st.height<J+Y)&&(st.width=q+z,st.height=J+Y,st.ctxWebGL&&st.ctxWebGL.viewport(0,0,q+z,J+Y));const nt=st.ctxWebGL||st.getContext("webgl",{antialias:!1})||st.getContext("experimental-webgl",{antialias:!1});if(!nt){et._onLog&&et._onLog("DCE: WebGL unavailable.");const m=new Error("WebGL error: unable to initialize WebGL. Your browser or machine may not support it.");throw m.name="WebGLError",m}if(!st.ctxWebGL||tt!==this.shaderPixelFormat){st.ctxWebGL=nt;const m=t=>{const i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),t.STATIC_DRAW);const o=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),t.STATIC_DRAW),{positions:i,texCoords:o}},dt=t=>{const i=t.createTexture();return t.bindTexture(t.TEXTURE_2D,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),i},_t=(t,i)=>{const o=t.createProgram();if(i.forEach(f=>t.attachShader(o,f)),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS)){const f=new Error(`An error occured linking the program: ${t.getProgramInfoLog(o)}.`);throw f.name="WebGLError",f}return t.useProgram(o),o},Ft=(t,i,o)=>{const f=t.createShader(i);if(t.shaderSource(f,o),t.compileShader(f),!t.getShaderParameter(f,t.COMPILE_STATUS)){const h=new Error(`An error occured compiling the shader: ${t.getShaderInfoLog(f)}.`);throw h.name="WebGLError",h}return f},s=`
                    attribute vec2 a_position;
                    attribute vec2 a_texCoord;

                    uniform mat3 u_matrix;
                    uniform mat3 u_textureMatrix;

                    varying vec2 v_texCoord;
                    void main(void) {
                    gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);
                    v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;
                    }
                `;let r="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(tt)&&(r=tt.slice(0,3));const n=`
                    precision mediump float;
                    varying vec2 v_texCoord;
                    uniform sampler2D u_image;
                    uniform float uColorFactor;

                    void main() {
                        vec4 sample = texture2D(u_image, v_texCoord);
                        float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;
                        gl_FragColor = vec4(sample.${r} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);
                    }
                `,l=_t(nt,[Ft(nt,nt.VERTEX_SHADER,s),Ft(nt,nt.FRAGMENT_SHADER,n)]);this._webGLProgramInfo={program:l,attribLocations:{vertexPosition:nt.getAttribLocation(l,"a_position"),texPosition:nt.getAttribLocation(l,"a_texCoord")},uniformLocations:{uSampler:nt.getUniformLocation(l,"u_image"),uColorFactor:nt.getUniformLocation(l,"uColorFactor"),uMatrix:nt.getUniformLocation(l,"u_matrix"),uTextureMatrix:nt.getUniformLocation(l,"u_textureMatrix")}},this._webGLBuffers=m(nt),this._webGLTexture=dt(nt),this.shaderPixelFormat=tt}const ot=(m,dt,_t)=>{m.bindBuffer(m.ARRAY_BUFFER,dt),m.enableVertexAttribArray(_t),m.vertexAttribPointer(_t,2,m.FLOAT,!1,0,0)},ct=(m,dt,_t)=>{const Ft=m.RGBA,s=m.RGBA,r=m.UNSIGNED_BYTE;m.bindTexture(m.TEXTURE_2D,dt),m.texImage2D(m.TEXTURE_2D,0,Ft,s,r,_t)},ut=(m,dt,_t,Ft)=>{m.clearColor(0,0,0,1),m.clearDepth(1),m.enable(m.DEPTH_TEST),m.depthFunc(m.LEQUAL),m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT),ot(m,_t.positions,dt.attribLocations.vertexPosition),ot(m,_t.texCoords,dt.attribLocations.texPosition),m.activeTexture(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,Ft),m.uniform1i(dt.uniformLocations.uSampler,0),m.uniform1f(dt.uniformLocations.uColorFactor,[vt.GREY,vt.GREY32].includes(tt)?1:0);let s,r,n=Wt.translate(Wt.identity(),-1,-1);n=Wt.scale(n,2,2),n=Wt.scale(n,1/m.canvas.width,1/m.canvas.height),s=Wt.translate(n,q,J),s=Wt.scale(s,z,Y),m.uniformMatrix3fv(dt.uniformLocations.uMatrix,!1,s),r=Wt.translate(Wt.identity(),T/d,M/p),r=Wt.scale(r,B/d,j/p),m.uniformMatrix3fv(dt.uniformLocations.uTextureMatrix,!1,r),m.drawArrays(m.TRIANGLES,0,6)};let mt;if(ct(nt,this._webGLTexture,a),ut(nt,this._webGLProgramInfo,this._webGLBuffers,this._webGLTexture),b){if(b.length<z*Y*4)throw new Error("Unexpected size of the 'bufferContainer'.");mt=b}else mt=new Uint8Array(z*Y*4);if(nt.readPixels(q,J,z,Y,nt.RGBA,nt.UNSIGNED_BYTE,mt),mt[3]!==255){et._onLog&&et._onLog("DCE: WebGL drawing incorrect."),this._bWebGLSupported=!1;const m=new Error("WebGL error: incorrect WebGL drawing.");throw m.name="WebGLError",m}return et._onLog&&et._onLog("DCE: _drawImage() in WebGL end. Costs: "+(Date.now()-S)),{context:nt,pixelFormat:tt===vt.GREY?vt.GREY32:tt,_bUseWebGL:!0}}{et._onLog&&et._onLog("DCE: _drawImage() in context2d."),st.ctx2d||(st.ctx2d=st.getContext("2d",{willReadFrequently:!0}));const nt=st.ctx2d;if(!nt)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(st.width<q+z||st.height<J+Y)&&(st.width=q+z,st.height=J+Y),nt.drawImage(a,T,M,B,j,q,J,z,Y),et._onLog&&et._onLog("DCE: _drawImage() in context2d end. Costs: "+(Date.now()-S)),{context:nt,pixelFormat:vt.RGBA,_bUseWebGL:!1}}}_readCvsData(e,a,d){let p,v=0,b=0,C=e.canvas.width,S=e.canvas.height;if(a&&(a.x&&(v=a.x),a.y&&(b=a.y),a.width&&(C=a.width),a.height&&(S=a.height)),e instanceof WebGLRenderingContext){const T=e;if(d){if(d.length<C*S*4)throw new Error("Unexpected size of the 'bufferContainer'.");T.readPixels(v,b,C,S,T.RGBA,T.UNSIGNED_BYTE,d),p=new Uint8Array(d.buffer,0,C*S*4)}else p=new Uint8Array(C*S*4),T.readPixels(v,b,C,S,T.RGBA,T.UNSIGNED_BYTE,p)}else if(e instanceof CanvasRenderingContext2D){let T;if(T=e.getImageData(v,b,C,S),p=new Uint8Array(T.data.buffer),d){if(d.length<p.length)throw new Error("Unexpected size of the 'bufferContainer'.");d.set(p)}}return p}_transformPixelFormat(e,a,d,p){let v,b;if(et._onLog&&(v=Date.now(),et._onLog("DCE: _transformPixelFormat(), START: "+v)),a===d)return et._onLog&&et._onLog("DCE: _transformPixelFormat() end. Costs: "+(Date.now()-v)),p?new Uint8Array(e):e;const C=[vt.RGBA,vt.RBGA,vt.GRBA,vt.GBRA,vt.BRGA,vt.BGRA];if(C.includes(a))if(d===vt.GREY){b=new Uint8Array(e.length/4);for(let S=0;S<e.length;S+=4){const T=.21*e[S]+.71*e[S+1]+.07*e[S+2];b[S/4]=T}}else if(d===vt.GREY32){b=p?new Uint8Array(e):e;for(let S=0;S<e.length;S+=4){const T=.21*e[S]+.71*e[S+1]+.07*e[S+2];b[S]=T,b[S+1]=T,b[S+2]=T}}else{if(!C.includes(d))throw new Error("Unable to transform.");if(p){b=new Uint8Array(e);const S=a.indexOf("r"),T=a.indexOf("g"),M=a.indexOf("b"),B=d.indexOf("r"),j=d.indexOf("g"),q=d.indexOf("b");for(let J=0;J<e.length;J+=4)b[J+B]=e[J+S],b[J+j]=e[J+T],b[J+q]=e[J+M]}else{b=e;const S=a.indexOf("r"),T=a.indexOf("g"),M=a.indexOf("b"),B=d.indexOf("r"),j=d.indexOf("g"),q=d.indexOf("b");for(let J=0;J<e.length;J+=4){let z=[e[J],e[J+1],e[J+2]];b[J+B]=z[S],b[J+j]=z[T],b[J+q]=z[M]}}}else if(a===vt.GREY){if(d!==vt.GREY32)throw new Error("Unable to transform.");b=new Uint8Array(4*e.length);for(let S=0;S<e.length;S++)b[4*S]=e[S],b[4*S+1]=e[S],b[4*S+2]=e[S],b[4*S+3]=255}else{if(a!==vt.GREY32)throw new Error("Unable to transform.");if(d!==vt.GREY)throw new Error("Unable to transform.");b=new Uint8Array(new Uint32Array(e.buffer))}return et._onLog&&et._onLog("DCE: _transformPixelFormat() end. Costs: "+(Date.now()-v)),b}_getImageData(e,a,d,p,v,b){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(!a||!d)return null;if(p.sx>a||p.sy>d||p.sx+p.sWidth>a||p.sy+p.sHeight>d)throw new Error("Invalid position.");if(e instanceof HTMLVideoElement&&e.readyState!==4||e instanceof HTMLImageElement&&!e.complete)throw new Error("The source is not loaded.");let C;et._onLog&&(C=Date.now(),et._onLog("DCE: _getImageData(), START: "+C));const S=Math.round(p.sx),T=Math.round(p.sy),M=Math.round(p.sWidth),B=Math.round(p.sHeight),j=Math.round(p.dWidth),q=Math.round(p.dHeight);let J=vt.RGBA;b&&b.pixelFormat&&(J=b.pixelFormat);let z,Y,tt,st=this._bWebGLSupported;b&&b.bUseWebGL==0&&(st=!1),st?(this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),z=this._reusedWebGLCvs):(this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),z=this._reusedCvs);try{if(st)if(et._onLog&&et._onLog("DCE: _getImageData() in WebGL."),v)if(J===vt.GREY){if(tt=new Uint8Array(j*q*4),Y=this._drawImage(z,e,a,d,{sx:S,sy:T,sWidth:M,sHeight:B,dWidth:j,dHeight:q},tt,{pixelFormat:J,bUseWebGL:st}),tt=this._transformPixelFormat(tt,Y.pixelFormat,J),v){if(v.length<tt.length)throw new Error("Unexpected size of the 'bufferContainer'.");v.set(tt)}}else Y=this._drawImage(z,e,a,d,{sx:S,sy:T,sWidth:M,sHeight:B,dWidth:j,dHeight:q},v,{pixelFormat:J,bUseWebGL:st}),tt=new Uint8Array(v.buffer,0,j*q*4),tt=this._transformPixelFormat(tt,Y.pixelFormat,J);else J===vt.GREY?((!this._tempDataContainer||this._tempDataContainer.length<j*q*4)&&(this._tempDataContainer=new Uint8Array(j*q*4)),tt=new Uint8Array(this._tempDataContainer.buffer,0,j*q*4)):tt=new Uint8Array(j*q*4),Y=this._drawImage(z,e,a,d,{sx:S,sy:T,sWidth:M,sHeight:B,dWidth:j,dHeight:q},tt,{pixelFormat:J,bUseWebGL:st}),tt=this._transformPixelFormat(tt,Y.pixelFormat,J);else if(et._onLog&&et._onLog("DCE: _getImageData() in context2d."),Y=this._drawImage(z,e,a,d,{sx:S,sy:T,sWidth:M,sHeight:B,dWidth:j,dHeight:q},null,{pixelFormat:vt.RGBA,bUseWebGL:st}),tt=this._readCvsData(Y.context,null,null),tt=this._transformPixelFormat(tt,Y.pixelFormat,J),v){if(v.length<tt.length)throw new Error("Unexpected size of the 'bufferContainer'.");v.set(tt)}}catch(nt){if(nt.name==="WebGLError")return et._onLog&&et._onLog("DCE: _getImageData() in WebGL failed, try again in context2d."),this.forceLoseContext(),this._bWebGLSupported=!1,this._getImageData(e,a,d,{sx:S,sy:T,sWidth:M,sHeight:B,dWidth:j,dHeight:q},v,b);throw nt}return et._onLog&&et._onLog("DCE: _getImageData() end. Costs: "+(Date.now()-C)),{data:tt,pixelFormat:J,_bUseWebGL:Y._bUseWebGL}}forceLoseContext(){if(!this._reusedWebGLCvs)return;const e=this._reusedWebGLCvs.ctxWebGL;e&&!e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").loseContext(),this._webGLTexture=null,this._webGLProgramInfo=null,this._webGLBuffers=null,this._reusedWebGLCvs=null}_getVideoData(e,a){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(this._assertOpen(),this.singleFrameMode)throw new Error("'_getVideoData()' is unavailable in singleFrameMode.");if(!this._video||this._video.readyState!==4)return null;const d=Date.now();et._onLog&&et._onLog("DCE: _getVideoData() START: "+d);let p=this._scanRegion;a&&a.hasOwnProperty("region")&&(p=a.region);let v=this.mapPixelFormatString_Enum.get(this.framePixelFormat.toLowerCase());a&&a.pixelFormat&&(v=this.mapPixelFormatString_Enum.get(a.pixelFormat.toLowerCase()));let b=this._softwareScale;a&&a.scale&&(b=a.scale);const C=this._video.videoWidth,S=this._video.videoHeight;let T=this._scaleCenter;if(a&&a.scaleCenter){if(typeof a.scaleCenter.x!="string"||typeof a.scaleCenter.y!="string")throw new Error("Invalid scale center.");let z=0,Y=0;if(a.scaleCenter.x.endsWith("px"))z=parseFloat(a.scaleCenter.x);else{if(!a.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");z=parseFloat(a.scaleCenter.x)/100*C}if(a.scaleCenter.y.endsWith("px"))Y=parseFloat(a.scaleCenter.y);else{if(!a.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");Y=parseFloat(a.scaleCenter.y)/100*S}if(z==NaN||Y==NaN)throw new Error("Invalid scale center.");T.x=Math.round(z),T.y=Math.round(Y)}if(C===0||S===0)return null;const M=this.getFrameSize(C,S,p,this.maxCvsSideLength);if(!M)return null;let B=!0;C===M.sWidth&&S===M.sHeight&&(B=!1);const j={data:null,region:p?JSON.parse(JSON.stringify(p)):null,sx:M.sx,sy:M.sy,width:M.dWidth,height:M.dHeight,colorMode:null,pixelFormat:null,timeSpent:null,timeStamp:null,isCropped:B,toCanvas:this._toCanvas,_sWidth:M.sWidth,_sHeight:M.sHeight,_bUseWebGL:null};b!==1&&(M.sWidth=Math.round(M.sWidth/b),M.sHeight=Math.round(M.sHeight/b),M.sx=Math.round((1-1/b)*T.x+M.sx/b),M.sy=Math.round((1-1/b)*T.y+M.sy/b));const q=this._getImageData(this._video,C,S,M,e,{pixelFormat:v});if(!q)return null;const J=Date.now();return et._onLog&&et._onLog("DCE: _getVideoData() END: "+J),j.data=q.data,j.pixelFormat=j.colorMode=q.pixelFormat,j._bUseWebGL=q._bUseWebGL,j.timeSpent=J-d,j.timeStamp=J,q.pixelFormat===vt.GREY?j.stride=j.width:j.stride=4*j.width,j}getCurrentRegion(){let e=null;if(this._scanRegion)e=this._scanRegion;else if(this.croppingRegions){if(this._croppingRegionIndex>=this.croppingRegions.length||this._croppingRegionIndex<0)throw new Error("The 'croppingRegionIndex' is out of bounds.");e=this.croppingRegions[this._croppingRegionIndex],this.bIncreaseRegionIndexAuto&&++this._croppingRegionIndex>=this.croppingRegions.length&&(this._croppingRegionIndex=0)}return e}_fetchingLoop(e){if(this.isDisposed&&this.disposed)return;if(!this._bOpen||!this.isFetchingLoopStarted())return void this.stopFetchingLoop();const a=()=>{et._onLog&&et._onLog("DCE: start fetching a frame into buffer: "+Date.now());const p=this.getCurrentRegion();let v=this._getVideoData(null,{region:p});if(!v)return void(et._onLog&&et._onLog("DCE: get a invalid frame, abandon it: "+Date.now()));for(;this._frameQueue&&this._frameQueue.length>=this.maxNumberOfFramesInBuffer;)this._frameQueue.shift();this._frameQueue.push(v),et._onLog&&et._onLog("DCE: finish fetching a frame into buffer: "+Date.now());const b=this.mapCameraEvents.get("frameaddedtobuffer");for(let C of b)C&&setTimeout(()=>{this.isDisposed&&this.disposed||C.apply(this)},0)},d=()=>{this.isDisposed&&this.disposed||(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this.refreshInterval<=0||(this._frameLoopTimeoutId2=setTimeout(()=>{this.isDisposed&&this.disposed||(this._bOpen&&this.isFetchingLoopStarted()?(et._onLog&&et._onLog("DCE: second timeout executes: "+Date.now()),a(),d()):this.stopFetchingLoop())},this.refreshInterval)))};e&&(this._frameQueue.length<this.maxNumberOfFramesInBuffer?(a(),this.refreshInterval>0&&d()):this.refreshInterval>0?(a(),d()):this.refreshInterval===0?a():this.refreshInterval),this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),this._frameLoopTimeoutId=setTimeout(()=>{this.isDisposed&&this.disposed||this._fetchingLoop(!0)},this.loopInterval)}startFetchingLoop(){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(this._assertOpen(),this.singleFrameMode)throw Error("'startFetchingLoop()' is unavailable in singleFrameMode.");this.isFetchingLoopStarted()||(this._bFetchingLoopStarted=!0,this._recordedStates.fetchingLoopStart=!0,et._onLog&&et._onLog("DCE: start fetching loop: "+Date.now()),this._fetchingLoop(!0))}isFetchingLoopStarted(){return this._bFetchingLoopStarted}stopFetchingLoop(){this._bFetchingLoopStarted&&(et._onLog&&et._onLog("DCE: stop fetching loop: "+Date.now()),this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),this._frameQueue.length=0,this._bFetchingLoopStarted=!1,this._recordedStates.fetchingLoopStart=!1)}getFrameFromBuffer(e){return this._frameQueue&&this._frameQueue.length?e?e<this._frameQueue.length?(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this._frameQueue.splice(e,1)[0]):void 0:(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this._frameQueue.pop()):null}clearFrameBuffer(){this._frameQueue&&(this._frameQueue.length=0)}_createDrawingLayerBaseCvs(){this._assertOpen();const e=this._calculateCvsSize();if(!e)throw new Error("Camera is not open.");const{width:a,height:d,objectFit:p}=e;if(a<=0||d<=0)throw new Error("Invalid dimension of video or image.");const v=document.createElement("canvas");if(v.width==a&&v.height==d||(v.width=a,v.height=d),v.style.objectFit=p,this._cvsScanRegion)this._cvsScanRegion.after(v);else if(this._cvsOriginalImage)this._cvsOriginalImage.after(v);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(v);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(v)}return v}_updateDrawingLayersSize(e){let a;if(a=e&&e.width&&e.height&&e.objectFit?{width:e.width,height:e.height,objectFit:e.objectFit}:this._calculateCvsSize(),!a)return;const{width:d,height:p,objectFit:v}=a;this._drawingLayersManager.setDimensions({width:d,height:p},{backstoreOnly:!0}),this._drawingLayersManager.setObjectFit(v)}_createDrawingLayer(e){this._layerBaseCvs||(this._layerBaseCvs=this._createDrawingLayerBaseCvs());const a=this._layerBaseCvs;return this._drawingLayersManager.createDrawingLayer(a,e)}deleteDrawingLayer(e){this._drawingLayersManager.deleteDrawingLayer(e),this._drawingLayersManager.getDrawingLayers().length||this._layerBaseCvs&&(this._layerBaseCvs.remove(),this._layerBaseCvs=null)}createDrawingLayer(){return this._createDrawingLayer()}getDrawingLayer(e){return this._drawingLayersManager.getDrawingLayer(e)||([1,2,3].includes(e)?this._createDrawingLayer(e):null)}getDrawingLayers(){return this._drawingLayersManager.getDrawingLayers().filter(e=>e.getId()>=0)}getSelectedDrawingItems(){return this._drawingLayersManager.getSelectedDrawingItems()}createDrawingStyle(e){return this._drawingLayersManager.createDrawingStyle(e)}getDrawingStyle(e){return this._drawingLayersManager.getDrawingStyle(e)}getDrawingStyles(){return this._drawingLayersManager.getDrawingStyles()}updateDrawingStyle(e,a){return this._drawingLayersManager.updateDrawingStyle(e,a)}clearDrawingLayers(){const e=this.getDrawingLayers();for(let a of e)this.deleteDrawingLayer(a.getId())}showTip(e,a,d,p,v=3e3,b=!0){this._assertOpen(),this._tipArgs.x=e,this._tipArgs.y=a,this._tipArgs.width=d,this._tipArgs.autoShowSuggestedTip=!!b,this._drawingLayerOfTip||(this._drawingLayerOfTip=this._createDrawingLayer(-1)),this._tipStyleId||(this._tipStyleId=this.createDrawingStyle({fillStyle:"#FFFFFF",paintMode:"fill",fontFamily:"Open Sans",fontSize:40})),this._drawingLayerOfTip.clearDrawingItems();const C=new wa(p||"",e,a,d,this._tipStyleId);C._fabricObject.paddingTop=15,C._fabricObject.calcTextHeight=function(){for(var S=0,T=0,M=this._textLines.length;T<M;T++)S+=this.getHeightOfLine(T);return S+=2*this.paddingTop},C._fabricObject._getTopOffset=function(){return-this.height/2+this.getHeightOfLine(0)*(1-1/this.lineHeight)/2+this.paddingTop},C.setAttribute("backgroundColor","rgba(50, 50, 52, .8)"),C.setAttribute("lineHeight",1.3),C.setAttribute("textAlign","center"),this._drawingLayerOfTip.addDrawingItem(C),this._hideTipTimeoutId&&clearTimeout(this._hideTipTimeoutId),this._tipArgs.duration=v===void 0?3e3:v,this._tipArgs.duration>0&&(this._hideTipTimeoutId=setTimeout(()=>{this.isDisposed&&this.disposed||this._hideTip()},this._tipArgs.duration))}_hideTip(){this._drawingLayerOfTip&&(this.deleteDrawingLayer(this._drawingLayerOfTip.getId()),this._drawingLayerOfTip=null,this._hideTipTimeoutId&&clearTimeout(this._hideTipTimeoutId))}hideTip(){this._hideTip(),this._tipArgs.x=null,this._tipArgs.y=null,this._tipArgs.width=null,this._tipArgs.autoShowSuggestedTip=null}updateTipMessage(e){if(!this._drawingLayerOfTip)throw new Error("The Tip is not showing.");this._drawingLayerOfTip.getDrawingItems()[0].setAttribute("text",e),this._drawingLayerOfTip.renderAll(),this._tipArgs.duration>0&&(this._hideTipTimeoutId&&clearTimeout(this._hideTipTimeoutId),this._hideTipTimeoutId=setTimeout(()=>{this.isDisposed&&this.disposed||this._hideTip()},this._tipArgs.duration))}suggestTip(e,a){this._tipArgs.autoShowSuggestedTip&&(this._drawingLayerOfTip?this.updateTipMessage(a):this._tipArgs.x!==void 0&&this.showTip(this._tipArgs.x,this._tipArgs.y,this._tipArgs.width,a,this._tipArgs.duration)),this.onTipSuggested&&setTimeout(()=>{this.isDisposed&&this.disposed||this.onTipSuggested.apply(this,[e,a])},0)}_createControler(){if(this._controler||(this._controler=new Sa(this)),this._controler)return this._controler}_destroyControler(){this._controler=null}setOriginalImage(e,a,d){if(!e||!a||!d)throw new Error("Invalid arguments");this._originalImageData={imageData:e,width:a,height:d};let p=this._cvsOriginalImage;p||(p=document.createElement("canvas"),p.style.position="absolute",p.style.width="100%",p.style.height="100%",p.style.left="0",p.style.top="0",p.style.backgroundColor="white",p.style.objectFit="contain",this._cvsOriginalImage=p),p.width===a&&p.height===d||(p.width=a,p.height=d);const v=p.getContext("2d");v.clearRect(0,0,p.width,p.height),e instanceof Uint8Array||e instanceof Uint8ClampedArray?(e instanceof Uint8Array&&(e=new Uint8ClampedArray(e.buffer)),v.putImageData(new ImageData(e,a,d),0,0)):e instanceof HTMLCanvasElement&&v.drawImage(e,0,0),document.body.contains(p)&&p.style.display===""&&this._updateDrawingLayersSize({width:a,height:d,objectFit:"contain"})}getOriginalImage(){return this._originalImageData?Object.assign({},this._originalImageData):null}async deleteOriginalImage(){await this.hideOriginalImage(),this._cvsOriginalImage&&(this._cvsOriginalImage.remove(),this._cvsOriginalImage=null),this._originalImageData=null}_showOriginalImageCvs(){this._cvsOriginalImage&&this._cvsOriginalImage.style.display=="none"&&(this._cvsOriginalImage.style.display="")}_hideOriginalImageCvs(){this._cvsOriginalImage&&(this._cvsOriginalImage.style.display="none")}showOriginalImage(){if(!this._originalImageData)throw new Error("No original image is set.");const e=this._cvsOriginalImage;if(e.style.display===""&&document.body.contains(e))return;const{width:a,height:d}=this._originalImageData;if(this._updateDrawingLayersSize({width:a,height:d,objectFit:"contain"}),this._bOpen&&(this._video&&!this._video.paused&&this._video.pause(),this._bFetchingLoopStarted&&(this.stopFetchingLoop(),this._recordedStates.fetchingLoopStart=!0),this.ifShowScanRegionMask&&this._cvsScanRegion&&(this._cvsScanRegion.style.display="none"),this.ifShowScanRegionLaser&&this._divScanLight&&(this._divScanLight.style.display="none"),this._cvsViewDecorator&&(this._cvsViewDecorator.style.display="none"),this._scanRegionOverlayContainer&&(this._scanRegionOverlayContainer.style.display="none"),this._selCam&&(this._selCam.parentElement.style.display="none")),!document.body.contains(e))if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(e);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(e)}this._showOriginalImageCvs()}async _hideOriginalImage(e){this._originalImageData&&this._cvsOriginalImage&&this._cvsOriginalImage.style.display!=="none"&&(this._updateDrawingLayersSize(),this._bOpen&&e&&(this._video&&this._recordedStates.videoPlaying&&await this.play(null,null,null,{notTriggerSingleFrameClick:!0}),this._recordedStates.fetchingLoopStart&&!this.singleFrameMode&&this.startFetchingLoop(),this.ifShowScanRegionMask&&this._cvsScanRegion&&this._recordedStates.maskShow&&this.showScanRegionMask(),this.ifShowScanRegionLaser&&this._divScanLight&&this._recordedStates.laserShow&&this.showScanRegionLaser(),this._cvsViewDecorator&&this._recordedStates.decoratorShow&&this.showViewDecorator(),this._scanRegionOverlayContainer&&this._recordedStates.overlayShow&&this.showScanRegionOverlays()),this._selCam&&(this._selCam.parentElement.style.display=""),this._hideOriginalImageCvs())}async hideOriginalImage(){return this._hideOriginalImage(!0)}transformCoord(e){if(!this.isOpen())throw new Error("Unavailable when the camera is not open.");if(this.singleFrameMode&&!this._cvsSingleFrameMode)throw new Error("No image is selected. ");const a=this._elContainer.getBoundingClientRect();let d,p,v,b,C,S=a.left,T=a.top,M=S+window.scrollX,B=T+window.scrollY;this.singleFrameMode?(d=this._cvsSingleFrameMode.width,p=this._cvsSingleFrameMode.height,v=parseFloat(window.getComputedStyle(this._cvsSingleFrameMode).width),b=parseFloat(window.getComputedStyle(this._cvsSingleFrameMode).height),C="contain"):(d=this.video.videoWidth,p=this.video.videoHeight,v=parseFloat(window.getComputedStyle(this._elContainer).width),b=parseFloat(window.getComputedStyle(this._elContainer).height),C=this.videoFit);const j=v/b,q=d/p;let J,z,Y,tt,st=1;if(C==="contain")j<q?(st=v/d,J=S+e.x*st,z=T+e.y*st+(b-p*st)/2,Y=M+e.x*st,tt=B+e.y*st+(b-p*st)/2):(st=b/p,J=S+e.x*st+(v-d*st)/2,z=T+e.y*st,Y=M+e.x*st+(v-d*st)/2,tt=B+e.y*st);else if(C==="cover")if(j<q){st=b/p;let nt=e.x*st-(d*st-v)/2;nt=Math.max(nt,0),nt=Math.min(nt,v),J=S+nt,z=T+e.y*st,Y=M+nt,tt=B+e.y*st}else{st=v/d;let nt=e.y*st-(p*st-b)/2;nt=Math.max(nt,0),nt=Math.min(nt,b),J=S+e.x*st,z=T+nt,Y=M+e.x*st,tt=B+nt}return{clientX:Math.round(J),clientY:Math.round(z),pageX:Math.round(Y),pageY:Math.round(tt)}}convertToPageCoordinates(e){const a=this.transformCoord(e);return{x:a.pageX,y:a.pageY}}convertToClientCoordinates(e){const a=this.transformCoord(e);return{x:a.clientX,y:a.clientY}}dispose(e){this.UIElement&&(this._uiOriginalState&&this._uiOriginalState.inDom?this.UIElement.style.display=this._uiOriginalState.display:this.UIElement.style.display="none"),this.clearDrawingLayers(),this.close(),this.forceLoseContext(),this.setViewDecorator(null,null),this._scanRegionOverlayContainer&&this._scanRegionOverlayContainer.remove(),this._arrScanRegionOverlays.length=0,e&&this.UIElement&&this.UIElement.remove(),this.__proto__=null;for(let a in this)delete this[a];Object.defineProperty(this,"isCameraEnhancer",{value:!0}),Object.defineProperty(this,"isDisposed",{value:!0}),Object.defineProperty(this,"disposed",{value:!0})}}et._jsVersion="3.3.4",et._jsEditVersion="20230414",et._version="JS "+et._jsVersion+"."+et._jsEditVersion,et.browserInfo=Mt,et._hasEngineResourceLoaded=!1,et._engineResourcePath=ba,et._defaultUIElementURL="@engineResourcePath/dce.ui.html";const Ta=(u,e)=>{const a=u.__vccOpts||u;for(const[d,p]of e)a[d]=p;return a},Oa={id:"enhancerUIContainer",style:{height:"100vh",width:"100vw"}},Ea={mounted(){let u=null;(async()=>(u=await et.createInstance(),await u.setUIElement("src/assets/dce.ui.html"),document.getElementById("enhancerUIContainer").appendChild(u.getUIElement()),await u.open()))(),document.getElementById("capture").onclick=()=>{if(u){let e=u.getFrame(),a=screen.availWidth,d=screen.availHeight,p=640,v=640,b=(a-p)/2,C=(d-v)/2;popWindow=window.open("","popup","width="+p+",height="+v+",top="+C+",left="+b+", scrollbars=yes"),popWindow.document.body.appendChild(e.canvas)}}}},Ma=Object.assign(Ea,{__name:"HelloWorld",props:{msg:String},setup(u){return Ds(0),(e,a)=>(Mn(),Io("div",Oa))}}),Da=Ta(Ma,[["__scopeId","data-v-334bfdf2"]]),Ia={__name:"App",setup(u){return(e,a)=>(Mn(),Fo(Da))}};ga(Ia).mount("#app");
